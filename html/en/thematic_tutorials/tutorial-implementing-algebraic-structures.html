<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="How to call a C code (or a compiled library) from Sage ?" href="cython_interface.html" /><link rel="prev" title="How to implement new algebraic structures in Sage" href="coercion_and_categories.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Tutorial: Implementing Algebraic Structures - Thematic Tutorials</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Thematic Tutorials</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 10.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="index.html">Home - Thematic Tutorials</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="toctree.html">Thematic tutorial document tree</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="algebraic_combinatorics.html">Algebraic Combinatorics in Sage</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="algebraic_combinatorics/walks.html">Walks in graphs</a></li>
<li class="toctree-l3"><a class="reference internal" href="algebraic_combinatorics/n_cube.html"><span class="math notranslate nohighlight">\(n\)</span>-Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="algebraic_combinatorics/tsetlin_library.html">The Tsetlin library</a></li>
<li class="toctree-l3"><a class="reference internal" href="algebraic_combinatorics/rsk.html">Young’s lattice and the RSK algorithm</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="sandpile.html">Abelian Sandpile Model</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="group_theory.html">Group Theory and Sage</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="lie.html">Lie Methods and Related Combinatorics in Sage</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="lie/introduction.html">The Scope of this Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/lie_basics.html">Lie Group Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/weyl_character_ring.html">The Weyl Character Ring</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/branching_rules.html">Maximal Subgroups and Branching Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/weyl_groups.html">Weyl Groups, Coxeter Groups and the Bruhat Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/crystals.html">Classical Crystals</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/affine.html">Affine Root System Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/integrable.html">Integrable Highest Weight Representations of Affine Lie algebras</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/affine_finite_crystals.html">Affine Finite Crystals</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/affine_hw_crystals.html">Affine Highest Weight Crystals</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/elementary_crystals.html">Elementary crystals</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/infinity_crystals.html">Infinity Crystals</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/iwahori_hecke_algebra.html">Iwahori Hecke Algebras</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/kazhdan_lusztig_polynomials.html">Kazhdan-Lusztig Polynomials</a></li>
<li class="toctree-l3"><a class="reference internal" href="lie/bibliography.html">Bibliography</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="vector_calculus.html">Tutorial: Vector Calculus in Euclidean Spaces</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="vector_calculus/vector_calc_cartesian.html">How to compute a gradient, a divergence or a curl</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_calculus/vector_calc_curvilinear.html">How to perform vector calculus in curvilinear coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_calculus/vector_calc_change.html">How to change coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_calculus/vector_calc_advanced.html">Advanced aspects: the Euclidean space as a Riemannian manifold</a></li>
<li class="toctree-l3"><a class="reference internal" href="vector_calculus/vector_calc_plane.html">Vector calculus in the Euclidean plane</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="linear_programming.html">Linear Programming (Mixed Integer)</a></li>
<li class="toctree-l2"><a class="reference internal" href="numtheory_rsa.html">Number Theory and the RSA Public Key Cryptosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding_theory.html">Coding Theory in Sage</a></li>
<li class="toctree-l2"><a class="reference internal" href="structures_in_coding_theory.html">How to write your own classes for coding theory</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="geometry.html">Polyhedra</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="geometry/polyhedra_quicktutorial.html">A Brief Introduction to Polytopes in Sage</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry/polyhedra_tutorial.html">A Longer Introduction to Polyhedral Computations in Sage</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry/polyhedra_quickref.html">Quick reference for polyhedra in Sage</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry/tips.html">Polyhedra tips and tricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry/visualization.html">Visualization of polyhedron objects in Sage</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry/polytope_tikz.html">Draw polytopes in LaTeX using TikZ</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="steenrod_algebra_modules.html">Steenrod Algebra Modules</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-programming-python.html">Tutorial: Programming in Python and Sage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-comprehensions.html">Tutorial: Comprehensions, Iterators, and Iterables</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-objects-and-classes.html">Tutorial: Objects and Classes in Python and Sage</a></li>
<li class="toctree-l2"><a class="reference internal" href="functional_programming.html">Functional Programming for Mathematicians</a></li>
<li class="toctree-l2"><a class="reference internal" href="coercion_and_categories.html">How to implement new algebraic structures in Sage</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Tutorial: Implementing Algebraic Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="cython_interface.html">How to call a C code (or a compiled library) from Sage ?</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="numerical_sage/index.html">Numerical Computing with Sage</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="numerical_sage/numerical_tools.html">Numerical Tools</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/numpy.html">NumPy</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/scipy.html">SciPy</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/cvxopt.html">Cvxopt</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="numerical_sage/using_compiled_code_iteractively.html">Using Compiled Code Interactively</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/f2py.html">f2py</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/f2py_examples.html">More Interesting Examples with f2py</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/ctypes.html">Ctypes</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/ctypes_examples.html">More complicated ctypes example</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/comparison_to_cython.html">Comparison to Cython/Pyrex</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="numerical_sage/parallel_computation.html">Parallel Computation</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/mpi4py.html">mpi4py</a></li>
<li class="toctree-l4"><a class="reference internal" href="numerical_sage/parallel_laplace_solver.html">Parallel Laplace Solver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="explicit_methods_in_number_theory/index.html">Three Lectures about Explicit Methods in Number Theory Using Sage</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="explicit_methods_in_number_theory/introduction.html">Introduction</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="explicit_methods_in_number_theory/number_fields.html">Number Fields</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/nf_introduction.html">Introduction to Number Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/nf_galois_groups.html">Number Fields: Galois Groups and Class Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/nf_orders.html">Orders and Relative Extensions</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="explicit_methods_in_number_theory/birds_eye_view.html">A Bird’s Eye View</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/integer_factorization.html">Integer Factorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/elliptic_curves.html">Elliptic Curves</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/birds_other.html">The Matrix of Frobenius on Hyperelliptic Curves</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/birds_other.html#modular-symbols">Modular Symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/birds_other.html#enumerating-totally-real-number-fields">Enumerating Totally Real Number Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/birds_other.html#bernoulli-numbers">Bernoulli Numbers</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/birds_other.html#polynomial-arithmetic">Polynomial Arithmetic</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="explicit_methods_in_number_theory/modular_forms.html">Modular Forms</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/modular_forms_and_hecke_operators.html">Modular Forms and Hecke Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/modular_symbols.html">Modular Symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/method_of_graphs.html">Method of Graphs</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/level_one_forms.html">Level One Modular Forms</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/half_integral.html">Half Integral Weight Forms</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/generators_for_rings.html">Generators for Rings of Modular Forms</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/l_series.html"><span class="math notranslate nohighlight">\(L\)</span>-series</a></li>
<li class="toctree-l4"><a class="reference internal" href="explicit_methods_in_number_theory/modabvar.html">Modular Abelian Varieties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling in Sage</a></li>
<li class="toctree-l2"><a class="reference internal" href="sws2rst.html">Creating a Tutorial from an old Sage Worksheet (.sws)</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="tutorial-implementing-algebraic-structures">
<span id="id1"></span><h1>Tutorial: Implementing Algebraic Structures<a class="headerlink" href="#tutorial-implementing-algebraic-structures" title="Permalink to this heading">#</a></h1>
<p><em>Author: Nicolas M. Thiéry &lt;nthiery at users.sf.net&gt;,
Jason Bandlow &lt;<a class="reference external" href="mailto:jbandlow&#37;&#52;&#48;gmail&#46;com">jbandlow<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt; et al.</em></p>
<p>This tutorial will cover four concepts:</p>
<ul class="simple">
<li><p>endowing free modules and vector spaces with additional algebraic structure</p></li>
<li><p>defining morphisms</p></li>
<li><p>defining coercions and conversions</p></li>
<li><p>implementing algebraic structures with several realizations</p></li>
</ul>
<p>At the end of this tutorial, the reader should be able to reimplement
by himself the example of algebra with several realizations:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">Sets</span><span class="p">()</span><span class="o">.</span><span class="n">WithRealizations</span><span class="p">()</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
<span class="go">The subset algebra of {1, 2, 3} over Rational Field</span>
</pre></div>
</div>
<p>Namely, we consider an algebra <span class="math notranslate nohighlight">\(A(S)\)</span> whose basis is indexed by the
subsets <span class="math notranslate nohighlight">\(s\)</span> of a given set <span class="math notranslate nohighlight">\(S\)</span>. <span class="math notranslate nohighlight">\(A(S)\)</span> is endowed with three natural
basis: <code class="docutils literal notranslate"><span class="pre">F</span></code>, <code class="docutils literal notranslate"><span class="pre">In</span></code>, <code class="docutils literal notranslate"><span class="pre">Out</span></code>; in the first basis, the product is
given by the union of the indexing sets. The <code class="docutils literal notranslate"><span class="pre">In</span></code> basis and <code class="docutils literal notranslate"><span class="pre">Out</span></code>
basis are defined respectively by:</p>
<blockquote>
<div><div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[In_s  = \sum_{t\subset s} F_t \qquad
F_s   = \sum_{t\supset s} Out_t\]</div>
</div>
</div></blockquote>
<p>Each such basis gives a realization of <span class="math notranslate nohighlight">\(A\)</span>, where the elements are
represented by their expansion in this basis. In the running exercises
we will progressively implement this algebra and its three
realizations, with coercions and mixed arithmetic between them.</p>
<p>This tutorial heavily depends on <a class="reference external" href="../reference/modules/sage/modules/tutorial_free_modules.html#sage-modules-tutorial-free-modules" title="(in Modules v10.1)"><span>Tutorial: Using free modules and vector spaces</span></a>.
You may also want to read the less specialized thematic tutorial
<a class="reference internal" href="coercion_and_categories.html#coercion-and-categories"><span class="std std-ref">How to implement new algebraic structures</span></a>.</p>
<section id="subclassing-free-modules-and-including-category-information">
<h2>Subclassing free modules and including category information<a class="headerlink" href="#subclassing-free-modules-and-including-category-information" title="Permalink to this heading">#</a></h2>
<p>As a warm-up, we implement the group algebra of the additive group
<span class="math notranslate nohighlight">\(\ZZ/5\ZZ\)</span>. Of course this is solely for pedagogical purposes; group
algebras are already implemented (see <code class="docutils literal notranslate"><span class="pre">ZMod(5).algebra(ZZ)</span></code>). Recall
that a fully functional <span class="math notranslate nohighlight">\(\ZZ\)</span>-module over this group can be created
with the simple command:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">CombinatorialFreeModule</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">Zmod</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We reproduce the same, but by deriving a subclass of
<a class="reference external" href="../reference/combinat/sage/combinat/free_module.html#sage.combinat.free_module.CombinatorialFreeModule" title="(in Combinatorics v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialFreeModule</span></code></a>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">MyCyclicGroupModule</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="sd">&quot;&quot;&quot;An absolutely minimal implementation of a module whose basis is a cyclic group&quot;&quot;&quot;</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">MyCyclicGroupModule</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="c1"># or 4 or 5 or 11     ...</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">basis</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">A</span><span class="o">.</span><span class="n">an_element</span><span class="p">()</span>
<span class="go">2*a[0] + 2*a[1] + 3*a[2]</span>
</pre></div>
</div>
<p>We now want to endow <span class="math notranslate nohighlight">\(A\)</span> with its natural product structure, to get
the desired group algebra. To define a multiplication, we should be in
a category where multiplication makes sense, which is not yet the
case:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span><span class="o">.</span><span class="n">category</span><span class="p">()</span>
<span class="go">Category of finite dimensional vector spaces with basis over Rational Field</span>
</pre></div>
</div>
<p>We can look at the available <a class="reference external" href="../reference/categories/sage/categories/category.html">Categories</a>
from the documentation in the reference manual or we can use introspection to
look through the list of categories to pick one we want:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">categories</span><span class="o">.&lt;</span><span class="n">tab</span><span class="o">&gt;</span>                   <span class="c1"># not tested</span>
</pre></div>
</div>
<p>Once we have chosen an appropriate category (here
<a class="reference external" href="../reference/categories/sage/categories/algebras_with_basis.html#sage.categories.algebras_with_basis.AlgebrasWithBasis" title="(in Category Framework v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlgebrasWithBasis</span></code></a>), one can look at one example:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">AlgebrasWithBasis</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">example</span><span class="p">();</span> <span class="n">E</span>
<span class="go">An example of an algebra with basis: the free algebra on the generators (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;) over Rational Field</span>
<span class="gp">sage: </span><span class="n">e</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">an_element</span><span class="p">();</span> <span class="n">e</span>
<span class="go">B[word: ] + 2*B[word: a] + 3*B[word: b] + B[word: bab]</span>
</pre></div>
</div>
<p>and browse through its code:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span><span class="err">??</span>                                     <span class="c1"># not tested</span>
</pre></div>
</div>
<p>This code is meant as a template for implementing a
new algebra. In particular, this template suggests that we need to implement the
methods <code class="docutils literal notranslate"><span class="pre">product_on_basis</span></code>, <code class="docutils literal notranslate"><span class="pre">one_basis</span></code>, <code class="docutils literal notranslate"><span class="pre">_repr_</span></code> and
<code class="docutils literal notranslate"><span class="pre">algebra_generators</span></code>. Another way to get this list of methods is to
ask the category (TODO: find a slicker idiom for this):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.abstract_method</span> <span class="kn">import</span> <span class="n">abstract_methods_of_class</span>
<span class="gp">sage: </span><span class="n">abstract_methods_of_class</span><span class="p">(</span><span class="n">AlgebrasWithBasis</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">element_class</span><span class="p">)</span>
<span class="go">{&#39;optional&#39;: [&#39;_add_&#39;, &#39;_mul_&#39;],</span>
<span class="go"> &#39;required&#39;: [&#39;__bool__&#39;, &#39;monomial_coefficients&#39;]}</span>
<span class="gp">sage: </span><span class="n">abstract_methods_of_class</span><span class="p">(</span><span class="n">AlgebrasWithBasis</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">parent_class</span><span class="p">)</span>
<span class="go">{&#39;optional&#39;: [&#39;one_basis&#39;, &#39;product_on_basis&#39;], &#39;required&#39;: [&#39;__contains__&#39;]}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The result above is not yet necessarily complete; many required
methods in the categories are not yet marked as
<code class="xref py py-func docutils literal notranslate"><span class="pre">abstract_methods()</span></code>. We also recommend browsing the
documentation of this category: <a class="reference external" href="../reference/categories/sage/categories/algebras_with_basis.html#sage.categories.algebras_with_basis.AlgebrasWithBasis" title="(in Category Framework v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlgebrasWithBasis</span></code></a>.</p>
</div>
<p>Adding these methods, here is the minimal implementation of the group algebra:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">MyCyclicGroupAlgebra</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">):</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="p">,</span>
<span class="gp">....: </span>            <span class="n">category</span><span class="o">=</span><span class="n">AlgebrasWithBasis</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">product_on_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">monomial</span><span class="p">(</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span> <span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">one_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">algebra_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">Family</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">monomial</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">_repr_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="s2">&quot;Jason&#39;s group algebra of </span><span class="si">%s</span><span class="s2"> over </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ring</span><span class="p">())</span>
</pre></div>
</div>
<p>Some notes about this implementation:</p>
<ul>
<li><p>Alternatively, we could have defined <code class="docutils literal notranslate"><span class="pre">product</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">product_on_basis</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">....: </span>    <span class="c1"># def product(self, left, right):</span>
<span class="gp">....: </span>    <span class="c1">#     return ## something ##</span>
</pre></div>
</div>
</li>
<li><p>For the sake of readability in this tutorial, we have stripped out
all the documentation strings. Of course all of those should be
present as in <code class="docutils literal notranslate"><span class="pre">E</span></code>.</p></li>
<li><p>The purpose of <code class="docutils literal notranslate"><span class="pre">**keywords</span></code> is to pass down options like
<code class="docutils literal notranslate"><span class="pre">prefix</span></code> to <code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialFreeModules</span></code>.</p></li>
</ul>
<p>Let us do some calculations:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">MyCyclicGroupAlgebra</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="c1"># or 4 or 5 or 11     ...</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">basis</span><span class="p">();</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">an_element</span><span class="p">();</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">,</span> <span class="n">f</span>
<span class="go">(Jason&#39;s group algebra of Ring of integers modulo 2 over Rational Field, 2*a[0] + 2*a[1])</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">*</span> <span class="n">f</span>
<span class="go">8*a[0] + 8*a[1]</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.&lt;</span><span class="n">tab</span><span class="o">&gt;</span>                                 <span class="c1"># not tested</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.</span><span class="n">is_idempotent</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">A</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="go">a[0]</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">algebra_generators</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="c1"># Typically x,y,    ... = A.algebra_generators()</span>
<span class="gp">sage: </span><span class="p">[</span><span class="n">x</span><span class="o">^</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="go">[a[0], a[1], a[0], a[1]]</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="n">g</span><span class="p">)</span><span class="o">*</span><span class="n">f</span> <span class="o">==</span> <span class="n">f</span><span class="o">*</span><span class="n">f</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">f</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This seems to work fine, but we would like to put more stress on our
implementation to shake potential bugs out of it. To this end, we will
use <a class="reference external" href="../reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Utilities v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestSuite</span></code></a>, a tool that performs many routine tests
on our algebra for us.</p>
<p>Since we defined the class interactively, instead of in a Python
module, those tests will complain about “pickling”. We can silence this
error by making sage think that the class is defined in a module. We could also
just ignore those failing tests for now or call <a class="reference external" href="../reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Utilities v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestSuite</span></code></a> with the
argument <span class="math notranslate nohighlight">\(skip='_test_pickling')\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">MyCyclicGroupAlgebra</span> <span class="o">=</span> <span class="n">MyCyclicGroupAlgebra</span>
</pre></div>
</div>
<p>Ok, let’s run the tests:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">TestSuite</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">running ._test_additive_associativity() . . . pass</span>
<span class="go">running ._test_an_element() . . . pass</span>
<span class="go">running ._test_associativity() . . . pass</span>
<span class="go">running ._test_cardinality() . . . pass</span>
<span class="go">running ._test_category() . . . pass</span>
<span class="go">running ._test_characteristic() . . . pass</span>
<span class="go">running ._test_construction() . . . pass</span>
<span class="go">running ._test_distributivity() . . . pass</span>
<span class="go">running ._test_elements() . . .</span>
<span class="go">  Running the test suite of self.an_element()</span>
<span class="go">  running ._test_category() . . . pass</span>
<span class="go">  running ._test_eq() . . . pass</span>
<span class="go">  running ._test_new() . . . pass</span>
<span class="go">  running ._test_nonzero_equal() . . . pass</span>
<span class="go">  running ._test_not_implemented_methods() . . . pass</span>
<span class="go">  running ._test_pickling() . . . pass</span>
<span class="go">  pass</span>
<span class="go">running ._test_elements_eq_reflexive() . . . pass</span>
<span class="go">running ._test_elements_eq_symmetric() . . . pass</span>
<span class="go">running ._test_elements_eq_transitive() . . . pass</span>
<span class="go">running ._test_elements_neq() . . . pass</span>
<span class="go">running ._test_eq() . . . pass</span>
<span class="go">running ._test_new() . . . pass</span>
<span class="go">running ._test_not_implemented_methods() . . . pass</span>
<span class="go">running ._test_one() . . . pass</span>
<span class="go">running ._test_pickling() . . . pass</span>
<span class="go">running ._test_prod() . . . pass</span>
<span class="go">running ._test_some_elements() . . . pass</span>
<span class="go">running ._test_zero() . . . pass</span>
</pre></div>
</div>
<p>For more information on categories, see <a class="reference external" href="../reference/categories/sage/categories/primer.html#sage-categories-primer" title="(in Category Framework v10.1)"><span>Elements, parents, and categories in Sage: a primer</span></a>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">primer</span><span class="err">?</span>                 <span class="c1"># not tested</span>
</pre></div>
</div>
<section id="review">
<h3>Review<a class="headerlink" href="#review" title="Permalink to this heading">#</a></h3>
<p>We wanted to implement an algebra, so we:</p>
<ol class="arabic simple">
<li><p>Created the underlying vector space using <a class="reference external" href="../reference/combinat/sage/combinat/free_module.html#sage.combinat.free_module.CombinatorialFreeModule" title="(in Combinatorics v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinatorialFreeModule</span></code></a></p></li>
<li><p>Looked at <code class="docutils literal notranslate"><span class="pre">sage.categories.&lt;tab&gt;</span></code> to find an appropriate category</p></li>
<li><p>Loaded an example of that category, and used <a class="reference external" href="../reference/misc/sage/misc/abstract_method.html#sage.misc.abstract_method.abstract_methods_of_class" title="(in Utilities v10.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">sage.misc.abstract_method.abstract_methods_of_class()</span></code></a>, to see what methods we needed to write</p></li>
<li><p>Added the category information and other necessary methods to our class</p></li>
<li><p>Ran <a class="reference external" href="../reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Utilities v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestSuite</span></code></a> to catch potential discrepancies</p></li>
</ol>
</section>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p>Make a tiny modification to <code class="docutils literal notranslate"><span class="pre">product_on_basis</span></code> in
“MyCyclicGroupAlgebra” to implement the <em>dual</em> of the group algebra
of the cyclic group instead of its group algebra (so the product is now given by
<span class="math notranslate nohighlight">\(b_fb_g=\delta_{f,g}bf\)</span>).</p>
<p>Run the <a class="reference external" href="../reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Utilities v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestSuite</span></code></a> tests (you may ignore the “pickling”
errors). What do you notice?</p>
<p>Fix the implementation of <code class="docutils literal notranslate"><span class="pre">one</span></code> and check that the <a class="reference external" href="../reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Utilities v10.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestSuite</span></code></a> tests now pass.</p>
<p>Add the Hopf algebra structure. Hint: look at the example:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">HopfAlgebrasWithBasis</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Given a set <span class="math notranslate nohighlight">\(S\)</span>, say:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">Set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>and a base ring, say:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">QQ</span>
</pre></div>
</div>
<p>implement an <span class="math notranslate nohighlight">\(R\)</span>-algebra:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">F</span> <span class="o">=</span> <span class="n">SubsetAlgebraOnFundamentalBasis</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>   <span class="c1"># todo: not implemented</span>
</pre></div>
</div>
<p>with a basis <code class="docutils literal notranslate"><span class="pre">(b_s)_{s\subset</span> <span class="pre">S}</span></code> indexed by the subsets of <code class="docutils literal notranslate"><span class="pre">S</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">Subsets</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="go">Subsets of {1, 2, 3, 4, 5}</span>
</pre></div>
</div>
<p>and where the product is defined by <span class="math notranslate nohighlight">\(b_s b_t = b_{s\cup t}\)</span>.</p>
</li>
</ol>
</section>
</section>
<section id="morphisms">
<h2>Morphisms<a class="headerlink" href="#morphisms" title="Permalink to this heading">#</a></h2>
<p>To better understand relationships between algebraic spaces, one wants
to consider morphisms between them:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span><span class="o">.</span><span class="n">module_morphism</span><span class="err">?</span>                      <span class="c1"># not tested</span>
<span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">MyCyclicGroupAlgebra</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MyCyclicGroupAlgebra</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">,</span> <span class="n">B</span>
<span class="go">(Jason&#39;s group algebra of Ring of integers modulo 2 over Rational Field, Jason&#39;s group algebra of Ring of integers modulo 6 over Rational Field)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">func_on_basis</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="sd">    This function is the &#39;brain&#39; of a (linear) morphism</span>
<span class="gp">....: </span><span class="sd">    from A --&gt; B.</span>
<span class="gp">....: </span><span class="sd">    The input is the index of basis element of the domain (A).</span>
<span class="gp">....: </span><span class="sd">    The output is an element of the codomain (B).</span>
<span class="gp">....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="n">g</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">B</span><span class="o">.</span><span class="n">monomial</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="mi">6</span><span class="p">)(</span><span class="mi">3</span><span class="p">))</span><span class="c1"># g==1 in the range A</span>
<span class="gp">....: </span>    <span class="k">else</span><span class="p">:</span>    <span class="k">return</span> <span class="n">B</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</pre></div>
</div>
<p>We can now define a morphism that extends this function to <span class="math notranslate nohighlight">\(A\)</span> by
linearity:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">phi</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="n">func_on_basis</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="n">B</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">an_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">2*a[0] + 2*a[1]</span>
<span class="gp">sage: </span><span class="n">phi</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">2*b[0] + 2*b[3]</span>
</pre></div>
</div>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h3>
<p>Define a new free module <code class="docutils literal notranslate"><span class="pre">In</span></code> with basis indexed by the subsets of
<span class="math notranslate nohighlight">\(S\)</span>, and a morphism <code class="docutils literal notranslate"><span class="pre">phi</span></code> from <code class="docutils literal notranslate"><span class="pre">In</span></code> to <code class="docutils literal notranslate"><span class="pre">F</span></code> defined by</p>
<blockquote>
<div><div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\phi(In_s) = \sum_{t\subset s} F_t\]</div>
</div>
</div></blockquote>
</section>
</section>
<section id="diagonal-and-triangular-morphisms">
<h2>Diagonal and Triangular Morphisms<a class="headerlink" href="#diagonal-and-triangular-morphisms" title="Permalink to this heading">#</a></h2>
<p>We now illustrate how to specify that a given morphism is diagonal or triangular
with respect to some order on the basis, which means that the morphism is
invertible and <span class="math notranslate nohighlight">\(Sage\)</span> is able to compute the inverse morphism automatically.
Currently this feature requires the domain and codomain to have the same index
set (in progress …).</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">X</span> <span class="o">=</span> <span class="n">CombinatorialFreeModule</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">Partitions</span><span class="p">(),</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">);</span> <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">basis</span><span class="p">();</span>
<span class="gp">sage: </span><span class="n">Y</span> <span class="o">=</span> <span class="n">CombinatorialFreeModule</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">Partitions</span><span class="p">(),</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">basis</span><span class="p">();</span>
</pre></div>
</div>
<p>A diagonal module morphism takes as argument a function whose input is
the index of a basis element of the domain, and whose output is the
coefficient of the corresponding basis element of the codomain:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">diag_func</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
<span class="gp">....: </span>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">....:</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">diag_func</span><span class="p">(</span><span class="n">Partition</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="n">diagonal</span><span class="o">=</span><span class="n">diag_func</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">an_element</span><span class="p">();</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">2*x[[]] + 2*x[[1]] + 3*x[[2]]</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">2*y[[]] + 2*y[[1]] + 6*y[[2]]</span>
</pre></div>
</div>
<p>Python fun fact: <code class="docutils literal notranslate"><span class="pre">~</span></code> is the inversion operator (but be careful with
int’s!):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">~</span><span class="mi">2</span>
<span class="go">1/2</span>
<span class="gp">sage: </span><span class="o">~</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># in python this is the bitwise complement: ~x = -x-1</span>
<span class="go">-3</span>
</pre></div>
</div>
<p>Diagonal module morphisms are invertible:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">Y_to_X</span> <span class="o">=</span> <span class="o">~</span><span class="n">X_to_Y</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">3</span><span class="p">])]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">-2*y[[2, 1]] + y[[3]]</span>
<span class="gp">sage: </span><span class="n">Y_to_X</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">-x[[2, 1]] + 1/3*x[[3]]</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span><span class="p">(</span><span class="n">Y_to_X</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">-2*y[[2, 1]] + y[[3]]</span>
</pre></div>
</div>
<p>For triangular morphisms, just like ordinary morphisms, we need a
function that accepts as input the index of a basis element of the
domain and returns an element of the codomain.  We think of this
function as representing the columns of the matrix of the linear
transformation:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">triang_on_basis</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">Y</span><span class="o">.</span><span class="n">sum_of_monomials</span><span class="p">(</span><span class="n">mu</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">if</span> <span class="n">mu</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">triang_on_basis</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">y[[3, 2]] + y[[4, 1]] + y[[5]]</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="n">triang_on_basis</span><span class="p">,</span> <span class="n">triangular</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">unitriangular</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])];</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">x[[1, 1, 1]] + 2*x[[3, 2]]</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">X_to_Y</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">y[[1, 1, 1]] + y[[2, 1]] + y[[3]] + 2*y[[3, 2]] + 2*y[[4, 1]] + 2*y[[5]]</span>
</pre></div>
</div>
<p>Triangular module_morphisms are also invertible, even if <code class="docutils literal notranslate"><span class="pre">X</span></code> and
<code class="docutils literal notranslate"><span class="pre">Y</span></code> are both infinite-dimensional:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">Y_to_X</span> <span class="o">=</span> <span class="o">~</span><span class="n">X_to_Y</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">x[[1, 1, 1]] + 2*x[[3, 2]]</span>
<span class="gp">sage: </span><span class="n">Y_to_X</span><span class="p">(</span><span class="n">X_to_Y</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">x[[1, 1, 1]] + 2*x[[3, 2]]</span>
</pre></div>
</div>
<p>For details, see
<a class="reference external" href="../reference/categories/sage/categories/modules_with_basis.html#sage.categories.modules_with_basis.ModulesWithBasis.ParentMethods.module_morphism" title="(in Category Framework v10.1)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModulesWithBasis.ParentMethods.module_morphism()</span></code></a> (and also
<code class="xref py py-class docutils literal notranslate"><span class="pre">sage.categories.modules_with_basis.TriangularModuleMorphism</span></code>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span><span class="o">.</span><span class="n">module_morphism</span><span class="err">?</span>                      <span class="c1"># not tested</span>
</pre></div>
</div>
<section id="id2">
<h3>Exercise<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>Redefine the morphism <code class="docutils literal notranslate"><span class="pre">phi</span></code> from the previous exercise as a morphism that is
triangular with respect to inclusion of subsets and define the inverse morphism.
You may want to use the following comparison key as
<code class="docutils literal notranslate"><span class="pre">key</span></code> argument to <code class="docutils literal notranslate"><span class="pre">modules_morphism</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">subset_key</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="s2">    A comparison key on sets that gives a linear extension</span>
<span class="gp">....: </span><span class="s2">    of the inclusion order.</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="n">INPUT</span><span class="p">:</span>
<span class="gp">....:</span>
<span class="gp">....: </span>     <span class="o">-</span> <span class="err">``</span><span class="n">s</span><span class="err">``</span> <span class="o">--</span> <span class="nb">set</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="n">EXAMPLES</span><span class="p">::</span>
<span class="gp">....:</span>
<span class="gp">....: </span>        <span class="n">sage</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Subsets</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">key</span><span class="o">=</span><span class="n">subset_key</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="p">[{},</span> <span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}]</span>
<span class="gp">....: </span>    <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="s2">    return (len(s), list(s))</span>
</pre></div>
</div>
</section>
</section>
<section id="coercions">
<h2>Coercions<a class="headerlink" href="#coercions" title="Permalink to this heading">#</a></h2>
<p>Once we have defined a morphism from <span class="math notranslate nohighlight">\(X \to Y\)</span>, we can register it as
a coercion.  This will allow Sage to apply the morphism automatically
whenever we combine elements of <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> together. See
<a class="reference external" href="http://sagemath.com/doc/reference/coercion.html">http://sagemath.com/doc/reference/coercion.html</a> for more
information. As a training step, let us first define a morphism <span class="math notranslate nohighlight">\(X\)</span> to
<span class="math notranslate nohighlight">\(Y\)</span>, and register it as a coercion:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">triang_on_basis</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">Y</span><span class="o">.</span><span class="n">sum_of_monomials</span><span class="p">(</span><span class="n">mu</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">if</span> <span class="n">mu</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">triang_on_basis</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="go">y[[3, 2]] + y[[4, 1]] + y[[5]]</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="n">triang_on_basis</span><span class="p">,</span> <span class="n">triangular</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">unitriangular</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span><span class="o">.&lt;</span><span class="n">tab</span><span class="o">&gt;</span>                            <span class="c1"># not tested</span>
<span class="gp">sage: </span><span class="n">X_to_Y</span><span class="o">.</span><span class="n">register_as_coercion</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can not only convert elements from <span class="math notranslate nohighlight">\(X\)</span> to <span class="math notranslate nohighlight">\(Y\)</span>, but we can also do
mixed arithmetic with these elements:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">Y</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])])</span>
<span class="go">y[[3, 2]] + y[[4, 1]] + y[[5]]</span>
<span class="gp">sage: </span><span class="n">Y</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">Partition</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span>
<span class="go">2*y[[2, 2, 1]] + y[[3, 1, 1]] + y[[3, 2]] + y[[4, 1]] + y[[5]]</span>
</pre></div>
</div>
<section id="id3">
<h3>Exercise<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<p>Use the inverse of <code class="docutils literal notranslate"><span class="pre">phi</span></code> to implement the inverse coercion from
<code class="docutils literal notranslate"><span class="pre">F</span></code> to <code class="docutils literal notranslate"><span class="pre">In</span></code>. Reimplement <code class="docutils literal notranslate"><span class="pre">In</span></code> as an algebra, with a product
method making it use <code class="docutils literal notranslate"><span class="pre">phi</span></code> and its inverse.</p>
</section>
</section>
<section id="a-digression-new-bases-and-quotients-of-symmetric-functions">
<h2>A digression: new bases and quotients of symmetric functions<a class="headerlink" href="#a-digression-new-bases-and-quotients-of-symmetric-functions" title="Permalink to this heading">#</a></h2>
<p>As an application, we show how to combine what we have learned to
implement a new basis and a quotient of the algebra of symmetric
functions:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">SF</span> <span class="o">=</span> <span class="n">SymmetricFunctions</span><span class="p">(</span><span class="n">QQ</span><span class="p">);</span>  <span class="c1"># A graded Hopf algebra</span>
<span class="gp">sage: </span><span class="n">h</span>  <span class="o">=</span> <span class="n">SF</span><span class="o">.</span><span class="n">homogeneous</span><span class="p">()</span>         <span class="c1"># A particular basis, indexed by partitions (with some additional magic)</span>
</pre></div>
</div>
<p>So, <span class="math notranslate nohighlight">\(h\)</span> is a graded algebra whose basis is indexed by partitions. In more
detail, <code class="docutils literal notranslate"><span class="pre">h([i])</span></code> is the sum of all monomials of degree <span class="math notranslate nohighlight">\(i\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">h</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">x0^2 + x0*x1 + x1^2 + x0*x2 + x1*x2 + x2^2 + x0*x3 + x1*x3 + x2*x3 + x3^2</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">h(mu)</span> <span class="pre">=</span> <span class="pre">prod(</span> <span class="pre">h(p)</span> <span class="pre">for</span> <span class="pre">p</span> <span class="pre">in</span> <span class="pre">mu</span> <span class="pre">)</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">h</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">h</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">h</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">h</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">h</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Here we define a new basis <span class="math notranslate nohighlight">\((X_\lambda)_\lambda\)</span> by triangularity
with respect to <span class="math notranslate nohighlight">\(h\)</span>; namely, we set <span class="math notranslate nohighlight">\(X_\lambda = \sum_{\mu\geq \lambda, |\mu|=|\nu|} h_\mu\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">MySFBasis</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="sd">    Note: We would typically use SymmetricFunctionAlgebra_generic</span>
<span class="gp">....: </span><span class="sd">    for this. This is as an example only.</span>
<span class="gp">....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="sd">&quot;&quot;&quot; TODO: Informative doc-string and examples &quot;&quot;&quot;</span>
<span class="gp">....: </span>        <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Partitions</span><span class="p">(),</span> <span class="n">category</span><span class="o">=</span><span class="n">AlgebrasWithBasis</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_h</span> <span class="o">=</span> <span class="n">SymmetricFunctions</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">homogeneous</span><span class="p">()</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_to_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_h_on_basis</span><span class="p">,</span> <span class="n">triangular</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">unitriangular</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_from_h</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_h</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_to_h</span><span class="o">.</span><span class="n">register_as_coercion</span><span class="p">()</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_from_h</span><span class="o">.</span><span class="n">register_as_coercion</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">_to_h_on_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">la</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="o">.</span><span class="n">sum_of_monomials</span><span class="p">(</span><span class="n">mu</span> <span class="k">for</span> <span class="n">mu</span> <span class="ow">in</span> <span class="n">Partitions</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">la</span><span class="p">))</span> <span class="k">if</span> <span class="n">mu</span> <span class="o">&gt;=</span> <span class="n">la</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">_repr_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="s2">&quot;Jason&#39;s basis for symmetric functions over </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">self</span>.base_ring()
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="nd">@cached_method</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">one_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Returns the index of the basis element that is equal to &#39;1&#39;.&quot;&quot;&quot;</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">Partition</span><span class="p">([])</span>
<span class="gp">sage: </span><span class="n">X</span> <span class="o">=</span> <span class="n">MySFBasis</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">);</span> <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">basis</span><span class="p">();</span> <span class="n">h</span> <span class="o">=</span> <span class="n">SymmetricFunctions</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">homogeneous</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">h</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>  <span class="c1"># Note the capital X</span>
<span class="gp">sage: </span><span class="n">f</span>
<span class="go">x[[2, 1, 1]] - 3*x[[2, 2]] + 2*x[[3, 1]]</span>
<span class="gp">sage: </span><span class="n">h</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">h[2, 1, 1] - 2*h[2, 2]</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">f</span>
<span class="go">x[[2, 2, 2, 1, 1, 1, 1, 1, 1]] - 7*x[[2, 2, 2, 2, 1, 1, 1, 1]] + 18*x[[2, 2, 2, 2, 2, 1, 1]]</span>
<span class="go">- 20*x[[2, 2, 2, 2, 2, 2]] + 8*x[[3, 1, 1, 1, 1, 1, 1, 1, 1, 1]]</span>
<span class="gp">sage: </span><span class="n">h</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">f</span><span class="p">)</span>
<span class="go">h[2, 2, 1, 1, 1, 1] - 4*h[2, 2, 2, 1, 1] + 4*h[2, 2, 2, 2]</span>
</pre></div>
</div>
<p>We now implement a quotient of the algebra of symmetric functions
obtained by killing any monomial symmetric function <span class="math notranslate nohighlight">\(m_\lambda\)</span> such
that the first part of <span class="math notranslate nohighlight">\(\lambda\)</span> is greater than <span class="math notranslate nohighlight">\(k\)</span>. See
<a class="reference external" href="../reference/categories/sage/categories/sets_cat.html#sage.categories.sets_cat.Sets.SubcategoryMethods.Subquotients" title="(in Category Framework v10.1)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Sets.SubcategoryMethods.Subquotients()</span></code></a> for more details about
implementing quotients:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">MySFQuotient</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="sd">    The quotient of the ring of symmetric functions by the ideal generated</span>
<span class="gp">....: </span><span class="sd">    by those monomial symmetric functions whose part is larger than some fixed</span>
<span class="gp">....: </span><span class="sd">    number ``k``.</span>
<span class="gp">....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span>
<span class="gp">....: </span>            <span class="n">Partitions</span><span class="p">(</span><span class="n">NonNegativeIntegers</span><span class="p">(),</span> <span class="n">max_part</span><span class="o">=</span><span class="n">k</span><span class="p">),</span>
<span class="gp">....: </span>            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span>
<span class="gp">....: </span>            <span class="n">category</span> <span class="o">=</span> <span class="n">Algebras</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">Graded</span><span class="p">()</span><span class="o">.</span><span class="n">WithBasis</span><span class="p">()</span><span class="o">.</span><span class="n">Quotients</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_k</span> <span class="o">=</span> <span class="n">k</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_m</span> <span class="o">=</span> <span class="n">SymmetricFunctions</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">monomial</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_m</span><span class="o">.</span><span class="n">monomial</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">retract</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m</span><span class="o">.</span><span class="n">module_morphism</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retract_on_basis</span><span class="p">,</span> <span class="n">codomain</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">lift</span><span class="o">.</span><span class="n">register_as_coercion</span><span class="p">()</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">retract</span><span class="o">.</span><span class="n">register_as_coercion</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">ambient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_m</span>
<span class="gp">....:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">_retract_on_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">....: </span><span class="sd">        Takes the index of a basis element of a monomial</span>
<span class="gp">....: </span><span class="sd">        symmetric function, and returns the projection of that</span>
<span class="gp">....: </span><span class="sd">        element to the quotient.</span>
<span class="gp">....: </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="gp">....: </span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k</span><span class="p">:</span>
<span class="gp">....: </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">monomial</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">MM</span> <span class="o">=</span> <span class="n">MySFQuotient</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mm</span> <span class="o">=</span> <span class="n">MM</span><span class="o">.</span><span class="n">basis</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">m</span> <span class="o">=</span> <span class="n">SymmetricFunctions</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span><span class="o">.</span><span class="n">monomial</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">Partition</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">P</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="n">P</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="n">P</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">])];</span> <span class="n">g</span>
<span class="go">m[3, 2, 1] + 2*m[3, 3] + m[4, 2]</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">MM</span><span class="p">(</span><span class="n">g</span><span class="p">);</span> <span class="n">f</span>
<span class="go">mm[[3, 2, 1]] + 2*mm[[3, 3]]</span>
<span class="gp">sage: </span><span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">m[3, 2, 1] + 2*m[3, 3]</span>

<span class="gp">sage: </span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span>
<span class="go">8*m[3, 3, 2, 2, 1, 1] + 12*m[3, 3, 2, 2, 2] + 24*m[3, 3, 3, 2, 1] + 48*m[3, 3, 3, 3]</span>
<span class="go">+ 4*m[4, 3, 2, 2, 1] + 4*m[4, 3, 3, 1, 1] + 14*m[4, 3, 3, 2] + 4*m[4, 4, 2, 2]</span>
<span class="go">+ 4*m[4, 4, 3, 1] + 6*m[4, 4, 4] + 4*m[5, 3, 2, 1, 1] + 4*m[5, 3, 2, 2]</span>
<span class="go">+ 12*m[5, 3, 3, 1] + 2*m[5, 4, 2, 1] + 6*m[5, 4, 3] + 4*m[5, 5, 1, 1] + 2*m[5, 5, 2]</span>
<span class="go">+ 4*m[6, 2, 2, 1, 1] + 6*m[6, 2, 2, 2] + 6*m[6, 3, 2, 1] + 10*m[6, 3, 3] + 2*m[6, 4, 1, 1] + 5*m[6, 4, 2] + 4*m[6, 5, 1] + 4*m[6, 6]</span>

<span class="gp">sage: </span><span class="n">f</span><span class="o">^</span><span class="mi">2</span>
<span class="go">8*mm[[3, 3, 2, 2, 1, 1]] + 12*mm[[3, 3, 2, 2, 2]] + 24*mm[[3, 3, 3, 2, 1]] + 48*mm[[3, 3, 3, 3]]</span>

<span class="gp">sage: </span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="go">4*m[4, 3, 2, 2, 1] + 4*m[4, 3, 3, 1, 1] + 14*m[4, 3, 3, 2] + 4*m[4, 4, 2, 2] + 4*m[4, 4, 3, 1] + 6*m[4, 4, 4] + 4*m[5, 3, 2, 1, 1] + 4*m[5, 3, 2, 2] + 12*m[5, 3, 3, 1] + 2*m[5, 4, 2, 1] + 6*m[5, 4, 3] + 4*m[5, 5, 1, 1] + 2*m[5, 5, 2] + 4*m[6, 2, 2, 1, 1] + 6*m[6, 2, 2, 2] + 6*m[6, 3, 2, 1] + 10*m[6, 3, 3] + 2*m[6, 4, 1, 1] + 5*m[6, 4, 2] + 4*m[6, 5, 1] + 4*m[6, 6]</span>

<span class="gp">sage: </span><span class="n">MM</span><span class="p">(</span> <span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</section>
<section id="implementing-algebraic-structures-with-several-realizations">
<h2>Implementing algebraic structures with several realizations<a class="headerlink" href="#implementing-algebraic-structures-with-several-realizations" title="Permalink to this heading">#</a></h2>
<p>We now return to the subset algebra and use it as an example to show how to
implement several different bases for an algebra with automatic coercions
between the different bases. We have already implemented three bases for this
algebra:  the <code class="docutils literal notranslate"><span class="pre">F</span></code>, <code class="docutils literal notranslate"><span class="pre">In</span></code>, and <code class="docutils literal notranslate"><span class="pre">Out</span></code> bases, as well as coercions between
them. In real calculations it is convenient to tie these parents together by
implementing an object <code class="docutils literal notranslate"><span class="pre">A</span></code> that models the abstract algebra itself. Then, the
parents <code class="docutils literal notranslate"><span class="pre">F</span></code>, <code class="docutils literal notranslate"><span class="pre">In</span></code> and <code class="docutils literal notranslate"><span class="pre">Out</span></code> will be <em>realizations</em> of <code class="docutils literal notranslate"><span class="pre">A</span></code>, while <code class="docutils literal notranslate"><span class="pre">A</span></code>
will be a <em>parent with realizations</em>. See <a class="reference external" href="../reference/categories/sage/categories/with_realizations.html#sage.categories.with_realizations.WithRealizations" title="(in Category Framework v10.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">Sets().WithRealizations</span></code></a> for more information
about the expected user interface and the rationale.</p>
<p>Here is a brief template highlighting the overall structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAlgebra</span><span class="p">(</span><span class="n">Parent</span><span class="p">,</span> <span class="n">UniqueRepresentation</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">Algebras</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">Commutative</span><span class="p">()</span>
        <span class="n">Parent</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="o">.</span><span class="n">WithRealizations</span><span class="p">())</span>
        <span class="c1"># attribute initialization, construction of the morphisms</span>
        <span class="c1"># between the bases, ...</span>

    <span class="k">class</span> <span class="nc">Bases</span><span class="p">(</span><span class="n">Category_realization_of_parent</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">super_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">()</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">Algebras</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">base_ring</span><span class="p">())</span><span class="o">.</span><span class="n">Commutative</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">Realizations</span><span class="p">(),</span> <span class="n">category</span><span class="o">.</span><span class="n">Realizations</span><span class="p">()</span><span class="o">.</span><span class="n">WithBasis</span><span class="p">()]</span>

        <span class="k">class</span> <span class="nc">ParentMethods</span><span class="p">:</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Code that is common to all bases of the algebra&quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">ElementMethods</span><span class="p">:</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Code that is common to elements of all bases of the algebra&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">FirstBasis</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">,</span> <span class="n">BindableClass</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
            <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">Bases</span><span class="p">())</span>

        <span class="c1"># implementation of the multiplication, the unit, ...</span>

    <span class="k">class</span> <span class="nc">SecondBasis</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">,</span> <span class="n">BindableClass</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
            <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">Bases</span><span class="p">())</span>

        <span class="c1"># implementation of the multiplication, the unit, ...</span>
</pre></div>
</div>
<p>The class <code class="docutils literal notranslate"><span class="pre">MyAlgebra</span></code> implements a commutative algebra <code class="docutils literal notranslate"><span class="pre">A</span></code> with several
realizations, which we specify in the constructor of <code class="docutils literal notranslate"><span class="pre">MyAlgebra</span></code>. The two
bases classes <code class="docutils literal notranslate"><span class="pre">MyAlgebra.FirstBasis</span></code> and <code class="docutils literal notranslate"><span class="pre">MyAlgebra.SecondBasis</span></code> implement
different realizations of <code class="docutils literal notranslate"><span class="pre">A</span></code> that correspond to distinguished bases on which
elements are expanded. They are initialized in the category <code class="docutils literal notranslate"><span class="pre">MyAlgebra.Bases</span></code>
of all bases of <code class="docutils literal notranslate"><span class="pre">A</span></code>, whose role is to factor out their common features. In
particular, this construction says that they are:</p>
<ul class="simple">
<li><p>realizations of <code class="docutils literal notranslate"><span class="pre">A</span></code></p></li>
<li><p>realizations of a commutative algebra, with a distinguished basis</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a bit of redundancy here: given that <code class="docutils literal notranslate"><span class="pre">A</span></code> knows it is a
commutative algebra with realizations the infrastructure could, in
principle, determine that its realizations are commutative algebras. If this
was done then it would be possible to implement <span class="math notranslate nohighlight">\(Bases.super_categories\)</span> by
returning:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">[A.Realizations().WithBasis()]</span>
</pre></div>
</div>
<p>However, this has not been implemented yet.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Inheriting from <code class="xref py py-class docutils literal notranslate"><span class="pre">BindableCass</span></code> just provides syntactic
sugar: it makes <code class="docutils literal notranslate"><span class="pre">MyAlgebras().FirstBasis()</span></code> a shorthand for
<code class="docutils literal notranslate"><span class="pre">MyAlgebras.FirstBasis(MyAlgebras().FirstBasis())</span></code> (binding
behavior). The class <code class="docutils literal notranslate"><span class="pre">Bases</span></code> inherits this binding behavior from
<code class="xref py py-class docutils literal notranslate"><span class="pre">Category_realization_of_parent</span></code> , which is why we can
write <code class="docutils literal notranslate"><span class="pre">MyAlgebras().Bases</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">MyAlgebras.Bases(MyAlgebras())</span></code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More often than not, the constructors for all of the bases will be very
similar, if not identical; so we would want to factor it out. Annoyingly,
the natural approach of putting the constructor in <code class="docutils literal notranslate"><span class="pre">Bases.ParentMethods</span></code>
does not work because this is an abstract class whereas the constructor
handles the concrete implementation of the data structure. Similarly, it
would be better if it was only necessary to  specify the classes the bases
inherit from once, but this can’t code go into <code class="docutils literal notranslate"><span class="pre">Bases</span></code> for the same
reason.</p>
<p>The current recommended solution is to have an additional class <code class="docutils literal notranslate"><span class="pre">Basis</span></code>
that factors out the common concrete features of the different bases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">class</span> <span class="nc">Basis</span><span class="p">(</span><span class="n">CombinatorialFreeModule</span><span class="p">,</span> <span class="n">BindableClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="n">CombinatorialFreeModule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">Bases</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">FirstBasis</span><span class="p">(</span><span class="n">Basis</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">SecondBasis</span><span class="p">(</span><span class="n">Basis</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This solution works but it is not optimal because to share features between
the two bases code needs to go into two locations, <code class="docutils literal notranslate"><span class="pre">Basis</span></code> and <code class="docutils literal notranslate"><span class="pre">Bases</span></code>,
depending on whether they are concrete or abstract, respectively.</p>
</div>
<p>We now urge the reader to browse the full code of the following
example, which is meant as a complete template for constructing new
parents with realizations:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">Sets</span><span class="p">()</span><span class="o">.</span><span class="n">WithRealizations</span><span class="p">()</span><span class="o">.</span><span class="n">example</span><span class="p">();</span> <span class="n">A</span>
<span class="go">The subset algebra of {1, 2, 3} over Rational Field</span>

<span class="gp">sage: </span><span class="n">A</span><span class="err">??</span>                                     <span class="c1"># not implemented</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>Review<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>Congratulations on reading this far!</p>
<p>We have now been through a complete tour of the features needed to
implement an algebra with several realizations. The infrastructure for
realizations is not tied specifically to algebras; what we have
learned applies mutatis mutandis in full generality, for example for
implementing groups with several realizations.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cython_interface.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">How to call a C code (or a compiled library) from Sage ?</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="coercion_and_categories.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">How to implement new algebraic structures in Sage</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tutorial: Implementing Algebraic Structures</a><ul>
<li><a class="reference internal" href="#subclassing-free-modules-and-including-category-information">Subclassing free modules and including category information</a><ul>
<li><a class="reference internal" href="#review">Review</a></li>
<li><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#morphisms">Morphisms</a><ul>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#diagonal-and-triangular-morphisms">Diagonal and Triangular Morphisms</a><ul>
<li><a class="reference internal" href="#id2">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coercions">Coercions</a><ul>
<li><a class="reference internal" href="#id3">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-digression-new-bases-and-quotients-of-symmetric-functions">A digression: new bases and quotients of symmetric functions</a></li>
<li><a class="reference internal" href="#implementing-algebraic-structures-with-several-realizations">Implementing algebraic structures with several realizations</a></li>
<li><a class="reference internal" href="#id4">Review</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"ZZ": "\\Bold{Z}", "NN": "\\Bold{N}", "RR": "\\Bold{R}", "CC": "\\Bold{C}", "QQ": "\\Bold{Q}", "QQbar": "\\overline{\\QQ}", "GF": ["\\Bold{F}_{#1}", 1], "Zp": ["\\Bold{Z}_{#1}", 1], "Qp": ["\\Bold{Q}_{#1}", 1], "Zmod": ["\\ZZ/#1\\ZZ", 1], "CDF": "\\Bold{C}", "CIF": "\\Bold{C}", "CLF": "\\Bold{C}", "RDF": "\\Bold{R}", "RIF": "\\Bold{I} \\Bold{R}", "RLF": "\\Bold{R}", "SL": "\\mathrm{SL}", "PSL": "\\mathrm{PSL}", "lcm": "\\mathop{\\operatorname{lcm}}", "Bold": ["\\mathbf{#1}", 1]}, "inlineMath": [["$", "$"], ["\\(", "\\)"]], "maxBuffer": 51200, "autoload": {"color": [], "colorv2": ["color"]}}}</script>
    <script defer="defer" src="_static/mathjax/tex-chtml.js"></script>
    </body>
</html>