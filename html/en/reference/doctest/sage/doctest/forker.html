<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Parsing docstrings" href="parsing.html" /><link rel="prev" title="Classes for sources of doctests" href="sources.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.06.21"/>
        <title>Processes for running doctests - Sage&#39;s Doctesting Framework</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZGD13B5572"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ZGD13B5572');
</script></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Sage's Doctesting Framework</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 9.7 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../../index.html">Home - Sage's Doctesting Framework</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="control.html">Classes involved in doctesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources.html">Classes for sources of doctests</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Processes for running doctests</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsing.html">Parsing docstrings</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html">Reporting doctest results</a></li>
<li class="toctree-l1"><a class="reference internal" href="external.html">Detecting external software</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Test the doctesting framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utility functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html">Fixtures to help testing functionality</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="processes-for-running-doctests">
<span id="sage-doctest-forker"></span><h1>Processes for running doctests<a class="headerlink" href="#processes-for-running-doctests" title="Permalink to this headline">#</a></h1>
<span class="target" id="module-sage.doctest.forker"></span><p>This module controls the processes started by Sage that actually run
the doctests.</p>
<p>EXAMPLES:</p>
<p>The following examples are used in doctesting this file:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">doctest_var</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="n">doctest_var</span><span class="o">^</span><span class="mi">2</span>
<span class="go">1764</span>
<span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">+</span> <span class="n">doctest_var</span>
<span class="go">a + 42</span>
</pre></div>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>David Roe (2012-03-27) – initial version, based on Robert Bradshaw’s code.</p></li>
<li><p>Jeroen Demeyer (2013 and 2015) – major improvements to forking and logging</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestDispatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">DocTestDispatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">controller</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="../../../structure/sage/structure/sage_object.html#sage.structure.sage_object.SageObject" title="(in Parents and Elements v9.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.sage_object.SageObject</span></code></a></p>
<p>Creates parallel <a class="reference internal" href="#sage.doctest.forker.DocTestWorker" title="sage.doctest.forker.DocTestWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestWorker</span></code></a> processes and dispatches
doctesting tasks.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestDispatcher.dispatch">
<span class="sig-name descname"><span class="pre">dispatch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.dispatch" title="Permalink to this definition">#</a></dt>
<dd><p>Run the doctests for the controller’s specified sources,
by calling <a class="reference internal" href="#sage.doctest.forker.DocTestDispatcher.parallel_dispatch" title="sage.doctest.forker.DocTestDispatcher.parallel_dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">parallel_dispatch()</span></code></a> or <a class="reference internal" href="#sage.doctest.forker.DocTestDispatcher.serial_dispatch" title="sage.doctest.forker.DocTestDispatcher.serial_dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serial_dispatch()</span></code></a>
according to the <code class="docutils literal notranslate"><span class="pre">--serial</span></code> option.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">freehom</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;modules&#39;</span><span class="p">,</span> <span class="s1">&#39;free_module_homspace.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">bigo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;big_oh.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">freehom</span><span class="p">,</span> <span class="n">bigo</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">dispatch</span><span class="p">()</span>
<span class="go">sage -t .../sage/modules/free_module_homspace.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../sage/rings/big_oh.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestDispatcher.parallel_dispatch">
<span class="sig-name descname"><span class="pre">parallel_dispatch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.parallel_dispatch" title="Permalink to this definition">#</a></dt>
<dd><p>Run the doctests from the controller’s specified sources in parallel.</p>
<p>This creates <a class="reference internal" href="#sage.doctest.forker.DocTestWorker" title="sage.doctest.forker.DocTestWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestWorker</span></code></a> subprocesses, while the master
process checks for timeouts and collects and displays the results.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">crem</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;databases&#39;</span><span class="p">,</span> <span class="s1">&#39;cremona.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">bigo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;big_oh.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">crem</span><span class="p">,</span> <span class="n">bigo</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">parallel_dispatch</span><span class="p">()</span>
<span class="go">sage -t .../databases/cremona.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../rings/big_oh.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">exitfirst=True</span></code> option is given, the results for a failing
module will be immediately printed and any other ongoing tests
canceled:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">NamedTemporaryFile</span> <span class="k">as</span> <span class="n">NTF</span>
<span class="gp">sage: </span><span class="k">with</span> <span class="n">NTF</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+t&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">,</span> \
<span class="gp">....: </span>     <span class="n">NTF</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+t&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;</span><span class="se">\n</span><span class="s2">sage: import time; time.sleep(60)</span><span class="se">\n</span><span class="s2">&#39;&#39;&#39;&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">f1</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;</span><span class="se">\n</span><span class="s2">sage: True</span><span class="se">\n</span><span class="s2">False</span><span class="se">\n</span><span class="s2">&#39;&#39;&#39;&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">f2</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(</span><span class="n">exitfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">....: </span>                                           <span class="n">nthreads</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="gp">....: </span>                           <span class="p">[</span><span class="n">f1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f2</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
<span class="gp">....: </span>    <span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">....: </span>    <span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">....: </span>    <span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">DD</span><span class="o">.</span><span class="n">parallel_dispatch</span><span class="p">()</span>
<span class="go">sage -t ...</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;...&quot;, line 2, in ...</span>
<span class="go">Failed example:</span>
<span class="go">    True</span>
<span class="go">Expected:</span>
<span class="go">    False</span>
<span class="go">Got:</span>
<span class="go">    True</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">   1 of   1 in ...</span>
<span class="go">    [1 test, 1 failure, ... s]</span>
<span class="go">Killing test ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestDispatcher.serial_dispatch">
<span class="sig-name descname"><span class="pre">serial_dispatch</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestDispatcher.serial_dispatch" title="Permalink to this definition">#</a></dt>
<dd><p>Run the doctests from the controller’s specified sources in series.</p>
<p>There is no graceful handling for signals, no possibility of
interrupting tests and no timeout.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestDispatcher</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">homset</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;homset.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ideal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span> <span class="s1">&#39;sage&#39;</span><span class="p">,</span> <span class="s1">&#39;rings&#39;</span><span class="p">,</span> <span class="s1">&#39;ideal.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DocTestDefaults</span><span class="p">(),</span> <span class="p">[</span><span class="n">homset</span><span class="p">,</span> <span class="n">ideal</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">expand_files_into_sources</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDispatcher</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DR</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DR</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">DD</span>
<span class="gp">sage: </span><span class="n">DC</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DD</span><span class="o">.</span><span class="n">serial_dispatch</span><span class="p">()</span>
<span class="go">sage -t .../rings/homset.py</span>
<span class="go">    [... tests, ... s]</span>
<span class="go">sage -t .../rings/ideal.py</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestTask">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">DocTestTask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestTask" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class encapsulates the tests from a single source.</p>
<p>This class does not insulate from problems in the source
(e.g. entering an infinite loop or causing a segfault), that has to
be dealt with at a higher level.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> – a <a class="reference internal" href="sources.html#sage.doctest.sources.DocTestSource" title="sage.doctest.sources.DocTestSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.doctest.sources.DocTestSource</span></code></a> instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – boolean, controls reporting of progress by <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTestRunner" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner</span></code></a>.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">,</span> <span class="n">DocTestController</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;sources.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTT</span> <span class="o">=</span> <span class="n">DocTestTask</span><span class="p">(</span><span class="n">FDS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DD</span><span class="p">,[</span><span class="n">filename</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">ntests</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">DTT</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ntests</span> <span class="o">&gt;=</span> <span class="mi">300</span> <span class="ow">or</span> <span class="n">ntests</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;cputime&#39;, &#39;err&#39;, &#39;failures&#39;, &#39;optionals&#39;, &#39;tests&#39;, &#39;walltime&#39;, &#39;walltime_skips&#39;]</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestTask.extra_globals">
<span class="sig-name descname"><span class="pre">extra_globals</span></span><em class="property"><span class="w"> </span><span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#sage.doctest.forker.DocTestTask.extra_globals" title="Permalink to this definition">#</a></dt>
<dd><p>Extra objects to place in the global namespace in which tests are run.
Normally this should be empty but there are special cases where it may
be useful.</p>
<p>For example, in Sage versions 9.1 and earlier, on Python 3 add
<code class="docutils literal notranslate"><span class="pre">long</span></code> as an alias for <code class="docutils literal notranslate"><span class="pre">int</span></code> so that tests that use the
<code class="docutils literal notranslate"><span class="pre">long</span></code> built-in (of which there are many) still pass.  We did
this so that the test suite could run on Python 3 while Python 2
was still the default.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">DocTestWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">funclist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.context.Process</span></code></p>
<p>The DocTestWorker process runs one <a class="reference internal" href="#sage.doctest.forker.DocTestTask" title="sage.doctest.forker.DocTestTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestTask</span></code></a> for a given
source. It returns messages about doctest failures (or all tests if
verbose doctesting) through a pipe and returns results through a
<code class="docutils literal notranslate"><span class="pre">multiprocessing.Queue</span></code> instance (both these are created in the
<a class="reference internal" href="#sage.doctest.forker.DocTestWorker.start" title="sage.doctest.forker.DocTestWorker.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code></a> method).</p>
<p>It runs the task in its own process-group, such that killing the
process group kills this process together with its child processes.</p>
<p>The class has additional methods and attributes for bookkeeping
by the master process. Except in <a class="reference internal" href="#sage.doctest.forker.DocTestWorker.run" title="sage.doctest.forker.DocTestWorker.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>, nothing from this
class should be accessed by the child process.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestSource</span></code> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code> – an object representing doctest options.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">funclist</span></code> – a list of callables to be called at the start of
the child process.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DC</span> <span class="o">=</span> <span class="n">DocTestController</span><span class="p">(</span><span class="n">DD</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">reporter</span> <span class="o">=</span> <span class="n">DocTestReporter</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># Wait for worker to finish</span>
<span class="gp">sage: </span><span class="n">result</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">result_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">reporter</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">exitcode</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="go">    [... tests, ... s]</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker.kill">
<span class="sig-name descname"><span class="pre">kill</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.kill" title="Permalink to this definition">#</a></dt>
<dd><p>Kill this worker.  Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the signal(s) are sent
successfully or <code class="docutils literal notranslate"><span class="pre">False</span></code> if the worker process no longer exists.</p>
<p>This method is only called if there is something wrong with the
worker. Under normal circumstances, the worker is supposed to
exit by itself after finishing.</p>
<p>The first time this is called, use <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code>. This will trigger
the cysignals <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code> handler and try to print an enhanced
traceback.</p>
<p>Subsequent times, use <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>.  Also close the message pipe
if it was still open.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">time</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span><span class="s1">&#39;99seconds.rst&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
</pre></div>
</div>
<p>We set up the worker to start by blocking <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code>, such that
killing will fail initially:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">cysignals.pselect</span> <span class="kn">import</span> <span class="n">PSelecter</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">signal</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">block_hup</span><span class="p">():</span>
<span class="gp">....: </span>    <span class="c1"># We never __exit__()</span>
<span class="gp">....: </span>    <span class="n">PSelecter</span><span class="p">([</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">])</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">,</span> <span class="p">[</span><span class="n">block_hup</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">killed</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">killed</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>  <span class="c1"># Worker doesn&#39;t die</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>         <span class="c1"># Worker dies now</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker.read_messages">
<span class="sig-name descname"><span class="pre">read_messages</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.read_messages" title="Permalink to this definition">#</a></dt>
<dd><p>In the master process, read from the pipe and store the data
read in the <code class="docutils literal notranslate"><span class="pre">messages</span></code> attribute.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function may need to be called multiple times in
order to read all of the messages.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">nthreads</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">while</span> <span class="n">W</span><span class="o">.</span><span class="n">rmessages</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">W</span><span class="o">.</span><span class="n">read_messages</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.run" title="Permalink to this definition">#</a></dt>
<dd><p>Runs the <a class="reference internal" href="#sage.doctest.forker.DocTestTask" title="sage.doctest.forker.DocTestTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocTestTask</span></code></a> under its own PGID.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker.save_result_output">
<span class="sig-name descname"><span class="pre">save_result_output</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.save_result_output" title="Permalink to this definition">#</a></dt>
<dd><p>Annotate <code class="docutils literal notranslate"><span class="pre">self</span></code> with <code class="docutils literal notranslate"><span class="pre">self.result</span></code> (the result read through
the <code class="docutils literal notranslate"><span class="pre">result_queue</span></code> and with <code class="docutils literal notranslate"><span class="pre">self.output</span></code>, the complete
contents of <code class="docutils literal notranslate"><span class="pre">self.outtmpfile</span></code>. Then close the Queue and
<code class="docutils literal notranslate"><span class="pre">self.outtmpfile</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">DocTestWorker</span><span class="p">,</span> <span class="n">DocTestTask</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.reporting</span> <span class="kn">import</span> <span class="n">DocTestReporter</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestController</span><span class="p">,</span> <span class="n">DocTestDefaults</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;util.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span> <span class="o">=</span> <span class="n">DocTestWorker</span><span class="p">(</span><span class="n">FDS</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">W</span><span class="o">.</span><span class="n">save_result_output</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;cputime&#39;, &#39;err&#39;, &#39;failures&#39;, &#39;optionals&#39;, &#39;tests&#39;, &#39;walltime&#39;, &#39;walltime_skips&#39;]</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is called from the parent process, not from the
subprocess.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.DocTestWorker.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.DocTestWorker.start" title="Permalink to this definition">#</a></dt>
<dd><p>Start the worker and close the writing end of the message pipe.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">SageDocTestRunner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTestRunner" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A customized version of DocTestRunner that tracks dependencies
of doctests.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stdout</span></code> – an open file to restore for debugging</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checker</span></code> – None, or an instance of
<a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.OutputChecker" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.OutputChecker</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – boolean, determines whether verbose printing
is enabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optionflags</span></code> – Controls the comparison with the expected
output.  See <code class="xref py py-mod docutils literal notranslate"><span class="pre">testmod</span></code> for more information.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span>
<span class="go">&lt;sage.doctest.forker.SageDocTestRunner object at ...&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.compile_and_execute">
<span class="sig-name descname"><span class="pre">compile_and_execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compiler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">globs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.compile_and_execute" title="Permalink to this definition">#</a></dt>
<dd><p>Runs the given example, recording dependencies.</p>
<p>Rather than using a basic dictionary, Sage’s doctest runner
uses a <a class="reference internal" href="util.html#sage.doctest.util.RecordingDict" title="sage.doctest.util.RecordingDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.doctest.util.RecordingDict</span></code></a>, which records
every time a value is set or retrieved.  Executing the given
code with this recording dictionary as the namespace allows
Sage to track dependencies between doctest lines.  For
example, in the following two lines</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>the recording dictionary records that the second line depends
on the first since the first INSERTS <code class="docutils literal notranslate"><span class="pre">x</span></code> into the global
namespace and the second line RETRIEVES <code class="docutils literal notranslate"><span class="pre">x</span></code> from the global
namespace.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compiler</span></code> – a callable that, applied to example,
produces a code object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">globs</span></code> – a dictionary in which to execute the code.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>the output of the compiled code snippet.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">RecordingDict</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">hashlib</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_doctest_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">globs</span> <span class="o">=</span> <span class="n">RecordingDict</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="s1">&#39;doctest_var&#39;</span> <span class="ow">in</span> <span class="n">globs</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="n">globs</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ex0</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">flags</span> <span class="o">=</span> <span class="mi">32768</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="k">else</span> <span class="mi">524288</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span> <span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[0]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="go">1764</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="p">[</span><span class="s1">&#39;doctest_var&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">set</span>
<span class="go">{&#39;doctest_var&#39;}</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">got</span>
<span class="go">{&#39;Integer&#39;}</span>
</pre></div>
</div>
<p>Now we can execute some more doctests to see the dependencies.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ex1</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span><span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[1]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">set</span><span class="p">))</span>
<span class="go">[&#39;R&#39;, &#39;a&#39;]</span>
<span class="gp">sage: </span><span class="n">globs</span><span class="o">.</span><span class="n">got</span>
<span class="go">{&#39;ZZ&#39;}</span>
<span class="gp">sage: </span><span class="n">ex1</span><span class="o">.</span><span class="n">predecessors</span>
<span class="go">[]</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ex2</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">compiler</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ex</span><span class="p">:</span><span class="nb">compile</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;&lt;doctest sage.doctest.forker[2]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">compile_and_execute</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">globs</span><span class="p">)</span>
<span class="go">a + 42</span>
<span class="gp">sage: </span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">globs</span><span class="o">.</span><span class="n">got</span><span class="p">))</span>
<span class="go">[&#39;a&#39;, &#39;doctest_var&#39;]</span>
<span class="gp">sage: </span><span class="nb">set</span><span class="p">(</span><span class="n">ex2</span><span class="o">.</span><span class="n">predecessors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.report_failure">
<span class="sig-name descname"><span class="pre">report_failure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">got</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">globs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_failure" title="Permalink to this definition">#</a></dt>
<dd><p>Called when a doctest fails.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">globs</span></code> – a dictionary of globals, used if in debugging mode</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">no_failure_yet</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_failure</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;BAD ANSWER</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;.../sage/doctest/forker.py&quot;, line 11, in sage.doctest.forker</span>
<span class="go">Failed example:</span>
<span class="go">    doctest_var = 42; doctest_var^2</span>
<span class="go">Expected:</span>
<span class="go">    1764</span>
<span class="go">Got:</span>
<span class="go">    BAD ANSWER</span>
</pre></div>
</div>
<p>If debugging is turned on this function starts an IPython
prompt when a test returns an incorrect answer:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SAGE_PEXPECT_LOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import doctest, sys, os, multiprocessing, subprocess&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.parsing import SageOutputChecker&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import sage.doctest.forker as sdf&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.control import DocTestDefaults&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DD = DocTestDefaults(debug=True)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex1 = doctest.Example(&#39;a = 17&#39;, &#39;&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex2 = doctest.Example(&#39;2*a&#39;, &#39;1&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DT = doctest.DocTest([ex1,ex2], globals(), &#39;doubling&#39;, None, 0, None)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR = sdf.SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;sdf.init_sage(); DTR.run(DT, clear_globs=False)&quot;</span><span class="p">))</span> <span class="c1"># indirect doctest</span>
<span class="go">**********************************************************************</span>
<span class="go">Line 1, in doubling</span>
<span class="go">Failed example:</span>
<span class="go">    2*a</span>
<span class="go">Expected:</span>
<span class="go">    1</span>
<span class="go">Got:</span>
<span class="go">    34</span>
<span class="go">**********************************************************************</span>
<span class="go">Previously executed commands:</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_expect</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;sage: &#39;</span><span class="p">)</span>   <span class="c1"># sage0 just mis-identified the output as prompt, synchronize</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="go">&#39;...17&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">)</span>
<span class="go">&#39;Returning to doctests...TestResults(failed=1, attempted=2)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.report_overtime">
<span class="sig-name descname"><span class="pre">report_overtime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">got</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_duration</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_overtime" title="Permalink to this definition">#</a></dt>
<dd><p>Called when the <code class="docutils literal notranslate"><span class="pre">warn_long</span></code> option flag is set and a doctest
runs longer than the specified time.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_duration</span></code> – number (default: <code class="docutils literal notranslate"><span class="pre">0</span></code>) time spent for checking
the test output</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.misc</span> <span class="kn">import</span> <span class="n">walltime</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">ex</span><span class="o">.</span><span class="n">walltime</span> <span class="o">=</span> <span class="mf">1.23</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_overtime</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;BAD ANSWER</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">check_duration</span><span class="o">=</span><span class="mf">2.34</span><span class="p">)</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;.../sage/doctest/forker.py&quot;, line 11, in sage.doctest.forker</span>
<span class="go">Warning, slow doctest:</span>
<span class="go">    doctest_var = 42; doctest_var^2</span>
<span class="go">Test ran for 1.23 s, check ran for 2.34 s</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.report_start">
<span class="sig-name descname"><span class="pre">report_start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_start" title="Permalink to this definition">#</a></dt>
<dd><p>Called when an example starts.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_start</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">)</span>
<span class="go">Trying (line 11):    doctest_var = 42; doctest_var^2</span>
<span class="go">Expecting:</span>
<span class="go">    1764</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.report_success">
<span class="sig-name descname"><span class="pre">report_success</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">got</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_duration</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_success" title="Permalink to this definition">#</a></dt>
<dd><p>Called when an example succeeds.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">got</span></code> – a string, the result of running <code class="docutils literal notranslate"><span class="pre">example</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_duration</span></code> – number (default: <code class="docutils literal notranslate"><span class="pre">0</span></code>) time spent for checking
the test output</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></p></li>
<li><p>if in debugging mode, starts an IPython prompt at the point
of the failure</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.misc</span> <span class="kn">import</span> <span class="n">walltime</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">ex</span><span class="o">.</span><span class="n">walltime</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">report_success</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex</span><span class="p">,</span> <span class="s1">&#39;1764&#39;</span><span class="p">)</span>
<span class="go">ok [0.00 s]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.report_unexpected_exception">
<span class="sig-name descname"><span class="pre">report_unexpected_exception</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exc_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.report_unexpected_exception" title="Permalink to this definition">#</a></dt>
<dd><p>Called when a doctest raises an exception that’s not matched by the expected output.</p>
<p>If debugging has been turned on, starts an interactive debugger.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for printing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a> instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance in <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exc_info</span></code> – the result of <code class="docutils literal notranslate"><span class="pre">sys.exc_info()</span></code></p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>prints a report to <code class="docutils literal notranslate"><span class="pre">out</span></code></p></li>
<li><p>if in debugging mode, starts PDB with the given traceback</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SAGE_PEXPECT_LOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import doctest, sys, os, multiprocessing, subprocess&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.parsing import SageOutputChecker&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;import sage.doctest.forker as sdf&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;from sage.doctest.control import DocTestDefaults&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DD = DocTestDefaults(debug=True)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ex = doctest.Example(&#39;E = EllipticCurve([0,0]); E&#39;, &#39;A singular Elliptic Curve&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DT = doctest.DocTest([ex], globals(), &#39;singular_curve&#39;, None, 0, None)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR = sdf.SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">old_prompt</span> <span class="o">=</span> <span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\(Pdb\) &quot;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;DTR.run(DT, clear_globs=False)&quot;</span><span class="p">)</span> <span class="c1"># indirect doctest</span>
<span class="go">&#39;... ArithmeticError(self._equation_string() + &quot; defines a singular curve&quot;)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">)</span>
<span class="go">&#39;...if self.discriminant() == 0:...raise ArithmeticError...&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>
<span class="go">&#39;...EllipticCurve_field.__init__(self, K, ainvs)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;p ainvs&quot;</span><span class="p">)</span>
<span class="go">&#39;(0, 0, 0, 0, 0)&#39;</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">_prompt</span> <span class="o">=</span> <span class="n">old_prompt</span>
<span class="gp">sage: </span><span class="n">sage0</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">)</span>
<span class="go">&#39;TestResults(failed=1, attempted=1)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compileflags</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_globs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.run" title="Permalink to this definition">#</a></dt>
<dd><p>Runs the examples in a given doctest.</p>
<p>This function replaces <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTestRunner.run</span></code>
since it needs to handle spoofing. It also leaves the display
hook in place.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code> – an instance of <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.DocTest" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.DocTest</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compileflags</span></code> – int (default: 0) the set of compiler flags used to
execute examples (passed in to the <a class="reference external" href="https://docs.python.org/library/functions.html#compile" title="(in Python v3.6)"><code class="xref py py-func docutils literal notranslate"><span class="pre">compile()</span></code></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> – a function for writing the output (defaults to
<code class="xref py py-func docutils literal notranslate"><span class="pre">sys.stdout.write()</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_globs</span></code> – boolean (default True): whether to clear
the namespace after running this doctest.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code> – integer, the number of examples that failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t</span></code> – the number of examples tried</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clear_globs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">TestResults(failed=0, attempted=4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.summarize">
<span class="sig-name descname"><span class="pre">summarize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.summarize" title="Permalink to this definition">#</a></dt>
<dd><p>Print results of testing to <code class="docutils literal notranslate"><span class="pre">self.msgfile</span></code> and return number
of failures and tests run.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code> – whether to print lots of stuff</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>returns <code class="docutils literal notranslate"><span class="pre">(f,</span> <span class="pre">t)</span></code>, a <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.TestResults</span></code> instance
giving the number of failures and the total number of tests
run.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">_name2ft</span><span class="p">[</span><span class="s1">&#39;sage.doctest.forker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">results</span> <span class="o">=</span> <span class="n">DTR</span><span class="o">.</span><span class="n">summarize</span><span class="p">()</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">    1 of 120 in sage.doctest.forker</span>
<span class="gp">sage: </span><span class="n">results</span>
<span class="go">TestResults(failed=1, attempted=120)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.update_digests">
<span class="sig-name descname"><span class="pre">update_digests</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">example</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.update_digests" title="Permalink to this definition">#</a></dt>
<dd><p>Update global and doctest digests.</p>
<p>Sage’s doctest runner tracks the state of doctests so that
their dependencies are known.  For example, in the following
two lines</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>it records that the second line depends on the first since the
first INSERTS <code class="docutils literal notranslate"><span class="pre">x</span></code> into the global namespace and the second
line RETRIEVES <code class="docutils literal notranslate"><span class="pre">x</span></code> from the global namespace.</p>
<p>This function updates the hashes that record these
dependencies.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example</span></code> – a <a class="reference external" href="https://docs.python.org/library/doctest.html#doctest.Example" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">doctest.Example</span></code></a> instance</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">hashlib</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_global_digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="go">&#39;d41d8cd98f00b204e9800998ecf8427e&#39;</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_doctest_digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">ex</span> <span class="o">=</span> <span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">examples</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ex</span><span class="o">.</span><span class="n">predecessors</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">update_digests</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">running_global_digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="go">&#39;3cb44104292c3a3ab4da3112ce5dc35c&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageDocTestRunner.update_results">
<span class="sig-name descname"><span class="pre">update_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">D</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageDocTestRunner.update_results" title="Permalink to this definition">#</a></dt>
<dd><p>When returning results we pick out the results of interest
since many attributes are not pickleable.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">D</span></code> – a dictionary to update with cputime and walltime</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>the number of failures (or False if there is no failure attribute)</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.parsing</span> <span class="kn">import</span> <span class="n">SageOutputChecker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageDocTestRunner</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.sources</span> <span class="kn">import</span> <span class="n">FileDocTestSource</span><span class="p">,</span> <span class="n">DictAsObject</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.control</span> <span class="kn">import</span> <span class="n">DocTestDefaults</span><span class="p">;</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">DocTestDefaults</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_SRC</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">doctest</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">DTR</span> <span class="o">=</span> <span class="n">SageDocTestRunner</span><span class="p">(</span><span class="n">SageOutputChecker</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sage_options</span><span class="o">=</span><span class="n">DD</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="o">|</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_SRC</span><span class="p">,</span><span class="s1">&#39;sage&#39;</span><span class="p">,</span><span class="s1">&#39;doctest&#39;</span><span class="p">,</span><span class="s1">&#39;forker.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">FDS</span> <span class="o">=</span> <span class="n">FileDocTestSource</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">DD</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">doctests</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">FDS</span><span class="o">.</span><span class="n">create_doctests</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.util</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="gp">sage: </span><span class="n">T</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">doctests</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">TestResults(failed=0, attempted=4)</span>
<span class="gp">sage: </span><span class="n">T</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">DTR</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">D</span> <span class="o">=</span> <span class="n">DictAsObject</span><span class="p">({</span><span class="s1">&#39;cputime&#39;</span><span class="p">:[],</span><span class="s1">&#39;walltime&#39;</span><span class="p">:[],</span><span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">})</span>
<span class="gp">sage: </span><span class="n">DTR</span><span class="o">.</span><span class="n">update_results</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="go">[(&#39;cputime&#39;, [...]), (&#39;err&#39;, None), (&#39;failures&#39;, 0), (&#39;tests&#39;, 4), (&#39;walltime&#39;, [...]), (&#39;walltime_skips&#39;, 0)]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.SageSpoofInOut">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">SageSpoofInOut</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="../../../structure/sage/structure/sage_object.html#sage.structure.sage_object.SageObject" title="(in Parents and Elements v9.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.structure.sage_object.SageObject</span></code></a></p>
<p>We replace the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">doctest._SpoofOut</span></code> for three reasons:</p>
<ul class="simple">
<li><p>we need to divert the output of C programs that don’t print
through sys.stdout,</p></li>
<li><p>we want the ability to recover partial output from doctest
processes that segfault.</p></li>
<li><p>we also redirect stdin (usually from /dev/null) during doctests.</p></li>
</ul>
<p>This class defines streams <code class="docutils literal notranslate"><span class="pre">self.real_stdin</span></code>, <code class="docutils literal notranslate"><span class="pre">self.real_stdout</span></code>
and <code class="docutils literal notranslate"><span class="pre">self.real_stderr</span></code> which refer to the original streams.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">outfile</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">tempfile.TemporaryFile()</span></code>) a seekable open file
object to which stdout and stderr should be redirected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infile</span></code> – (default: <code class="docutils literal notranslate"><span class="pre">open(os.devnull)</span></code>) an open file object
from which stdin should be redirected.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">O</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;hello world\n&#39;</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">O</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageSpoofInOut.getvalue">
<span class="sig-name descname"><span class="pre">getvalue</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.getvalue" title="Permalink to this definition">#</a></dt>
<dd><p>Gets the value that has been printed to <code class="docutils literal notranslate"><span class="pre">outfile</span></code> since the
last time this function was called.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step 1&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;step 1\n&#39;</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;step 2&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;step 2\n&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageSpoofInOut.start_spoofing">
<span class="sig-name descname"><span class="pre">start_spoofing</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.start_spoofing" title="Permalink to this definition">#</a></dt>
<dd><p>Set stdin to read from <code class="docutils literal notranslate"><span class="pre">self.infile</span></code> and stdout to print to
<code class="docutils literal notranslate"><span class="pre">self.outfile</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">O</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is not printed&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;this is not printed\n&#39;</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="n">O</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">v</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">v</span>
<span class="go">&#39;this is not printed\n&#39;</span>
</pre></div>
</div>
<p>We also catch non-Python output:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="n">retval</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;echo &quot;Hello there&quot;</span><span class="se">\n</span><span class="s1">if [ $? -eq 0 ]; then</span><span class="se">\n</span><span class="s1">echo &quot;good&quot;</span><span class="se">\n</span><span class="s1">fi&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="go">&#39;Hello there\ngood\n&#39;</span>
<span class="gp">sage: </span><span class="n">O</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.doctest.forker.SageSpoofInOut.stop_spoofing">
<span class="sig-name descname"><span class="pre">stop_spoofing</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.SageSpoofInOut.stop_spoofing" title="Permalink to this definition">#</a></dt>
<dd><p>Reset stdin and stdout to their original values.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">SageSpoofInOut</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">SageSpoofInOut</span><span class="p">()</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">start_spoofing</span><span class="p">()</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is not printed&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">finally</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">S</span><span class="o">.</span><span class="n">stop_spoofing</span><span class="p">()</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is now printed&quot;</span><span class="p">)</span>
<span class="go">this is now printed</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.doctest.forker.TestResults">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">TestResults</span></span><a class="headerlink" href="#sage.doctest.forker.TestResults" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage.doctest.forker.TestResults.attempted">
<span class="sig-name descname"><span class="pre">attempted</span></span><a class="headerlink" href="#sage.doctest.forker.TestResults.attempted" title="Permalink to this definition">#</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage.doctest.forker.TestResults.failed">
<span class="sig-name descname"><span class="pre">failed</span></span><a class="headerlink" href="#sage.doctest.forker.TestResults.failed" title="Permalink to this definition">#</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.doctest.forker.dummy_handler">
<span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">dummy_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frame</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.dummy_handler" title="Permalink to this definition">#</a></dt>
<dd><p>Dummy signal handler for SIGCHLD (just to ensure the signal
isn’t ignored).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.doctest.forker.init_sage">
<span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">init_sage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">controller</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.init_sage" title="Permalink to this definition">#</a></dt>
<dd><p>Import the Sage library.</p>
<p>This function is called once at the beginning of a doctest run
(rather than once for each file).  It imports the Sage library,
sets DOCTEST_MODE to True, and invalidates any interfaces.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">init_sage</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">DOCTEST_MODE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="gp">sage: </span><span class="n">init_sage</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">doctest</span><span class="o">.</span><span class="n">DOCTEST_MODE</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Check that pexpect interfaces are invalidated, but still work:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var := 42;&quot;</span><span class="p">)</span>
<span class="go">&#39;42&#39;</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var;&quot;</span><span class="p">)</span>
<span class="go">&#39;42&#39;</span>
<span class="gp">sage: </span><span class="n">init_sage</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="p">(</span><span class="s1">&#39;Group((1,2,3)(4,5), (3,4))&#39;</span><span class="p">)</span>
<span class="go">Group( [ (1,2,3)(4,5), (3,4) ] )</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;my_test_var;&quot;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">RuntimeError: Gap produced error output...</span>
</pre></div>
</div>
<p>Check that SymPy equation pretty printer is limited in doctest
mode to default width (80 chars):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sympify</span>                                                 <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sympy.printing.pretty.pretty</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>                    <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="s1">&#39;+x^&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)))</span>                        <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wrap_line&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>             <span class="c1"># optional - sage.symbolic</span>
<span class="go"> 29    28    27    26    25    24    23    22    21    20    19    18    17</span>
<span class="go">x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   + x   +</span>

<span class="go"> 16    15    14    13    12    11    10    9    8    7    6    5    4    3</span>
<span class="go">x   + x   + x   + x   + x   + x   + x   + x  + x  + x  + x  + x  + x  + x  + x</span>

<span class="go">2</span>
<span class="go">  + x</span>
</pre></div>
</div>
<p>The displayhook sorts dictionary keys to simplify doctesting of
dictionary output:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;au&#39;</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;bbf&#39;</span><span class="p">:</span><span class="mi">234</span><span class="p">,</span> <span class="s1">&#39;aaa&#39;</span><span class="p">:</span><span class="mi">234</span><span class="p">}</span>
<span class="go">{&#39;a&#39;: 23, &#39;aaa&#39;: 234, &#39;au&#39;: 56, &#39;b&#39;: 34, &#39;bbf&#39;: 234}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.doctest.forker.showwarning_with_traceback">
<span class="sig-prename descclassname"><span class="pre">sage.doctest.forker.</span></span><span class="sig-name descname"><span class="pre">showwarning_with_traceback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">category</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lineno</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.doctest.forker.showwarning_with_traceback" title="Permalink to this definition">#</a></dt>
<dd><p>Displays a warning message with a traceback.</p>
<p>INPUT: see <a class="reference external" href="https://docs.python.org/library/warnings.html#warnings.showwarning" title="(in Python v3.6)"><code class="xref py py-func docutils literal notranslate"><span class="pre">warnings.showwarning()</span></code></a>.</p>
<p>OUTPUT: None</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.doctest.forker</span> <span class="kn">import</span> <span class="n">showwarning_with_traceback</span>
<span class="gp">sage: </span><span class="n">showwarning_with_traceback</span><span class="p">(</span><span class="s2">&quot;bad stuff&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="s2">&quot;myfile.py&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">doctest:warning</span>
<span class="go">  ...</span>
<span class="go">  File &quot;&lt;doctest sage.doctest.forker.showwarning_with_traceback[1]&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">    showwarning_with_traceback(&quot;bad stuff&quot;, UserWarning, &quot;myfile.py&quot;, Integer(0))</span>
<span class="go">:</span>
<span class="go">UserWarning: bad stuff</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="parsing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Parsing docstrings</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="sources.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Classes for sources of doctests</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2022, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    </body>
</html>