<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Parallel Iterator built using Python’s multiprocessing module" href="multiprocessing_sage.html" /><link rel="prev" title="Parallel iterator built using the fork() system call" href="use_fork.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Parallel computations using RecursivelyEnumeratedSet and Map-Reduce - Parallel Computing</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-furo.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-codemirror-monokai.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Parallel Computing</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 10.2 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../../index.html">Home - Parallel Computing</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="decorate.html">Decorate interface for parallel computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Parallel Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_fork.html">Parallel iterator built using the <code class="docutils literal notranslate"><span class="pre">fork()</span></code> system call</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Parallel computations using RecursivelyEnumeratedSet and Map-Reduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiprocessing_sage.html">Parallel Iterator built using Python’s multiprocessing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelism.html">Parallelization control</a></li>
<li class="toctree-l1"><a class="reference internal" href="ncpus.html">CPU Detection</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="parallel-computations-using-recursivelyenumeratedset-and-map-reduce">
<span id="sage-parallel-map-reduce"></span><h1>Parallel computations using RecursivelyEnumeratedSet and Map-Reduce<a class="headerlink" href="#parallel-computations-using-recursivelyenumeratedset-and-map-reduce" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-sage.parallel.map_reduce"></span><p>There is an efficient way to distribute computations on a set
<span class="math notranslate nohighlight">\(S\)</span> of objects defined by <a class="reference external" href="../../../sets/sage/sets/recursively_enumerated_set.html#sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet" title="(in Sets v10.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet()</span></code></a>
(see <a class="reference external" href="../../../sets/sage/sets/recursively_enumerated_set.html#module-sage.sets.recursively_enumerated_set" title="(in Sets v10.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.sets.recursively_enumerated_set</span></code></a> for more details)
over which one would like to perform the following kind of operations:</p>
<ul class="simple">
<li><p>Compute the cardinality of a (very large) set defined recursively
(through a call to <code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest</span></code>)</p></li>
<li><p>More generally, compute any kind of generating series over this set</p></li>
<li><p>Test a conjecture, e.g. find an element of <span class="math notranslate nohighlight">\(S\)</span> satisfying a specific
property, or check that none does or that they all do</p></li>
<li><p>Count/list the elements of <span class="math notranslate nohighlight">\(S\)</span> that have a specific property</p></li>
<li><p>Apply any map/reduce kind of operation over the elements of <span class="math notranslate nohighlight">\(S\)</span></p></li>
</ul>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Florent Hivert – code, documentation (2012–2016)</p></li>
<li><p>Jean Baptiste Priez – prototype, debugging help on MacOSX (2011-June, 2016)</p></li>
<li><p>Nathann Cohen – some documentation (2012)</p></li>
</ul>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#basic-usage"><span class="std std-ref">How can I use all that stuff?</span></a></p></li>
<li><p><a class="reference internal" href="#advanced-use"><span class="std std-ref">Advanced use</span></a></p></li>
<li><p><a class="reference internal" href="#profiling"><span class="std std-ref">Profiling</span></a></p></li>
<li><p><a class="reference internal" href="#logging"><span class="std std-ref">Logging</span></a></p></li>
<li><p><a class="reference internal" href="#protocol-description"><span class="std std-ref">How does it work ?</span></a></p></li>
<li><p><a class="reference internal" href="#examples"><span class="std std-ref">Are there examples of classes?</span></a></p></li>
</ul>
</section>
<section id="how-is-this-different-from-usual-mapreduce">
<h2>How is this different from usual MapReduce?<a class="headerlink" href="#how-is-this-different-from-usual-mapreduce" title="Permalink to this heading">#</a></h2>
<p>This implementation is specific to <code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest</span></code>, and uses its
properties to do its job. Not only mapping and reducing but also
<strong>generating the elements</strong> of <span class="math notranslate nohighlight">\(S\)</span> is done on different processors.</p>
</section>
<section id="how-can-i-use-all-that-stuff">
<span id="basic-usage"></span><h2>How can I use all that stuff?<a class="headerlink" href="#how-can-i-use-all-that-stuff" title="Permalink to this heading">#</a></h2>
<p>First, you need to set the environment variable <code class="docutils literal notranslate"><span class="pre">SAGE_NUM_THREADS</span></code> to the
desired number of parallel threads to be used:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>                                 <span class="c1"># not tested</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SAGE_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;8&#39;</span>      <span class="c1"># not tested</span>
</pre></div>
</div>
<p>Second, you need the information necessary to describe a
<code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest</span></code> representing your set <span class="math notranslate nohighlight">\(S\)</span> (see
<a class="reference external" href="../../../sets/sage/sets/recursively_enumerated_set.html#module-sage.sets.recursively_enumerated_set" title="(in Sets v10.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.sets.recursively_enumerated_set</span></code></a>).  Then, you need to provide a
“map” function as well as a “reduce” function. Here are some examples:</p>
<ul>
<li><p><strong>Counting the number of elements.</strong> In this situation, the map function
can be set to <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">1</span></code>, and the reduce function just adds the
values together, i.e. <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>.</p>
<p>We count binary words of length <span class="math notranslate nohighlight">\(\leq 16\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">seeds</span> <span class="o">=</span> <span class="p">[[]]</span>
<span class="gp">sage: </span><span class="n">succ</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="k">else</span> <span class="p">[]</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">succ</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">map_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span>
<span class="gp">sage: </span><span class="n">reduce_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="gp">sage: </span><span class="n">reduce_init</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="n">map_function</span><span class="p">,</span> <span class="n">reduce_function</span><span class="p">,</span> <span class="n">reduce_init</span><span class="p">)</span>
<span class="go">131071</span>
</pre></div>
</div>
<p>This matches the number of binary words of length <span class="math notranslate nohighlight">\(\leq 16\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">factor</span><span class="p">(</span><span class="mi">131071</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">2^17</span>
</pre></div>
</div>
<p>Note that the map and reduce functions here have the default values of the
<a class="reference external" href="../../../sets/sage/sets/recursively_enumerated_set.html#sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_forest.map_reduce" title="(in Sets v10.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_forest.map_reduce()</span></code></a> method
so that the number of elements can be obtained more simply with:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">()</span>
<span class="go">131071</span>
</pre></div>
</div>
<p>Instead of using <a class="reference external" href="../../../sets/sage/sets/recursively_enumerated_set.html#sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet" title="(in Sets v10.2)"><code class="xref py py-func docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet()</span></code></a>, one can directly use
<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a>, which gives finer
control over the parallel execution (see <a class="reference internal" href="#advanced-use"><span class="std std-ref">Advanced use</span></a> below):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="n">roots</span><span class="o">=</span><span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="n">children</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="k">else</span> <span class="p">[],</span>
<span class="gp">....: </span>    <span class="n">map_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">reduce_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">reduce_init</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">131071</span>
</pre></div>
</div>
</li>
<li><p><strong>Generating series.</strong> For this, take a Map function that associates a
monomial to each element of <span class="math notranslate nohighlight">\(S\)</span>, while the Reduce function is still equal to
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>.</p>
<p>We compute the generating series for counting binary words of each
length <span class="math notranslate nohighlight">\(\leq 16\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="p">[[]],</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="k">else</span> <span class="p">[],</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sp</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="n">map_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
<span class="gp">....: </span>    <span class="n">reduce_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">reduce_init</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sp</span>
<span class="go">65536*x^16 + 32768*x^15 + 16384*x^14 + 8192*x^13 + 4096*x^12</span>
<span class="go">+ 2048*x^11 + 1024*x^10 + 512*x^9 + 256*x^8 + 128*x^7 + 64*x^6</span>
<span class="go">+ 32*x^5 + 16*x^4 + 8*x^3 + 4*x^2 + 2*x + 1</span>
</pre></div>
</div>
<p>This is of course <span class="math notranslate nohighlight">\(\sum_{i=0}^{16} (2x)^i\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sp</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Here is another example where we count permutations of size <span class="math notranslate nohighlight">\(\leq 8\)</span> (here
we use the default values):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">([</span><span class="n">l</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="o">+</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="gp">....: </span>               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="k">else</span> <span class="p">[]),</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sp</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">));</span> <span class="n">sp</span>
<span class="go">40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<p>This is of course <span class="math notranslate nohighlight">\(\sum_{i=0}^{8} i! x^i\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sp</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
</li>
<li><p><strong>Post Processing.</strong> We now demonstrate the use of <code class="docutils literal notranslate"><span class="pre">post_process</span></code>. We
generate the permutation as previously, but we only perform the map/reduce
computation on those of even <code class="docutils literal notranslate"><span class="pre">len</span></code>. Of course we get the even part of the
previous generating series:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">([</span><span class="n">l</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="gp">....: </span>               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="k">else</span> <span class="p">[]),</span>
<span class="gp">....: </span>    <span class="n">post_process</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sp</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">));</span> <span class="n">sp</span>
<span class="go">40320*x^8 + 720*x^6 + 24*x^4 + 2*x^2 + 1</span>
</pre></div>
</div>
<p>This is also useful for example to call a constructor on the generated
elements:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">([</span><span class="n">l</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="gp">....: </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">[]),</span>
<span class="gp">....: </span>    <span class="n">post_process</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">Permutation</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sp</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">z</span><span class="o">.</span><span class="n">number_of_inversions</span><span class="p">());</span> <span class="n">sp</span>
<span class="go">x^10 + 4*x^9 + 9*x^8 + 15*x^7 + 20*x^6 + 22*x^5 + 20*x^4 + 15*x^3 + 9*x^2 + 4*x + 1</span>
</pre></div>
</div>
<p>We get here a polynomial which is the <span class="math notranslate nohighlight">\(q\)</span>-factorial (in the variable <span class="math notranslate nohighlight">\(x\)</span>) of <span class="math notranslate nohighlight">\(5\)</span>,
that is, <span class="math notranslate nohighlight">\(\prod_{i=1}^{5} \frac{1-x^i}{1-x}\)</span>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">prod</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">^</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="go">x^10 + 4*x^9 + 9*x^8 + 15*x^7 + 20*x^6 + 22*x^5 + 20*x^4 + 15*x^3 + 9*x^2 + 4*x + 1</span>
</pre></div>
</div>
<p>Compare:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.combinat.q_analogues</span> <span class="kn">import</span> <span class="n">q_factorial</span>                           <span class="c1"># needs sage.combinat</span>
<span class="gp">sage: </span><span class="n">q_factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                                                              <span class="c1"># needs sage.combinat</span>
<span class="go">q^10 + 4*q^9 + 9*q^8 + 15*q^7 + 20*q^6 + 22*q^5 + 20*q^4 + 15*q^3 + 9*q^2 + 4*q + 1</span>
</pre></div>
</div>
</li>
<li><p><strong>Listing the objects.</strong> One can also compute the list of objects in a
<code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest&gt;</span></code>
using <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a>. As an example, we compute the set of numbers
between 1 and 63, generated by their binary expansion:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RecursivelyEnumeratedSet</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[(</span><span class="n">l</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span> <span class="k">else</span> <span class="p">[],</span>
<span class="gp">....: </span>    <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;forest&#39;</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">enumeration</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the list computed without <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">serial</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">serial</span>
<span class="go">[1, 2, 4, 8, 16, 32, 33, 17, 34, 35, 9, 18, 36, 37, 19, 38, 39, 5, 10,</span>
<span class="go"> 20, 40, 41, 21, 42, 43, 11, 22, 44, 45, 23, 46, 47, 3, 6, 12, 24, 48,</span>
<span class="go"> 49, 25, 50, 51, 13, 26, 52, 53, 27, 54, 55, 7, 14, 28, 56, 57, 29, 58,</span>
<span class="go"> 59, 15, 30, 60, 61, 31, 62, 63]</span>
</pre></div>
</div>
<p>Here is how to perform the parallel computation. The order of the lists
depends on the synchronisation of the various computation processes and
therefore should be considered as random:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">parall</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">map_reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="p">[])</span>
<span class="gp">sage: </span><span class="n">parall</span>  <span class="c1"># random</span>
<span class="go">[1, 3, 7, 15, 31, 63, 62, 30, 61, 60, 14, 29, 59, 58, 28, 57, 56, 6, 13,</span>
<span class="go"> 27, 55, 54, 26, 53, 52, 12, 25, 51, 50, 24, 49, 48, 2, 5, 11, 23, 47,</span>
<span class="go"> 46, 22, 45, 44, 10, 21, 43, 42, 20, 41, 40, 4, 9, 19, 39, 38, 18, 37,</span>
<span class="go"> 36, 8, 17, 35, 34, 16, 33, 32]</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parall</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="advanced-use">
<span id="id1"></span><h2>Advanced use<a class="headerlink" href="#advanced-use" title="Permalink to this heading">#</a></h2>
<p>Fine control over the execution of a map/reduce computation is achieved
via parameters passed to the <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.run" title="sage.parallel.map_reduce.RESetMapReduce.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RESetMapReduce.run()</span></code></a> method.
The following three parameters can be used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_proc</span></code> – (integer, default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) if given, the
maximum number of worker processors to use. The actual number
is also bounded by the value of the environment variable
<code class="docutils literal notranslate"><span class="pre">SAGE_NUM_THREADS</span></code> (the number of cores by default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> – a timeout on the computation (default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_locally</span></code> – whether the workers should reduce locally
their work or sends results to the master as soon as possible.
See <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a> for details.</p></li>
</ul>
<p>Here is an example or how to deal with timeout:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="p">(</span><span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">AbortError</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">res</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
<span class="gp">....: </span><span class="k">except</span> <span class="n">AbortError</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation timeout&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation normally finished&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">res</span>
<span class="go">Computation timeout</span>
</pre></div>
</div>
<p>The following should not timeout even on a very slow machine:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">res</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">except</span> <span class="n">AbortError</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation Timeout&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation normally finished&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">res</span>
<span class="go">Computation normally finished</span>
<span class="go">40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<p>As for <code class="docutils literal notranslate"><span class="pre">reduce_locally</span></code>, one should not see any difference, except for speed
during normal usage. Most of the time one should leave it set to <code class="docutils literal notranslate"><span class="pre">True</span></code>,
unless one sets up a mechanism to consume the partial results as soon as they
arrive. See <a class="reference internal" href="#sage.parallel.map_reduce.RESetParallelIterator" title="sage.parallel.map_reduce.RESetParallelIterator"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetParallelIterator</span></code></a> and in particular the <code class="docutils literal notranslate"><span class="pre">__iter__</span></code>
method for a example of consumer use.</p>
</section>
<section id="profiling">
<span id="id2"></span><h2>Profiling<a class="headerlink" href="#profiling" title="Permalink to this heading">#</a></h2>
<p>It is possible to profile a map/reduce computation. First we create a
<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a> object:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="n">roots</span><span class="o">=</span><span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="n">children</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="k">else</span> <span class="p">[],</span>
<span class="gp">....: </span>    <span class="n">map_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">reduce_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
<span class="gp">....: </span>    <span class="n">reduce_init</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The profiling is activated by the <code class="docutils literal notranslate"><span class="pre">profile</span></code> parameter. The value provided
should be a prefix (including a possible directory) for the profile dump:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="gp">sage: </span><span class="n">d</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;RESetMR_profile&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># random</span>
<span class="go">[RESetMapReduceWorker-1:58] (20:00:41.444) Profiling in</span>
<span class="go">/home/user/.sage/temp/.../32414/RESetMR_profilewRCRAx/profcomp1</span>
<span class="go">...</span>
<span class="go">[RESetMapReduceWorker-1:57] (20:00:41.444) Profiling in</span>
<span class="go">/home/user/.sage/temp/.../32414/RESetMR_profilewRCRAx/profcomp0</span>
<span class="go">...</span>
<span class="gp">sage: </span><span class="n">res</span>
<span class="go">131071</span>
</pre></div>
</div>
<p>In this example, the profiles have been dumped in files such as
<code class="docutils literal notranslate"><span class="pre">profcomp0</span></code>. One can then load and print them as follows. See
<code class="xref py py-class docutils literal notranslate"><span class="pre">cProfile.Profile</span></code> for more details:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">cProfile</span><span class="o">,</span> <span class="nn">pstats</span>
<span class="gp">sage: </span><span class="n">st</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">st</span><span class="o">.</span><span class="n">strip_dirs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s1">&#39;cumulative&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>  <span class="c1"># random</span>
<span class="go">...</span>
<span class="go">   Ordered by: cumulative time</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">        1    0.023    0.023    0.432    0.432 map_reduce.py:1211(run_myself)</span>
<span class="go">    11968    0.151    0.000    0.223    0.000 map_reduce.py:1292(walk_branch_locally)</span>
<span class="go">...</span>
<span class="go">&lt;pstats.Stats instance at 0x7fedea40c6c8&gt;</span>
</pre></div>
</div>
<p>Like a good neighbor we clean up our temporary directory as soon as
possible:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">d</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.python.org/2/library/profile.html">The Python Profilers</a>
for more detail on profiling in python.</p>
</div>
</section>
<section id="logging">
<span id="id3"></span><h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">#</a></h2>
<p>The computation progress is logged through a <a class="reference external" href="https://docs.python.org/library/logging.html#logging.Logger" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> in
<code class="docutils literal notranslate"><span class="pre">sage.parallel.map_reduce.logger</span></code> together with <a class="reference external" href="https://docs.python.org/library/logging.handlers.html#logging.StreamHandler" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.StreamHandler</span></code></a>
and a <a class="reference external" href="https://docs.python.org/library/logging.html#logging.Formatter" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Formatter</span></code></a>. They are currently configured to print
warning messages to the console.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.python.org/2/library/logging.html">Logging facility for Python</a>
for more detail on logging and log system configuration.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Calls to logger which involve printing the node are commented out in the
code, because the printing (to a string) of the node can be very time
consuming depending on the node and it happens before the decision whether
the logger should record the string or drop it.</p>
</div>
</section>
<section id="how-does-it-work">
<span id="protocol-description"></span><h2>How does it work ?<a class="headerlink" href="#how-does-it-work" title="Permalink to this heading">#</a></h2>
<p>The scheduling algorithm we use here is any adaptation of <a class="reference external" href="https://en.wikipedia.org/wiki/Work_stealing">Wikipedia article Work_stealing</a>:</p>
<blockquote>
<div><p>In a work stealing scheduler, each processor in a computer system has a
queue of work items (computational tasks, threads) to perform. […]. Each
work items are initially put on the queue of the processor executing the
work item. When a processor runs out of work, it looks at the queues of
other processors and “steals” their work items. In effect, work stealing
distributes the scheduling work over idle processors, and as long as all
processors have work to do, no scheduling overhead occurs.</p>
</div></blockquote>
<p>For communication we use Python’s basic <a class="reference external" href="https://docs.python.org/library/multiprocessing.html#module-multiprocessing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> module. We
first describe the different actors and communication tools used by the
system. The work is done under the coordination of a <strong>master</strong> object (an
instance of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a>) by a bunch of <strong>worker</strong> objects
(instances of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a>).</p>
<p>Each running map reduce instance works on a <code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest&gt;</span></code> called here <span class="math notranslate nohighlight">\(C\)</span> and is
coordinated by a <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a> object called the <strong>master</strong>. The
master is in charge of launching the work, gathering the results and cleaning
up at the end of the computation. It doesn’t perform any computation
associated to the generation of the element <span class="math notranslate nohighlight">\(C\)</span> nor the computation of the
mapped function. It however occasionally perform a reduce, but most reducing
is by default done by the workers. Also thanks to the work-stealing algorithm,
the master is only involved in detecting the termination of the computation
but all the load balancing is done at the level of the workers.</p>
<p>Workers are instances of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a>. They are responsible
for doing the actual computations: element generation, mapping and reducing.
They are also responsible for the load balancing thanks to work-stealing.</p>
<p>Here is a description of the attributes of the <strong>master</strong> relevant to the
map-reduce protocol:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_results</span></code> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleQueue</span></code> where
the master gathers the results sent by the workers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_active_tasks</span></code> – a <a class="reference external" href="https://docs.python.org/library/multiprocessing.html#multiprocessing.Semaphore" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Semaphore</span></code></a> recording
the number of active tasks.  The work is complete when it reaches 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_done</span></code> – a <a class="reference external" href="https://docs.python.org/library/multiprocessing.html#multiprocessing.Lock" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Lock</span></code></a> which ensures that
shutdown is done only once.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_aborted</span></code> – a <a class="reference external" href="https://docs.python.org/library/multiprocessing.html#multiprocessing.Value" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">Value()</span></code></a> storing a shared
<a class="reference external" href="https://docs.python.org/library/ctypes.html#ctypes.c_bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ctypes.c_bool</span></code></a> which is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the computation was aborted
before all workers ran out of work.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_workers</span></code> – a list of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a> objects.
Each worker is identified by its position in this list.</p></li>
</ul>
<p>Each <strong>worker</strong> is a process (<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a> inherits from
<a class="reference external" href="https://docs.python.org/library/multiprocessing.html#multiprocessing.Process" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Process</span></code></a>) which contains:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">worker._iproc</span></code> – the identifier of the worker that is its position in the
master’s list of workers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker._todo</span></code> – a <a class="reference external" href="https://docs.python.org/library/collections.html#collections.deque" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.deque</span></code></a> storing of nodes of the
worker. It is used as a stack by the worker. Thiefs steal from the bottom of
this queue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker._request</span></code> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleQueue</span></code> storing
steal request submitted to <code class="docutils literal notranslate"><span class="pre">worker</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker._read_task</span></code>, <code class="docutils literal notranslate"><span class="pre">worker._write_task</span></code> – a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Pipe</span></code> used to transfer node during steal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker._thief</span></code> – a <a class="reference external" href="https://docs.python.org/library/threading.html#threading.Thread" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> which is in charge of
stealing from <code class="docutils literal notranslate"><span class="pre">worker._todo</span></code>.</p></li>
</ul>
<p>Here is a schematic of the architecture:</p>
<figure class="align-default" id="figure-map-reduce-arch">
<img alt="../../_images/map_reduce_arch.png" src="../../_images/map_reduce_arch.png" />
</figure>
</section>
<section id="how-thefts-are-performed">
<h2>How thefts are performed<a class="headerlink" href="#how-thefts-are-performed" title="Permalink to this heading">#</a></h2>
<p>During normal time, that is, when all workers are active, a worker <code class="docutils literal notranslate"><span class="pre">W</span></code> is
iterating though a loop inside
<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.walk_branch_locally" title="sage.parallel.map_reduce.RESetMapReduceWorker.walk_branch_locally"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RESetMapReduceWorker.walk_branch_locally()</span></code></a>. Work nodes are taken from
and new nodes <code class="docutils literal notranslate"><span class="pre">W._todo</span></code> are appended to <code class="docutils literal notranslate"><span class="pre">W._todo</span></code>. When a worker <code class="docutils literal notranslate"><span class="pre">W</span></code>
runs out of work, that is, when <code class="docutils literal notranslate"><span class="pre">worker._todo</span></code> is empty, it tries to steal
some work (i.e., a node) from another worker. This is performed in the
<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.steal" title="sage.parallel.map_reduce.RESetMapReduceWorker.steal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RESetMapReduceWorker.steal()</span></code></a> method.</p>
<p>From the point of view of <code class="docutils literal notranslate"><span class="pre">W</span></code>, here is what happens:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> signals to the master that it is idle: <code class="docutils literal notranslate"><span class="pre">master._signal_task_done</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> chooses a victim <code class="docutils literal notranslate"><span class="pre">V</span></code> at random;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> sends a request to <code class="docutils literal notranslate"><span class="pre">V</span></code>: it puts its identifier into <code class="docutils literal notranslate"><span class="pre">V._request</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">W</span></code> tries to read a node from <code class="docutils literal notranslate"><span class="pre">W._read_task</span></code>. Then three things may happen:</p>
<ul>
<li><p>a proper node is read. Then the theft was a success and <code class="docutils literal notranslate"><span class="pre">W</span></code> starts
working locally on the received node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> is received. This means that <code class="docutils literal notranslate"><span class="pre">V</span></code> was idle. Then <code class="docutils literal notranslate"><span class="pre">W</span></code> tries
another victim.</p></li>
<li><p><a class="reference internal" href="#sage.parallel.map_reduce.AbortError" title="sage.parallel.map_reduce.AbortError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AbortError</span></code></a> is received. This means either that the computation was
aborted or that it simply succeeded and that no more work is required by
<code class="docutils literal notranslate"><span class="pre">W</span></code>. Therefore an <a class="reference internal" href="#sage.parallel.map_reduce.AbortError" title="sage.parallel.map_reduce.AbortError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AbortError</span></code></a> exception is raised leading <code class="docutils literal notranslate"><span class="pre">W</span></code> to
shutdown.</p></li>
</ul>
</li>
</ul>
<p>We now describe the protocol on the victim’s side. Each worker process contains
a <a class="reference external" href="https://docs.python.org/library/threading.html#threading.Thread" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> which we call <code class="docutils literal notranslate"><span class="pre">T</span></code> for thief which acts like some kind of
Troyan horse during theft. It is normally blocked waiting for a steal request.</p>
<p>From the point of view of <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span></code>, here is what happens:</p>
<ul class="simple">
<li><p>during normal time, <code class="docutils literal notranslate"><span class="pre">T</span></code> is blocked waiting on <code class="docutils literal notranslate"><span class="pre">V._request</span></code>;</p></li>
<li><p>upon steal request, <code class="docutils literal notranslate"><span class="pre">T</span></code> wakes up receiving the identification of <code class="docutils literal notranslate"><span class="pre">W</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code> signals to the master that a new task is starting by
<code class="docutils literal notranslate"><span class="pre">master._signal_task_start</span></code>;</p></li>
<li><p>Two things may happen depending if the queue <code class="docutils literal notranslate"><span class="pre">V._todo</span></code> is empty or not.
Remark that due to the GIL, there is no parallel execution between the
victim <code class="docutils literal notranslate"><span class="pre">V</span></code> and its thief thread <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">V._todo</span></code> is empty, then <code class="docutils literal notranslate"><span class="pre">None</span></code> is answered on
<code class="docutils literal notranslate"><span class="pre">W._write_task</span></code>. The task is immediately signaled to end the master
through <code class="docutils literal notranslate"><span class="pre">master._signal_task_done</span></code>.</p></li>
<li><p>Otherwise, a node is removed from the bottom of <code class="docutils literal notranslate"><span class="pre">V._todo</span></code>. The node is
sent to <code class="docutils literal notranslate"><span class="pre">W</span></code> on <code class="docutils literal notranslate"><span class="pre">W._write_task</span></code>. The task will be ended by <code class="docutils literal notranslate"><span class="pre">W</span></code>, that
is, when finished working on the subtree rooted at the node, <code class="docutils literal notranslate"><span class="pre">W</span></code> will
call <code class="docutils literal notranslate"><span class="pre">master._signal_task_done</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="the-end-of-the-computation">
<h2>The end of the computation<a class="headerlink" href="#the-end-of-the-computation" title="Permalink to this heading">#</a></h2>
<p>To detect when a computation is finished, a synchronized integer is kept which
counts the number of active tasks. This is essentially a semaphore but
semaphores are broken on Darwin OSes so we ship two implementations depending
on the OS (see <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounter" title="sage.parallel.map_reduce.ActiveTaskCounter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActiveTaskCounter</span></code></a> and <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin" title="sage.parallel.map_reduce.ActiveTaskCounterDarwin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActiveTaskCounterDarwin</span></code></a>
and the note below).</p>
<p>When a worker finishes working on a task, it calls
<code class="docutils literal notranslate"><span class="pre">master._signal_task_done</span></code>. This decreases the task counter
<code class="docutils literal notranslate"><span class="pre">master._active_tasks</span></code>. When it reaches 0, it means that there are no more
nodes: the work is completed. The worker executes <code class="docutils literal notranslate"><span class="pre">master._shutdown</span></code>
which sends <a class="reference internal" href="#sage.parallel.map_reduce.AbortError" title="sage.parallel.map_reduce.AbortError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AbortError</span></code></a> to all <code class="docutils literal notranslate"><span class="pre">worker._request</span></code> and
<code class="docutils literal notranslate"><span class="pre">worker._write_task</span></code> queues. Each worker or thief thread receiving such
a message raises the corresponding exception, therefore stopping its work. A
lock called <code class="docutils literal notranslate"><span class="pre">master._done</span></code> ensures that shutdown is only done once.</p>
<p>Finally, it is also possible to interrupt the computation before its ends,
by calling <code class="docutils literal notranslate"><span class="pre">master.abort()</span></code>. This is achieved by setting
<code class="docutils literal notranslate"><span class="pre">master._active_tasks</span></code> to 0 and calling <code class="docutils literal notranslate"><span class="pre">master._shutdown</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The macOS Semaphore bug</p>
<p>Darwin OSes do not correctly implement POSIX’s semaphore semantic.
Indeed, on these systems, acquire may fail and return False not only when
the semaphore is equal to zero but also <strong>because someone else is trying
to acquire</strong> at the same time. This makes using Semaphores impossible
on macOS so that on these systems we use a synchronized integer instead.</p>
</div>
</section>
<section id="are-there-examples-of-classes">
<span id="examples"></span><h2>Are there examples of classes?<a class="headerlink" href="#are-there-examples-of-classes" title="Permalink to this heading">#</a></h2>
<p>Yes! Here they are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sage.parallel.map_reduce.RESetMPExample" title="sage.parallel.map_reduce.RESetMPExample"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMPExample</span></code></a> – a simple basic example</p></li>
<li><p><a class="reference internal" href="#sage.parallel.map_reduce.RESetParallelIterator" title="sage.parallel.map_reduce.RESetParallelIterator"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetParallelIterator</span></code></a> – a more advanced example using non standard
communication configuration.</p></li>
</ul>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this heading">#</a></h2>
<p>Generating series for the sum of strictly decreasing lists of integers
smaller than 15:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">y</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">R</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span>
<span class="gp">....: </span>    <span class="n">roots</span><span class="o">=</span><span class="p">[([],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[([</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)],</span>
<span class="gp">....: </span>    <span class="n">children</span><span class="o">=</span><span class="k">lambda</span> <span class="n">list_sum_last</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="p">[(</span><span class="n">list_sum_last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">list_sum_last</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="gp">....: </span>         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">list_sum_last</span><span class="p">[</span><span class="mi">2</span><span class="p">])],</span>
<span class="gp">....: </span>    <span class="n">map_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">li_sum_dummy</span><span class="p">:</span> <span class="n">y</span><span class="o">**</span><span class="n">li_sum_dummy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">sg</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sg</span> <span class="o">==</span> <span class="n">prod</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="classes-and-methods">
<h2>Classes and methods<a class="headerlink" href="#classes-and-methods" title="Permalink to this heading">#</a></h2>
</section>
<dl class="py exception">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.AbortError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">AbortError</span></span><a class="headerlink" href="#sage.parallel.map_reduce.AbortError" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/exceptions.html#Exception" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
<p>Exception for aborting parallel computations.</p>
<p>This is used both as exception or as abort message.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounter">
<span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">ActiveTaskCounter</span></span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounter" title="Permalink to this definition">#</a></dt>
<dd><p>alias of <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix" title="sage.parallel.map_reduce.ActiveTaskCounterPosix"><code class="xref py py-class docutils literal notranslate"><span class="pre">ActiveTaskCounterPosix</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterDarwin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">ActiveTaskCounterDarwin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_number</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Handling the number of active tasks.</p>
<p>A class for handling the number of active tasks in a distributed
computation process. This is essentially a semaphore, but Darwin OSes
do not correctly implement POSIX’s semaphore semantic. So we use
a shared integer with a lock.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterDarwin.abort">
<span class="sig-name descname"><span class="pre">abort</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.abort" title="Permalink to this definition">#</a></dt>
<dd><p>Set the task counter to zero.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounterDarwin</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=0)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_done">
<span class="sig-name descname"><span class="pre">task_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_done" title="Permalink to this definition">#</a></dt>
<dd><p>Decrement the task counter by one.</p>
<p>OUTPUT:</p>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_done" title="sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_done"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_done()</span></code></a> decrements the counter and returns
its new value.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounterDarwin</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=3)</span>

<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<span class="go">-1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start">
<span class="sig-name descname"><span class="pre">task_start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start" title="Permalink to this definition">#</a></dt>
<dd><p>Increment the task counter by one.</p>
<p>OUTPUT:</p>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start" title="sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_start()</span></code></a> on a zero or negative counter returns 0,
otherwise increment the counter and returns its value after the
incrementation.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounterDarwin</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_start</span><span class="p">()</span>
<span class="go">5</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=5)</span>
</pre></div>
</div>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start" title="sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_start()</span></code></a> on a zero counter does nothing:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_start</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=0)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterPosix">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">ActiveTaskCounterPosix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_number</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Handling the number of active tasks.</p>
<p>A class for handling the number of active tasks in a distributed
computation process. This is the standard implementation on POSIX
compliant OSes. We essentially wrap a semaphore.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A legitimate question is whether there is a need in keeping the two
implementations. I ran the following experiment on my machine:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">S = RecursivelyEnumeratedSet(</span>
<span class="go">        [[]],</span>
<span class="go">        lambda l: ([l[:i] + [len(l)] + l[i:]</span>
<span class="go">                    for i in range(len(l) + 1)]</span>
<span class="go">                   if len(l) &lt; NNN else []),</span>
<span class="go">        structure=&#39;forest&#39;,</span>
<span class="go">        enumeration=&#39;depth&#39;)</span>
<span class="go">%time sp = S.map_reduce(lambda z: x**len(z)); sp</span>
</pre></div>
</div>
<p>For NNN = 10, averaging a dozen of runs, I got:</p>
<ul class="simple">
<li><p>Posix compliant implementation: 17.04 s</p></li>
<li><p>Darwin implementation: 18.26 s</p></li>
</ul>
<p>So there is a non negligible overhead. It will probably be worth it
if we try to cythonize the code. So I’m keeping both implementations.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterPosix.abort">
<span class="sig-name descname"><span class="pre">abort</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.abort" title="Permalink to this definition">#</a></dt>
<dd><p>Set the task counter to zero.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounter</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=0)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done">
<span class="sig-name descname"><span class="pre">task_done</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done" title="Permalink to this definition">#</a></dt>
<dd><p>Decrement the task counter by one.</p>
<p>OUTPUT:</p>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done" title="sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_done()</span></code></a> decrements the counter and returns
its new value.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounter</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=3)</span>

<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
<span class="go">-1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start">
<span class="sig-name descname"><span class="pre">task_start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start" title="Permalink to this definition">#</a></dt>
<dd><p>Increment the task counter by one.</p>
<p>OUTPUT:</p>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start" title="sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_start()</span></code></a> on a zero or negative counter returns 0,
otherwise increment the counter and returns its value after the
incrementation.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">ActiveTaskCounterDarwin</span> <span class="k">as</span> <span class="n">ATC</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="n">c</span>
<span class="go">ActiveTaskCounter(value=4)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_start</span><span class="p">()</span>
<span class="go">5</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=5)</span>
</pre></div>
</div>
<p>Calling <a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start" title="sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task_start()</span></code></a> on a zero counter does nothing:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">ATC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">task_start</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">ActiveTaskCounter(value=0)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMPExample">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">RESetMPExample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">maxl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMPExample" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a></p>
<p>An example of map reduce class.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maxl</span></code> – the maximum size of permutations generated (default to <span class="math notranslate nohighlight">\(9\)</span>).</p></li>
</ul>
<p>This computes the generating series of permutations counted by their size
up to size <code class="docutils literal notranslate"><span class="pre">maxl</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">362880*x^9 + 40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5</span>
<span class="go">+ 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This is an example of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a></p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMPExample.children">
<span class="sig-name descname"><span class="pre">children</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMPExample.children" title="Permalink to this definition">#</a></dt>
<dd><p>Return the children of the permutation <span class="math notranslate nohighlight">\(l\)</span>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code> – a list containing a permutation</p></li>
</ul>
<p>OUTPUT:</p>
<p>The lists with <code class="docutils literal notranslate"><span class="pre">len(l)</span></code> inserted at all possible positions into <code class="docutils literal notranslate"><span class="pre">l</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">RESetMPExample</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="go">[[2, 1, 0], [1, 2, 0], [1, 0, 2]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMPExample.map_function">
<span class="sig-name descname"><span class="pre">map_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMPExample.map_function" title="Permalink to this definition">#</a></dt>
<dd><p>The monomial associated to the permutation <span class="math notranslate nohighlight">\(l\)</span>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code> – a list containing a permutation</p></li>
</ul>
<p>OUTPUT:</p>
<p>The monomial <code class="docutils literal notranslate"><span class="pre">x^len(l)</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">RESetMPExample</span><span class="p">()</span><span class="o">.</span><span class="n">map_function</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="go">x^2</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMPExample.roots">
<span class="sig-name descname"><span class="pre">roots</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMPExample.roots" title="Permalink to this definition">#</a></dt>
<dd><p>Return the empty permutation.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">RESetMPExample</span><span class="p">()</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<span class="go">[[]]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">RESetMapReduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">children</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_process</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Map-Reduce on recursively enumerated sets.</p>
<p>INPUT:</p>
<p>Description of the set:</p>
<ul class="simple">
<li><p>either <code class="docutils literal notranslate"><span class="pre">forest=f</span></code> – where <code class="docutils literal notranslate"><span class="pre">f</span></code> is a <code class="xref py py-class docutils literal notranslate"><span class="pre">RecursivelyEnumeratedSet_forest&gt;</span></code></p></li>
<li><p>or a triple <code class="docutils literal notranslate"><span class="pre">roots,</span> <span class="pre">children,</span> <span class="pre">post_process</span></code> as follows</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">roots=r</span></code> – The root of the enumeration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">children=c</span></code> – a function iterating through children nodes,
given a parent node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post_process=p</span></code> – a post-processing function</p></li>
</ul>
</li>
</ul>
<p>The option <code class="docutils literal notranslate"><span class="pre">post_process</span></code> allows for customizing the nodes that
are actually produced. Furthermore, if <code class="docutils literal notranslate"><span class="pre">post_process(x)</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code>,
then <code class="docutils literal notranslate"><span class="pre">x</span></code> won’t be output at all.</p>
<p>Description of the map/reduce operation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">map_function=f</span></code> – (default to <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_function=red</span></code> – (default to <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_init=init</span></code> – (default to <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#module-sage.parallel.map_reduce" title="sage.parallel.map_reduce"><code class="xref py py-mod docutils literal notranslate"><span class="pre">the</span> <span class="pre">Map/Reduce</span> <span class="pre">module</span></code></a> for
details and examples.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.abort">
<span class="sig-name descname"><span class="pre">abort</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.abort" title="Permalink to this definition">#</a></dt>
<dd><p>Abort the current parallel computation.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetParallelIterator</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetParallelIterator</span><span class="p">([[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">17</span> <span class="k">else</span> <span class="p">[])</span>
<span class="gp">sage: </span><span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>  <span class="c1"># random</span>
<span class="go">[]</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="s1">&#39;work_queue&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Cleanup:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.finish">
<span class="sig-name descname"><span class="pre">finish</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.finish" title="Permalink to this definition">#</a></dt>
<dd><p>Destroy the workers and all the communication objects.</p>
<p>Communication statistics are gathered before destroying the workers.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.print_communication_statistics" title="sage.parallel.map_reduce.RESetMapReduce.print_communication_statistics"><code class="xref py py-meth docutils literal notranslate"><span class="pre">print_communication_statistics()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.get_results">
<span class="sig-name descname"><span class="pre">get_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.get_results" title="Permalink to this definition">#</a></dt>
<dd><p>Get the results from the queue.</p>
<p>OUTPUT:</p>
<p>The reduction of the results of all the workers, that is, the result of
the map/reduce computation.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span> <span class="n">S</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
<span class="go">6</span>
</pre></div>
</div>
<p>Cleanup:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">S</span><span class="o">.</span><span class="n">_results</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">_active_tasks</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">_done</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">_workers</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.map_function">
<span class="sig-name descname"><span class="pre">map_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">o</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.map_function" title="Permalink to this definition">#</a></dt>
<dd><p>Return the function mapped by <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">o</span></code> – a node</p></li>
</ul>
<p>OUTPUT:</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be overloaded in applications.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">map_function</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span><span class="n">map_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">map_function</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">26</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.post_process">
<span class="sig-name descname"><span class="pre">post_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.post_process" title="Permalink to this definition">#</a></dt>
<dd><p>Return the image of <code class="docutils literal notranslate"><span class="pre">a</span></code> under the post-processing function for <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> – a node</p></li>
</ul>
<p>With the default post-processing function, which is the identity function,
this returns <code class="docutils literal notranslate"><span class="pre">a</span></code> itself.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be overloaded in applications.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">post_process</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span><span class="n">post_process</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">post_process</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">16</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.print_communication_statistics">
<span class="sig-name descname"><span class="pre">print_communication_statistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.print_communication_statistics" title="Permalink to this definition">#</a></dt>
<dd><p>Print the communication statistics in a nice way.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>

<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">print_communication_statistics</span><span class="p">()</span>  <span class="c1"># random</span>
<span class="go">#proc:        0    1    2    3    4    5    6    7</span>
<span class="go">reqs sent:    5    2    3   11   21   19    1    0</span>
<span class="go">reqs rcvs:   10   10    9    5    1   11    9    2</span>
<span class="go">- thefs:      1    0    0    0    0    0    0    0</span>
<span class="go">+ thefs:      0    0    1    0    0    0    0    0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.random_worker">
<span class="sig-name descname"><span class="pre">random_worker</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.random_worker" title="Permalink to this definition">#</a></dt>
<dd><p>Return a random worker.</p>
<p>OUTPUT:</p>
<p>A worker for <code class="docutils literal notranslate"><span class="pre">self</span></code> chosen at random.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">random_worker</span><span class="p">()</span>
<span class="go">&lt;RESetMapReduceWorker...RESetMapReduceWorker-... initial...&gt;</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">random_worker</span><span class="p">()</span> <span class="ow">in</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Cleanup:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">EX</span><span class="o">.</span><span class="n">_results</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_active_tasks</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_done</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.reduce_function">
<span class="sig-name descname"><span class="pre">reduce_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.reduce_function" title="Permalink to this definition">#</a></dt>
<dd><p>Return the reducer function for <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> – two values to be reduced</p></li>
</ul>
<p>OUTPUT:</p>
<p>By default the sum of <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be overloaded in applications.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">reduce_function</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">7</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span><span class="n">reduce_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">reduce_function</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">12</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.reduce_init">
<span class="sig-name descname"><span class="pre">reduce_init</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.reduce_init" title="Permalink to this definition">#</a></dt>
<dd><p>Return the initial element for a reduction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be overloaded in applications.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.roots">
<span class="sig-name descname"><span class="pre">roots</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.roots" title="Permalink to this definition">#</a></dt>
<dd><p>Return the roots of <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>OUTPUT:</p>
<p>An iterable of nodes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This should be overloaded in applications.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMapReduce</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetMapReduce</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<span class="go">42</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_proc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_locally</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">profile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.run" title="Permalink to this definition">#</a></dt>
<dd><p>Run the computations.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_proc</span></code> – (integer, default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) if given, the
maximum number of worker processors to use. The actual number
is also bounded by the value of the environment variable
<code class="docutils literal notranslate"><span class="pre">SAGE_NUM_THREADS</span></code> (the number of cores by default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_locally</span></code> – See <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a> (default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> – a timeout on the computation (default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">profile</span></code> – directory/filename prefix for profiling, or <code class="docutils literal notranslate"><span class="pre">None</span></code>
for no profiling (default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li>
</ul>
<p>OUTPUT:</p>
<p>The result of the map/reduce computation or an exception
<a class="reference internal" href="#sage.parallel.map_reduce.AbortError" title="sage.parallel.map_reduce.AbortError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AbortError</span></code></a> if the computation was interrupted or timeout.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="go">40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<p>Here is an example or how to deal with timeout:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">AbortError</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">res</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
<span class="gp">....: </span><span class="k">except</span> <span class="n">AbortError</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation timeout&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation normally finished&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">res</span>
<span class="go">Computation timeout</span>
</pre></div>
</div>
<p>The following should not timeout even on a very slow machine:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">AbortError</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="n">res</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">except</span> <span class="n">AbortError</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation Timeout&quot;</span><span class="p">)</span>
<span class="gp">....: </span><span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computation normally finished&quot;</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="n">res</span>
<span class="go">Computation normally finished</span>
<span class="go">40320*x^8 + 5040*x^7 + 720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.run_serial">
<span class="sig-name descname"><span class="pre">run_serial</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.run_serial" title="Permalink to this definition">#</a></dt>
<dd><p>Run the computation serially (mostly for tests).</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">run_serial</span><span class="p">()</span>
<span class="go">24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.setup_workers">
<span class="sig-name descname"><span class="pre">setup_workers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_proc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_locally</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.setup_workers" title="Permalink to this definition">#</a></dt>
<dd><p>Setup the communication channels.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_proc</span></code> – (integer) an upper bound on the number of
worker processes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_locally</span></code> – whether the workers should reduce locally
their work or sends results to the master as soon as possible.
See <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="sage.parallel.map_reduce.RESetMapReduceWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a> for details.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduce.start_workers">
<span class="sig-name descname"><span class="pre">start_workers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduce.start_workers" title="Permalink to this definition">#</a></dt>
<dd><p>Launch the workers.</p>
<p>The workers should have been created using <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.setup_workers" title="sage.parallel.map_reduce.RESetMapReduce.setup_workers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_workers()</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">RESetMapReduceWorker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iproc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_locally</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ForkProcess</span></code></p>
<p>Worker for generate-map-reduce.</p>
<p>This shouldn’t be called directly, but instead created by
<a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.setup_workers" title="sage.parallel.map_reduce.RESetMapReduce.setup_workers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RESetMapReduce.setup_workers()</span></code></a>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mapred</span></code> – the instance of <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a> for which
this process is working.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iproc</span></code> – the id of this worker.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce_locally</span></code> – when reducing the results. Three possible values
are supported:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> – means the reducing work is done all locally, the result is
only sent back at the end of the work. This ensure the lowest level of
communication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> – results are sent back after each finished branches, when
the process is asking for more work.</p></li>
</ul>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker.run" title="Permalink to this definition">#</a></dt>
<dd><p>The main function executed by the worker.</p>
<p>Calls <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.run_myself" title="sage.parallel.map_reduce.RESetMapReduceWorker.run_myself"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run_myself()</span></code></a> after possibly setting up parallel profiling.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">w</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EX</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
<span class="go">720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<p>Cleanups:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">EX</span><span class="o">.</span><span class="n">_results</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_active_tasks</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_done</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker.run_myself">
<span class="sig-name descname"><span class="pre">run_myself</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker.run_myself" title="Permalink to this definition">#</a></dt>
<dd><p>The main function executed by the worker.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">w</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EX</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">run_myself</span><span class="p">()</span>

<span class="gp">sage: </span><span class="n">sleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>
<span class="go">720*x^6 + 120*x^5 + 24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
<p>Cleanups:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">EX</span><span class="o">.</span><span class="n">_results</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_active_tasks</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_done</span><span class="p">,</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker.send_partial_result">
<span class="sig-name descname"><span class="pre">send_partial_result</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker.send_partial_result" title="Permalink to this definition">#</a></dt>
<dd><p>Send results to the MapReduce process.</p>
<p>Send the result stored in <code class="docutils literal notranslate"><span class="pre">self._res</span></code> to the master an reinitialize it to
<code class="docutils literal notranslate"><span class="pre">master.reduce_init</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">w</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">send_partial_result</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">4</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker.steal">
<span class="sig-name descname"><span class="pre">steal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker.steal" title="Permalink to this definition">#</a></dt>
<dd><p>Steal some node from another worker.</p>
<p>OUTPUT:</p>
<p>A node stolen from another worker chosen at random.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">EX</span><span class="o">.</span><span class="n">setup_workers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">sage: </span><span class="c1"># known bug (Issue #27537)</span>
<span class="gp">sage: </span><span class="n">w0</span><span class="p">,</span> <span class="n">w1</span> <span class="o">=</span> <span class="n">EX</span><span class="o">.</span><span class="n">_workers</span>
<span class="gp">sage: </span><span class="n">w0</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">thief0</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">w0</span><span class="o">.</span><span class="n">_thief</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Thief&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">thief0</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">w1</span><span class="o">.</span><span class="n">steal</span><span class="p">()</span>
<span class="go">42</span>
<span class="gp">sage: </span><span class="n">w0</span><span class="o">.</span><span class="n">_todo</span>
<span class="go">deque([])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetMapReduceWorker.walk_branch_locally">
<span class="sig-name descname"><span class="pre">walk_branch_locally</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetMapReduceWorker.walk_branch_locally" title="Permalink to this definition">#</a></dt>
<dd><p>Work locally.</p>
<p>Performs the map/reduce computation on the subtrees rooted at <code class="docutils literal notranslate"><span class="pre">node</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> – the root of the subtree explored.</p></li>
</ul>
<p>OUTPUT:</p>
<p>Nothing, the result are stored in <code class="docutils literal notranslate"><span class="pre">self._res</span></code>.</p>
<p>This is where the actual work is performed.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetMPExample</span><span class="p">,</span> <span class="n">RESetMapReduceWorker</span>
<span class="gp">sage: </span><span class="n">EX</span> <span class="o">=</span> <span class="n">RESetMPExample</span><span class="p">(</span><span class="n">maxl</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">w</span> <span class="o">=</span> <span class="n">RESetMapReduceWorker</span><span class="p">(</span><span class="n">EX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">sync</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">synchronize</span> <span class="o">=</span> <span class="n">sync</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="mi">0</span>

<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">walk_branch_locally</span><span class="p">([])</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span>
<span class="go">x^4 + x^3 + x^2 + x + 1</span>

<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">walk_branch_locally</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span>
<span class="go">2*x^4 + x^3 + x^2 + x + 1</span>

<span class="gp">sage: </span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">walk_branch_locally</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">_todo</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">IndexError: pop from an empty deque</span>
<span class="gp">sage: </span><span class="n">w</span><span class="o">.</span><span class="n">_res</span>
<span class="go">24*x^4 + 6*x^3 + 2*x^2 + x + 1</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetParallelIterator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">RESetParallelIterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">children</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_process</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetParallelIterator" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a></p>
<p>A parallel iterator for recursively enumerated sets.</p>
<p>This demonstrates how to use <a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce" title="sage.parallel.map_reduce.RESetMapReduce"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a> to get an iterator on
a recursively enumerated set for which the computations are done in
parallel.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetParallelIterator</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetParallelIterator</span><span class="p">([[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">15</span> <span class="k">else</span> <span class="p">[])</span>
<span class="gp">sage: </span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">S</span><span class="p">)</span>
<span class="go">65535</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetParallelIterator.map_function">
<span class="sig-name descname"><span class="pre">map_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.RESetParallelIterator.map_function" title="Permalink to this definition">#</a></dt>
<dd><p>Return a singleton tuple.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">z</span></code> – a node</p></li>
</ul>
<p>OUTPUT:</p>
<p>The singleton <code class="docutils literal notranslate"><span class="pre">(z,</span> <span class="pre">)</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">RESetParallelIterator</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">RESetParallelIterator</span><span class="p">(</span> <span class="p">[[]],</span>
<span class="gp">....: </span>    <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">15</span> <span class="k">else</span> <span class="p">[])</span>
<span class="gp">sage: </span><span class="n">S</span><span class="o">.</span><span class="n">map_function</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="go">([1, 0],)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.RESetParallelIterator.reduce_init">
<span class="sig-name descname"><span class="pre">reduce_init</span></span><a class="headerlink" href="#sage.parallel.map_reduce.RESetParallelIterator.reduce_init" title="Permalink to this definition">#</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.parallel.map_reduce.proc_number">
<span class="sig-prename descclassname"><span class="pre">sage.parallel.map_reduce.</span></span><span class="sig-name descname"><span class="pre">proc_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_proc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.parallel.map_reduce.proc_number" title="Permalink to this definition">#</a></dt>
<dd><p>Return the number of processes to use.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_proc</span></code> – an upper bound on the number of processes or
<code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.parallel.map_reduce</span> <span class="kn">import</span> <span class="n">proc_number</span>
<span class="gp">sage: </span><span class="n">proc_number</span><span class="p">()</span>  <span class="c1"># random</span>
<span class="go">8</span>
<span class="gp">sage: </span><span class="n">proc_number</span><span class="p">(</span><span class="n">max_proc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">sage: </span><span class="n">proc_number</span><span class="p">(</span><span class="n">max_proc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="multiprocessing_sage.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Parallel Iterator built using Python’s multiprocessing module</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="use_fork.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Parallel iterator built using the <code class="docutils literal notranslate"><span class="pre">fork()</span></code> system call</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Parallel computations using RecursivelyEnumeratedSet and Map-Reduce</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#how-is-this-different-from-usual-mapreduce">How is this different from usual MapReduce?</a></li>
<li><a class="reference internal" href="#how-can-i-use-all-that-stuff">How can I use all that stuff?</a></li>
<li><a class="reference internal" href="#advanced-use">Advanced use</a></li>
<li><a class="reference internal" href="#profiling">Profiling</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work ?</a></li>
<li><a class="reference internal" href="#how-thefts-are-performed">How thefts are performed</a></li>
<li><a class="reference internal" href="#the-end-of-the-computation">The end of the computation</a></li>
<li><a class="reference internal" href="#are-there-examples-of-classes">Are there examples of classes?</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#classes-and-methods">Classes and methods</a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.AbortError"><code class="docutils literal notranslate"><span class="pre">AbortError</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounter"><code class="docutils literal notranslate"><span class="pre">ActiveTaskCounter</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin"><code class="docutils literal notranslate"><span class="pre">ActiveTaskCounterDarwin</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.abort"><code class="docutils literal notranslate"><span class="pre">abort()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_done"><code class="docutils literal notranslate"><span class="pre">task_done()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterDarwin.task_start"><code class="docutils literal notranslate"><span class="pre">task_start()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix"><code class="docutils literal notranslate"><span class="pre">ActiveTaskCounterPosix</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.abort"><code class="docutils literal notranslate"><span class="pre">abort()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done"><code class="docutils literal notranslate"><span class="pre">task_done()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start"><code class="docutils literal notranslate"><span class="pre">task_start()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMPExample"><code class="docutils literal notranslate"><span class="pre">RESetMPExample</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMPExample.children"><code class="docutils literal notranslate"><span class="pre">children()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMPExample.map_function"><code class="docutils literal notranslate"><span class="pre">map_function()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMPExample.roots"><code class="docutils literal notranslate"><span class="pre">roots()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce"><code class="docutils literal notranslate"><span class="pre">RESetMapReduce</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.abort"><code class="docutils literal notranslate"><span class="pre">abort()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.finish"><code class="docutils literal notranslate"><span class="pre">finish()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.get_results"><code class="docutils literal notranslate"><span class="pre">get_results()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.map_function"><code class="docutils literal notranslate"><span class="pre">map_function()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.post_process"><code class="docutils literal notranslate"><span class="pre">post_process()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.print_communication_statistics"><code class="docutils literal notranslate"><span class="pre">print_communication_statistics()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.random_worker"><code class="docutils literal notranslate"><span class="pre">random_worker()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.reduce_function"><code class="docutils literal notranslate"><span class="pre">reduce_function()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.reduce_init"><code class="docutils literal notranslate"><span class="pre">reduce_init()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.roots"><code class="docutils literal notranslate"><span class="pre">roots()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.run"><code class="docutils literal notranslate"><span class="pre">run()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.run_serial"><code class="docutils literal notranslate"><span class="pre">run_serial()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.setup_workers"><code class="docutils literal notranslate"><span class="pre">setup_workers()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduce.start_workers"><code class="docutils literal notranslate"><span class="pre">start_workers()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker"><code class="docutils literal notranslate"><span class="pre">RESetMapReduceWorker</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.run"><code class="docutils literal notranslate"><span class="pre">run()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.run_myself"><code class="docutils literal notranslate"><span class="pre">run_myself()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.send_partial_result"><code class="docutils literal notranslate"><span class="pre">send_partial_result()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.steal"><code class="docutils literal notranslate"><span class="pre">steal()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetMapReduceWorker.walk_branch_locally"><code class="docutils literal notranslate"><span class="pre">walk_branch_locally()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetParallelIterator"><code class="docutils literal notranslate"><span class="pre">RESetParallelIterator</span></code></a><ul>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetParallelIterator.map_function"><code class="docutils literal notranslate"><span class="pre">map_function()</span></code></a></li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.RESetParallelIterator.reduce_init"><code class="docutils literal notranslate"><span class="pre">reduce_init</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.parallel.map_reduce.proc_number"><code class="docutils literal notranslate"><span class="pre">proc_number()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"ZZ": "\\Bold{Z}", "NN": "\\Bold{N}", "RR": "\\Bold{R}", "CC": "\\Bold{C}", "QQ": "\\Bold{Q}", "QQbar": "\\overline{\\QQ}", "GF": ["\\Bold{F}_{#1}", 1], "Zp": ["\\Bold{Z}_{#1}", 1], "Qp": ["\\Bold{Q}_{#1}", 1], "Zmod": ["\\ZZ/#1\\ZZ", 1], "CDF": "\\Bold{C}", "CIF": "\\Bold{C}", "CLF": "\\Bold{C}", "RDF": "\\Bold{R}", "RIF": "\\Bold{I} \\Bold{R}", "RLF": "\\Bold{R}", "SL": "\\mathrm{SL}", "PSL": "\\mathrm{PSL}", "lcm": "\\mathop{\\operatorname{lcm}}", "Bold": ["\\mathbf{#1}", 1]}, "inlineMath": [["$", "$"], ["\\(", "\\)"]], "maxBuffer": 51200, "autoload": {"color": [], "colorv2": ["color"]}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="../../../_static/jupyter-sphinx-furo.js"></script>
    </body>
</html>