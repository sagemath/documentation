<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Load Python, Sage, Cython, Fortran and Magma files in Sage" href="load.html" /><link rel="prev" title="Interactively tracing execution of a command" href="../misc/trace.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>The Sage Preparser - The Sage Command Line</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZGD13B5572"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ZGD13B5572');
</script></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">The Sage Command Line</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 9.8 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../../index.html">Home - The Sage Command Line</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../options.html">Invoking Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../startup.html">Sage startup scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environ.html">Environment variables used by Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../environ.html#relevant-environment-variables-for-other-packages">Relevant environment variables for other packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/trace.html">Interactively tracing execution of a command</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">The Sage Preparser</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="load.html">Load Python, Sage, Cython, Fortran and Magma files in Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="attach.html">Keep track of attached files</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="display/formatter.html">IPython Displayhook Formatters</a></li>
<li class="toctree-l1"><a class="reference internal" href="display/pretty_print.html">The Sage pretty printer</a></li>
<li class="toctree-l1"><a class="reference internal" href="display/fancy_repr.html">Representations of objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="display/util.html">Utility functions for pretty-printing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rich_output/display_manager.html">Display Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/preferences.html">Display Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/pretty_print.html">The <code class="docutils literal notranslate"><span class="pre">pretty_print</span></code> command</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/buffer.html">Output Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/output_basic.html">Basic Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/output_graphics.html">Graphics Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/output_graphics3d.html">Three-Dimensional Graphics Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/output_video.html">Video Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/output_catalog.html">Catalog of all available output container types.</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/backend_base.html">Base Class for Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/test_backend.html">Test Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/backend_doctest.html">The backend used for doctests</a></li>
<li class="toctree-l1"><a class="reference internal" href="rich_output/backend_ipython.html">IPython Backend for the Sage Rich Output System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interpreter.html">Sage’s IPython Modifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_extension.html">Sage’s IPython Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface_magic.html">Magics for each of the Sage interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_kernel/interact.html">Interacts for the Sage Jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_kernel/widgets.html">Widgets to be used for the Sage Jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_kernel/install.html">Installing the SageMath Jupyter Kernel and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_kernel/kernel.html">The Sage ZMQ Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_tests.html">Tests for the IPython integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="display/jsmol_iframe.html">HTML Generator for JSmol</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Sage Wrapper for Bitmap Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputhook.html">The Sage Input Hook</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="the-sage-preparser">
<span id="sage-repl-preparse"></span><h1>The Sage Preparser<a class="headerlink" href="#the-sage-preparser" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-sage.repl.preparse"></span><p>EXAMPLES:</p>
<p>Preparsing:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2/3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)/Integer(3)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2.5&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;2.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2^3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)**Integer(3)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a^b&#39;</span><span class="p">)</span>            <span class="c1"># exponent</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a**b&#39;</span><span class="p">)</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;G.0&#39;</span><span class="p">)</span>            <span class="c1"># generator</span>
<span class="go">&#39;G.gen(0)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a = 939393R&#39;</span><span class="p">)</span>    <span class="c1"># raw</span>
<span class="go">&#39;a = 939393&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a b c in L&#39;</span><span class="p">)</span>     <span class="c1"># implicit multiplication</span>
<span class="go">&#39;a*b*c in L&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2e3x + 3exp(y)&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;2e3&#39;)*x + Integer(3)*exp(y)&quot;</span>
</pre></div>
</div>
<p>A string with escaped quotes in it (the point here is that the
preparser does not get confused by the internal quotes):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="s2">&quot;&quot;</span><span class="n">Yes</span><span class="p">,</span><span class="s2">&quot; he said.&quot;</span>
<span class="go">&#39;&quot;Yes,&quot; he said.&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">; s</span>
<span class="go">&#39;\&#39;</span>
</pre></div>
</div>
<p>A hex literal:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;0x2e3&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x2e3)&#39;</span>
<span class="gp">sage: </span><span class="mh">0xA</span>
<span class="go">10</span>
<span class="gp">sage: </span><span class="mh">0xe</span>
<span class="go">14</span>
</pre></div>
</div>
<p>Raw and hex work correctly:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0xa1</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.rings.integer.Integer&#39;&gt;</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0xa1</span><span class="n">r</span><span class="p">)</span>
<span class="go">&lt;class &#39;int&#39;&gt;</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="mh">0Xa1</span><span class="n">R</span><span class="p">)</span>
<span class="go">&lt;class &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>The preparser can handle PEP 515 (see <a class="reference external" href="https://trac.sagemath.org/28490">trac ticket #28490</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mi">1_000_000</span> <span class="o">+</span> <span class="mi">3_000</span>
<span class="go">1003000</span>
</pre></div>
</div>
<p>In Sage, methods can also be called on integer and real literals (note
that in pure Python this would be a syntax error):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mf">16.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="go">4</span>
<span class="gp">sage: </span><span class="mf">87.</span><span class="n">factor</span><span class="p">()</span>
<span class="go">3 * 29</span>
<span class="gp">sage: </span><span class="mf">15.10</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="go">3.88587184554509</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;87.sqrt()&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(87).sqrt()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;15.10.sqrt()&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;15.10&#39;).sqrt()&quot;</span>
</pre></div>
</div>
<p>Note that calling methods on int literals in pure Python is a syntax
error, but Sage allows this for Sage integers and reals, because users
frequently request it:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;4.__add__(3)&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid ...</span>
</pre></div>
</div>
<p>Symbolic functional notation:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> <span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">beta</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">theta</span>              <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="n">f</span>                                                                 <span class="c1"># optional - sage.symbolic</span>
<span class="go">(theta, beta) |--&gt; beta + theta</span>
<span class="gp">sage: </span><span class="n">a</span>                                                                 <span class="c1"># optional - sage.symbolic</span>
<span class="go">10</span>
<span class="gp">sage: </span><span class="n">b</span>                                                                 <span class="c1"># optional - sage.symbolic</span>
<span class="go">x^2 + theta</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>                                                    <span class="c1"># optional - sage.symbolic</span>
<span class="go">2*theta</span>

<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>                                       <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="n">f</span>                                                                 <span class="c1"># optional - sage.symbolic</span>
<span class="go">(x, y) |--&gt; sqrt(5)*x*y</span>
</pre></div>
</div>
<p>This involves an =-, but should still be turned into a symbolic
expression:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a(x) =- 5&#39;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); a = symbolic_expression(- Integer(5)).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">=-</span><span class="n">x</span>                                                           <span class="c1"># optional - sage.symbolic</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>                                                             <span class="c1"># optional - sage.symbolic</span>
<span class="go">-10</span>
</pre></div>
</div>
<p>This involves -=, which should not be turned into a symbolic
expression (of course a(x) is not an identifier, so this will never be
valid):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;a(x) -= 5&#39;</span><span class="p">)</span>
<span class="go">&#39;a(x) -= Integer(5)&#39;</span>
</pre></div>
</div>
<p>Raw literals:</p>
<p>Raw literals are not preparsed, which can be useful from an efficiency
point of view.  Just like Python ints are denoted by an L, in Sage raw
integer and floating literals are followed by an”r” (or “R”) for raw,
meaning not preparsed.</p>
<p>We create a raw integer:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">393939</span><span class="n">r</span>
<span class="gp">sage: </span><span class="n">a</span>
<span class="go">393939</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;class &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>We create a raw float:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="mf">1.5949</span><span class="n">r</span>
<span class="gp">sage: </span><span class="n">z</span>
<span class="go">1.5949</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">&lt;class &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>You can also use an upper case letter:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="mf">3.1415</span><span class="n">R</span>
<span class="gp">sage: </span><span class="n">z</span>
<span class="go">3.1415</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">&lt;class &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>This next example illustrates how raw literals can be very useful in
certain cases.  We make a list of even integers up to 10000:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
</pre></div>
</div>
<p>This takes a noticeable fraction of a second (e.g., 0.25
seconds). After preparsing, what Python is really executing is the
following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;v = [ 2*i for i in range(10000)]&#39;</span><span class="p">)</span>
<span class="go">&#39;v = [ Integer(2)*i for i in range(Integer(10000))]&#39;</span>
</pre></div>
</div>
<p>If instead we use a raw 2 we get execution that is <em>instant</em> (0.00
seconds):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="n">r</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="n">r</span><span class="p">)]</span>
</pre></div>
</div>
<p>Behind the scenes what happens is the following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;v = [ 2r * i for i in range(10000r)]&#39;</span><span class="p">)</span>
<span class="go">&#39;v = [ 2 * i for i in range(10000)]&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The results of the above two expressions are different.  The
first one computes a list of Sage integers, whereas the second
creates a list of Python integers.  Python integers are typically
much more efficient than Sage integers when they are very small;
large Sage integers are much more efficient than Python integers,
since they are implemented using the GMP C library.</p>
</div>
<p>F-Strings (<a class="reference external" href="https://www.python.org/dev/peps/pep-0498/">PEP 498</a>):</p>
<p>Expressions embedded within F-strings are preparsed:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;1/3&#39;</span>
<span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span><span class="o">^</span><span class="mi">3</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;8&#39;</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> in binary is: </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;20 in binary is: 00010100&#39;</span>
<span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">..</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;[1, 4, 9, 16, 25]&#39;</span>
</pre></div>
</div>
<p>Note that the format specifier is not preparsed. Expressions within it,
however, are:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">10r</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">ValueError: Unknown format code &#39;r&#39; for object of type &#39;int&#39;</span>
<span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:{</span><span class="mi">10</span><span class="n">r</span><span class="si">}}</span><span class="s1">&#39;</span>
<span class="go">&#39;        20&#39;</span>
</pre></div>
</div>
<p>Nested F-strings are also supported:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span> <span class="si">}</span><span class="s2">&quot;</span> <span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;1/2&#39;</span>
<span class="gp">sage: </span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;1</span><span class="si">{</span> <span class="sa">f</span><span class="s2">&quot;2</span><span class="si">{</span> <span class="sa">f</span><span class="s1">&#39;4</span><span class="si">{</span> <span class="mi">2</span><span class="o">^</span><span class="mi">3</span> <span class="si">}</span><span class="s1">4&#39;</span> <span class="si">}</span><span class="s2">2&quot;</span> <span class="si">}</span><span class="s1">1&#39;&#39;&#39;</span>
<span class="go">&#39;1248421&#39;</span>
</pre></div>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>William Stein (2006-02-19): fixed bug when loading .py files</p></li>
<li><p>William Stein (2006-03-09): fixed crash in parsing exponentials; precision of
real literals now determined by digits of input (like Mathematica)</p></li>
<li><p>Joe Wetherell (2006-04-14): added MAGMA-style constructor preparsing</p></li>
<li><p>Bobby Moretti (2007-01-25): added preliminary function assignment notation</p></li>
<li><p>Robert Bradshaw (2007-09-19): added strip_string_literals, containing_block
utility functions. Arrr!; added [1,2,..,n] notation</p></li>
<li><p>Robert Bradshaw (2008-01-04): implicit multiplication (off by default)</p></li>
<li><p>Robert Bradshaw (2008-09-23): factor out constants</p></li>
<li><p>Robert Bradshaw (2009-01): simplify preparser by making it modular and using
regular expressions; bug fixes, complex numbers, and binary input</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStack">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">QuoteStack</span></span><a class="headerlink" href="#sage.repl.preparse.QuoteStack" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The preserved state of parsing in <a class="reference internal" href="#sage.repl.preparse.strip_string_literals" title="sage.repl.preparse.strip_string_literals"><code class="xref py py-func docutils literal notranslate"><span class="pre">strip_string_literals()</span></code></a>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStack.peek">
<span class="sig-name descname"><span class="pre">peek</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.QuoteStack.peek" title="Permalink to this definition">#</a></dt>
<dd><p>Get the frame at the top of the stack or None if empty.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">qs</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStack</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
<span class="go">QuoteStackFrame(...delim=&#39;&quot;&#39;...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStack.pop">
<span class="sig-name descname"><span class="pre">pop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.QuoteStack.pop" title="Permalink to this definition">#</a></dt>
<dd><p>Remove and return the frame that was most recently added to the stack.</p>
<p>Raise an IndexError if the stack is empty.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">qs</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStack</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">IndexError: ...</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">QuoteStackFrame(...delim=&#39;&quot;&#39;...)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStack.push">
<span class="sig-name descname"><span class="pre">push</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.QuoteStack.push" title="Permalink to this definition">#</a></dt>
<dd><p>Add a frame to the stack.</p>
<p>If the frame corresponds to an F-string, its delimiter is marked as no
longer being a <a class="reference internal" href="#sage.repl.preparse.QuoteStack.safe_delimiter" title="sage.repl.preparse.QuoteStack.safe_delimiter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">safe_delimiter()</span></code></a>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">qs</span> <span class="o">=</span> <span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStack</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">qs</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">sage</span><span class="o">.</span><span class="n">repl</span><span class="o">.</span><span class="n">preparse</span><span class="o">.</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStack.safe_delimiter">
<span class="sig-name descname"><span class="pre">safe_delimiter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.QuoteStack.safe_delimiter" title="Permalink to this definition">#</a></dt>
<dd><p>Return a string delimiter that may be safely inserted into the code
output by <a class="reference internal" href="#sage.repl.preparse.strip_string_literals" title="sage.repl.preparse.strip_string_literals"><code class="xref py py-func docutils literal notranslate"><span class="pre">strip_string_literals()</span></code></a>, if any.</p>
<p><code class="docutils literal notranslate"><span class="pre">'</span></code> is preferred over <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>. The triple-quoted versions are never
returned since by the time they would be chosen, they would also be invalid.
<code class="docutils literal notranslate"><span class="pre">'''</span></code> cannot, for example, appear within an F-string delimited by <code class="docutils literal notranslate"><span class="pre">'</span></code>.</p>
<p>Once marked unsafe, a delimiter is never made safe again, even after the
stack frame that used it is popped. It may no longer be applicable to parsing,
but it appears somewhere in the processed code, so it is not safe to insert
just anywhere. A future enhancement could be to map ranges in the processed
code to the delimiter(s) that would be safe to insert there.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">QuoteStack</span><span class="p">,</span> <span class="n">QuoteStackFrame</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">QuoteStack</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">safe_delimiter</span><span class="p">()</span>
<span class="go">&quot;&#39;&quot;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">safe_delimiter</span><span class="p">()</span>
<span class="go">&quot;&#39;&quot;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">QuoteStackFrame(...)</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="n">f_string</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">safe_delimiter</span><span class="p">()</span>
<span class="go">&#39;&quot;&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">QuoteStackFrame</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">f_string</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">s</span><span class="o">.</span><span class="n">safe_delimiter</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.repl.preparse.QuoteStackFrame">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">QuoteStackFrame</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">delim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_string</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">braces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parens</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">brackets</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt_spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nested_fmt_spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.QuoteStackFrame" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/types.html#types.SimpleNamespace" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code></a></p>
<p>The state of a single level of a string literal being parsed.</p>
<p>Only F-strings have more than one level.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.containing_block">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">containing_block</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['()',</span> <span class="pre">'[]',</span> <span class="pre">'{}']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_delim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.containing_block" title="Permalink to this definition">#</a></dt>
<dd><p>Find the code block given by balanced delimiters that contains the position <code class="docutils literal notranslate"><span class="pre">idx</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idx</span></code> - an integer; a starting position</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delimiters</span></code> - a list of strings (default: [‘()’, ‘[]’,
‘{}’]); the delimiters to balance. A delimiter must be a single
character and no character can at the same time be opening and
closing delimiter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">require_delim</span></code> - a boolean (default: True); whether to raise
a SyntaxError if delimiters are present. If the delimiters are
unbalanced, an error will be raised in any case.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a 2-tuple <code class="docutils literal notranslate"><span class="pre">(a,b)</span></code> of integers, such that <code class="docutils literal notranslate"><span class="pre">code[a:b]</span></code> is
delimited by balanced delimiters, <code class="docutils literal notranslate"><span class="pre">a&lt;=idx&lt;b</span></code>, and <code class="docutils literal notranslate"><span class="pre">a</span></code>
is maximal and <code class="docutils literal notranslate"><span class="pre">b</span></code> is minimal with that property. If that
does not exist, a <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> is raised.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">require_delim</span></code> is false and <code class="docutils literal notranslate"><span class="pre">a,b</span></code> as above can not be
found, then <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">len(code)</span></code> is returned.</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">containing_block</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;factor(next_prime(L[5]+1))&quot;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
<span class="go">&#39;+&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span>
<span class="go">(17, 25)</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(L[5]+1)&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="go">&#39;5&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;[5]&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">delimiters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;()&#39;</span><span class="p">]);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(L[5]+1)&#39;</span>
<span class="gp">sage: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">containing_block</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
<span class="go">&#39;(next_prime(L[5]+1))&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.extract_numeric_literals">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">extract_numeric_literals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.extract_numeric_literals" title="Permalink to this definition">#</a></dt>
<dd><p>Pulls out numeric literals and assigns them to global variables.
This eliminates the need to re-parse and create the literals,
e.g., during every iteration of a loop.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string; a block of code</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a (string, string:string dictionary) 2-tuple; the block with
literals replaced by variable names and a mapping from names to
the new variables</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">extract_numeric_literals</span>
<span class="gp">sage: </span><span class="n">code</span><span class="p">,</span> <span class="n">nums</span> <span class="o">=</span> <span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.2 + 5&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="go">_sage_const_1p2  + _sage_const_5</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="go">{&#39;_sage_const_1p2&#39;: &quot;RealNumber(&#39;1.2&#39;)&quot;, &#39;_sage_const_5&#39;: &#39;Integer(5)&#39;}</span>

<span class="gp">sage: </span><span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;[1, 1.1, 1e1, -1e-1, 1.]&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;[_sage_const_1 , _sage_const_1p1 , _sage_const_1e1 , -_sage_const_1en1 , _sage_const_1p ]&#39;</span>

<span class="gp">sage: </span><span class="n">extract_numeric_literals</span><span class="p">(</span><span class="s2">&quot;[1.sqrt(), 1.2.sqrt(), 1r, 1.2r, R.1, R0.1, (1..5)]&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;[_sage_const_1 .sqrt(), _sage_const_1p2 .sqrt(), 1 , 1.2 , R.1, R0.1, (_sage_const_1 .._sage_const_5 )]&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.handle_encoding_declaration">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">handle_encoding_declaration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contents</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.handle_encoding_declaration" title="Permalink to this definition">#</a></dt>
<dd><p>Find a PEP 263-style Python encoding declaration in the first or
second line of <code class="docutils literal notranslate"><span class="pre">contents</span></code>. If found, output it to <code class="docutils literal notranslate"><span class="pre">out</span></code> and return
<code class="docutils literal notranslate"><span class="pre">contents</span></code> without the encoding line; otherwise output a default
UTF-8 declaration and return <code class="docutils literal notranslate"><span class="pre">contents</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">handle_encoding_declaration</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">sage: </span><span class="n">c1</span><span class="o">=</span><span class="s1">&#39;# -*- coding: latin-1 -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c2</span><span class="o">=</span><span class="s1">&#39;# -*- coding: iso-8859-15 -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c3</span><span class="o">=</span><span class="s1">&#39;# -*- coding: ascii -*-</span><span class="se">\n</span><span class="s1">import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">c4</span><span class="o">=</span><span class="s1">&#39;import os, sys</span><span class="se">\n</span><span class="s1">...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: latin-1 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: iso-8859-15 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: ascii -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
<span class="gp">sage: </span><span class="n">handle_encoding_declaration</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="go"># -*- coding: utf-8 -*-</span>
<span class="go">&#39;import os, sys\n...&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0263/"><strong>PEP 263</strong></a> says that Python will interpret a UTF-8
byte order mark as a declaration of UTF-8 encoding, but I do not
think we do that; this function only sees a Python string so it
cannot account for a BOM.</p></li>
<li><p>We default to UTF-8 encoding even though PEP 263 says that
Python files should default to ASCII.</p></li>
<li><p>Also see <a class="reference external" href="https://docs.python.org/ref/encodings.html">https://docs.python.org/ref/encodings.html</a>.</p></li>
</ul>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Lars Fischer</p></li>
<li><p>Dan Drake (2010-12-08, rewrite for <a class="reference external" href="https://trac.sagemath.org/10440">trac ticket #10440</a>)</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.implicit_mul">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">implicit_mul</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.implicit_mul" title="Permalink to this definition">#</a></dt>
<dd><p>Insert *’s to make implicit multiplication explicit.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>  – a string; the code with missing *’s</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> – an integer (default: 5); see <a class="reference internal" href="#sage.repl.preparse.implicit_multiplication" title="sage.repl.preparse.implicit_multiplication"><code class="xref py py-func docutils literal notranslate"><span class="pre">implicit_multiplication()</span></code></a>
for a list</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">implicit_mul</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;(2x^2-4x+3)a0&#39;</span><span class="p">)</span>
<span class="go">&#39;(2*x^2-4*x+3)*a0&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;a b c in L&#39;</span><span class="p">)</span>
<span class="go">&#39;a*b*c in L&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;1r + 1e3 + 5exp(2)&#39;</span><span class="p">)</span>
<span class="go">&#39;1r + 1e3 + 5*exp(2)&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_mul</span><span class="p">(</span><span class="s1">&#39;f(a)(b)&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&#39;f(a)*(b)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.implicit_multiplication">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">implicit_multiplication</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.implicit_multiplication" title="Permalink to this definition">#</a></dt>
<dd><p>Turn implicit multiplication on or off, optionally setting a
specific <code class="docutils literal notranslate"><span class="pre">level</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> – a boolean or integer (default: 5); how aggressive to be in
placing *’s</p>
<ul>
<li><p>0 - Do nothing</p></li>
<li><p>1 - Numeric followed by alphanumeric</p></li>
<li><p>2 - Closing parentheses followed by alphanumeric</p></li>
<li><p>3 - Spaces between alphanumeric</p></li>
<li><p>10 - Adjacent parentheses (may mangle call statements)</p></li>
</ul>
</li>
</ul>
<p>OUTPUT:</p>
<p>The current <code class="docutils literal notranslate"><span class="pre">level</span></code> if no argument is given.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">()</span>
<span class="go">5</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(2)*x&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;2x&#39;</span><span class="p">)</span>
<span class="go">&#39;2x&#39;</span>
</pre></div>
</div>
<p>Note that the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-automagic">IPython automagic</a>
feature cannot be used if <code class="docutils literal notranslate"><span class="pre">level</span> <span class="pre">&gt;=</span> <span class="pre">3</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;cd Documents&#39;</span><span class="p">)</span>
<span class="go">&#39;cd*Documents&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;cd Documents&#39;</span><span class="p">)</span>
<span class="go">&#39;cd Documents&#39;</span>
<span class="gp">sage: </span><span class="n">implicit_multiplication</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, one can use the explicit syntax for IPython magics such as
<code class="docutils literal notranslate"><span class="pre">%cd</span> <span class="pre">Documents</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.in_quote">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">in_quote</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.in_quote" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.isalphadigit_">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">isalphadigit_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.isalphadigit_" title="Permalink to this definition">#</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">s</span></code> is a non-empty string of alphabetic characters
or a non-empty string of digits or just a single <code class="docutils literal notranslate"><span class="pre">_</span></code></p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">isalphadigit_</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">isalphadigit_</span><span class="p">(</span><span class="s1">&#39;a123&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.parse_ellipsis">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">parse_ellipsis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preparse_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.parse_ellipsis" title="Permalink to this definition">#</a></dt>
<dd><p>Preparses [0,2,..,n] notation.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preparse_step</span></code> - a boolean (default: True)</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">parse_ellipsis</span>
<span class="gp">sage: </span><span class="n">parse_ellipsis</span><span class="p">(</span><span class="s2">&quot;[1,2,..,n]&quot;</span><span class="p">)</span>
<span class="go">&#39;(ellipsis_range(1,2,Ellipsis,n))&#39;</span>
<span class="gp">sage: </span><span class="n">parse_ellipsis</span><span class="p">(</span><span class="s2">&quot;for i in (f(x) .. L[10]):&quot;</span><span class="p">)</span>
<span class="go">&#39;for i in (ellipsis_iter(f(x) ,Ellipsis, L[10])):&#39;</span>
<span class="gp">sage: </span><span class="p">[</span><span class="mf">1.0</span><span class="o">.</span><span class="mf">.2.0</span><span class="p">]</span>
<span class="go">[1.00000000000000, 2.00000000000000]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_prompts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numeric_literals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse" title="Permalink to this definition">#</a></dt>
<dd><p>Preparses a line of input.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">line</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset</span></code> - a boolean (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_time</span></code> - a boolean (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore_prompts</span></code> - a boolean (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric_literals</span></code> - a boolean (default: True)</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = ZZ[&#39;x&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;x&#39;]; (x,) = ZZ._first_ngens(1)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = ZZ[&#39;y&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;y&#39;]; (x,) = ZZ._first_ngens(1)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x,y&gt; = ZZ[]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;x, y&#39;]; (x, y,) = ZZ._first_ngens(2)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x,y&gt; = ZZ[&#39;u,v&#39;]&quot;</span><span class="p">)</span>
<span class="go">&quot;ZZ = ZZ[&#39;u,v&#39;]; (x, y,) = ZZ._first_ngens(2)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;ZZ.&lt;x&gt; = QQ[2^(1/3)]&quot;</span><span class="p">)</span>
<span class="go">&#39;ZZ = QQ[Integer(2)**(Integer(1)/Integer(3))]; (x,) = ZZ._first_ngens(1)&#39;</span>
<span class="gp">sage: </span><span class="n">QQ</span><span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)]</span>
<span class="go">Number Field in a with defining polynomial x^3 - 2 with a = 1.259921049894873?</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a^b&quot;</span><span class="p">)</span>
<span class="go">&#39;a**b&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a^^b&quot;</span><span class="p">)</span>
<span class="go">&#39;a^b&#39;</span>
<span class="gp">sage: </span><span class="mi">8</span><span class="o">^</span><span class="mi">1</span>
<span class="go">8</span>
<span class="gp">sage: </span><span class="mi">8</span><span class="o">^^</span><span class="mi">1</span>
<span class="go">9</span>
<span class="gp">sage: </span><span class="mi">9</span><span class="o">^^</span><span class="mi">1</span>
<span class="go">8</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;A </span><span class="se">\\</span><span class="s2"> B&quot;</span><span class="p">)</span>
<span class="go">&#39;A  * BackslashOperator() * B&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;A^2 </span><span class="se">\\</span><span class="s2"> B + C&quot;</span><span class="p">)</span>
<span class="go">&#39;A**Integer(2)  * BackslashOperator() * B + C&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;a </span><span class="se">\\</span><span class="s2"> b </span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># There is really only one backslash here, it is just being escaped.</span>
<span class="go">&#39;a  * BackslashOperator() * b \\&#39;</span>

<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;time R.&lt;x&gt; = ZZ[]&quot;</span><span class="p">,</span> <span class="n">do_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;__time__ = cputime(); __wall__ = walltime(); R = ZZ[\&#39;x\&#39;]; print(&quot;Time: CPU {:.2f} s, Wall: {:.2f} s&quot;.format(cputime(__time__), walltime(__wall__))); (x,) = R._first_ngens(1)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_calculus">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_calculus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_calculus" title="Permalink to this definition">#</a></dt>
<dd><p>Supports calculus-like function assignment, e.g., transforms:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">f(x,y,z) = sin(x^3 - 4*y) + y^x</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">__tmp__=var(&quot;x,y,z&quot;)</span>
<span class="go">f = symbolic_expression(sin(x**3 - 4*y) + y**x).function(x,y,z)</span>
</pre></div>
</div>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Bobby Moretti</p>
<ul>
<li><p>Initial version - 02/2007</p></li>
</ul>
</li>
<li><p>William Stein</p>
<ul>
<li><p>Make variables become defined if they are not already defined.</p></li>
</ul>
</li>
<li><p>Robert Bradshaw</p>
<ul>
<li><p>Rewrite using regular expressions (01/2009)</p></li>
</ul>
</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) = x^3-x&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); f = symbolic_expression(x**Integer(3)-x).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(u,v) = u - v&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;u,v&quot;); f = symbolic_expression(u - v).function(u,v)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) =-5&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x&quot;); f = symbolic_expression(-Integer(5)).function(x)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x) -= 5&quot;</span><span class="p">)</span>
<span class="go">&#39;f(x) -= Integer(5)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="s2">&quot;f(x_1, x_2) = x_1^2 - x_2^2&quot;</span><span class="p">)</span>
<span class="go">&#39;__tmp__=var(&quot;x_1,x_2&quot;); f = symbolic_expression(x_1**Integer(2) - x_2**Integer(2)).function(x_1,x_2)&#39;</span>
</pre></div>
</div>
<p>For simplicity, this function assumes all statements begin and end
with a semicolon:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">preparse_calculus</span>
<span class="gp">sage: </span><span class="n">preparse_calculus</span><span class="p">(</span><span class="s2">&quot;;f(t,s)=t^2;&quot;</span><span class="p">)</span>
<span class="go">&#39;;__tmp__=var(&quot;t,s&quot;); f = symbolic_expression(t^2).function(t,s);&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_calculus</span><span class="p">(</span><span class="s2">&quot;;f( t , s ) = t^2;&quot;</span><span class="p">)</span>
<span class="go">&#39;;__tmp__=var(&quot;t,s&quot;); f = symbolic_expression(t^2).function(t,s);&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_file">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contents</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">globals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numeric_literals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file" title="Permalink to this definition">#</a></dt>
<dd><p>Preparse <code class="docutils literal notranslate"><span class="pre">contents</span></code> which is input from a file such as <code class="docutils literal notranslate"><span class="pre">.sage</span></code> files.</p>
<p>Special attentions are given to numeric literals and load/attach
file directives.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Temporarily, if &#64;parallel is in the input, then
numeric_literals is always set to False.</p>
</div>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contents</span></code> - a string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">globals</span></code> - dict or None (default: None); if given, then
arguments to load/attach are evaluated in the namespace of this
dict.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric_literals</span></code> - bool (default: True), whether to factor
out wrapping of integers and floats, so they do not get created
repeatedly inside loops</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_file_named">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_file_named</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file_named" title="Permalink to this definition">#</a></dt>
<dd><p>Preparse file named code{name} (presumably a .sage file), outputting to a
temporary file.  Returns name of temporary file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_file_named_to_stream">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_file_named_to_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_file_named_to_stream" title="Permalink to this definition">#</a></dt>
<dd><p>Preparse file named code{name} (presumably a .sage file), outputting to
stream code{out}.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_generators">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_generators</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_generators" title="Permalink to this definition">#</a></dt>
<dd><p>Parses generator syntax, converting:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj.&lt;gen0,gen1,...,genN&gt; = objConstructor(...)</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj = objConstructor(..., names=(&quot;gen0&quot;, &quot;gen1&quot;, ..., &quot;genN&quot;))</span>
<span class="go">(gen0, gen1, ..., genN,) = obj.gens()</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj.&lt;gen0,gen1,...,genN&gt; = R[interior]</span>
</pre></div>
</div>
<p>into:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="go">obj = R[interior]; (gen0, gen1, ..., genN,) = obj.gens()</span>
</pre></div>
</div>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string</p></li>
</ul>
<p>LIMITATIONS:</p>
<blockquote>
<div><ul class="simple">
<li><p>The entire constructor <em>must</em> be on one line.</p></li>
</ul>
</div></blockquote>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>2006-04-14: Joe Wetherell (<a class="reference external" href="mailto:jlwether&#37;&#52;&#48;alum&#46;mit&#46;edu">jlwether<span>&#64;</span>alum<span>&#46;</span>mit<span>&#46;</span>edu</a>)</p>
<ul>
<li><p>Initial version.</p></li>
</ul>
</li>
<li><p>2006-04-17: William Stein</p>
<ul>
<li><p>Improvements to allow multiple statements.</p></li>
</ul>
</li>
<li><p>2006-05-01: William</p>
<ul>
<li><p>Fix bug that Joe found.</p></li>
</ul>
</li>
<li><p>2006-10-31: William</p>
<ul>
<li><p>Fix so obj does not have to be mutated.</p></li>
</ul>
</li>
<li><p>2009-01-27: Robert Bradshaw</p>
<ul>
<li><p>Rewrite using regular expressions</p></li>
</ul>
</li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.preparse_numeric_literals">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">preparse_numeric_literals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extract</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quotes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&quot;'&quot;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.preparse_numeric_literals" title="Permalink to this definition">#</a></dt>
<dd><p>Preparse numerical literals into their Sage counterparts,
e.g. Integer, RealNumber, and ComplexNumber.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - string; a code block to preparse</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extract</span></code> - boolean (default: <code class="docutils literal notranslate"><span class="pre">False</span></code>); whether to create
names for the literals and return a dictionary of
name-construction pairs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quotes</span></code> - string (default: <code class="docutils literal notranslate"><span class="pre">&quot;'&quot;</span></code>); used to surround string
arguments to RealNumber and ComplexNumber. If None, will rebuild
the string using a list of its Unicode code-points.</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string or (string, string:string dictionary) 2-tuple; the
preparsed block and, if <code class="docutils literal notranslate"><span class="pre">extract</span></code> is True, the
name-construction mapping</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">preparse_numeric_literals</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(5)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5jr&quot;</span><span class="p">)</span>
<span class="go">&#39;5J&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5l&quot;</span><span class="p">)</span>
<span class="go">&#39;5&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5L&quot;</span><span class="p">)</span>
<span class="go">&#39;5&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;1.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;.5j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;.5&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5e9j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5e9&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;5.&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.j&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5.&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.foo()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(5).foo()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.5.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;5.5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5.5j.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5.5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;5j.foo()&quot;</span><span class="p">)</span>
<span class="go">&quot;ComplexNumber(0, &#39;5&#39;).foo()&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1.exp()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(1).exp()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;1e+10&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1e+10&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;0x0af&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x0af)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s2">&quot;0x10.sqrt()&quot;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x10).sqrt()&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0o100&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0o100)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0b111001&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0b111001)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xe&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0xe)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xEAR&#39;</span><span class="p">)</span>
<span class="go">&#39;0xEA&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0x1012Fae&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0x1012Fae)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;042&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(42)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;000042&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(42)&#39;</span>
</pre></div>
</div>
<p>Test underscores as digit separators (PEP 515,
<a class="reference external" href="https://www.python.org/dev/peps/pep-0515/">https://www.python.org/dev/peps/pep-0515/</a>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123_456&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(123_456)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123_456.78_9_0&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;123_456.78_9_0&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0b11_011&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0b11_011)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0o76_321&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0o76_321)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;0xaa_aaa&#39;</span><span class="p">)</span>
<span class="go">&#39;Integer(0xaa_aaa)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;1_3.2_5e-2_2&#39;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;1_3.2_5e-2_2&#39;)&quot;</span>

<span class="gp">sage: </span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1_1.&quot;</span><span class="p">,</span> <span class="s2">&quot;11_2.&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;.1e1_1&quot;</span><span class="p">,</span>
<span class="gp">....: </span>          <span class="s2">&quot;1e12_3&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1_3e1_2&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1e1_1&quot;</span><span class="p">,</span> <span class="s2">&quot;1e1&quot;</span><span class="p">,</span> <span class="s2">&quot;1.e1_1&quot;</span><span class="p">,</span>
<span class="gp">....: </span>          <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1_1.0&quot;</span><span class="p">]:</span>
<span class="gp">....: </span>    <span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">assert</span> <span class="n">preparse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">f</span>
<span class="go">&quot;RealNumber(&#39;1_1.&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;11_2.&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;.1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1e12_3&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.1_3e1_2&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1e1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.e1_1&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1.0&#39;)&quot;</span>
<span class="go">&quot;RealNumber(&#39;1_1.0&#39;)&quot;</span>
</pre></div>
</div>
<p>Having consecutive underscores is not valid Python syntax, so
it is not preparsed, and similarly with a trailing underscore:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;123__45&#39;</span><span class="p">)</span>
<span class="go">&#39;123__45&#39;</span>
<span class="gp">sage: </span><span class="mi">123</span><span class="n">__45</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid ...</span>

<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;3040_1_&#39;</span><span class="p">)</span>
<span class="go">&#39;3040_1_&#39;</span>
<span class="gp">sage: </span><span class="mi">3040_1</span><span class="n">_</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: invalid ...</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">quotes</span></code> parameter:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;5j&#39;</span><span class="p">,</span> <span class="n">quotes</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="go">&#39;ComplexNumber(0, &quot;5&quot;)&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;3.14&#39;</span><span class="p">,</span> <span class="n">quotes</span><span class="o">=</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)</span>
<span class="go">&quot;RealNumber(&#39;&#39;&#39;3.14&#39;&#39;&#39;)&quot;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;3.14&#39;</span><span class="p">,</span> <span class="n">quotes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">&#39;RealNumber(str().join(map(chr, [51, 46, 49, 52])))&#39;</span>
<span class="gp">sage: </span><span class="n">preparse_numeric_literals</span><span class="p">(</span><span class="s1">&#39;5j&#39;</span><span class="p">,</span> <span class="n">quotes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">&#39;ComplexNumber(0, str().join(map(chr, [53])))&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.strip_prompts">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">strip_prompts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.strip_prompts" title="Permalink to this definition">#</a></dt>
<dd><p>Removes leading sage: and &gt;&gt;&gt; prompts so that pasting of examples
from the documentation works.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">line</span></code> - a string to process</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a string stripped of leading prompts</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">strip_prompts</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;sage: 2 + 2&quot;</span><span class="p">)</span>
<span class="go">&#39;2 + 2&#39;</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt;   3 + 2&quot;</span><span class="p">)</span>
<span class="go">&#39;3 + 2&#39;</span>
<span class="gp">sage: </span><span class="n">strip_prompts</span><span class="p">(</span><span class="s2">&quot;  2 + 4&quot;</span><span class="p">)</span>
<span class="go">&#39;  2 + 4&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.repl.preparse.strip_string_literals">
<span class="sig-prename descclassname"><span class="pre">sage.repl.preparse.</span></span><span class="sig-name descname"><span class="pre">strip_string_literals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.preparse.strip_string_literals" title="Permalink to this definition">#</a></dt>
<dd><p>Return a string with all literal quotes replaced with labels and
a dictionary of labels for re-substitution.</p>
<p>This makes parsing easier.</p>
<p>INPUT:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> - a string; the input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code> - a <a class="reference internal" href="#sage.repl.preparse.QuoteStack" title="sage.repl.preparse.QuoteStack"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuoteStack</span></code></a> (default: None); state with which to
continue processing, e.g., across multiple calls to this function</p></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li><p>a 3-tuple of the processed code, the dictionary of labels, and
any accumulated state</p></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.preparse</span> <span class="kn">import</span> <span class="n">strip_string_literals</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;[&#39;a&#39;, &quot;b&quot;, &#39;c&#39;, &quot;d\&quot;&quot;]&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span>
<span class="go">&#39;[%(L1)s, %(L2)s, %(L3)s, %(L4)s]&#39;</span>
<span class="gp">sage: </span><span class="n">literals</span>
<span class="go">{&#39;L1&#39;: &quot;&#39;a&#39;&quot;, &#39;L2&#39;: &#39;&quot;b&quot;&#39;, &#39;L3&#39;: &quot;&#39;c&#39;&quot;, &#39;L4&#39;: &#39;&quot;d\\&quot;&quot;&#39;}</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &quot;b&quot;, &#39;c&#39;, &quot;d\&quot;&quot;]</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">strip_string_literals</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-&quot;</span><span class="se">\\</span><span class="s1">\&quot;&quot;-&quot;</span><span class="se">\\</span><span class="s1">&quot;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">-%(L1)s-%(L2)s-</span>
</pre></div>
</div>
<p>Triple-quotes are handled as well:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s2">&quot;[a, &#39;&#39;&#39;b&#39;&#39;&#39;, c, &#39;&#39;]&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">s</span>
<span class="go">&#39;[a, %(L1)s, c, %(L2)s]&#39;</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span><span class="p">)</span>
<span class="go">[a, &#39;&#39;&#39;b&#39;&#39;&#39;, c, &#39;&#39;]</span>
</pre></div>
</div>
<p>Comments are substitute too:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s2">&quot;code &#39;#&#39; # ccc &#39;t&#39;&quot;</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;code %(L1)s #%(L2)s&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">%</span> <span class="n">literals</span>
<span class="go">&quot;code &#39;#&#39; # ccc &#39;t&#39;&quot;</span>
</pre></div>
</div>
<p>A state is returned so one can break strings across multiple calls to
this function:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s1">&#39;s = &quot;some&#39;</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;s = %(L1)s&#39;</span>
<span class="gp">sage: </span><span class="n">s</span><span class="p">,</span> <span class="n">literals</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">strip_string_literals</span><span class="p">(</span><span class="s1">&#39;thing&quot; * 5&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span> <span class="n">s</span>
<span class="go">&#39;%(L1)s * 5&#39;</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="load.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Load Python, Sage, Cython, Fortran and Magma files in Sage</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../misc/trace.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Interactively tracing execution of a command</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">The Sage Preparser</a><ul>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStack"><code class="docutils literal notranslate"><span class="pre">QuoteStack</span></code></a><ul>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStack.peek"><code class="docutils literal notranslate"><span class="pre">peek()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStack.pop"><code class="docutils literal notranslate"><span class="pre">pop()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStack.push"><code class="docutils literal notranslate"><span class="pre">push()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStack.safe_delimiter"><code class="docutils literal notranslate"><span class="pre">safe_delimiter()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.repl.preparse.QuoteStackFrame"><code class="docutils literal notranslate"><span class="pre">QuoteStackFrame</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.containing_block"><code class="docutils literal notranslate"><span class="pre">containing_block()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.extract_numeric_literals"><code class="docutils literal notranslate"><span class="pre">extract_numeric_literals()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.handle_encoding_declaration"><code class="docutils literal notranslate"><span class="pre">handle_encoding_declaration()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.implicit_mul"><code class="docutils literal notranslate"><span class="pre">implicit_mul()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.implicit_multiplication"><code class="docutils literal notranslate"><span class="pre">implicit_multiplication()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.in_quote"><code class="docutils literal notranslate"><span class="pre">in_quote()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.isalphadigit_"><code class="docutils literal notranslate"><span class="pre">isalphadigit_()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.parse_ellipsis"><code class="docutils literal notranslate"><span class="pre">parse_ellipsis()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse"><code class="docutils literal notranslate"><span class="pre">preparse()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_calculus"><code class="docutils literal notranslate"><span class="pre">preparse_calculus()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_file"><code class="docutils literal notranslate"><span class="pre">preparse_file()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_file_named"><code class="docutils literal notranslate"><span class="pre">preparse_file_named()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_file_named_to_stream"><code class="docutils literal notranslate"><span class="pre">preparse_file_named_to_stream()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_generators"><code class="docutils literal notranslate"><span class="pre">preparse_generators()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.preparse_numeric_literals"><code class="docutils literal notranslate"><span class="pre">preparse_numeric_literals()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.strip_prompts"><code class="docutils literal notranslate"><span class="pre">strip_prompts()</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.preparse.strip_string_literals"><code class="docutils literal notranslate"><span class="pre">strip_string_literals()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    </body>
</html>