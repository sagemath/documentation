<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sage’s IPython Modifications &mdash; Sage Reference Manual v7.3: The Sage Command Line</title>
    
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Sage Reference Manual v7.3: The Sage Command Line" href="../../index.html" />
    <link rel="next" title="Sage’s IPython Extension" href="ipython_extension.html" />
    <link rel="prev" title="Extra Readline Commands" href="readline_extra_commands.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ipython_extension.html" title="Sage’s IPython Extension"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="readline_extra_commands.html" title="Extra Readline Commands"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">The Sage Command Line</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sage-s-ipython-modifications">
<span id="sage-repl-interpreter"></span><h1>Sage&#8217;s IPython Modifications<a class="headerlink" href="#sage-s-ipython-modifications" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.repl.interpreter"></span><p>This module contains all of Sage&#8217;s customizations to the IPython
interpreter.  These changes consist of the following major components:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#sage.repl.interpreter.SageTerminalApp" title="sage.repl.interpreter.SageTerminalApp"><code class="xref py py-class docutils literal"><span class="pre">SageTerminalApp</span></code></a></li>
<li><code class="xref py py-class docutils literal"><span class="pre">SageInteractiveShell</span></code></li>
<li><a class="reference internal" href="#sage.repl.interpreter.SageTerminalInteractiveShell" title="sage.repl.interpreter.SageTerminalInteractiveShell"><code class="xref py py-class docutils literal"><span class="pre">SageTerminalInteractiveShell</span></code></a></li>
<li><a class="reference internal" href="#sage.repl.interpreter.interface_shell_embed" title="sage.repl.interpreter.interface_shell_embed"><code class="xref py py-func docutils literal"><span class="pre">interface_shell_embed()</span></code></a></li>
</ul>
</div></blockquote>
<div class="section" id="sageterminalapp">
<h2>SageTerminalApp<a class="headerlink" href="#sageterminalapp" title="Permalink to this headline">¶</a></h2>
<p>This is the main application object.  It is used by the
<code class="docutils literal"><span class="pre">$SAGE_LOCAL/bin/sage-ipython</span></code> script to start the Sage
command-line.  It&#8217;s primary purpose is to</p>
<blockquote>
<div><ul class="simple">
<li>Initialize the <a class="reference internal" href="#sage.repl.interpreter.SageTerminalInteractiveShell" title="sage.repl.interpreter.SageTerminalInteractiveShell"><code class="xref py py-class docutils literal"><span class="pre">SageTerminalInteractiveShell</span></code></a>.</li>
<li>Provide default configuration options for the shell, and its
subcomponents.  These work with (and can be overridden by)
IPython&#8217;s configuration system.</li>
<li>Load the Sage ipython extension (which does things like preparsing,
add magics, etc.).</li>
<li>Provide a custom <a class="reference internal" href="#sage.repl.interpreter.SageCrashHandler" title="sage.repl.interpreter.SageCrashHandler"><code class="xref py py-class docutils literal"><span class="pre">SageCrashHandler</span></code></a> to give the user
instructions on how to report the crash to the Sage support
mailing list.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="sageinteractiveshell">
<h2>SageInteractiveShell<a class="headerlink" href="#sageinteractiveshell" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal"><span class="pre">SageInteractiveShell</span></code> object is the object responsible for
accepting input from the user and evaluating it.  From the command-line,
this object can be retrieved by running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>   <span class="c1"># not tested</span>
</pre></div>
</div>
<p>Any input is preprocessed and evaluated inside the <code class="docutils literal"><span class="pre">shell.run_cell</span></code>
method. If the command line processing does not do what you want it to
do, you can step through it in the debugger:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">debug</span> <span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>        <span class="c1"># not tested</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal"><span class="pre">SageInteractiveShell</span></code> provides the following
customizations:</p>
<blockquote>
<div><ul class="simple">
<li>Modify the libraries before calling system commands. See
<code class="xref py py-meth docutils literal"><span class="pre">system_raw()</span></code>.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="sageterminalinteractiveshell">
<h2>SageTerminalInteractiveShell<a class="headerlink" href="#sageterminalinteractiveshell" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#sage.repl.interpreter.SageTerminalInteractiveShell" title="sage.repl.interpreter.SageTerminalInteractiveShell"><code class="xref py py-class docutils literal"><span class="pre">SageTerminalInteractiveShell</span></code></a> is a close relative of
<code class="xref py py-class docutils literal"><span class="pre">SageInteractiveShell</span></code> that is specialized for running in a
terminal. In particular, running commands like <code class="docutils literal"><span class="pre">!ls</span></code> will directly
write to stdout. Technically, the <code class="docutils literal"><span class="pre">system</span></code> attribute will point to
<code class="docutils literal"><span class="pre">system_raw</span></code> instead of <code class="docutils literal"><span class="pre">system_piped</span></code>.</p>
</div>
<div class="section" id="interface-shell">
<h2>Interface Shell<a class="headerlink" href="#interface-shell" title="Permalink to this headline">¶</a></h2>
<p>The function <a class="reference internal" href="#sage.repl.interpreter.interface_shell_embed" title="sage.repl.interpreter.interface_shell_embed"><code class="xref py py-func docutils literal"><span class="pre">interface_shell_embed()</span></code></a> takes a
<a class="reference external" href="../../../interfaces/sage/interfaces/interface.html#sage.interfaces.interface.Interface" title="(in Sage Reference Manual: Interpreter Interfaces v7.3)"><code class="xref py py-class docutils literal"><span class="pre">Interface</span></code></a> object and returns an
embeddable IPython shell which can be used to directly interact with
that shell.  The bulk of this functionality is provided through
<a class="reference internal" href="#sage.repl.interpreter.InterfaceShellTransformer" title="sage.repl.interpreter.InterfaceShellTransformer"><code class="xref py py-class docutils literal"><span class="pre">InterfaceShellTransformer</span></code></a>.</p>
<p>TESTS:</p>
<p>Check that Cython source code appears in tracebacks:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;1/0&#39;</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">ZeroDivisionError                         Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-...&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 Integer(1)/Integer(0)</span>

<span class="go">.../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (.../cythonized/sage/rings/integer.c:...)()</span>
<span class="go">   ...          if type(left) is type(right):</span>
<span class="go">   ...              if mpz_sgn((&lt;Integer&gt;right).value) == 0:</span>
<span class="go">-&gt; ...                  raise ZeroDivisionError(&quot;rational division by zero&quot;)</span>
<span class="go">   ...              x = &lt;Rational&gt; Rational.__new__(Rational)</span>
<span class="go">   ...              mpq_div_zz(x.value, (&lt;Integer&gt;left).value, (&lt;Integer&gt;right).value)</span>

<span class="go">ZeroDivisionError: rational division by zero</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<dl class="class">
<dt id="sage.repl.interpreter.InterfaceShellTransformer">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">InterfaceShellTransformer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.InterfaceShellTransformer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">IPython.core.prefilter.PrefilterTransformer</span></code></p>
<p>Initialize this class.  All of the arguments get passed to
<code class="xref py py-meth docutils literal"><span class="pre">PrefilterTransformer.__init__()</span></code>.</p>
<dl class="attribute">
<dt id="sage.repl.interpreter.InterfaceShellTransformer.temporary_objects">
<code class="descname">temporary_objects</code><a class="headerlink" href="#sage.repl.interpreter.InterfaceShellTransformer.temporary_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>a list of hold onto interface objects and keep them from being
garbage collected</p>
</dd></dl>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#sage.repl.interpreter.interface_shell_embed" title="sage.repl.interpreter.interface_shell_embed"><code class="xref py py-func docutils literal"><span class="pre">interface_shell_embed()</span></code></a></p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">interface_shell_embed</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">interface_shell_embed</span><span class="p">(</span><span class="n">maxima</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">prefilter_manager</span><span class="o">.</span><span class="n">transformers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">temporary_objects</span>
<span class="go">set()</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">_sage_import_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;sage(a) + maxima(b)&#39;</span><span class="p">)</span>
<span class="go">[&#39;a&#39;, &#39;b&#39;]</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.repl.interpreter.InterfaceShellTransformer.preparse_imports_from_sage">
<code class="descname">preparse_imports_from_sage</code><span class="sig-paren">(</span><em>line</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.InterfaceShellTransformer.preparse_imports_from_sage" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds occurrences of strings such as <code class="docutils literal"><span class="pre">sage(object)</span></code> in
<em>line</em>, converts <code class="docutils literal"><span class="pre">object</span></code> to <code class="xref py py-attr docutils literal"><span class="pre">shell.interface</span></code>,
and replaces those strings with their identifier in the new
system.  This also works with strings such as
<code class="docutils literal"><span class="pre">maxima(object)</span></code> if <code class="xref py py-attr docutils literal"><span class="pre">shell.interface</span></code> is
<code class="docutils literal"><span class="pre">maxima</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>line</strong> (<em>string</em>) &#8211; the line to transform</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This does not parse nested parentheses correctly.  Thus,
lines like <code class="docutils literal"><span class="pre">sage(a.foo())</span></code> will not work correctly.
This can&#8217;t be done in generality with regular expressions.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">interface_shell_embed</span><span class="p">,</span> <span class="n">InterfaceShellTransformer</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">interface_shell_embed</span><span class="p">(</span><span class="n">maxima</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span> <span class="o">=</span> <span class="n">InterfaceShellTransformer</span><span class="p">(</span><span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">prefilter_manager</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">prefilter_manager</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ex</span><span class="p">(</span><span class="s1">&#39;a = 3&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">preparse_imports_from_sage</span><span class="p">(</span><span class="s1">&#39;2 + sage(a)&#39;</span><span class="p">)</span>
<span class="go">&#39;2 + sage0 &#39;</span>
<span class="gp">sage: </span><span class="n">maxima</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;sage0&#39;</span><span class="p">)</span>
<span class="go">&#39;3&#39;</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">preparse_imports_from_sage</span><span class="p">(</span><span class="s1">&#39;2 + maxima(a)&#39;</span><span class="p">)</span> <span class="c1"># maxima calls set_seed on startup which is why &#39;sage0&#39; will becomes &#39;sage4&#39; and not just &#39;sage1&#39;</span>
<span class="go">&#39;2 +  sage4 &#39;</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">preparse_imports_from_sage</span><span class="p">(</span><span class="s1">&#39;2 + gap(a)&#39;</span><span class="p">)</span>
<span class="go">&#39;2 + gap(a)&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.InterfaceShellTransformer.transform">
<code class="descname">transform</code><span class="sig-paren">(</span><em>line</em>, <em>continue_prompt</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.InterfaceShellTransformer.transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluates <em>line</em> in <code class="xref py py-attr docutils literal"><span class="pre">shell.interface</span></code> and returns a
string representing the result of that evaluation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>line</strong> (<em>string</em>) &#8211; the line to be transformed <em>and evaluated</em></li>
<li><strong>continue_prompt</strong> (<em>bool</em>) &#8211; is this line a continuation in a sequence of multiline input?</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">interface_shell_embed</span><span class="p">,</span> <span class="n">InterfaceShellTransformer</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">interface_shell_embed</span><span class="p">(</span><span class="n">maxima</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span> <span class="o">=</span> <span class="n">InterfaceShellTransformer</span><span class="p">(</span><span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">prefilter_manager</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">prefilter_manager</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;2+2&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>   <span class="c1"># note: output contains triple quotation marks</span>
<span class="go">&#39;sage.misc.all.logstr(&quot;&quot;&quot;4&quot;&quot;&quot;)&#39;</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ex</span><span class="p">(</span><span class="s1">&#39;a = 4&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">r&#39;sage(a)+4&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="go">&#39;sage.misc.all.logstr(&quot;&quot;&quot;8&quot;&quot;&quot;)&#39;</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">temporary_objects</span>
<span class="go">set()</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">interface_shell_embed</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span> <span class="o">=</span> <span class="n">InterfaceShellTransformer</span><span class="p">(</span><span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">prefilter_manager</span><span class="o">=</span><span class="n">shell</span><span class="o">.</span><span class="n">prefilter_manager</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ift</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;2+2&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="go">&#39;sage.misc.all.logstr(&quot;&quot;&quot;4&quot;&quot;&quot;)&#39;</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageCrashHandler">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageCrashHandler</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageCrashHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">IPython.terminal.ipapp.IPAppCrashHandler</span></code></p>
<p>A custom <code class="xref py py-class docutils literal"><span class="pre">CrashHandler</span></code> which gives the user
instructions on how to post the problem to sage-support.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageTerminalApp</span><span class="p">,</span> <span class="n">SageCrashHandler</span>
<span class="gp">sage: </span><span class="n">app</span> <span class="o">=</span> <span class="n">SageTerminalApp</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sch</span> <span class="o">=</span> <span class="n">SageCrashHandler</span><span class="p">(</span><span class="n">app</span><span class="p">);</span> <span class="n">sch</span>
<span class="go">&lt;sage.repl.interpreter.SageCrashHandler object at 0x...&gt;</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="n">sch</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;app_name&#39;, u&#39;Sage&#39;),</span>
<span class="go"> (&#39;bug_tracker&#39;, &#39;http://trac.sagemath.org&#39;),</span>
<span class="go"> (&#39;contact_email&#39;, &#39;sage-support@googlegroups.com&#39;),</span>
<span class="go"> (&#39;contact_name&#39;, &#39;sage-support&#39;),</span>
<span class="go"> (&#39;crash_report_fname&#39;, u&#39;Crash_report_Sage.txt&#39;)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageNotebookInteractiveShell">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageNotebookInteractiveShell</code><span class="sig-paren">(</span><em>ipython_dir=None</em>, <em>profile_dir=None</em>, <em>user_module=None</em>, <em>user_ns=None</em>, <em>custom_exceptions=(()</em>, <em>None)</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageNotebookInteractiveShell" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.repl.interpreter.SageShellOverride" title="sage.repl.interpreter.SageShellOverride"><code class="xref py py-class docutils literal"><span class="pre">sage.repl.interpreter.SageShellOverride</span></code></a>, <code class="xref py py-class docutils literal"><span class="pre">IPython.core.interactiveshell.InteractiveShell</span></code></p>
<p>IPython Shell for the Sage IPython Notebook</p>
<p>The doctests are not tested since they would change the current
rich output backend away from the doctest rich output backend.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageNotebookInteractiveShell</span>
<span class="gp">sage: </span><span class="n">SageNotebookInteractiveShell</span><span class="p">()</span>   <span class="c1"># not tested</span>
<span class="go">&lt;sage.repl.interpreter.SageNotebookInteractiveShell object at 0x...&gt;</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.repl.interpreter.SageNotebookInteractiveShell.init_display_formatter">
<code class="descname">init_display_formatter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageNotebookInteractiveShell.init_display_formatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the Sage IPython notebook rich output backend</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageNotebookInteractiveShell</span>
<span class="gp">sage: </span><span class="n">SageNotebookInteractiveShell</span><span class="p">()</span><span class="o">.</span><span class="n">init_display_formatter</span><span class="p">()</span>   <span class="c1"># not tested</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.SagePreparseTransformer">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">SagePreparseTransformer</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SagePreparseTransformer" title="Permalink to this definition">¶</a></dt>
<dd><p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SagePreparseTransformer</span>
<span class="gp">sage: </span><span class="n">spt</span> <span class="o">=</span> <span class="n">SagePreparseTransformer</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;1+1r+2.3^2.3r&#39;</span><span class="p">)</span>
<span class="go">&quot;Integer(1)+1+RealNumber(&#39;2.3&#39;)**2.3&quot;</span>
<span class="gp">sage: </span><span class="n">preparser</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;2.3^2&#39;</span><span class="p">)</span>
<span class="go">&#39;2.3^2&#39;</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Check that syntax errors in the preparser do not crash IPython,
see <a class="reference external" href="https://trac.sagemath.org/14961">trac ticket #14961</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">preparser</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">bad_syntax</span> <span class="o">=</span> <span class="s2">&quot;R.&lt;t&gt; = QQ{]&quot;</span>
<span class="gp">sage: </span><span class="n">preparse</span><span class="p">(</span><span class="n">bad_syntax</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">SyntaxError</span>: <span class="n">Mismatched &#39;]&#39;</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="n">bad_syntax</span><span class="p">)</span>
<span class="go">  File &quot;&lt;string&gt;&quot;, line unknown</span>
<span class="go">SyntaxError: Mismatched &#39;]&#39;</span>

<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.SagePromptTransformer">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">SagePromptTransformer</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SagePromptTransformer" title="Permalink to this definition">¶</a></dt>
<dd><p>Strip the sage:/....: prompts of Sage.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SagePromptTransformer</span>
<span class="gp">sage: </span><span class="n">spt</span> <span class="o">=</span> <span class="n">SagePromptTransformer</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;sage: 2 + 2&quot;</span><span class="p">)</span>
<span class="go">&#39;2 + 2&#39;</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="go">&#39;&#39;</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;....: 2+2&quot;</span><span class="p">)</span>
<span class="go">&#39;2+2&#39;</span>
</pre></div>
</div>
<p>This should strip multiple prompts: see <a class="reference external" href="https://trac.sagemath.org/16297">trac ticket #16297</a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;sage:   sage: 2+2&quot;</span><span class="p">)</span>
<span class="go">&#39;2+2&#39;</span>
<span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;   sage: ....: 2+2&quot;</span><span class="p">)</span>
<span class="go">&#39;2+2&#39;</span>
</pre></div>
</div>
<p>The prompt contains a trailing space. Extra spaces between the
last prompt and the remainder should not be stripped:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">spt</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;   sage: ....:    2+2&quot;</span><span class="p">)</span>
<span class="go">&#39;   2+2&#39;</span>
</pre></div>
</div>
<p>We test that the input transformer is enabled on the Sage command
line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;sage: a = 123&#39;</span><span class="p">)</span>              <span class="c1"># single line</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;sage: a = [</span><span class="se">\n</span><span class="s1">... 123]&#39;</span><span class="p">)</span>      <span class="c1"># old-style multi-line</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;sage: a = [</span><span class="se">\n</span><span class="s1">....: 123]&#39;</span><span class="p">)</span>    <span class="c1"># new-style multi-line</span>
</pre></div>
</div>
<p>We test that <a class="reference external" href="https://trac.sagemath.org/16196">trac ticket #16196</a> is resolved:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;    sage: 1+1&#39;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageShellOverride">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageShellOverride</code><a class="headerlink" href="#sage.repl.interpreter.SageShellOverride" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Mixin to override methods in IPython&#8217;s [Terminal]InteractiveShell
classes.</p>
<dl class="method">
<dt id="sage.repl.interpreter.SageShellOverride.show_usage">
<code class="descname">show_usage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageShellOverride.show_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the basic Sage usage.</p>
<p>This method ends up being called when you enter <code class="docutils literal"><span class="pre">?</span></code> and
nothing else on the command line.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
<span class="go">Welcome to Sage ...</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.SageShellOverride.system_raw">
<code class="descname">system_raw</code><span class="sig-paren">(</span><em>cmd</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageShellOverride.system_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a system command.</p>
<p>This is equivalent to the sage-native-execute shell script.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">system_raw</span><span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">user_ns</span><span class="p">[</span><span class="s1">&#39;_exit_code&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">system_raw</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">user_ns</span><span class="p">[</span><span class="s1">&#39;_exit_code&#39;</span><span class="p">]</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">system_raw</span><span class="p">(</span><span class="s1">&#39;R --version&#39;</span><span class="p">)</span>
<span class="go">R version ...</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">user_ns</span><span class="p">[</span><span class="s1">&#39;_exit_code&#39;</span><span class="p">]</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageTerminalApp">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageTerminalApp</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">IPython.terminal.ipapp.TerminalIPythonApp</span></code></p>
<dl class="attribute">
<dt id="sage.repl.interpreter.SageTerminalApp.crash_handler_class">
<code class="descname">crash_handler_class</code><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp.crash_handler_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sage.repl.interpreter.SageCrashHandler" title="sage.repl.interpreter.SageCrashHandler"><code class="xref py py-class docutils literal"><span class="pre">SageCrashHandler</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.SageTerminalApp.init_shell">
<code class="descname">init_shell</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp.init_shell" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the <code class="xref py py-class docutils literal"><span class="pre">SageInteractiveShell</span></code> instance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This code is based on
<code class="xref py py-meth docutils literal"><span class="pre">TerminalIPythonApp.init_shell()</span></code>.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageTerminalApp</span><span class="p">,</span> <span class="n">DEFAULT_SAGE_CONFIG</span>
<span class="gp">sage: </span><span class="n">app</span> <span class="o">=</span> <span class="n">SageTerminalApp</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">app</span><span class="o">.</span><span class="n">shell</span>
<span class="go">&lt;sage.repl.interpreter.SageTestShell object at 0x...&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.SageTerminalApp.load_config_file">
<code class="descname">load_config_file</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp.load_config_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Merges a config file with the default sage config.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This code is based on <code class="xref py py-meth docutils literal"><span class="pre">Application.update_config()</span></code>.</p>
</div>
<p>TESTS:</p>
<p>Test that <a class="reference external" href="https://trac.sagemath.org/15972">trac ticket #15972</a> has been fixed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.temporary_file</span> <span class="kn">import</span> <span class="n">tmp_dir</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageTerminalApp</span>
<span class="gp">sage: </span><span class="n">d</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">IPython.paths</span> <span class="kn">import</span> <span class="n">get_ipython_dir</span>
<span class="gp">sage: </span><span class="n">IPYTHONDIR</span> <span class="o">=</span> <span class="n">get_ipython_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;IPYTHONDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
<span class="gp">sage: </span><span class="n">SageTerminalApp</span><span class="p">()</span><span class="o">.</span><span class="n">load_config_file</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;IPYTHONDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IPYTHONDIR</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="sage.repl.interpreter.SageTerminalApp.shell_class">
<code class="descname">shell_class</code><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp.shell_class" title="Permalink to this definition">¶</a></dt>
<dd><p>A trait whose value must be a subclass of a specified class.</p>
</dd></dl>

<dl class="attribute">
<dt id="sage.repl.interpreter.SageTerminalApp.test_shell">
<code class="descname">test_shell</code><a class="headerlink" href="#sage.repl.interpreter.SageTerminalApp.test_shell" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean (True, False) trait.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageTerminalInteractiveShell">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageTerminalInteractiveShell</code><span class="sig-paren">(</span><em>ipython_dir=None</em>, <em>profile_dir=None</em>, <em>user_module=None</em>, <em>user_ns=None</em>, <em>custom_exceptions=(()</em>, <em>None)</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTerminalInteractiveShell" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.repl.interpreter.SageShellOverride" title="sage.repl.interpreter.SageShellOverride"><code class="xref py py-class docutils literal"><span class="pre">sage.repl.interpreter.SageShellOverride</span></code></a>, <code class="xref py py-class docutils literal"><span class="pre">IPython.terminal.interactiveshell.TerminalInteractiveShell</span></code></p>
<p>IPython Shell for the Sage IPython Commandline Interface</p>
<p>The doctests are not tested since they would change the current
rich output backend away from the doctest rich output backend.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageTerminalInteractiveShell</span>
<span class="gp">sage: </span><span class="n">SageTerminalInteractiveShell</span><span class="p">()</span>   <span class="c1"># not tested</span>
<span class="go">&lt;sage.repl.interpreter.SageNotebookInteractiveShell object at 0x...&gt;</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.repl.interpreter.SageTerminalInteractiveShell.init_display_formatter">
<code class="descname">init_display_formatter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTerminalInteractiveShell.init_display_formatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the Sage IPython commandline rich output backend</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">SageTerminalInteractiveShell</span>
<span class="gp">sage: </span><span class="n">SageTerminalInteractiveShell</span><span class="p">()</span><span class="o">.</span><span class="n">init_display_formatter</span><span class="p">()</span>   <span class="c1"># not tested</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sage.repl.interpreter.SageTestShell">
<em class="property">class </em><code class="descclassname">sage.repl.interpreter.</code><code class="descname">SageTestShell</code><span class="sig-paren">(</span><em>ipython_dir=None</em>, <em>profile_dir=None</em>, <em>user_module=None</em>, <em>user_ns=None</em>, <em>custom_exceptions=(()</em>, <em>None)</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTestShell" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.repl.interpreter.SageShellOverride" title="sage.repl.interpreter.SageShellOverride"><code class="xref py py-class docutils literal"><span class="pre">sage.repl.interpreter.SageShellOverride</span></code></a>, <code class="xref py py-class docutils literal"><span class="pre">IPython.terminal.interactiveshell.TerminalInteractiveShell</span></code></p>
<p>Test Shell</p>
<p>Care must be taken in these doctests to quit the test shell in
order to switch back the rich output display backend to the
doctest backend.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">();</span>  <span class="n">shell</span>
<span class="go">&lt;sage.repl.interpreter.SageTestShell object at 0x...&gt;</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="sage.repl.interpreter.SageTestShell.init_display_formatter">
<code class="descname">init_display_formatter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTestShell.init_display_formatter" title="Permalink to this definition">¶</a></dt>
<dd><p>Switch to the Sage IPython commandline rich output backend</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">();</span>  <span class="n">shell</span>
<span class="go">&lt;sage.repl.interpreter.SageTestShell object at 0x...&gt;</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">init_display_formatter</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.SageTestShell.quit">
<code class="descname">quit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTestShell.quit" title="Permalink to this definition">¶</a></dt>
<dd><p>Quit the test shell.</p>
<p>To make the test shell as realistic as possible, we switch to
the
<a class="reference internal" href="rich_output/backend_ipython.html#sage.repl.rich_output.backend_ipython.BackendIPythonCommandline" title="sage.repl.rich_output.backend_ipython.BackendIPythonCommandline"><code class="xref py py-class docutils literal"><span class="pre">BackendIPythonCommandline</span></code></a>
display backend. This method restores the previous display
backend, which is the
<a class="reference internal" href="rich_output/backend_doctest.html#sage.repl.rich_output.backend_doctest.BackendDoctest" title="sage.repl.rich_output.backend_doctest.BackendDoctest"><code class="xref py py-class docutils literal"><span class="pre">BackendDoctest</span></code></a>
during doctests.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.rich_output</span> <span class="kn">import</span> <span class="n">get_display_manager</span>
<span class="gp">sage: </span><span class="n">get_display_manager</span><span class="p">()</span>
<span class="go">The Sage display manager using the doctest backend</span>

<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">get_display_manager</span><span class="p">()</span>
<span class="go">The Sage display manager using the IPython command line backend</span>

<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">get_display_manager</span><span class="p">()</span>
<span class="go">The Sage display manager using the doctest backend</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.repl.interpreter.SageTestShell.run_cell">
<code class="descname">run_cell</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.SageTestShell.run_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>Run IPython cell</p>
<p>Starting with IPython-3.0, this returns an success/failure
information. Since it is more convenient for doctests, we
ignore it.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">rc</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;1/0&#39;</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">ZeroDivisionError                         Traceback (most recent call last)</span>
<span class="gp">...</span>
<span class="go">ZeroDivisionError: rational division by zero</span>
<span class="gp">sage: </span><span class="n">rc</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.embedded">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">embedded</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.embedded" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if Sage is being run from the notebook.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">embedded</span>
<span class="gp">sage: </span><span class="n">embedded</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.get_test_shell">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">get_test_shell</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.get_test_shell" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a IPython shell that can be used in testing the functions
in this module.</p>
<p>OUTPUT:</p>
<p>An IPython shell</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">();</span> <span class="n">shell</span>
<span class="go">&lt;sage.repl.interpreter.SageTestShell object at 0x...&gt;</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shell_class</span>
<span class="go">&lt;class &#39;sage.repl.interpreter.SageTestShell&#39;&gt;</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">test_shell</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Check that <a class="reference external" href="https://trac.sagemath.org/14070">trac ticket #14070</a> has been resolved:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.tests.cmdline</span> <span class="kn">import</span> <span class="n">test_executable</span>
<span class="gp">sage: </span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;from sage.repl.interpreter import get_test_shell; shell = get_test_shell()&#39;</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span> <span class="o">=</span> <span class="n">test_executable</span><span class="p">([</span><span class="s2">&quot;sage&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">out</span> <span class="o">+</span> <span class="n">err</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.interface_shell_embed">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">interface_shell_embed</code><span class="sig-paren">(</span><em>interface</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.interface_shell_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an IPython shell which uses a Sage interface on the
backend to perform the evaluations.  It uses
<a class="reference internal" href="#sage.repl.interpreter.InterfaceShellTransformer" title="sage.repl.interpreter.InterfaceShellTransformer"><code class="xref py py-class docutils literal"><span class="pre">InterfaceShellTransformer</span></code></a> to transform the input into the
appropriate <code class="docutils literal"><span class="pre">interface.eval(...)</span></code> input.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">interface</span></code> &#8211; A Sage <code class="docutils literal"><span class="pre">PExpect</span></code> interface instance.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">interface_shell_embed</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">interface_shell_embed</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;List( [1..10], IsPrime )&#39;</span><span class="p">)</span>
<span class="go">[ false, true, true, false, true, false, true, false, false, false ]</span>
<span class="go">&lt;IPython.core.interactiveshell.ExecutionResult object at 0x...&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.repl.interpreter.preparser">
<code class="descclassname">sage.repl.interpreter.</code><code class="descname">preparser</code><span class="sig-paren">(</span><em>on=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.repl.interpreter.preparser" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn on or off the Sage preparser.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>on</strong> (<em>bool</em>) &#8211; if True turn on preparsing; if False, turn it off.</td>
</tr>
</tbody>
</table>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span>
<span class="go">2/3</span>
<span class="gp">sage: </span><span class="n">preparser</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">sage: </span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># not tested since doctests are always preparsed</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">preparser</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">sage: </span><span class="mi">2</span><span class="o">^</span><span class="mi">3</span>
<span class="go">8</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Sage&#8217;s IPython Modifications</a><ul>
<li><a class="reference internal" href="#sageterminalapp">SageTerminalApp</a></li>
<li><a class="reference internal" href="#sageinteractiveshell">SageInteractiveShell</a></li>
<li><a class="reference internal" href="#sageterminalinteractiveshell">SageTerminalInteractiveShell</a></li>
<li><a class="reference internal" href="#interface-shell">Interface Shell</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="readline_extra_commands.html"
                                  title="previous chapter">Extra Readline Commands</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="ipython_extension.html"
                                  title="next chapter">Sage&#8217;s IPython Extension</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/sage/repl/interpreter.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18" />
               <!-- The shading of the "Go" button should be consistent -->
               <!-- with the colour of the header and footer. See the file -->
               <!-- doc/common/themes/sage/theme.conf for colours used by -->
               <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ipython_extension.html" title="Sage’s IPython Extension"
             >next</a> |</li>
        <li class="right" >
          <a href="readline_extra_commands.html" title="Extra Readline Commands"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">The Sage Command Line</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005--2016, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>