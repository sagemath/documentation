<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Inventory builder" href="ext/inventory_builder.html" /><link rel="prev" title="Sphinx build configuration" href="conf.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Utilities - Documentation System</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Documentation System</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 10.0 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../index.html">Home - Documentation System</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="__main__.html">Sage docbuild main</a></li>
<li class="toctree-l1"><a class="reference internal" href="builders.html">Documentation builders</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_options.html">Build options</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinxbuild.html">Sphinx build script</a></li>
<li class="toctree-l1"><a class="reference internal" href="conf.html">Sphinx build configuration</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ext/inventory_builder.html">Inventory builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="ext/sage_autodoc.html">Sage autodoc extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="ext/multidocs.html">Sage multidocs extension</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="utilities">
<span id="sage-docbuild-utils"></span><h1>Utilities<a class="headerlink" href="#utilities" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-sage_docbuild.utils"></span><dl class="py exception">
<dt class="sig sig-object py" id="sage_docbuild.utils.RemoteException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage_docbuild.utils.</span></span><span class="sig-name descname"><span class="pre">RemoteException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tb</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage_docbuild.utils.RemoteException" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/exceptions.html#Exception" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
<p>Raised if an exception occurred in one of the child processes.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage_docbuild.utils.RemoteException.tb">
<span class="sig-name descname"><span class="pre">tb</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#sage_docbuild.utils.RemoteException.tb" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage_docbuild.utils.RemoteExceptionWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage_docbuild.utils.</span></span><span class="sig-name descname"><span class="pre">RemoteExceptionWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/exceptions.html#BaseException" title="(in Python v3.6)"><span class="pre">BaseException</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage_docbuild.utils.RemoteExceptionWrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Used by child processes to capture exceptions thrown during execution and
report them to the main process, including the correct traceback.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage_docbuild.utils.RemoteExceptionWrapper.exc">
<span class="sig-name descname"><span class="pre">exc</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/exceptions.html#BaseException" title="(in Python v3.6)"><span class="pre">BaseException</span></a></em><a class="headerlink" href="#sage_docbuild.utils.RemoteExceptionWrapper.exc" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage_docbuild.utils.RemoteExceptionWrapper.tb">
<span class="sig-name descname"><span class="pre">tb</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#sage_docbuild.utils.RemoteExceptionWrapper.tb" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="sage_docbuild.utils.WorkerDiedException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage_docbuild.utils.</span></span><span class="sig-name descname"><span class="pre">WorkerDiedException</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/typing.html#typing.Optional" title="(in Python v3.6)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_exception</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/typing.html#typing.Optional" title="(in Python v3.6)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/exceptions.html#BaseException" title="(in Python v3.6)"><span class="pre">BaseException</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage_docbuild.utils.WorkerDiedException" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RuntimeError</span></code></a></p>
<p>Raised if a worker process dies unexpected.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage_docbuild.utils.WorkerDiedException.original_exception">
<span class="sig-name descname"><span class="pre">original_exception</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/typing.html#typing.Optional" title="(in Python v3.6)"><span class="pre">Optional</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/exceptions.html#BaseException" title="(in Python v3.6)"><span class="pre">BaseException</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sage_docbuild.utils.WorkerDiedException.original_exception" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage_docbuild.utils.build_many">
<span class="sig-prename descclassname"><span class="pre">sage_docbuild.utils.</span></span><span class="sig-name descname"><span class="pre">build_many</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">processes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage_docbuild.utils.build_many" title="Permalink to this definition">#</a></dt>
<dd><p>Map a list of arguments in <code class="docutils literal notranslate"><span class="pre">args</span></code> to a single-argument target function
<code class="docutils literal notranslate"><span class="pre">target</span></code> in parallel using <code class="docutils literal notranslate"><span class="pre">multiprocessing.cpu_count()</span></code> (or
<code class="docutils literal notranslate"><span class="pre">processes</span></code> if given) simultaneous processes.</p>
<p>This is a simplified version of <code class="docutils literal notranslate"><span class="pre">multiprocessing.Pool.map</span></code> from the
Python standard library which avoids a couple of its pitfalls.  In
particular, it can abort (with a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code>) without hanging if one of
the worker processes unexpectedly dies.  It also has semantics equivalent
to <code class="docutils literal notranslate"><span class="pre">maxtasksperchild=1</span></code>; that is, one process is started per argument.
As such, this is inefficient for processing large numbers of fast tasks,
but appropriate for running longer tasks (such as doc builds) which may
also require significant cleanup.</p>
<p>It also avoids starting new processes from a pthread, which results in at
least two known issues:</p>
<ul class="simple">
<li><p>On versions of Cygwin prior to 3.0.0 there were bugs in mmap handling
on threads (see <a class="reference external" href="https://github.com/sagemath/sage/issues/27214#comment:25">github issue #27214#comment:25</a>).</p></li>
<li><p>When PARI is built with multi-threading support, forking a Sage
process from a thread leaves the main Pari interface instance broken
(see <a class="reference external" href="https://github.com/sagemath/sage/issues/26608#comment:38">github issue #26608#comment:38</a>).</p></li>
</ul>
<p>In the future this may be replaced by a generalized version of the more
robust parallel processing implementation from <code class="docutils literal notranslate"><span class="pre">sage.doctest.forker</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage_docbuild.utils</span> <span class="kn">import</span> <span class="n">build_many</span>
<span class="gp">sage: </span><span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="kn">import</span> <span class="nn">time</span>
<span class="gp">....: </span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="gp">....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processed task </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">_</span> <span class="o">=</span> <span class="n">build_many</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
<span class="go">Processed task ...</span>
</pre></div>
</div>
<p>Unlike the first version of <code class="docutils literal notranslate"><span class="pre">build_many</span></code> which was only intended to get
around the Cygwin bug, this version can also return a result, and thus can
be used as a replacement for <code class="docutils literal notranslate"><span class="pre">multiprocessing.Pool.map</span></code> (i.e. it still
blocks until the result is ready):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">N</span>
<span class="gp">sage: </span><span class="n">build_many</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="go">[0, 1, 4, 9, ..., 9604, 9801]</span>
</pre></div>
</div>
<p>If the target function raises an exception in any of the workers,
<code class="docutils literal notranslate"><span class="pre">build_many</span></code> raises that exception and all other results are discarded.
Any in-progress tasks may still be allowed to complete gracefully before
the exception is raised:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">signal</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="c1"># Task 4 is a poison pill</span>
<span class="gp">....: </span>        <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
<span class="gp">....: </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="gp">....: </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processed task </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: In practice this test might still show output from the other worker
processes before the poison-pill is executed.  It may also display the
traceback from the failing process on stderr.  However, due to how the
doctest runner works, the doctest will only expect the final exception:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">build_many</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">    raise ZeroDivisionError(&quot;rational division by zero&quot;)</span>
<span class="go"> ZeroDivisionError: rational division by zero</span>
<span class="go">...</span>
<span class="go">    raise worker_exc.original_exception</span>
<span class="go">ZeroDivisionError: rational division by zero</span>
</pre></div>
</div>
<p>Similarly, if one of the worker processes dies unexpectedly otherwise exits
non-zero (e.g. killed by a signal) any in-progress tasks will be completed
gracefully, but then a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> is raised and pending tasks are not
started:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">signal</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="c1"># Task 4 is a poison pill</span>
<span class="gp">....: </span>        <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
<span class="gp">....: </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">....: </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="gp">....: </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processed task </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">build_many</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">WorkerDiedException: worker for 4 died with non-zero exit code -9</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ext/inventory_builder.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Inventory builder</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="conf.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Sphinx build configuration</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Utilities</a><ul>
<li><a class="reference internal" href="#sage_docbuild.utils.RemoteException"><code class="docutils literal notranslate"><span class="pre">RemoteException</span></code></a><ul>
<li><a class="reference internal" href="#sage_docbuild.utils.RemoteException.tb"><code class="docutils literal notranslate"><span class="pre">tb</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage_docbuild.utils.RemoteExceptionWrapper"><code class="docutils literal notranslate"><span class="pre">RemoteExceptionWrapper</span></code></a><ul>
<li><a class="reference internal" href="#sage_docbuild.utils.RemoteExceptionWrapper.exc"><code class="docutils literal notranslate"><span class="pre">exc</span></code></a></li>
<li><a class="reference internal" href="#sage_docbuild.utils.RemoteExceptionWrapper.tb"><code class="docutils literal notranslate"><span class="pre">tb</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage_docbuild.utils.WorkerDiedException"><code class="docutils literal notranslate"><span class="pre">WorkerDiedException</span></code></a><ul>
<li><a class="reference internal" href="#sage_docbuild.utils.WorkerDiedException.original_exception"><code class="docutils literal notranslate"><span class="pre">original_exception</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage_docbuild.utils.build_many"><code class="docutils literal notranslate"><span class="pre">build_many()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    </body>
</html>