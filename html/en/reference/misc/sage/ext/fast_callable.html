<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Fast Numerical Evaluation" href="fast_eval.html" /><link rel="prev" title="Fast and safe weak value dictionary" href="../misc/weak_dict.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Fast Expression Evaluation - Utilities</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Utilities</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 10.1 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../../index.html">Home - Utilities</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/defaults.html">Default Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/functional.html">Functional notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/randstate.html">Random Number States</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/prandom.html">Random Numbers with Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/unknown.html">The Unknown truth value</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/abstract_method.html">Abstract methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/bindable_class.html">Bindable classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/decorators.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/constant_function.html">Constant functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/classcall_metaclass.html">Special Methods for Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/inherit_comparison.html">Metaclass for inheriting comparison functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/method_decorator.html">Base Class to Support Method Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/object_multiplexer.html">Multiplex calls to one object to calls to many objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/fast_methods.html">Fast methods via Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/call.html">Attribute and method calling</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/callable_dict.html">Callable dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/converting_dict.html">Converting Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/flatten.html">Flatten nested lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/search.html">Searching a sorted list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/mrange.html">Multidimensional enumeration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/multireplace.html">multi_replace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/map_threaded.html">Threaded map function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arith/srange.html">Ranges and the <code class="docutils literal notranslate"><span class="pre">[1,2,..,n]</span></code> notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/element_with_label.html">Elements with labels.</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/temporary_file.html">Temporary file handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/remote_file.html">get_remote_file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/messaging.html">Message delivery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_ostools.html">Miscellaneous operating system functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../databases/sql_db.html">Relational (sqlite) Databases Module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../structure/graphics_file.html">Wrapper for Graphics Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../media/wav.html">Work with WAV files</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/stopgap.html">Stopgaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/superseded.html">Handling Superseded Functionality</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/misc.html">Miscellaneous functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/misc_c.html">Miscellaneous functions (Cython)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/verbose.html">Verbosity System and Logging in SageMath</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_attribute.html">Lazy attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_format.html">Lazy format strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_import.html">Lazy imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_import_cache.html">Lazy import cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_list.html">Lazy lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/lazy_string.html">Lazy strings</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/cachefunc.html">Cached Functions and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/weak_dict.html">Fast and safe weak value dictionary</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Fast Expression Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="fast_eval.html">Fast Numerical Evaluation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/cython.html">Cython support functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/inline_fortran.html">Fortran compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/parser.html">A parser for symbolic equations and expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/python.html">Evaluating Python code without any preparsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_eval.html">Evaluating a String in Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sh.html">Evaluating shell scripts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../typeset/symbols.html">Symbols for Character Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typeset/character_art.html">Base Class for Character-Based Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typeset/character_art_factory.html">Factory for Character-Based Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typeset/ascii_art.html">ASCII Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typeset/unicode_art.html">Unicode Art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typeset/unicode_characters.html">Unicode Characters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/repr.html">Repr formatting support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_input.html">Sage Input Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/table.html">Tables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/html.html">HTML Fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/mathml.html">MathML output support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sagetex.html">Installing and using SageTeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/latex.html">LaTeX printing support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/latex_macros.html">LaTeX macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/latex_standalone.html">Standalone LaTeX Document class and TikzPicture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/func_persist.html">Support for persistent functions in .sage files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/persist.html">Object persistence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/fpickle.html">Function pickling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/explain_pickle.html">A tool for inspecting Python pickles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/nested_class.html">Fixing pickle for nested classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/session.html">Loading and saving sessions and listing all variables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/banner.html">SageMath version and banner info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/reset.html">Interpreter reset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/viewer.html">Determination of programs for viewing web pages, etc.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/pager.html">Pager for showing strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sagedoc.html">Format Sage documentation for viewing with IPython and the notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sagedoc_conf.html">Sphinx configuration shared by sage.misc.sphinxify and sage_docbuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sphinxify.html">Process docstrings with Sphinx</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/package.html">Listing Sage packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/dist.html">Installing shortcut scripts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/citation.html">Dependency usage tracking for citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/copying.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_unittest.html">Unit testing for Sage objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/random_testing.html">Random testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/test_nested_class.html">Test for nested class Parent</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/benchmark.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_timeit.html">Accurate timing information for Sage commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sage_timeit_class.html">The <code class="docutils literal notranslate"><span class="pre">timeit</span></code> command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/profiler.html">Simple profiling tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/gperftools.html">C Function Profiler Using Google Perftools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/instancedoc.html">Dynamic documentation for instances of classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sageinspect.html">Inspect Python, Sage, and Cython objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/edit_module.html">Edit the source code of Sage interactively</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/classgraph.html">Class inheritance graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/dev_tools.html">Some tools for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/function_mangling.html">Function Mangling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rest_index_of_methods.html">ReST index of functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Low-level memory allocation functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/c3.html">The C3 algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/c3_controlled.html">The C3 algorithm, under control of a total order</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="fast-expression-evaluation">
<span id="sage-ext-fast-callable"></span><h1>Fast Expression Evaluation<a class="headerlink" href="#fast-expression-evaluation" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-sage.ext.fast_callable"></span><p>For many applications such as numerical integration, differential
equation approximation, plotting a 3d surface, optimization problems,
Monte-Carlo simulations, etc., one wishes to pass around and evaluate
a single algebraic expression many, many times at various floating
point values.  Other applications may need to evaluate an expression
many times in interval arithmetic, or in a finite field.  Doing this
via recursive calls over a python representation of the object (even
if Maxima or other outside packages are not involved) is extremely
inefficient.</p>
<p>This module provides a function, <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>, to
transform such expressions into a form where they can be evaluated
quickly:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">sage: </span><span class="n">ff</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">ff</span><span class="p">(</span><span class="mf">3.5</span><span class="p">)</span>
<span class="go">36.3992167723104</span>
<span class="gp">sage: </span><span class="n">ff</span><span class="p">(</span><span class="n">RIF</span><span class="p">(</span><span class="mf">3.5</span><span class="p">))</span>
<span class="go">36.39921677231038?</span>
</pre></div>
</div>
<p>By default, <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> only removes some interpretive
overhead from the evaluation, but all of the individual arithmetic
operations are done using standard Sage arithmetic.  This is still a
huge win over sage.calculus, which evidently has a lot of overhead.
Compare the cost of evaluating Wilkinson’s polynomial (in unexpanded
form) at x=30:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">wilk</span> <span class="o">=</span> <span class="n">prod</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">20</span><span class="p">]);</span> <span class="n">wilk</span>
<span class="go">(x - 1)*(x - 2)*(x - 3)*(x - 4)*(x - 5)*(x - 6)*(x - 7)*(x - 8)*(x - 9)*(x - 10)*(x - 11)*(x - 12)*(x - 13)*(x - 14)*(x - 15)*(x - 16)*(x - 17)*(x - 18)*(x - 19)*(x - 20)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;wilk.subs(x=30)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 1.43 ms per loop</span>
<span class="gp">sage: </span><span class="n">fc_wilk</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk(30)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 9.72 us per loop</span>
</pre></div>
</div>
<p>You can specify a particular domain for the evaluation using
<code class="docutils literal notranslate"><span class="pre">domain=</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_zz</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">ZZ</span><span class="p">)</span>
</pre></div>
</div>
<p>The meaning of domain=D is that each intermediate and final result
is converted to type D.  For instance, the previous example of
<code class="docutils literal notranslate"><span class="pre">sin(x)</span> <span class="pre">+</span> <span class="pre">3*x^2</span></code> with domain=D would be equivalent to
<code class="docutils literal notranslate"><span class="pre">D(D(sin(D(x)))</span> <span class="pre">+</span> <span class="pre">D(D(3)*D(D(x)^2)))</span></code>.  (This example also
demonstrates the one exception to the general rule: if an exponent is an
integral constant, then it is not wrapped with D().)</p>
<p>At first glance, this seems like a very bad idea if you want to
compute quickly.  And it is a bad idea, for types where we don’t
have a special interpreter.  It’s not too bad of a slowdown, though.
To mitigate the costs, we check whether the value already has
the correct parent before we call D.</p>
<p>We don’t yet have a special interpreter with domain ZZ, so we can see
how that compares to the generic fc_wilk example above:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_zz(30)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 15.4 us per loop</span>
</pre></div>
</div>
<p>However, for other types, using domain=D will get a large speedup,
because we have special-purpose interpreters for those types.  One
example is RDF.  Since with domain=RDF we know that every single
operation will be floating-point, we can just execute the
floating-point operations directly and skip all the Python object
creations that you would get from actually using RDF objects:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_rdf</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_rdf(30.0)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 7 us per loop</span>
</pre></div>
</div>
<p>The domain does not need to be a Sage type; for instance, domain=float
also works.  (We actually use the same fast interpreter for domain=float
and domain=RDF; the only difference is that when domain=RDF is used,
the return value is an RDF element, and when domain=float is used,
the return value is a Python float.)</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_float</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_float(30.0)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 5.04 us per loop</span>
</pre></div>
</div>
<p>We also have support for <code class="docutils literal notranslate"><span class="pre">RR</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_rr</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RR</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_rr(30.0)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 13 us per loop</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">CC</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_cc</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">CC</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_cc(30.0)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 23 us per loop</span>
</pre></div>
</div>
<p>And support for <code class="docutils literal notranslate"><span class="pre">CDF</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fc_wilk_cdf</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">wilk</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">CDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;fc_wilk_cdf(30.0)&#39;</span><span class="p">)</span> <span class="c1"># random, long time</span>
<span class="go">625 loops, best of 3: 10.2 us per loop</span>
</pre></div>
</div>
<p>Currently, <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> can accept two kinds of objects:
polynomials (univariate and multivariate) and symbolic expressions
(elements of the Symbolic Ring).  (This list is likely to grow
significantly in the near future.)  For polynomials, you can omit the
‘vars’ argument; the variables will default to the ring generators (in
the order used when creating the ring).</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">fp</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="go">321</span>
</pre></div>
</div>
<p>But you can also specify the variable names to override the default
ordering (you can include extra variable names here, too).</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fp</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>For symbolic expressions, you need to specify the variable names, so
that <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> knows what order to use.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;y,z,x&#39;</span><span class="p">)</span>
<span class="go">(y, z, x)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">x</span>
<span class="gp">sage: </span><span class="n">ff</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">ff</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="go">321</span>
</pre></div>
</div>
<p>You can also specify extra variable names:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ff</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">ff</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="go">341</span>
</pre></div>
</div>
<p>This should be enough for normal use of <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>; let’s
discuss some more advanced topics.</p>
<p>Sometimes it may be useful to create a fast version of an expression
without going through symbolic expressions or polynomials; perhaps
because you want to describe to <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> an expression
with common subexpressions.</p>
<p>Internally, <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> works in two stages: it constructs
an expression tree from its argument, and then it builds a
fast evaluator from that expression tree.  You can bypass the first phase
by building your own expression tree and passing that directly to
<a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>, using an <a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder" title="sage.ext.fast_callable.ExpressionTreeBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionTreeBuilder</span></code></a>.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>An <a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder" title="sage.ext.fast_callable.ExpressionTreeBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionTreeBuilder</span></code></a> has three interesting methods:
<code class="xref py py-meth docutils literal notranslate"><span class="pre">constant()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code>, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">call()</span></code>.
All of these methods return <code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionTree</span></code> objects.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">var()</span></code> method takes a string, and returns an expression tree
for the corresponding variable.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">y</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Expression trees support Python’s numeric operators, so you can easily
build expression trees representing arithmetic expressions.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">//</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">constant()</span></code> method takes a Sage value, and returns an
expression tree representing that value.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v2</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1729</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span>
</pre></div>
</div>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">call()</span></code> method takes a sage/Python function and zero or more
expression trees, and returns an expression tree representing
the function call.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v3</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">v3</span>
<span class="go">sin(add(add(mul(add(v_0, v_1), add(v_1, v_1)), floordiv(v_1, v_1)), add(mul(3.14159000000000, v_0), mul(1729, v_1))))</span>
</pre></div>
</div>
<p>Many sage/Python built-in functions are specially handled; for instance,
when evaluating an expression involving <code class="xref py py-func docutils literal notranslate"><span class="pre">sin()</span></code> over <code class="docutils literal notranslate"><span class="pre">RDF</span></code>,
the C math library function <code class="xref py py-func docutils literal notranslate"><span class="pre">sin()</span></code> is called.  Arbitrary functions
are allowed, but will be much slower since they will call back to
Python code on every call; for example, the following will work.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">e</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">,</span> <span class="n">v1</span><span class="p">);</span> <span class="n">e</span>
<span class="go">{my_sqrt}(add(mul(add(v_0, v_1), add(v_1, v_1)), floordiv(v_1, v_1)))</span>
<span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="n">e</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">3.60555127546399</span>
</pre></div>
</div>
<p>To provide <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> for your own class (so that
<code class="docutils literal notranslate"><span class="pre">fast_callable(x)</span></code> works when <code class="docutils literal notranslate"><span class="pre">x</span></code> is an instance of your
class), implement a method <code class="docutils literal notranslate"><span class="pre">_fast_callable_(self,</span> <span class="pre">etb)</span></code> for your class.
This method takes an <a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder" title="sage.ext.fast_callable.ExpressionTreeBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionTreeBuilder</span></code></a>, and returns an
expression tree built up using the methods described above.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">x</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1.4142135623730951</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.</span><span class="n">op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;ipow&#39;, 7), (&#39;load_const&#39;, 1.0), &#39;add&#39;, &#39;sqrt&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
<p>To interpret that last line, we load argument 0 (‘x’ in this case) onto
the stack, push the constant 7.0 onto the stack, call the pow function
(which takes 2 arguments from the stack), push the constant 1.0, add the
top two arguments of the stack, and then call sqrt.</p>
<p>Here we take sin of the first argument and add it to f:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">x</span><span class="o">^</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="o">+</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;ipow&#39;, 7), (&#39;load_const&#39;, 1), &#39;add&#39;, (&#39;py_call&#39;, &lt;function sqrt at ...&gt;, 1), (&#39;load_arg&#39;, 0), (&#39;py_call&#39;, sin, 1), &#39;add&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
<p>AUTHOR:</p>
<ul class="simple">
<li><p>Carl Witty (2009-02): initial version (heavily inspired by
Robert Bradshaw’s fast_eval.pyx)</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>The following bits of text were written for the module docstring.
They are not true yet, but I hope they will be true someday, at
which point I will move them into the main text.</p>
<p>The final interesting method of <a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder" title="sage.ext.fast_callable.ExpressionTreeBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExpressionTreeBuilder</span></code></a> is
<a class="reference internal" href="../misc/prandom.html#sage.misc.prandom.choice" title="sage.misc.prandom.choice"><code class="xref py py-meth docutils literal notranslate"><span class="pre">choice()</span></code></a>.  This produces conditional expressions, like the C
<code class="docutils literal notranslate"><span class="pre">COND</span> <span class="pre">?</span> <span class="pre">T</span> <span class="pre">:</span> <span class="pre">F</span></code> expression or the Python <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">if</span> <span class="pre">COND</span> <span class="pre">else</span> <span class="pre">F</span></code>.
This lets you define piecewise functions using <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v4</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">v3</span> <span class="o">&gt;=</span> <span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>  <span class="c1"># not tested</span>
</pre></div>
</div>
<p>The arguments are <code class="docutils literal notranslate"><span class="pre">(COND,</span> <span class="pre">T,</span> <span class="pre">F)</span></code> (the same order as in C), so the
above means that if <code class="docutils literal notranslate"><span class="pre">v3</span></code> evaluates to a nonnegative number,
then <code class="docutils literal notranslate"><span class="pre">v4</span></code> will evaluate to the result of <code class="docutils literal notranslate"><span class="pre">v1</span></code>;
otherwise, <code class="docutils literal notranslate"><span class="pre">v4</span></code> will evaluate to the result of <code class="docutils literal notranslate"><span class="pre">v2</span></code>.</p>
<p>Let’s see an example where we see that <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> does not
evaluate common subexpressions more than once.  We’ll make a
<a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> expression that gives the result
of 16 iterations of the Mandelbrot function.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">z</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">c</span>
<span class="gp">sage: </span><span class="n">mand</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">CDF</span><span class="p">)</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">ff</span></code> does 32 complex arithmetic operations on each call
(16 additions and 16 multiplications).  However, if <code class="docutils literal notranslate"><span class="pre">z*z</span></code> produced
code that evaluated <code class="docutils literal notranslate"><span class="pre">z</span></code> twice, then this would do many
thousands of arithmetic operations instead.</p>
<p>Note that the handling for common subexpressions only checks whether
expression trees are the same Python object; for instance, the following
code will evaluate <code class="docutils literal notranslate"><span class="pre">x+1</span></code> twice:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="go">mul(add(v_0, 1), add(v_0, 1))</span>
</pre></div>
</div>
<p>but this code will only evaluate <code class="docutils literal notranslate"><span class="pre">x+1</span></code> once:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span>
<span class="go">mul(add(v_0, 1), add(v_0, 1))</span>
</pre></div>
</div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.CompilerInstrSpec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">CompilerInstrSpec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.CompilerInstrSpec" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Describe a single instruction to the fast_callable code generator.</p>
<p>An instruction has a number of stack inputs, a number of stack
outputs, and a parameter list describing extra arguments that
must be passed to the InstructionStream.instr method (that end up
as extra words in the code).</p>
<p>The parameter list is a list of strings.  Each string is one of
the following:</p>
<ul class="simple">
<li><p>‘args’ - The instruction argument refers to an input argument of the
wrapper class; it is just appended to the code.</p></li>
<li><p>‘constants’, ‘py_constants’ - The instruction argument is a value; the
value is added to the corresponding list (if it’s not already there) and
the index is appended to the code.</p></li>
<li><p>‘n_inputs’, ‘n_outputs’ - The instruction actually takes a variable
number of inputs or outputs (the n_inputs and n_outputs attributes of
this instruction are ignored). The instruction argument specifies the
number of inputs or outputs (respectively); it is just appended to the
code.</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Expression">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">Expression</span></span><a class="headerlink" href="#sage.ext.fast_callable.Expression" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Represent an expression for fast_callable.</p>
<p>Supports the standard Python arithmetic operators; if arithmetic
is attempted between an Expression and a non-Expression, the
non-Expression is converted to an expression (using the
__call__ method of the Expression’s ExpressionTreeBuilder).</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">v_0</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">sin(v_0)</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">div(add(v_0, 1), sub(v_0, 1))</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">//</span><span class="mi">5</span>
<span class="go">floordiv(v_0, 5)</span>
<span class="gp">sage: </span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="p">)</span>
<span class="go">neg(abs(inv(v_0)))</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Expression.abs">
<span class="sig-name descname"><span class="pre">abs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.Expression.abs" title="Permalink to this definition">#</a></dt>
<dd><p>Compute the absolute value of an Expression.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">abs(v_0)</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="go">abs(v_0)</span>
<span class="gp">sage: </span><span class="n">x</span><span class="o">.</span><span class="fm">__abs__</span><span class="p">()</span>
<span class="go">abs(v_0)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionCall">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionCall</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionCall" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.ext.fast_callable.Expression" title="sage.ext.fast_callable.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a></p>
<p>An Expression that represents a function call.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="go">&lt;class &#39;sage.ext.fast_callable.ExpressionCall&#39;&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionCall.arguments">
<span class="sig-name descname"><span class="pre">arguments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionCall.arguments" title="Permalink to this definition">#</a></dt>
<dd><p>Return the arguments from this ExpressionCall.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">arguments</span><span class="p">()</span>
<span class="go">[v_0]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionCall.function">
<span class="sig-name descname"><span class="pre">function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionCall.function" title="Permalink to this definition">#</a></dt>
<dd><p>Return the function from this ExpressionCall.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
<span class="go">sin</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionChoice">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionChoice</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionChoice" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.ext.fast_callable.Expression" title="sage.ext.fast_callable.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a></p>
<p>A conditional expression.</p>
<p>(It’s possible to create choice nodes, but they don’t work yet.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>
<span class="go">(0 if {eq}(v_0, 0) else div(1, v_0))</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionChoice.condition">
<span class="sig-name descname"><span class="pre">condition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionChoice.condition" title="Permalink to this definition">#</a></dt>
<dd><p>Return the condition of an ExpressionChoice.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">condition</span><span class="p">()</span>
<span class="go">v_0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionChoice.if_false">
<span class="sig-name descname"><span class="pre">if_false</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionChoice.if_false" title="Permalink to this definition">#</a></dt>
<dd><p>Return the false branch of an ExpressionChoice.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">if_false</span><span class="p">()</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionChoice.if_true">
<span class="sig-name descname"><span class="pre">if_true</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionChoice.if_true" title="Permalink to this definition">#</a></dt>
<dd><p>Return the true branch of an ExpressionChoice.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">~</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">if_true</span><span class="p">()</span>
<span class="go">inv(v_0)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionConstant">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionConstant</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionConstant" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.ext.fast_callable.Expression" title="sage.ext.fast_callable.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a></p>
<p>An Expression that represents an arbitrary constant.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">etb</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="go">&lt;class &#39;sage.ext.fast_callable.ExpressionConstant&#39;&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionConstant.value">
<span class="sig-name descname"><span class="pre">value</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionConstant.value" title="Permalink to this definition">#</a></dt>
<dd><p>Return the constant value of an ExpressionConstant.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="go">3</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionIPow">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionIPow</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionIPow" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.ext.fast_callable.Expression" title="sage.ext.fast_callable.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a></p>
<p>A power Expression with an integer exponent.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="o">^</span><span class="mi">17</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.ext.fast_callable.ExpressionIPow&#39;&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionIPow.base">
<span class="sig-name descname"><span class="pre">base</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionIPow.base" title="Permalink to this definition">#</a></dt>
<dd><p>Return the base from this ExpressionIPow.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">etb</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span><span class="o">^</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">base</span><span class="p">()</span>
<span class="go">33</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionIPow.exponent">
<span class="sig-name descname"><span class="pre">exponent</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionIPow.exponent" title="Permalink to this definition">#</a></dt>
<dd><p>Return the exponent from this ExpressionIPow.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">exponent</span><span class="p">()</span>
<span class="go">-1</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionTreeBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionTreeBuilder</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionTreeBuilder" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class with helper methods for building Expressions.</p>
<p>An instance of this class is passed to _fast_callable_ methods;
you can also instantiate it yourself to create your own expressions
for fast_callable, bypassing _fast_callable_.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span>
<span class="go">mul(add(v_0, 3), 5)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionTreeBuilder.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionTreeBuilder.call" title="Permalink to this definition">#</a></dt>
<dd><p>Construct a call node, given a function and a list of arguments.</p>
<p>The arguments will be converted to Expressions using
ExpressionTreeBuilder.__call__.</p>
<p>As a special case, notices if the function is operator.pow and
the second argument is integral, and constructs an ExpressionIPow
instead.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cos</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="go">cos(v_0)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">sin(1)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">etb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="go">sin(1)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">factorial</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">57</span><span class="p">)</span>
<span class="go">{factorial}(add(v_0, 57))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">543</span><span class="p">)</span>
<span class="go">ipow(v_0, 543)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionTreeBuilder.choice">
<span class="sig-name descname"><span class="pre">choice</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iftrue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iffalse</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionTreeBuilder.choice" title="Permalink to this definition">#</a></dt>
<dd><p>Construct a choice node (a conditional expression), given the
condition, and the values for the true and false cases.</p>
<p>(It’s possible to create choice nodes, but they don’t work yet.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>
<span class="go">(0 if {eq}(v_0, 0) else div(1, v_0))</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionTreeBuilder.constant">
<span class="sig-name descname"><span class="pre">constant</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">c</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionTreeBuilder.constant" title="Permalink to this definition">#</a></dt>
<dd><p>Turn the argument into an ExpressionConstant, converting it to
our domain if we have one.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="go">pi</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">RealField</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="go">3.1415926535897932384626433832795028841971693993751058209749</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionTreeBuilder.var">
<span class="sig-name descname"><span class="pre">var</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionTreeBuilder.var" title="Permalink to this definition">#</a></dt>
<dd><p>Turn the argument into an ExpressionVariable.  Look it up in
the list of variables.  (Variables are matched by name.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;a,b,some_really_long_name&#39;</span><span class="p">)</span>
<span class="go">(a, b, some_really_long_name)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">polygen</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">some_really_long_name</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">some_really_long_name</span><span class="p">)</span>
<span class="go">v_2</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;some_really_long_name&#39;</span><span class="p">)</span>
<span class="go">v_2</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">v_3</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">ValueError: Variable &#39;y&#39; not found...</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionVariable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">ExpressionVariable</span></span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionVariable" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="#sage.ext.fast_callable.Expression" title="sage.ext.fast_callable.Expression"><code class="xref py py-class docutils literal notranslate"><span class="pre">Expression</span></code></a></p>
<p>An Expression that represents a variable.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">&lt;class &#39;sage.ext.fast_callable.ExpressionVariable&#39;&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.ExpressionVariable.variable_index">
<span class="sig-name descname"><span class="pre">variable_index</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.ExpressionVariable.variable_index" title="Permalink to this definition">#</a></dt>
<dd><p>Return the variable index of an ExpressionVariable.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span>
<span class="gp">sage: </span><span class="n">etb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">variable_index</span><span class="p">()</span>
<span class="go">0</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.FastCallableFloatWrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">FastCallableFloatWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imag_tol</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.FastCallableFloatWrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to alter the return types of the fast-callable functions.</p>
<p>When applying numerical routines (including plotting) to symbolic
expressions and functions, we generally first convert them to a
faster form with <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>.  That function takes a
<code class="docutils literal notranslate"><span class="pre">domain</span></code> parameter that forces the end (and all intermediate)
results of evaluation to a specific type.  Though usually always
want the end result to be of type <code class="docutils literal notranslate"><span class="pre">float</span></code>, correctly choosing
the <code class="docutils literal notranslate"><span class="pre">domain</span></code> presents some problems:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">float</span></code> is a bad choice because it’s common for real
functions to have complex terms in them. Moreover precision
issues can produce terms like <code class="docutils literal notranslate"><span class="pre">1.0</span> <span class="pre">+</span> <span class="pre">1e-12*I</span></code> that are hard
to avoid if calling <code class="docutils literal notranslate"><span class="pre">real()</span></code> on everything is infeasible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complex</span></code> has essentially the same problem as <code class="docutils literal notranslate"><span class="pre">float</span></code>.
There are several symbolic functions like <code class="xref py py-func docutils literal notranslate"><span class="pre">min_symbolic()</span></code>,
<code class="xref py py-func docutils literal notranslate"><span class="pre">max_symbolic()</span></code>, and <code class="xref py py-func docutils literal notranslate"><span class="pre">floor()</span></code> that are unable to
operate on complex numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> leaves the types of the inputs/outputs alone, but due
to the lack of a specialized interpreter, slows down evaluation
by an unacceptable amount.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CDF</span></code> has none of the other issues, because <code class="docutils literal notranslate"><span class="pre">CDF</span></code> has its
own specialized interpreter, a lexicographic ordering (for
min/max), and supports <code class="xref py py-func docutils literal notranslate"><span class="pre">floor()</span></code>. However, most numerical
functions cannot handle complex numbers, so using <code class="docutils literal notranslate"><span class="pre">CDF</span></code>
would require us to wrap every evaluation in a
<code class="docutils literal notranslate"><span class="pre">CDF</span></code>-to-<code class="docutils literal notranslate"><span class="pre">float</span></code> conversion routine. That would slow
things down less than a domain of <code class="docutils literal notranslate"><span class="pre">None</span></code> would, but is
unattractive mainly because of how invasive it would be to
“fix” the output everywhere.</p></li>
</ul>
</div></blockquote>
<p>Creating a new fast-callable interpreter that has different input
and output types solves most of the problems with a <code class="docutils literal notranslate"><span class="pre">CDF</span></code>
domain, but <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a> and the interpreter classes in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.ext.interpreters</span></code> are not really written with that in
mind. The <code class="docutils literal notranslate"><span class="pre">domain</span></code> parameter to <a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>, for
example, is expecting a single Sage ring that corresponds to one
interpreter. You can make it accept, for example, a string like
“CDF-to-float”, but the hacks required to make that work feel
wrong.</p>
<p>Thus we arrive at this solution: a class to wrap the result of
<a class="reference internal" href="#sage.ext.fast_callable.fast_callable" title="sage.ext.fast_callable.fast_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">fast_callable()</span></code></a>. Whenever we need to support intermediate
complex terms in a numerical routine, we can set <code class="docutils literal notranslate"><span class="pre">domain=CDF</span></code>
while creating its fast-callable incarnation, and then wrap the
result in this class. The <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method of this class then
ensures that the <code class="docutils literal notranslate"><span class="pre">CDF</span></code> output is converted to a <code class="docutils literal notranslate"><span class="pre">float</span></code> if
its imaginary part is within an acceptable tolerance.</p>
<p>EXAMPLES:</p>
<p>An error is thrown if the answer is complex:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">FastCallableFloatWrapper</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">ff</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">CDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fff</span> <span class="o">=</span> <span class="n">FastCallableFloatWrapper</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">imag_tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1.0</span>
<span class="gp">sage: </span><span class="n">fff</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">ValueError: complex fast-callable function result</span>
<span class="go">1.0*I for arguments (-1,)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">InstructionStream</span></span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An InstructionStream takes a sequence of instructions (passed in by
a series of method calls) and computes the data structures needed
by the interpreter.  This is the stage where we switch from operating
on Expression trees to a linear representation.  If we had a peephole
optimizer (we don’t) it would go here.</p>
<p>Currently, this class is not very general; it only works for
interpreters with a fixed set of memory chunks (with fixed names).
Basically, it only works for stack-based expression interpreters.
It should be generalized, so that the interpreter metadata includes
a description of the memory chunks involved and the instruction stream
can handle any interpreter.</p>
<p>Once you’re done adding instructions, you call get_current() to retrieve
the information needed by the interpreter (as a Python dictionary).</p>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.current_op_list">
<span class="sig-name descname"><span class="pre">current_op_list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.current_op_list" title="Permalink to this definition">#</a></dt>
<dd><p>Return the list of instructions that have been added to this
InstructionStream so far.</p>
<p>It’s OK to call this, then add more instructions.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;load_arg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;py_call&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;py_call&#39;, &lt;built-in function sin&gt;, 1), &#39;abs&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.get_current">
<span class="sig-name descname"><span class="pre">get_current</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.get_current" title="Permalink to this definition">#</a></dt>
<dd><p>Return the current state of the InstructionStream, as a dictionary
suitable for passing to a wrapper class.</p>
<p>NOTE: The dictionary includes internal data structures of the
InstructionStream; you must not modify it.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
<span class="go">{&#39;args&#39;: 1,</span>
<span class="go"> &#39;code&#39;: [],</span>
<span class="go"> &#39;constants&#39;: [],</span>
<span class="go"> &#39;domain&#39;: None,</span>
<span class="go"> &#39;py_constants&#39;: [],</span>
<span class="go"> &#39;stack&#39;: 0}</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;load_arg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;py_call&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;py_call&#39;, &lt;built-in function sin&gt;, 1), &#39;abs&#39;, &#39;return&#39;]</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span>
<span class="go">{&#39;args&#39;: 1,</span>
<span class="go"> &#39;code&#39;: [0, 0, 3, 0, 1, 12, 2],</span>
<span class="go"> &#39;constants&#39;: [],</span>
<span class="go"> &#39;domain&#39;: None,</span>
<span class="go"> &#39;py_constants&#39;: [&lt;built-in function sin&gt;],</span>
<span class="go"> &#39;stack&#39;: 1}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.get_metadata">
<span class="sig-name descname"><span class="pre">get_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.get_metadata" title="Permalink to this definition">#</a></dt>
<dd><p>Return the interpreter metadata being used by the current
InstructionStream.</p>
<p>The code generator sometimes uses this to decide which code
to generate.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">md</span> <span class="o">=</span> <span class="n">instr_stream</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.ext.fast_callable.InterpreterMetadata&#39;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.has_instr">
<span class="sig-name descname"><span class="pre">has_instr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">opname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.has_instr" title="Permalink to this definition">#</a></dt>
<dd><p>Check whether this InstructionStream knows how to generate code
for a given instruction.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">has_instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">has_instr</span><span class="p">(</span><span class="s1">&#39;factorial&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">has_instr</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.instr">
<span class="sig-name descname"><span class="pre">instr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">opname</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.instr" title="Permalink to this definition">#</a></dt>
<dd><p>Generate code in this InstructionStream for the given instruction
and arguments.</p>
<p>The opname is used to look up a CompilerInstrSpec; the
CompilerInstrSpec describes how to interpret the arguments.
(This is documented in the class docstring for CompilerInstrSpec.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;load_arg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;sin&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;py_call&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;factorial&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">KeyError: &#39;factorial&#39;</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), &#39;sin&#39;, (&#39;py_call&#39;, &lt;built-in function sin&gt;, 1), &#39;abs&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.load_arg">
<span class="sig-name descname"><span class="pre">load_arg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.load_arg" title="Permalink to this definition">#</a></dt>
<dd><p>Add a ‘load_arg’ instruction to this InstructionStream.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">load_arg</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 5)]</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">load_arg</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 5), (&#39;load_arg&#39;, 3)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InstructionStream.load_const">
<span class="sig-name descname"><span class="pre">load_const</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">c</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.InstructionStream.load_const" title="Permalink to this definition">#</a></dt>
<dd><p>Add a ‘load_const’ instruction to this InstructionStream.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span><span class="p">,</span> <span class="n">op_list</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">load_const</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_const&#39;, 5)]</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">load_const</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">load_const</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_const&#39;, 5), (&#39;load_const&#39;, 7), (&#39;load_const&#39;, 5)]</span>
</pre></div>
</div>
<p>Note that constants are shared: even though we load 5 twice, it
only appears once in the constant table.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">get_current</span><span class="p">()[</span><span class="s1">&#39;constants&#39;</span><span class="p">]</span>
<span class="go">[5, 7]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.IntegerPowerFunction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">IntegerPowerFunction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.IntegerPowerFunction" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class represents the function x^n for an arbitrary integral
power n.  That is, IntegerPowerFunction(2) is the squaring function;
IntegerPowerFunction(-1) is the reciprocal function.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">IntegerPowerFunction</span>
<span class="gp">sage: </span><span class="n">square</span> <span class="o">=</span> <span class="n">IntegerPowerFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">square</span>
<span class="go">(^2)</span>
<span class="gp">sage: </span><span class="n">square</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
<span class="go">pi^2</span>
<span class="gp">sage: </span><span class="n">square</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="go">-1</span>
<span class="gp">sage: </span><span class="n">square</span><span class="p">(</span><span class="n">RIF</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;brackets&#39;</span><span class="p">)</span>
<span class="go">&#39;[0.0000000000000000 .. 1.0000000000000000]&#39;</span>
<span class="gp">sage: </span><span class="n">IntegerPowerFunction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="go">(^(-1))</span>
<span class="gp">sage: </span><span class="n">IntegerPowerFunction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)(</span><span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>
<span class="go">7/22</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">Integers</span><span class="p">(</span><span class="mi">123456789</span><span class="p">)(</span><span class="mi">54321</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">v</span><span class="o">^</span><span class="mi">9876543210</span>
<span class="go">79745229</span>
<span class="gp">sage: </span><span class="n">IntegerPowerFunction</span><span class="p">(</span><span class="mi">9876543210</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span>
<span class="go">79745229</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InterpreterMetadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">InterpreterMetadata</span></span><a class="headerlink" href="#sage.ext.fast_callable.InterpreterMetadata" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The interpreter metadata for a fast_callable interpreter.  Currently
consists of a dictionary mapping instruction names to
(CompilerInstrSpec, opcode) pairs, a list mapping opcodes to
(instruction name, CompilerInstrSpec) pairs, and a range of exponents
for which the ipow instruction can be used.  This range can be
False (if the ipow instruction should never be used), a pair of
two integers (a,b), if ipow should be used for a&lt;=n&lt;=b, or True,
if ipow should always be used.  When ipow cannot be used, then
we fall back on calling IntegerPowerFunction.</p>
<p>See the class docstring for CompilerInstrSpec for more information.</p>
<p>NOTE: You must not modify the metadata.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InterpreterMetadata.by_opcode">
<span class="sig-name descname"><span class="pre">by_opcode</span></span><a class="headerlink" href="#sage.ext.fast_callable.InterpreterMetadata.by_opcode" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InterpreterMetadata.by_opname">
<span class="sig-name descname"><span class="pre">by_opname</span></span><a class="headerlink" href="#sage.ext.fast_callable.InterpreterMetadata.by_opname" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sage.ext.fast_callable.InterpreterMetadata.ipow_range">
<span class="sig-name descname"><span class="pre">ipow_range</span></span><a class="headerlink" href="#sage.ext.fast_callable.InterpreterMetadata.ipow_range" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Wrapper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">Wrapper</span></span><a class="headerlink" href="#sage.ext.fast_callable.Wrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The parent class for all fast_callable wrappers.  Implements shared
behavior (currently only debugging).</p>
<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Wrapper.get_orig_args">
<span class="sig-name descname"><span class="pre">get_orig_args</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.Wrapper.get_orig_args" title="Permalink to this definition">#</a></dt>
<dd><p>Get the original arguments used when initializing this
wrapper.</p>
<p>(Probably only useful when writing doctests.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span><span class="o">.</span><span class="n">get_orig_args</span><span class="p">()</span>
<span class="go">{&#39;args&#39;: 1,</span>
<span class="go"> &#39;code&#39;: [0, 0, 16, 0, 0, 8, 2],</span>
<span class="go"> &#39;constants&#39;: [],</span>
<span class="go"> &#39;domain&#39;: Real Double Field,</span>
<span class="go"> &#39;py_constants&#39;: [],</span>
<span class="go"> &#39;stack&#39;: 2}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Wrapper.op_list">
<span class="sig-name descname"><span class="pre">op_list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.Wrapper.op_list" title="Permalink to this definition">#</a></dt>
<dd><p>Return the list of instructions in this wrapper.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span><span class="o">.</span><span class="n">op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;load_arg&#39;, 0), &#39;cos&#39;, &#39;mul&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.ext.fast_callable.Wrapper.python_calls">
<span class="sig-name descname"><span class="pre">python_calls</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.Wrapper.python_calls" title="Permalink to this definition">#</a></dt>
<dd><p>List the Python functions that are called in this wrapper.</p>
<p>(Python function calls are slow, so ideally this list would
be empty.  If it is not empty, then perhaps there is an
optimization opportunity where a Sage developer could speed
this up by adding a new instruction to the interpreter.)</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span><span class="o">.</span><span class="n">python_calls</span><span class="p">()</span>
<span class="go">[]</span>
<span class="gp">sage: </span><span class="n">fast_callable</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">python_calls</span><span class="p">()</span>
<span class="go">[factorial, sin]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.ext.fast_callable.fast_callable">
<span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">fast_callable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">domain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expect_one_var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.fast_callable" title="Permalink to this definition">#</a></dt>
<dd><p>Given an expression x, compile it into a form that can be quickly
evaluated, given values for the variables in x.</p>
<p>Currently, x can be an expression object, an element of SR, or a
(univariate or multivariate) polynomial; this list will probably
be extended soon.</p>
<p>By default, x is evaluated the same way that a Python function
would evaluate it – addition maps to PyNumber_Add, etc.  However,
you can specify domain=D where D is some Sage parent or Python
type; in this case, all arithmetic is done in that domain.  If we
have a special-purpose interpreter for that parent (like RDF or float),
domain=… will trigger the use of that interpreter.</p>
<p>If vars is None and x is a polynomial, then we will use the
generators of parent(x) as the variables; otherwise, vars must be
specified (unless x is a symbolic expression with only one variable,
and expect_one_var is True, in which case we will use that variable).</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="go">x</span>
<span class="gp">sage: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">sin(2) + 12</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="go">12.9092974268257</span>
</pre></div>
</div>
<p>We have special fast interpreters for domain=float and domain=RDF.
(Actually it’s the same interpreter; only the return type varies.)
Note that the float interpreter is not actually more accurate than
the RDF interpreter; elements of RDF just don’t display all
their digits. We have special fast interpreter for domain=CDF:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f_float</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f_float</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">12.909297426825681</span>
<span class="gp">sage: </span><span class="n">f_rdf</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f_rdf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">12.909297426825681</span>
<span class="gp">sage: </span><span class="n">f_cdf</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">CDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f_cdf</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">12.909297426825681</span>
<span class="gp">sage: </span><span class="n">f_cdf</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">I</span><span class="p">)</span>
<span class="go">10.40311925062204 + 11.510943740958707*I</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">sin(2) + 12</span>
<span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">5</span> <span class="o">-</span> <span class="n">x</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">12</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">95</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span>
<span class="gp">sage: </span><span class="n">fp</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fp</span><span class="o">.</span><span class="n">op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), (&#39;load_const&#39;, -0.25), &#39;mul&#39;, (&#39;load_const&#39;, 0.5), &#39;add&#39;, (&#39;load_arg&#39;, 0), &#39;mul&#39;, (&#39;load_const&#39;, -1.0), &#39;add&#39;, (&#39;load_arg&#39;, 0), &#39;mul&#39;, (&#39;load_const&#39;, -12.0), &#39;add&#39;, (&#39;load_arg&#39;, 0), &#39;mul&#39;, (&#39;load_const&#39;, 0.5), &#39;add&#39;, (&#39;load_arg&#39;, 0), &#39;mul&#39;, (&#39;load_const&#39;, -0.010526315789473684), &#39;add&#39;, (&#39;load_arg&#39;, 0), &#39;mul&#39;, (&#39;load_const&#39;, -0.5), &#39;add&#39;, &#39;return&#39;]</span>
<span class="gp">sage: </span><span class="n">fp</span><span class="p">(</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="go">-552.4182988917153</span>
<span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">z</span>
<span class="gp">sage: </span><span class="n">fp</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">RDF</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fp</span><span class="o">.</span><span class="n">op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_const&#39;, 0.0), (&#39;load_const&#39;, 1.0), (&#39;load_arg&#39;, 0), (&#39;ipow&#39;, 1), (&#39;load_arg&#39;, 1), (&#39;ipow&#39;, 2), &#39;mul&#39;, &#39;mul&#39;, &#39;add&#39;, (&#39;load_const&#39;, 0.3333333333333333), (&#39;load_arg&#39;, 1), (&#39;ipow&#39;, 2), &#39;mul&#39;, &#39;add&#39;, (&#39;load_const&#39;, -1.0), (&#39;load_arg&#39;, 0), (&#39;ipow&#39;, 1), (&#39;load_arg&#39;, 2), (&#39;ipow&#39;, 1), &#39;mul&#39;, &#39;mul&#39;, &#39;add&#39;, (&#39;load_const&#39;, -1.0), (&#39;load_arg&#39;, 1), (&#39;ipow&#39;, 1), (&#39;load_arg&#39;, 2), (&#39;ipow&#39;, 1), &#39;mul&#39;, &#39;mul&#39;, &#39;add&#39;, &#39;return&#39;]</span>
<span class="gp">sage: </span><span class="n">fp</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>   <span class="c1"># abs tol 3e-14</span>
<span class="go">21.831120464939584</span>
<span class="gp">sage: </span><span class="n">symbolic_result</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span> <span class="n">symbolic_result</span>
<span class="go">pi^2*e + 1/3*pi^2 - sqrt(2)*pi - sqrt(2)*e</span>
<span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">symbolic_result</span><span class="p">)</span>
<span class="go">21.8311204649396</span>
</pre></div>
</div>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">),</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">y</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span> <span class="n">expr</span>
<span class="go">sin(add(ipow(v_0, 2), v_1))</span>
<span class="gp">sage: </span><span class="n">fc</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="go">0.5514266812416906</span>
</pre></div>
</div>
<p>Check that fast_callable also works for symbolic functions with evaluation
functions:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">evalf_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span> <span class="k">return</span> <span class="n">parent</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
<span class="gp">sage: </span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="s1">&#39;x,y&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">evalf_func</span><span class="o">=</span><span class="n">evalf_func</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fc</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">fc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">f(3, 4)</span>
</pre></div>
</div>
<p>And also when there are complex values involved:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">evalf_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span> <span class="k">return</span> <span class="n">parent</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">I</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">evalf_func</span><span class="o">=</span><span class="n">evalf_func</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">fc</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">fc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">g(3, 4)</span>
<span class="gp">sage: </span><span class="n">fc2</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">domain</span><span class="o">=</span><span class="nb">complex</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">fc2</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">12j</span>
<span class="gp">sage: </span><span class="n">fc3</span> <span class="o">=</span> <span class="n">fast_callable</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">domain</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">fc3</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">    ...</span>
<span class="go">TypeError: unable to simplify to float approximation</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.ext.fast_callable.function_name">
<span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">function_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.function_name" title="Permalink to this definition">#</a></dt>
<dd><p>Given a function, return a string giving a name for the function.</p>
<p>For functions we recognize, we use our standard opcode name for the
function (so operator.add becomes ‘add’, and sage.all.sin becomes ‘sin’).</p>
<p>For functions we don’t recognize, we try to come up with a name,
but the name will be wrapped in braces; this is a signal that
we’ll definitely use a slow Python call to call this function.
(We may use a slow Python call even for functions we do recognize,
if we’re targeting an interpreter without an opcode for the function.)</p>
<p>Only used when printing Expressions.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">function_name</span>
<span class="gp">sage: </span><span class="n">function_name</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
<span class="go">&#39;pow&#39;</span>
<span class="gp">sage: </span><span class="n">function_name</span><span class="p">(</span><span class="n">cos</span><span class="p">)</span>
<span class="go">&#39;cos&#39;</span>
<span class="gp">sage: </span><span class="n">function_name</span><span class="p">(</span><span class="n">factorial</span><span class="p">)</span>
<span class="go">&#39;{factorial}&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.ext.fast_callable.generate_code">
<span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">generate_code</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stream</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.generate_code" title="Permalink to this definition">#</a></dt>
<dd><p>Generate code from an Expression tree; write the result into an
InstructionStream.</p>
<p>In fast_callable, first we create an Expression, either directly
with an ExpressionTreeBuilder or with _fast_callable_ methods.
Then we optimize the Expression in tree form.  (Unfortunately,
this step is currently missing – we do no optimizations.)</p>
<p>Then we linearize the Expression into a sequence of instructions,
by walking the Expression and sending the corresponding stack
instructions to an InstructionStream.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">ExpressionTreeBuilder</span><span class="p">,</span> <span class="n">generate_code</span><span class="p">,</span> <span class="n">InstructionStream</span>
<span class="gp">sage: </span><span class="n">etb</span> <span class="o">=</span> <span class="n">ExpressionTreeBuilder</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">etb</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">expr</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_py</span> <span class="kn">import</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Wrapper_py</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">generate_code</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">instr_stream</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">Wrapper_py</span><span class="p">(</span><span class="n">instr_stream</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.ext.interpreters.wrapper_py.Wrapper_py&#39;&gt;</span>
<span class="gp">sage: </span><span class="n">v</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">8*pi + 56</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.ext.fast_callable.get_builtin_functions">
<span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">get_builtin_functions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.get_builtin_functions" title="Permalink to this definition">#</a></dt>
<dd><p>To handle ExpressionCall, we need to map from Sage and
Python functions to opcode names.</p>
<p>This returns a dictionary which is that map.</p>
<p>We delay building builtin_functions to break a circular import
between sage.calculus and this file.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">get_builtin_functions</span>
<span class="gp">sage: </span><span class="n">builtins</span> <span class="o">=</span> <span class="n">get_builtin_functions</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="go">[&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;add&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;cot&#39;, &#39;csc&#39;, &#39;div&#39;, &#39;exp&#39;, &#39;floor&#39;, &#39;floordiv&#39;, &#39;inv&#39;, &#39;log&#39;, &#39;mul&#39;, &#39;neg&#39;, &#39;pow&#39;, &#39;sec&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;sub&#39;, &#39;tan&#39;, &#39;tanh&#39;]</span>
<span class="gp">sage: </span><span class="n">builtins</span><span class="p">[</span><span class="n">sin</span><span class="p">]</span>
<span class="go">&#39;sin&#39;</span>
<span class="gp">sage: </span><span class="n">builtins</span><span class="p">[</span><span class="n">ln</span><span class="p">]</span>
<span class="go">&#39;log&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.ext.fast_callable.op_list">
<span class="sig-prename descclassname"><span class="pre">sage.ext.fast_callable.</span></span><span class="sig-name descname"><span class="pre">op_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.ext.fast_callable.op_list" title="Permalink to this definition">#</a></dt>
<dd><p>Given a dictionary with the result of calling get_current on an
InstructionStream, and the corresponding interpreter metadata,
return a list of the instructions, in a simple somewhat
human-readable format.</p>
<p>For debugging only.  (That is, it’s probably not a good idea to
try to programmatically manipulate the result of this function;
the expected use is just to print the returned list to the
screen.)</p>
<p>There’s probably no reason to call this directly; if you
have a wrapper object, call op_list on it; if you have an
InstructionStream object, call current_op_list on it.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.interpreters.wrapper_rdf</span> <span class="kn">import</span> <span class="n">metadata</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.ext.fast_callable</span> <span class="kn">import</span> <span class="n">InstructionStream</span><span class="p">,</span> <span class="n">op_list</span>
<span class="gp">sage: </span><span class="n">instr_stream</span> <span class="o">=</span> <span class="n">InstructionStream</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;load_arg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">instr</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">instr_stream</span><span class="o">.</span><span class="n">current_op_list</span><span class="p">()</span>
<span class="go">[(&#39;load_arg&#39;, 0), &#39;abs&#39;, &#39;return&#39;]</span>
<span class="gp">sage: </span><span class="n">op_list</span><span class="p">(</span><span class="n">instr_stream</span><span class="o">.</span><span class="n">get_current</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">)</span>
<span class="go">[(&#39;load_arg&#39;, 0), &#39;abs&#39;, &#39;return&#39;]</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="fast_eval.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Fast Numerical Evaluation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../misc/weak_dict.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Fast and safe weak value dictionary</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Fast Expression Evaluation</a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.CompilerInstrSpec"><code class="docutils literal notranslate"><span class="pre">CompilerInstrSpec</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.Expression"><code class="docutils literal notranslate"><span class="pre">Expression</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.Expression.abs"><code class="docutils literal notranslate"><span class="pre">abs()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionCall"><code class="docutils literal notranslate"><span class="pre">ExpressionCall</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionCall.arguments"><code class="docutils literal notranslate"><span class="pre">arguments()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionCall.function"><code class="docutils literal notranslate"><span class="pre">function()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionChoice"><code class="docutils literal notranslate"><span class="pre">ExpressionChoice</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionChoice.condition"><code class="docutils literal notranslate"><span class="pre">condition()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionChoice.if_false"><code class="docutils literal notranslate"><span class="pre">if_false()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionChoice.if_true"><code class="docutils literal notranslate"><span class="pre">if_true()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionConstant"><code class="docutils literal notranslate"><span class="pre">ExpressionConstant</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionConstant.value"><code class="docutils literal notranslate"><span class="pre">value()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionIPow"><code class="docutils literal notranslate"><span class="pre">ExpressionIPow</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionIPow.base"><code class="docutils literal notranslate"><span class="pre">base()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionIPow.exponent"><code class="docutils literal notranslate"><span class="pre">exponent()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder"><code class="docutils literal notranslate"><span class="pre">ExpressionTreeBuilder</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder.call"><code class="docutils literal notranslate"><span class="pre">call()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder.choice"><code class="docutils literal notranslate"><span class="pre">choice()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder.constant"><code class="docutils literal notranslate"><span class="pre">constant()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionTreeBuilder.var"><code class="docutils literal notranslate"><span class="pre">var()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionVariable"><code class="docutils literal notranslate"><span class="pre">ExpressionVariable</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.ExpressionVariable.variable_index"><code class="docutils literal notranslate"><span class="pre">variable_index()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.FastCallableFloatWrapper"><code class="docutils literal notranslate"><span class="pre">FastCallableFloatWrapper</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream"><code class="docutils literal notranslate"><span class="pre">InstructionStream</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.current_op_list"><code class="docutils literal notranslate"><span class="pre">current_op_list()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.get_current"><code class="docutils literal notranslate"><span class="pre">get_current()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.get_metadata"><code class="docutils literal notranslate"><span class="pre">get_metadata()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.has_instr"><code class="docutils literal notranslate"><span class="pre">has_instr()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.instr"><code class="docutils literal notranslate"><span class="pre">instr()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.load_arg"><code class="docutils literal notranslate"><span class="pre">load_arg()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InstructionStream.load_const"><code class="docutils literal notranslate"><span class="pre">load_const()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.IntegerPowerFunction"><code class="docutils literal notranslate"><span class="pre">IntegerPowerFunction</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InterpreterMetadata"><code class="docutils literal notranslate"><span class="pre">InterpreterMetadata</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.InterpreterMetadata.by_opcode"><code class="docutils literal notranslate"><span class="pre">by_opcode</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InterpreterMetadata.by_opname"><code class="docutils literal notranslate"><span class="pre">by_opname</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.InterpreterMetadata.ipow_range"><code class="docutils literal notranslate"><span class="pre">ipow_range</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.Wrapper"><code class="docutils literal notranslate"><span class="pre">Wrapper</span></code></a><ul>
<li><a class="reference internal" href="#sage.ext.fast_callable.Wrapper.get_orig_args"><code class="docutils literal notranslate"><span class="pre">get_orig_args()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.Wrapper.op_list"><code class="docutils literal notranslate"><span class="pre">op_list()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.Wrapper.python_calls"><code class="docutils literal notranslate"><span class="pre">python_calls()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.ext.fast_callable.fast_callable"><code class="docutils literal notranslate"><span class="pre">fast_callable()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.function_name"><code class="docutils literal notranslate"><span class="pre">function_name()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.generate_code"><code class="docutils literal notranslate"><span class="pre">generate_code()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.get_builtin_functions"><code class="docutils literal notranslate"><span class="pre">get_builtin_functions()</span></code></a></li>
<li><a class="reference internal" href="#sage.ext.fast_callable.op_list"><code class="docutils literal notranslate"><span class="pre">op_list()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    </body>
</html>