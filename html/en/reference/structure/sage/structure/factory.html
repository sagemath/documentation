<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Dynamic classes" href="dynamic_class.html" /><link rel="prev" title="Unique Representation" href="unique_representation.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Factory for cached representations - Parents and Elements</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZGD13B5572"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ZGD13B5572');
</script></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Parents and Elements</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 9.8 Reference Manual</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="../../index.html">Home - Parents and Elements</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="sage_object.html">Abstract base class for Sage objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="category_object.html">Base class for objects of a category</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parent.html">Base class for parent objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexed_generators.html">Indexed Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonexact.html">Precision management for non-exact objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="global_options.html">Global options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parent_old.html">Base class for old-style parent objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="parent_base.html">Base class for old-style parent objects with a base ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="parent_gens.html">Base class for old-style parent objects with generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="gens_py.html">Pure python code for abstract base class for objects with generators</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="element.html">Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="element_wrapper.html">Element Wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_clone.html">Elements, Array and Lists With Clone Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_clone_demo.html">Elements, Array and Lists With Clone Protocol, demonstration classes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="formal_sum.html">Formal sums</a></li>
<li class="toctree-l1"><a class="reference internal" href="factorization.html">Factorizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="factorization_integer.html">IntegerFactorization objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="sequence.html">Finite Homogeneous Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="set_factories.html">Set factories</a></li>
<li class="toctree-l1"><a class="reference internal" href="set_factories_example.html">An example of set factory</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proof/proof.html">Global proof preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/proof.html">Whether or not computations are provably correct by default</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="richcmp.html">Cython-like rich comparisons in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="unique_representation.html">Unique Representation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Factory for cached representations</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_class.html">Dynamic classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutability.html">Mutability Cython Implementation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_options.html">Debug options for the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.structure</span></code> modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_clone_timings.html">Performance Test for Clone Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="list_clone_timings_cy.html">Cython Functions for Timing Clone Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_factory.html">Test of the <code class="xref py py-mod docutils literal notranslate"><span class="pre">factory</span></code> module</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="factory-for-cached-representations">
<span id="sage-structure-factory"></span><h1>Factory for cached representations<a class="headerlink" href="#factory-for-cached-representations" title="Permalink to this heading">#</a></h1>
<span class="target" id="module-sage.structure.factory"></span><div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="unique_representation.html#module-sage.structure.unique_representation" title="sage.structure.unique_representation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.structure.unique_representation</span></code></a></p>
</div>
<p>Using a <a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a> is one way of implementing a <em>cached
representation behaviour</em>. In spite of its name, using a
<a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a> is not enough to ensure the <em>unique representation
behaviour</em>. See <a class="reference internal" href="unique_representation.html#module-sage.structure.unique_representation" title="sage.structure.unique_representation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unique_representation</span></code></a> for a
detailed explanation.</p>
<p>With a <a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a>, one can preprocess the given arguments. There
is special support for specifying a subset of the arguments that serve as the
unique key, so that still <em>all</em> given arguments are used to create a new
instance, but only the specified subset is used to look up in the
cache. Typically, this is used to construct objects that accept an optional
<code class="docutils literal notranslate"><span class="pre">check=[True|False]</span></code> argument, but whose result should be unique
regardless of said optional argument. (This use case should be handled with
care, though: Any checking which isn’t done in the <code class="docutils literal notranslate"><span class="pre">create_key</span></code> or
<code class="docutils literal notranslate"><span class="pre">create_key_and_extra_args</span></code> method will be done only when a new object is
generated, but not when a cached object is retrieved from cache.
Consequently, if the factory is once called with <code class="docutils literal notranslate"><span class="pre">check=False</span></code>, a
subsequent call with <code class="docutils literal notranslate"><span class="pre">check=True</span></code> cannot be expected to perform all checks
unless these checks are all in the <code class="docutils literal notranslate"><span class="pre">create_key</span></code> or
<code class="docutils literal notranslate"><span class="pre">create_key_and_extra_args</span></code> method.)</p>
<p>For a class derived from
<a class="reference internal" href="unique_representation.html#sage.structure.unique_representation.CachedRepresentation" title="sage.structure.unique_representation.CachedRepresentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">CachedRepresentation</span></code></a>, argument
preprocessing can be obtained by providing a custom static <code class="docutils literal notranslate"><span class="pre">__classcall__</span></code>
or <code class="docutils literal notranslate"><span class="pre">__classcall_private__</span></code> method, but this seems less transparent. When
argument preprocessing is not needed or the preprocess is not very
sophisticated, then generally
<a class="reference internal" href="unique_representation.html#sage.structure.unique_representation.CachedRepresentation" title="sage.structure.unique_representation.CachedRepresentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">CachedRepresentation</span></code></a> is much
easier to use than a factory.</p>
<p>AUTHORS:</p>
<ul class="simple">
<li><p>Robert Bradshaw (2008): initial version.</p></li>
<li><p>Simon King (2013): extended documentation.</p></li>
<li><p>Julian Rueth (2014-05-09): use <code class="docutils literal notranslate"><span class="pre">_cache_key</span></code> if parameters are unhashable</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sage.structure.factory.</span></span><span class="sig-name descname"><span class="pre">UniqueFactory</span></span><a class="headerlink" href="#sage.structure.factory.UniqueFactory" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="sage_object.html#sage.structure.sage_object.SageObject" title="sage.structure.sage_object.SageObject"><code class="xref py py-class docutils literal notranslate"><span class="pre">SageObject</span></code></a></p>
<p>This class is intended to make it easy to cache objects.</p>
<p>It is based on the idea that the object is uniquely defined by a set of
defining data (the key). There is also the possibility of some
non-defining data (extra args) which will be used in initial creation,
but not affect the caching.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This class only provides <em>cached representation behaviour</em>. Hence,
using <a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a>, it is still possible to create distinct
objects that evaluate equal. Unique representation behaviour can be
added, for example, by additionally inheriting from
<a class="reference external" href="../../../misc/sage/misc/fast_methods.html#sage.misc.fast_methods.WithEqualityById" title="(in Utilities v9.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sage.misc.fast_methods.WithEqualityById</span></code></a>.</p>
</div>
<p>The objects created are cached (using weakrefs) based on their key and
returned directly rather than re-created if requested again. Pickling is
taken care of by the factory, and will return the same object for the same
version of Sage, and distinct (but hopefully equal) objects for different
versions of Sage.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The objects returned by a <a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a> must be instances of
new style classes (hence, they must be instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code>)
that must not only allow a weak reference, but must accept general
attribute assignment. Otherwise, pickling won’t work.</p>
</div>
<p>USAGE:</p>
<p>A <em>unique factory</em> provides a way to create objects from parameters
(the type of these objects can depend on the parameters, and is often
determined only at runtime) and to cache them by a certain key
derived from these parameters, so that when the factory is being
called again with the same parameters (or just with parameters which
yield the same key), the object is being returned from cache rather
than constructed anew.</p>
<p>An implementation of a unique factory consists of a factory class and
an instance of this factory class.</p>
<p>The factory class has to be a class inheriting from <code class="docutils literal notranslate"><span class="pre">UniqueFactory</span></code>.
Typically it only needs to implement <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a> (a method that
creates a key from the given parameters, under which key the object
will be stored in the cache) and <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_object" title="sage.structure.factory.UniqueFactory.create_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_object()</span></code></a> (a method that
returns the actual object from the key). Sometimes, one would also
implement <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key_and_extra_args" title="sage.structure.factory.UniqueFactory.create_key_and_extra_args"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key_and_extra_args()</span></code></a> (this differs from
<a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a> in allowing to also create some additional
arguments from the given parameters, which arguments then get passed
to <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_object" title="sage.structure.factory.UniqueFactory.create_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_object()</span></code></a> and thus can have an effect on the initial
creation of the object, but do <em>not</em> affect the key) or
<a class="reference internal" href="#sage.structure.factory.UniqueFactory.other_keys" title="sage.structure.factory.UniqueFactory.other_keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">other_keys()</span></code></a>. Other methods are not supposed to be overloaded.</p>
<p>The factory class itself cannot be called to create objects. Instead,
an instance of the factory class has to be created first. For
technical reasons, this instance has to be provided with a name that
allows Sage to find its definition. Specifically, the name of the
factory instance (or the full path to it, if it is not in the global
namespace) has to be passed to the factory class as a string variable.
So, if our factory class has been called <code class="docutils literal notranslate"><span class="pre">A</span></code> and is located in
<code class="docutils literal notranslate"><span class="pre">sage/spam/battletoads.py</span></code>, then we need to define an instance (say,
<code class="docutils literal notranslate"><span class="pre">B</span></code>) of <code class="docutils literal notranslate"><span class="pre">A</span></code> by writing <code class="docutils literal notranslate"><span class="pre">B</span> <span class="pre">=</span> <span class="pre">A(&quot;sage.spam.battletoads.B&quot;)</span></code>
(or <code class="docutils literal notranslate"><span class="pre">B</span> <span class="pre">=</span> <span class="pre">A(&quot;B&quot;)</span></code> if this <code class="docutils literal notranslate"><span class="pre">B</span></code> will be imported into global
namespace). This instance can then be used to create objects (by
calling <code class="docutils literal notranslate"><span class="pre">B(*parameters)</span></code>).</p>
<p>Notice that the objects created by the factory don’t inherit from the
factory class. They <em>do</em> know about the factory that created them (this
information, along with the keys under which this factory caches them,
is stored in the <code class="docutils literal notranslate"><span class="pre">_factory_data</span></code> attributes of the objects), but not
via inheritance.</p>
<p>EXAMPLES:</p>
<p>The below examples are rather artificial and illustrate particular
aspects. For a “real-life” usage case of <code class="docutils literal notranslate"><span class="pre">UniqueFactory</span></code>, see
the finite field factory in <a class="reference external" href="../../../finite_rings/sage/rings/finite_rings/finite_field_constructor.html#module-sage.rings.finite_rings.finite_field_constructor" title="(in Finite Rings v9.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.rings.finite_rings.finite_field_constructor</span></code></a>.</p>
<p>In many cases, a factory class is implemented by providing the two
methods <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a> and <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_object" title="sage.structure.factory.UniqueFactory.create_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_object()</span></code></a>. In our example,
we want to demonstrate how to use “extra arguments” to choose a specific
implementation, with preference given to an instance found in the cache,
even if its implementation is different. Hence, we implement
<a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key_and_extra_args" title="sage.structure.factory.UniqueFactory.create_key_and_extra_args"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key_and_extra_args()</span></code></a> rather than <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a>, putting
the chosen implementation into the extra arguments. Then, in the
<a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_object" title="sage.structure.factory.UniqueFactory.create_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_object()</span></code></a> method, we create and return instances of the
specified implementation.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.factory</span> <span class="kn">import</span> <span class="n">UniqueFactory</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">MyFactory</span><span class="p">(</span><span class="n">UniqueFactory</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">create_key_and_extra_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;impl&#39;</span><span class="p">:</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)}</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="nf">create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_args</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="n">impl</span> <span class="o">=</span> <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;impl&#39;</span><span class="p">]</span>
<span class="gp">....: </span>        <span class="k">if</span> <span class="n">impl</span><span class="o">==</span><span class="s1">&#39;C&#39;</span><span class="p">:</span>
<span class="gp">....: </span>            <span class="k">return</span> <span class="n">C</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="k">if</span> <span class="n">impl</span><span class="o">==</span><span class="s1">&#39;D&#39;</span><span class="p">:</span>
<span class="gp">....: </span>            <span class="k">return</span> <span class="n">D</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="n">E</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="gp">....:</span>
</pre></div>
</div>
<p>Now we can create a factory instance. It is supposed to be found under the
name <code class="docutils literal notranslate"><span class="pre">&quot;F&quot;</span></code> in the <code class="docutils literal notranslate"><span class="pre">&quot;__main__&quot;</span></code> module. Note that in an interactive
session, <code class="docutils literal notranslate"><span class="pre">F</span></code> would automatically be in the <code class="docutils literal notranslate"><span class="pre">__main__</span></code> module. Hence,
the second and third of the following four lines are only needed in
doctests.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">F</span> <span class="o">=</span> <span class="n">MyFactory</span><span class="p">(</span><span class="s2">&quot;__main__.F&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">F</span><span class="p">))</span> <span class="ow">is</span> <span class="n">F</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Now we create three classes <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">D</span></code> and <code class="docutils literal notranslate"><span class="pre">E</span></code>. The first is a Cython
extension-type class that does not allow weak references nor attribute
assignment. The second is a Python class that is not derived from
<code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code>. The third allows attribute assignment and is derived
from <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code>.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">cython</span><span class="p">(</span><span class="s2">&quot;cdef class C: pass&quot;</span><span class="p">)</span>                                      <span class="c1"># optional - sage.misc.cython</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">D</span><span class="p">:</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">args</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="k">return</span> <span class="s2">&quot;D</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">repr</span>(self.t)
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
</div>
<p>Again, being in a doctest, we need to put the class <code class="docutils literal notranslate"><span class="pre">D</span></code> into the
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> module, so that Python can find it:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
</pre></div>
</div>
<p>It is impossible to create an instance of <code class="docutils literal notranslate"><span class="pre">C</span></code> with our factory, since it
does not allow weak references:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>                                                    <span class="c1"># optional - sage.misc.cython</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">TypeError: cannot create weak reference to &#39;....C&#39; object</span>
</pre></div>
</div>
<p>Let us try again, with a Cython class that does allow weak
references. Now, creation of an instance using the factory works:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">cython</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;cdef class C:                                           # optional - sage.misc.cython</span>
<span class="gp">....: </span><span class="s1">    cdef __weakref__</span>
<span class="gp">....: </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">....:</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>                                                <span class="c1"># optional - sage.misc.cython</span>
<span class="gp">sage: </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>                                                  <span class="c1"># optional - sage.misc.cython</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The cache is used when calling the factory again—even if it is suggested
to use a different implementation. This is because the implementation is
only considered an “extra argument” that does not count for the key.</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">c</span> <span class="ow">is</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                     <span class="c1"># optional - sage.misc.cython</span>
<span class="go">True</span>
</pre></div>
</div>
<p>However, pickling and unpickling does not use the cache. This is because
the factory has tried to assign an attribute to the instance that provides
information on the key used to create the instance, but failed:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="ow">is</span> <span class="n">c</span>                                              <span class="c1"># optional - sage.misc.cython</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;_factory_data&#39;</span><span class="p">)</span>                                       <span class="c1"># optional - sage.misc.cython</span>
<span class="go">False</span>
</pre></div>
</div>
<p>We have already seen that our factory will only take the requested
implementation into account if the arguments used as key have not been
used yet. So, we use other arguments to create an instance of class
<code class="docutils literal notranslate"><span class="pre">D</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">d</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The factory only knows about the pickling protocol used by new style
classes. Hence, again, pickling and unpickling fails to use the cache,
even though the “factory data” are now available (this is not the case
on Python 3 which <em>only</em> has new style classes):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="ow">is</span> <span class="n">d</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">d</span><span class="o">.</span><span class="n">_factory_data</span>
<span class="go">(&lt;__main__.MyFactory object at ...&gt;,</span>
<span class="go"> (...),</span>
<span class="go"> (2,),</span>
<span class="go"> {&#39;impl&#39;: &#39;D&#39;})</span>
</pre></div>
</div>
<p>Only when we have a new style class that can be weak referenced and allows
for attribute assignment, everything works:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">e</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="ow">is</span> <span class="n">e</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">e</span><span class="o">.</span><span class="n">_factory_data</span>
<span class="go">(&lt;__main__.MyFactory object at ...&gt;,</span>
<span class="go"> (...),</span>
<span class="go"> (3,),</span>
<span class="go"> {&#39;impl&#39;: None})</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.create_key">
<span class="sig-name descname"><span class="pre">create_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.create_key" title="Permalink to this definition">#</a></dt>
<dd><p>Given the parameters (arguments and keywords), create a key
that uniquely determines this object.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">create_key</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">(1, 2)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.create_key_and_extra_args">
<span class="sig-name descname"><span class="pre">create_key_and_extra_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.create_key_and_extra_args" title="Permalink to this definition">#</a></dt>
<dd><p>Return a tuple containing the key (uniquely defining data)
and any extra arguments (empty by default).</p>
<p>Defaults to <a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a>.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">create_key_and_extra_args</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">((1, 2), {})</span>
<span class="gp">sage: </span><span class="n">GF</span><span class="o">.</span><span class="n">create_key_and_extra_args</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">((3, (&#39;x&#39;,), None, &#39;modn&#39;, 3, 1, True, None, None, None, True, False), {})</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.create_object">
<span class="sig-name descname"><span class="pre">create_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">version</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">extra_args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.create_object" title="Permalink to this definition">#</a></dt>
<dd><p>Create the object from the key and extra arguments. This is only
called if the object was not found in the cache.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">create_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="go">Making object (1, 2, 3)</span>
<span class="go">&lt;sage.structure.test_factory.A object at ...&gt;</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">Making object (&#39;a&#39;,)</span>
<span class="go">&lt;sage.structure.test_factory.A object at ...&gt;</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="c1"># NOT called again</span>
<span class="go">&lt;sage.structure.test_factory.A object at ...&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.get_object">
<span class="sig-name descname"><span class="pre">get_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">version</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.get_object" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the object corresponding to <code class="docutils literal notranslate"><span class="pre">key</span></code>, creating it with
<code class="docutils literal notranslate"><span class="pre">extra_args</span></code> if necessary (for example, it isn’t in the cache
or it is unpickling from an older version of Sage).</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{});</span> <span class="n">a</span>
<span class="go">Making object a</span>
<span class="go">&lt;sage.structure.test_factory.A object at ...&gt;</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">is</span> <span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">is</span> <span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="go">Making object a</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">is</span> <span class="n">test_factory</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="go">Making object b</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.get_version">
<span class="sig-name descname"><span class="pre">get_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sage_version</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.get_version" title="Permalink to this definition">#</a></dt>
<dd><p>This is provided to allow more or less granular control over
pickle versioning. Objects pickled in the same version of Sage
will unpickle to the same rather than simply equal objects. This
can provide significant gains as arithmetic must be performed on
objects with identical parents. However, if there has been an
incompatible change (e.g. in element representation) we want the
version number to change so coercion is forced between the two
parents.</p>
<p>Defaults to the Sage version that is passed in, but coarser
granularity can be provided.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">get_version</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="go">(3, 1, 0)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.other_keys">
<span class="sig-name descname"><span class="pre">other_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.other_keys" title="Permalink to this definition">#</a></dt>
<dd><p>Sometimes during object creation, certain defaults are chosen which
may result in a new (more specific) key. This allows the more specific
key to be regarded as equivalent to the original key returned by
<a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key" title="sage.structure.factory.UniqueFactory.create_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_key()</span></code></a> for the purpose of lookup in the cache, and is used
for pickling.</p>
<p>EXAMPLES:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">GF</span></code> factory used to have a custom <a class="reference internal" href="#sage.structure.factory.UniqueFactory.other_keys" title="sage.structure.factory.UniqueFactory.other_keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">other_keys()</span></code></a>
method, but this was removed in <a class="reference external" href="https://trac.sagemath.org/16934">trac ticket #16934</a>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">GF</span><span class="o">.</span><span class="n">create_key_and_extra_args</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">);</span> <span class="n">key</span>
<span class="go">(27, (&#39;k&#39;,), x^3 + 2*x + 1, &#39;givaro&#39;, 3, 3, True, None, &#39;poly&#39;, True, True, True)</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="o">.</span><span class="n">create_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="n">K</span>
<span class="go">Finite Field in k of size 3^3</span>
<span class="gp">sage: </span><span class="n">GF</span><span class="o">.</span><span class="n">other_keys</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="go">[]</span>

<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="mi">7</span><span class="o">^</span><span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">K</span><span class="p">))</span> <span class="ow">is</span> <span class="n">K</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sage.structure.factory.UniqueFactory.reduce_data">
<span class="sig-name descname"><span class="pre">reduce_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.UniqueFactory.reduce_data" title="Permalink to this definition">#</a></dt>
<dd><p>The results of this function can be returned from
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code>. This is here so the factory internals can
change without having to re-write <code class="xref py py-meth docutils literal notranslate"><span class="pre">__reduce__()</span></code> methods
that use it.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.modules.free_module</span> <span class="kn">import</span> <span class="n">FreeModuleFactory_with_standard_basis</span> <span class="k">as</span> <span class="n">F</span>
<span class="gp">sage: </span><span class="n">V</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">factory</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">reduce_data</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="go">Ambient free module of rank 5 over the principal ideal domain Integer Ring</span>
<span class="gp">sage: </span><span class="n">factory</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">V</span>
<span class="go">True</span>

<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.test_factory</span> <span class="kn">import</span> <span class="n">test_factory</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">test_factory</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">Making object (1, 2)</span>
<span class="gp">sage: </span><span class="n">test_factory</span><span class="o">.</span><span class="n">reduce_data</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">(&lt;built-in function generic_factory_unpickle&gt;,</span>
<span class="go"> (&lt;sage.structure.test_factory.UniqueFactoryTester object at ...&gt;,</span>
<span class="go">  (...),</span>
<span class="go">  (1, 2),</span>
<span class="go">  {}))</span>
</pre></div>
</div>
<p>Note that the ellipsis <code class="docutils literal notranslate"><span class="pre">(...)</span></code> here stands for the Sage
version.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.structure.factory.generic_factory_reduce">
<span class="sig-prename descclassname"><span class="pre">sage.structure.factory.</span></span><span class="sig-name descname"><span class="pre">generic_factory_reduce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proto</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.generic_factory_reduce" title="Permalink to this definition">#</a></dt>
<dd><p>Used to provide a <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> method if one does not already exist.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">V</span> <span class="o">=</span> <span class="n">QQ</span><span class="o">^</span><span class="mi">6</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">generic_factory_reduce</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">V</span><span class="o">.</span><span class="n">__reduce_ex__</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.structure.factory.generic_factory_unpickle">
<span class="sig-prename descclassname"><span class="pre">sage.structure.factory.</span></span><span class="sig-name descname"><span class="pre">generic_factory_unpickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">factory</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.generic_factory_unpickle" title="Permalink to this definition">#</a></dt>
<dd><p>Method used for unpickling the object.</p>
<p>The unpickling mechanism needs a plain Python function to call.
It takes a factory as the first argument, passes the rest of the
arguments onto the factory’s <a class="reference internal" href="#sage.structure.factory.UniqueFactory.get_object" title="sage.structure.factory.UniqueFactory.get_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UniqueFactory.get_object()</span></code></a> method.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.modules.free_module</span> <span class="kn">import</span> <span class="n">FreeModuleFactory_with_standard_basis</span> <span class="k">as</span> <span class="n">F</span>
<span class="gp">sage: </span><span class="n">V</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">func</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">reduce_data</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">func</span> <span class="ow">is</span> <span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">generic_factory_unpickle</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">generic_factory_unpickle</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">V</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.structure.factory.lookup_global">
<span class="sig-prename descclassname"><span class="pre">sage.structure.factory.</span></span><span class="sig-name descname"><span class="pre">lookup_global</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.lookup_global" title="Permalink to this definition">#</a></dt>
<dd><p>Used in unpickling the factory itself.</p>
<p>EXAMPLES:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.factory</span> <span class="kn">import</span> <span class="n">lookup_global</span>
<span class="gp">sage: </span><span class="n">lookup_global</span><span class="p">(</span><span class="s1">&#39;ZZ&#39;</span><span class="p">)</span>
<span class="go">Integer Ring</span>
<span class="gp">sage: </span><span class="n">lookup_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.all.ZZ&#39;</span><span class="p">)</span>
<span class="go">Integer Ring</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sage.structure.factory.register_factory_unpickle">
<span class="sig-prename descclassname"><span class="pre">sage.structure.factory.</span></span><span class="sig-name descname"><span class="pre">register_factory_unpickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callable</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.factory.register_factory_unpickle" title="Permalink to this definition">#</a></dt>
<dd><p>Register a callable to handle the unpickling from an old
<a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a> object.</p>
<p><a class="reference internal" href="#sage.structure.factory.UniqueFactory" title="sage.structure.factory.UniqueFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a> pickles use a global name through
<a class="reference internal" href="#sage.structure.factory.generic_factory_unpickle" title="sage.structure.factory.generic_factory_unpickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">generic_factory_unpickle()</span></code></a>, so the usual
<a class="reference external" href="../../../misc/sage/misc/persist.html#sage.misc.persist.register_unpickle_override" title="(in Utilities v9.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_unpickle_override()</span></code></a>
cannot be used here.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sage.structure.factory.generic_factory_unpickle" title="sage.structure.factory.generic_factory_unpickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">generic_factory_unpickle()</span></code></a></p>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="dynamic_class.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Dynamic classes</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="unique_representation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Unique Representation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Factory for cached representations</a><ul>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory"><code class="docutils literal notranslate"><span class="pre">UniqueFactory</span></code></a><ul>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key"><code class="docutils literal notranslate"><span class="pre">create_key()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_key_and_extra_args"><code class="docutils literal notranslate"><span class="pre">create_key_and_extra_args()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.create_object"><code class="docutils literal notranslate"><span class="pre">create_object()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.get_object"><code class="docutils literal notranslate"><span class="pre">get_object()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.get_version"><code class="docutils literal notranslate"><span class="pre">get_version()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.other_keys"><code class="docutils literal notranslate"><span class="pre">other_keys()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.UniqueFactory.reduce_data"><code class="docutils literal notranslate"><span class="pre">reduce_data()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sage.structure.factory.generic_factory_reduce"><code class="docutils literal notranslate"><span class="pre">generic_factory_reduce()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.generic_factory_unpickle"><code class="docutils literal notranslate"><span class="pre">generic_factory_unpickle()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.lookup_global"><code class="docutils literal notranslate"><span class="pre">lookup_global()</span></code></a></li>
<li><a class="reference internal" href="#sage.structure.factory.register_factory_unpickle"><code class="docutils literal notranslate"><span class="pre">register_factory_unpickle()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    </body>
</html>