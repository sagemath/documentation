<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=600, initial-scale=1">
    <title>Abstract base class for Sage objects &mdash; Sage Reference Manual v7.3: Basic Structures</title>
    
    <link rel="stylesheet" href="../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Sage Reference Manual v7.3: Basic Structures" href="../../index.html" />
    <link rel="next" title="Base class for objects of a category" href="category_object.html" />
    <link rel="prev" title="Basic Structures" href="../../index.html" />
    <link rel="icon" href="../../../_static/sageicon.png" type="image/x-icon" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="category_object.html" title="Base class for objects of a category"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../index.html" title="Basic Structures"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Basic Structures</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="abstract-base-class-for-sage-objects">
<span id="sage-structure-sage-object"></span><h1>Abstract base class for Sage objects<a class="headerlink" href="#abstract-base-class-for-sage-objects" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.structure.sage_object"></span><dl class="class">
<dt id="sage.structure.sage_object.SageObject">
<em class="property">class </em><code class="descclassname">sage.structure.sage_object.</code><code class="descname">SageObject</code><a class="headerlink" href="#sage.structure.sage_object.SageObject" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Base class for all (user-visible) objects in Sage</p>
<p>Every object that can end up being returned to the user should
inherit from <a class="reference internal" href="#sage.structure.sage_object.SageObject" title="sage.structure.sage_object.SageObject"><code class="xref py py-class docutils literal"><span class="pre">SageObject</span></code></a>.</p>
<dl class="method">
<dt id="sage.structure.sage_object.SageObject._ascii_art_">
<code class="descname">_ascii_art_</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject._ascii_art_" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an ASCII art representation.</p>
<p>To implement multi-line ASCII art output in a derived class
you must override this method. Unlike <code class="xref py py-meth docutils literal"><span class="pre">_repr_()</span></code>, which is
sometimes used for the hash key, the output of
<a class="reference internal" href="#sage.structure.sage_object.SageObject._ascii_art_" title="sage.structure.sage_object.SageObject._ascii_art_"><code class="xref py py-meth docutils literal"><span class="pre">_ascii_art_()</span></code></a> may depend on settings and is allowed to
change during runtime.</p>
<p>OUTPUT:</p>
<p>An <a class="reference external" href="../../../misc/sage/typeset/ascii_art.html#sage.typeset.ascii_art.AsciiArt" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-class docutils literal"><span class="pre">AsciiArt</span></code></a> object, see
<a class="reference external" href="../../../misc/sage/typeset/ascii_art.html#module-sage.typeset.ascii_art" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-mod docutils literal"><span class="pre">sage.typeset.ascii_art</span></code></a> for details.</p>
<p>EXAMPLES:</p>
<p>You can use the <a class="reference external" href="../../../misc/sage/typeset/ascii_art.html#sage.typeset.ascii_art.ascii_art" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-func docutils literal"><span class="pre">ascii_art()</span></code></a> function
to get the ASCII art representation of any object in Sage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">ascii_art</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
<span class="go">  /</span>
<span class="go"> |</span>
<span class="go"> |   2</span>
<span class="go"> |  x  + x</span>
<span class="go"> | e</span>
<span class="go"> | ------- dx</span>
<span class="go"> |  x + 1</span>
<span class="go"> |</span>
<span class="go">/</span>
</pre></div>
</div>
<p>Alternatively, you can use the <code class="docutils literal"><span class="pre">%display</span> <span class="pre">ascii_art/simple</span></code> magic to
switch all output to ASCII art and back:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.repl.interpreter</span> <span class="kn">import</span> <span class="n">get_test_shell</span>
<span class="gp">sage: </span><span class="n">shell</span> <span class="o">=</span> <span class="n">get_test_shell</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;tab = StandardTableaux(3)[2]; tab&#39;</span><span class="p">)</span>
<span class="go">[[1, 2], [3]]</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">isplay ascii_art&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;tab&#39;</span><span class="p">)</span>
<span class="go">1  2</span>
<span class="go">3</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;Tableaux.options(ascii_art=&quot;table&quot;, convention=&quot;French&quot;)&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;tab&#39;</span><span class="p">)</span>
<span class="go">+---+</span>
<span class="go">| 3 |</span>
<span class="go">+---+---+</span>
<span class="go">| 1 | 2 |</span>
<span class="go">+---+---+</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">isplay plain&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">run_cell</span><span class="p">(</span><span class="s1">&#39;Tableaux.options._reset()&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">shell</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>TESTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mf">1.</span><span class="n">_ascii_art_</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="go">&lt;class &#39;sage.typeset.ascii_art.AsciiArt&#39;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject._cache_key">
<code class="descname">_cache_key</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject._cache_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a hashable key which identifies this objects for caching. The
output must be hashable itself, or a tuple of objects which are
hashable or define a <code class="docutils literal"><span class="pre">_cache_key</span></code>.</p>
<p>This method will only be called if the object itself is not hashable.</p>
<p>Some immutable objects (such as <span class="math">\(p\)</span>-adic numbers) cannot implement a
reasonable hash function because their <code class="docutils literal"><span class="pre">==</span></code> operator has been
modified to return <code class="docutils literal"><span class="pre">True</span></code> for objects which might behave differently
in some computations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Qq</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">O</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">3</span>
<span class="gp">sage: </span><span class="n">b</span>
<span class="go">a + O(3)</span>
<span class="gp">sage: </span><span class="n">c</span>
<span class="go">a + 3 + O(3^20)</span>
<span class="gp">sage: </span><span class="n">b</span> <span class="o">==</span> <span class="n">c</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">b</span> <span class="o">==</span> <span class="n">a</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">==</span> <span class="n">a</span>
<span class="go">False</span>
</pre></div>
</div>
<p>If such objects defined a non-trivial hash function, this would break
caching in many places. However, such objects should still be usable in
caches. This can be achieved by defining an appropriate
<code class="docutils literal"><span class="pre">_cache_key</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">unhashable type: &#39;sage.rings.padics.qadic_flint_CR.qAdicCappedRelativeElement&#39;</span>
<span class="gp">sage: </span><span class="nd">@cached_method</span>
<span class="go">....: def f(x): return x==a</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1"># if b and c were hashable, this would return True</span>
<span class="go">False</span>

<span class="gp">sage: </span><span class="n">b</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">()</span>
<span class="go">(..., ((0, 1),), 0, 1)</span>
<span class="gp">sage: </span><span class="n">c</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">()</span>
<span class="go">(..., ((0, 1), (1,)), 0, 20)</span>
</pre></div>
</div>
<p>An implementation must make sure that for elements <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code>,
if <code class="docutils literal"><span class="pre">a</span> <span class="pre">!=</span> <span class="pre">b</span></code>, then also <code class="docutils literal"><span class="pre">a._cache_key()</span> <span class="pre">!=</span> <span class="pre">b._cache_key()</span></code>.
In practice this means that the <code class="docutils literal"><span class="pre">_cache_key</span></code> should always include
the parent as its first argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">S</span><span class="o">.&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Qq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">O</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">b</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">()</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">()</span> <span class="c1"># this would be True if the parents were not included</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.category">
<code class="descname">category</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.category" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.db">
<code class="descname">db</code><span class="sig-paren">(</span><em>name</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.db" title="Permalink to this definition">¶</a></dt>
<dd><p>Dumps self into the Sage database.  Use db(name) by itself to
reload.</p>
<p>The database directory is <code class="docutils literal"><span class="pre">$HOME/.sage/db</span></code></p>
<p>TESTS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">SageObject</span><span class="p">()</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<span class="go">doctest:... DeprecationWarning: db() is deprecated.</span>
<span class="go">See http://trac.sagemath.org/2536 for details.</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.dump">
<code class="descname">dump</code><span class="sig-paren">(</span><em>filename</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as self.save(filename, compress)</p>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.dumps">
<code class="descname">dumps</code><span class="sig-paren">(</span><em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump <code class="docutils literal"><span class="pre">self</span></code> to a string <code class="docutils literal"><span class="pre">s</span></code>, which can later be reconstituted
as <code class="docutils literal"><span class="pre">self</span></code> using <code class="docutils literal"><span class="pre">loads(s)</span></code>.</p>
<p>There is an optional boolean argument <code class="docutils literal"><span class="pre">compress</span></code> which defaults to <code class="docutils literal"><span class="pre">True</span></code>.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">O</span><span class="o">=</span><span class="n">SageObject</span><span class="p">();</span> <span class="n">O</span><span class="o">.</span><span class="n">dumps</span><span class="p">()</span>
<span class="go">&#39;x\x9ck`J.NLO\xd5+.)*M.)-\x02\xb2\x80\xdc\xf8\xfc\xa4\xac\xd4\xe4\x12\xae` \xdb\x1f\xc2,d\xd4l,d\xd2\x03\x00\xb7X\x10\xf1&#39;</span>
<span class="gp">sage: </span><span class="n">O</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">&#39;\x80\x02csage.structure.sage_object\nSageObject\nq\x01)\x81q\x02.&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.parent">
<code class="descname">parent</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.parent" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the type of <code class="docutils literal"><span class="pre">self</span></code> to support the coercion framework.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="n">t</span>
<span class="go">log(sqrt(2) + 1) + log(sqrt(2) - 1)</span>
<span class="gp">sage: </span><span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">maxima_methods</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">u</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
<span class="go">&lt;class &#39;sage.symbolic.maxima_wrapper.MaximaWrapper&#39;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.rename">
<code class="descname">rename</code><span class="sig-paren">(</span><em>x=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>Change self so it prints as x, where x is a string.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is <em>only</em> supported for Python classes that derive
from SageObject.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">x</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5</span>
<span class="gp">sage: </span><span class="n">g</span>
<span class="go">x^3 + x - 5</span>
<span class="gp">sage: </span><span class="n">g</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;a polynomial&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">g</span>
<span class="go">a polynomial</span>
<span class="gp">sage: </span><span class="n">g</span> <span class="o">+</span> <span class="n">x</span>
<span class="go">x^3 + 2*x - 5</span>
<span class="gp">sage: </span><span class="n">h</span> <span class="o">=</span> <span class="n">g</span><span class="o">^</span><span class="mi">100</span>
<span class="gp">sage: </span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]</span>
<span class="go">&#39;x^300 + 100*x^298 - &#39;</span>
<span class="gp">sage: </span><span class="n">h</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;x^300 + ...&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">h</span>
<span class="go">x^300 + ...</span>
</pre></div>
</div>
<p>Real numbers are not Python classes, so rename is not supported:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mf">3.14</span>
<span class="gp">sage: </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.real_mpfr.RealLiteral&#39;&gt;</span>
<span class="gp">sage: </span><span class="n">a</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">NotImplementedError</span>: <span class="n">object does not support renaming: 3.14000000000000</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The reason C-extension types are not supported by default
is if they were then every single one would have to carry
around an extra attribute, which would be slower and waste
a lot of memory.</p>
<p class="last">To support them for a specific class, add a
<code class="docutils literal"><span class="pre">cdef</span> <span class="pre">public</span> <span class="pre">__custom_name</span></code> attribute.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.reset_name">
<code class="descname">reset_name</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.reset_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the custom name of an object.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[]</span>
<span class="gp">sage: </span><span class="n">P</span>
<span class="go">Univariate Polynomial Ring in x over Rational Field</span>
<span class="gp">sage: </span><span class="n">P</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;A polynomial ring&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span>
<span class="go">A polynomial ring</span>
<span class="gp">sage: </span><span class="n">P</span><span class="o">.</span><span class="n">reset_name</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span>
<span class="go">Univariate Polynomial Ring in x over Rational Field</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.structure.sage_object.SageObject.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>filename=None</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.SageObject.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save self to the given filename.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span>
<span class="gp">sage: </span><span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;file.sobj&#39;</span><span class="p">))</span>
<span class="go">x^3 + 5</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.dumps">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">dumps</code><span class="sig-paren">(</span><em>obj</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump obj to a string s.  To recover obj, use <code class="docutils literal"><span class="pre">loads(s)</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#sage.structure.sage_object.dumps" title="sage.structure.sage_object.dumps"><code class="xref py py-func docutils literal"><span class="pre">dumps()</span></code></a></p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">49</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">2/3</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.load">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">load</code><span class="sig-paren">(</span><em>compress=True</em>, <em>verbose=True</em>, <em>*filename</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load Sage object from the file with name filename, which will have
an <code class="docutils literal"><span class="pre">.sobj</span></code> extension added if it doesn&#8217;t have one.  Or, if the input
is a filename ending in <code class="docutils literal"><span class="pre">.py</span></code>, <code class="docutils literal"><span class="pre">.pyx</span></code>, <code class="docutils literal"><span class="pre">.sage</span></code>, <code class="docutils literal"><span class="pre">.spyx</span></code>,
<code class="docutils literal"><span class="pre">.f</span></code>, <code class="docutils literal"><span class="pre">.f90</span></code> or <code class="docutils literal"><span class="pre">.m</span></code>, load that file into the current running
session.</p>
<p>Loaded files are not loaded into their own namespace, i.e., this is
much more like Python&#8217;s <code class="docutils literal"><span class="pre">execfile</span></code> than Python&#8217;s <code class="docutils literal"><span class="pre">import</span></code>.</p>
<p>This function also loads a <code class="docutils literal"><span class="pre">.sobj</span></code> file over a network by
specifying the full URL.  (Setting <code class="docutils literal"><span class="pre">verbose</span> <span class="pre">=</span> <span class="pre">False</span></code> suppresses
the loading progress indicator.)</p>
<p>Finally, if you give multiple positional input arguments, then all
of those files are loaded, or all of the objects are loaded and a
list of the corresponding loaded objects is returned.</p>
<p>EXAMPLE:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">u</span> <span class="o">=</span> <span class="s1">&#39;http://sage.math.washington.edu/home/was/db/test.sobj&#39;</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>                                                  <span class="c1"># optional - internet</span>
<span class="go">Attempting to load remote file: http://sage.math.washington.edu/home/was/db/test.sobj</span>
<span class="go">Loading: [.]</span>
<span class="gp">sage: </span><span class="n">s</span>                                                            <span class="c1"># optional - internet</span>
<span class="go">&#39;hello SAGE&#39;</span>
</pre></div>
</div>
<p>We test loading a file or multiple files or even mixing loading files and objects:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">open</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;print(&#39;hello world&#39;)&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="go">hello world</span>
<span class="gp">sage: </span><span class="n">t2</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">();</span> <span class="n">save</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="go">hello world</span>
<span class="go">[None, None, 2/3]</span>
</pre></div>
</div>
<p>We can load Fortran files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;      subroutine hello</span><span class="se">\n</span><span class="s1">         print *, &quot;Hello World!&quot;</span><span class="se">\n</span><span class="s1">      end subroutine hello</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.F&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">open</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">hello</span>
<span class="go">&lt;fortran object&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.loads">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">loads</code><span class="sig-paren">(</span><em>s</em>, <em>compress=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover an object x that has been dumped to a string s
using <code class="docutils literal"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">dumps(x)</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#sage.structure.sage_object.dumps" title="sage.structure.sage_object.dumps"><code class="xref py py-func docutils literal"><span class="pre">dumps()</span></code></a></p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[   1    2]</span>
<span class="go">[   3 -4/3]</span>
</pre></div>
</div>
<p>If compress is True (the default), it will try to decompress
the data with zlib and with bz2 (in turn); if neither succeeds,
it will assume the data is actually uncompressed.  If compress=False
is explicitly specified, then no decompression is attempted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="mi">10</span><span class="p">]</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span> <span class="o">==</span> <span class="n">v</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">compress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">compress</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnpicklingError</span>: <span class="n">invalid load key, &#39;x&#39;.</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.picklejar">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">picklejar</code><span class="sig-paren">(</span><em>obj</em>, <em>dir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.picklejar" title="Permalink to this definition">¶</a></dt>
<dd><p>Create pickled sobj of obj in dir, with name the absolute value of
the hash of the pickle of obj.  This is used in conjunction with
<a class="reference internal" href="#sage.structure.sage_object.unpickle_all" title="sage.structure.sage_object.unpickle_all"><code class="xref py py-func docutils literal"><span class="pre">unpickle_all()</span></code></a>.</p>
<p>To use this to test the whole Sage library right now, set the
environment variable <code class="docutils literal"><span class="pre">SAGE_PICKLE_JAR</span></code>, which will make it so dumps
will by default call picklejar with the default dir.  Once you do
that and doctest Sage, you&#8217;ll find that the <code class="docutils literal"><span class="pre">SAGE_ROOT</span></code>/tmp/
contains a bunch of pickled objects along with corresponding txt
descriptions of them.  Use the <a class="reference internal" href="#sage.structure.sage_object.unpickle_all" title="sage.structure.sage_object.unpickle_all"><code class="xref py py-func docutils literal"><span class="pre">unpickle_all()</span></code></a> to see if they unpickle
later.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">obj</span></code> &#8211; a pickleable object</li>
<li><code class="docutils literal"><span class="pre">dir</span></code> &#8211; a string or None; if None then <code class="docutils literal"><span class="pre">dir</span></code> defaults to
<code class="docutils literal"><span class="pre">SAGE_ROOT/tmp/pickle_jar</span></code></li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>   <span class="c1"># Two entries (sobj and txt) for each object</span>
<span class="go">4</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Test an unaccessible directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="mi">0</span><span class="n">o000</span><span class="p">)</span>
<span class="gp">sage: </span><span class="k">try</span><span class="p">:</span>
<span class="go">....:     uid = os.getuid()</span>
<span class="go">....: except AttributeError:</span>
<span class="go">....:     uid = -1</span>
<span class="gp">sage: </span><span class="k">if</span> <span class="n">uid</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<span class="go">....:     raise OSError(&#39;You must not run the doctests as root, geez!&#39;)</span>
<span class="go">....: else:</span>
<span class="go">....:     sage.structure.sage_object.picklejar(1, dir + &#39;/noaccess&#39;)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">OSError</span>: <span class="n">...</span>
<span class="gp">sage: </span><span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.py_rich_to_bool">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">py_rich_to_bool</code><span class="sig-paren">(</span><em>op</em>, <em>c</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.py_rich_to_bool" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal"><span class="pre">True</span></code> or <code class="docutils literal"><span class="pre">False</span></code> for a rich comparison, given the result of an
ordinary comparison.</p>
<p>Do not use this function from Cython. Instead, call <code class="docutils literal"><span class="pre">rich_to_bool</span></code> or
<code class="docutils literal"><span class="pre">rich_to_bool_sgn</span></code> defined in <code class="docutils literal"><span class="pre">sage_object.pxd</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">op</span></code> &#8211; a rich comparison operation (e.g. <code class="docutils literal"><span class="pre">op_EQ</span></code>)</li>
<li><code class="docutils literal"><span class="pre">c</span></code> &#8211; the result of an ordinary comparison, i.e. an integer.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="p">(</span><span class="n">py_rich_to_bool</span><span class="p">,</span>
<span class="go">....:    op_EQ, op_NE, op_LT, op_LE, op_GT, op_GE)</span>
<span class="gp">sage: </span><span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="n">op_LT</span><span class="p">,</span> <span class="n">op_LE</span><span class="p">,</span> <span class="n">op_EQ</span><span class="p">,</span> <span class="n">op_NE</span><span class="p">,</span> <span class="n">op_GT</span><span class="p">,</span> <span class="n">op_GE</span><span class="p">):</span>
<span class="go">....:     for c in (-1,0,1):</span>
<span class="go">....:         print(py_rich_to_bool(op, c))</span>
<span class="go">True False False</span>
<span class="go">True True False</span>
<span class="go">False True False</span>
<span class="go">True False True</span>
<span class="go">False False True</span>
<span class="go">False True True</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.register_unpickle_override">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">register_unpickle_override</code><span class="sig-paren">(</span><em>module</em>, <em>name</em>, <em>callable</em>, <em>call_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.register_unpickle_override" title="Permalink to this definition">¶</a></dt>
<dd><p>Python pickles include the module and class name of classes.
This means that rearranging the Sage source can invalidate old
pickles.  To keep the old pickles working, you can call
register_unpickle_override with an old module name and class name,
and the Python callable (function, class with __call__ method, etc.)
to use for unpickling.  (If this callable is a value in some module,
you can specify the module name and class name, for the benefit of
<a class="reference external" href="../../../misc/sage/misc/explain_pickle.html#sage.misc.explain_pickle.explain_pickle" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-func docutils literal"><span class="pre">explain_pickle()</span></code></a> when called with <code class="docutils literal"><span class="pre">in_current_sage=True</span></code>).)</p>
<p>EXAMPLES:</p>
<p>Imagine that there used to be an <code class="docutils literal"><span class="pre">old_integer</span></code> module and old
pickles essentially trying to do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ImportError</span>: <span class="n">cannot import OldInteger from sage.rings.old_integer, call register_unpickle_override(&#39;sage.rings.old_integer&#39;, &#39;OldInteger&#39;, ...) to fix this</span>
</pre></div>
</div>
<p>After following the advice from the error message, unpickling
works:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.old_integer&#39;</span><span class="p">,</span> <span class="s1">&#39;OldInteger&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
<p>In many cases, unpickling problems for old pickles can be resolved with a
simple call to <code class="docutils literal"><span class="pre">register_unpickle_override</span></code>, as in the example above and
in many of the <code class="docutils literal"><span class="pre">sage</span></code> source files.  However, if the underlying data
structure has changed significantly then unpickling may fail and it
will be necessary to explicitly implement unpickling methods for the
associated objects. The python pickle protocol is described in detail on the
web and, in particular, in the <a class="reference external" href="http://docs.python.org/library/pickle.html#pickle-protocol">python pickling documentation</a>. For example, the
following excerpt from this documentation shows that the unpickling of
classes is controlled by their <code class="xref py py-meth docutils literal"><span class="pre">__setstate__()</span></code> method.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>object.__setstate__(state)

    Upon unpickling, if the class also defines the method :meth:`__setstate__`, it is
    called with the unpickled state. If there is no :meth:`__setstate__` method,
    the pickled state must be a dictionary and its items are assigned to the new
    instance&#39;s dictionary. If a class defines both :meth:`getstate__` and
    :meth:`__setstate__`, the state object needn&#39;t be a dictionary and these methods
    can do what they want.
</pre></div>
</div>
<p>By implementing a <code class="xref py py-meth docutils literal"><span class="pre">__setstate__()</span></code> method for a class it should be
possible to fix any unpickling problems for the class. As an example of what
needs to be done, we show how to unpickle a <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v7.3)"><code class="xref py py-class docutils literal"><span class="pre">CombinatorialObject</span></code></a>
object using a class which also inherits from
<a class="reference internal" href="element.html#sage.structure.element.Element" title="sage.structure.element.Element"><code class="xref py py-class docutils literal"><span class="pre">Element</span></code></a>. This exact problem often arises
when refactoring old code into the element framework. First we create a
pickle to play with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.element</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">SourPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">SweetPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">,</span><span class="n">Element</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SourPickle</span><span class="o">=</span><span class="n">SourPickle</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SweetPickle</span><span class="o">=</span><span class="n">SweetPickle</span>  <span class="c1"># a hack to allow us to pickle command line classes</span>
<span class="gp">sage: </span><span class="n">gherkin</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span> <span class="n">SourPickle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
<p>Using <a class="reference internal" href="#sage.structure.sage_object.register_unpickle_override" title="sage.structure.sage_object.register_unpickle_override"><code class="xref py py-func docutils literal"><span class="pre">register_unpickle_override()</span></code></a> we try to sweeten our pickle, but we are unable to eat it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span><span class="s1">&#39;SourPickle&#39;</span><span class="p">,</span><span class="n">SweetPickle</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span> <span class="n">gherkin</span> <span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">KeyError</span>: <span class="n">0</span>
</pre></div>
</div>
<p>The problem is that the <code class="docutils literal"><span class="pre">SweetPickle</span></code> has inherited a
<code class="xref py py-meth docutils literal"><span class="pre">__setstate__()</span></code> method from
<a class="reference internal" href="element.html#sage.structure.element.Element" title="sage.structure.element.Element"><code class="xref py py-class docutils literal"><span class="pre">Element</span></code></a> which is not compatible with
unpickling for <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v7.3)"><code class="xref py py-class docutils literal"><span class="pre">CombinatorialObject</span></code></a>. We can fix this by explicitly
defining a new <code class="xref py py-meth docutils literal"><span class="pre">__setstate__()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">SweeterPickle</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">,</span><span class="n">Element</span><span class="p">):</span>
<span class="go">....:     def __setstate__(self, state):</span>
<span class="go">....:         if isinstance(state, dict):       # a pickle from CombinatorialObject is just its instance dictionary</span>
<span class="go">....:             self._set_parent(Tableaux())  # this is a fudge: we need an appropriate parent here</span>
<span class="go">....:             self.__dict__ = state</span>
<span class="go">....:         else:</span>
<span class="go">....:             self._set_parent(state[0])</span>
<span class="go">....:             self.__dict__ = state[1]</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">SweeterPickle</span> <span class="o">=</span> <span class="n">SweeterPickle</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span><span class="s1">&#39;SourPickle&#39;</span><span class="p">,</span><span class="n">SweeterPickle</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span> <span class="n">gherkin</span> <span class="p">)</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span> <span class="n">SweeterPickle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="p">))</span>   <span class="c1"># check that pickles work for SweeterPickle</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">state</span></code> passed to <code class="xref py py-meth docutils literal"><span class="pre">__setstate__()</span></code> will usually be something like
the instance dictionary of the pickled object, however, with some older
classes such as <a class="reference external" href="../../../combinat/sage/combinat/combinat.html#sage.combinat.combinat.CombinatorialObject" title="(in Sage Reference Manual: Combinatorics v7.3)"><code class="xref py py-class docutils literal"><span class="pre">CombinatorialObject</span></code></a> it will be a tuple. In general,
the <code class="docutils literal"><span class="pre">state</span></code> can be any python object.  <code class="docutils literal"><span class="pre">Sage</span></code> provides a special tool,
<a class="reference external" href="../../../misc/sage/misc/explain_pickle.html#sage.misc.explain_pickle.explain_pickle" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-func docutils literal"><span class="pre">explain_pickle()</span></code></a>, which can help in figuring
out the contents of an old pickle. Here is a second example.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="go">....:    def __init__(self,value):</span>
<span class="go">....:        self.original_attribute = value</span>
<span class="go">....:    def __repr__(self):</span>
<span class="go">....:        return &#39;A(%s)&#39;%self.original_attribute</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="go">....:    def __init__(self,value):</span>
<span class="go">....:        self.new_attribute = value</span>
<span class="go">....:    def __setstate__(self,state):</span>
<span class="go">....:        try:</span>
<span class="go">....:            self.new_attribute = state[&#39;new_attribute&#39;]</span>
<span class="go">....:        except KeyError:      # an old pickle</span>
<span class="go">....:            self.new_attribute = state[&#39;original_attribute&#39;]</span>
<span class="go">....:    def __repr__(self):</span>
<span class="go">....:        return &#39;B(%s)&#39;%self.new_attribute</span>
<span class="gp">sage: </span><span class="kn">import</span> <span class="nn">__main__</span>
<span class="gp">sage: </span><span class="n">__main__</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">;</span> <span class="n">__main__</span><span class="o">.</span><span class="n">B</span><span class="o">=</span><span class="n">B</span>  <span class="c1"># a hack to allow us to pickle command line classes</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">A(10)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span> <span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="p">)</span>
<span class="go">A(10)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">explain_pickle</span><span class="o">.</span><span class="n">explain_pickle</span><span class="p">(</span> <span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="p">)</span>
<span class="go">pg_A = unpickle_global(&#39;__main__&#39;, &#39;A&#39;)</span>
<span class="go">si = unpickle_newobj(pg_A, ())</span>
<span class="go">pg_make_integer = unpickle_global(&#39;sage.rings.integer&#39;, &#39;make_integer&#39;)</span>
<span class="go">unpickle_build(si, {&#39;original_attribute&#39;:pg_make_integer(&#39;a&#39;)})</span>
<span class="go">si</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span> <span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="p">)</span>
<span class="go">B(10)</span>
<span class="gp">sage: </span><span class="n">loads</span><span class="p">(</span> <span class="n">dumps</span><span class="p">(</span><span class="n">B</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="p">)</span>
<span class="go">B(10)</span>
</pre></div>
</div>
<p>Pickling for python classes and extension classes, such as cython, is
different &#8211; again this is discussed in the <a class="reference external" href="http://docs.python.org/library/pickle.html#pickle-protocol">python pickling documentation</a>. For the
unpickling of extension classes you need to write a <code class="xref py py-meth docutils literal"><span class="pre">__reduce__()</span></code>
method which typically returns a tuple <code class="docutils literal"><span class="pre">(f,</span> <span class="pre">args,...)</span></code> such that
<code class="docutils literal"><span class="pre">f(*args)</span></code> returns (a copy of) the original object. The following code
snippet is the <code class="xref py py-meth docutils literal"><span class="pre">__reduce__()</span></code> method from
<a class="reference external" href="../../../rings_standard/sage/rings/integer.html#sage.rings.integer.Integer" title="(in Sage Reference Manual: Standard Commutative Rings v7.3)"><code class="xref py py-class docutils literal"><span class="pre">sage.rings.integer.Integer</span></code></a>.</p>
<div class="highlight-cython"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&#39;Including the documentation properly causes a doc-test failure so we include it as a comment:&#39;</span>
    <span class="c">#* &#39;&#39;&#39;</span>
    <span class="c">#* This is used when pickling integers.</span>
    <span class="c">#*</span>
    <span class="c">#* EXAMPLES::</span>
    <span class="c">#*</span>
    <span class="c">#*     sage: n = 5</span>
    <span class="c">#*     sage: t = n.__reduce__(); t</span>
    <span class="c">#*     (&lt;built-in function make_integer&gt;, (&#39;5&#39;,))</span>
    <span class="c">#*     sage: t[0](*t[1])</span>
    <span class="c">#*     5</span>
    <span class="c">#*     sage: loads(dumps(n)) == n</span>
    <span class="c">#*     True</span>
    <span class="c">#* &#39;&#39;&#39;</span>
    <span class="c"># This single line below took me HOURS to figure out.</span>
    <span class="c"># It is the *trick* needed to pickle Cython extension types.</span>
    <span class="c"># The trick is that you must put a pure Python function</span>
    <span class="c"># as the first argument, and that function must return</span>
    <span class="c"># the result of unpickling with the argument in the second</span>
    <span class="c"># tuple as input. All kinds of problems happen</span>
    <span class="c"># if we don&#39;t do this.</span>
    <span class="k">return</span> <span class="n">sage</span><span class="o">.</span><span class="n">rings</span><span class="o">.</span><span class="n">integer</span><span class="o">.</span><span class="n">make_integer</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="mf">32</span><span class="p">),)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.save">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">save</code><span class="sig-paren">(</span><em>obj</em>, <em>filename=None</em>, <em>compress=True</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save <code class="docutils literal"><span class="pre">obj</span></code> to the file with name <code class="docutils literal"><span class="pre">filename</span></code>, which will have an
<code class="docutils literal"><span class="pre">.sobj</span></code> extension added if it doesn&#8217;t have one and if <code class="docutils literal"><span class="pre">obj</span></code>
doesn&#8217;t have its own <code class="docutils literal"><span class="pre">save()</span></code> method, like e.g. Python tuples.</p>
<p>For image objects and the like (which have their own <code class="docutils literal"><span class="pre">save()</span></code> method),
you may have to specify a specific extension, e.g. <code class="docutils literal"><span class="pre">.png</span></code>, if you
don&#8217;t want the object to be saved as a Sage object (or likewise, if
<code class="docutils literal"><span class="pre">filename</span></code> could be interpreted as already having some extension).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This will <em>replace</em> the contents of the file if it already exists.</p>
</div>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">objfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test.sobj&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">objfile_short</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">objfile</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile_short</span><span class="p">)</span>
<span class="go">[   1    2]</span>
<span class="go">[   3 -5/2]</span>
<span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">objfile_short</span><span class="p">)</span>   <span class="c1"># saves the plot to &quot;test.sobj&quot;</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s2">&quot;sage.png&quot;</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s2">&quot;filename.with.some.wrong.ext&quot;</span><span class="p">))</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">allowed file extensions for images are &#39;.eps&#39;, &#39;.pdf&#39;, &#39;.pgf&#39;, &#39;.png&#39;, &#39;.ps&#39;, &#39;.sobj&#39;, &#39;.svg&#39;!</span>
<span class="gp">sage: </span><span class="k">print</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">objfile</span><span class="p">))</span>
<span class="go">Graphics object consisting of 2 graphics primitives</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;A python string&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile</span><span class="p">)</span>
<span class="go">&#39;A python string&#39;</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">objfile_short</span><span class="p">)</span>
<span class="go">&#39;A python string&#39;</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Check that <a class="reference external" href="https://trac.sagemath.org/11577">trac ticket #11577</a> is fixed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_TMP</span><span class="p">,</span> <span class="s2">&quot;foo.bar&quot;</span><span class="p">)</span>  <span class="c1"># filename containing a dot</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">filename</span><span class="p">)</span>            <span class="c1"># saves tuple to &quot;foo.bar.sobj&quot;</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="go">(1, 1)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.unpickle_all">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">unpickle_all</code><span class="sig-paren">(</span><em>dir=None</em>, <em>debug=False</em>, <em>run_test_suite=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.unpickle_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpickle all sobj&#8217;s in the given directory, reporting failures as
they occur.  Also printed the number of successes and failure.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">dir</span></code> &#8211; a string; the name of a directory (or of a .tar.bz2
file that decompresses to a directory) full of pickles.
(default: the standard pickle jar)</li>
<li><code class="docutils literal"><span class="pre">debug</span></code> &#8211; a boolean (default: False)
whether to report a stacktrace in case of failure</li>
<li><code class="docutils literal"><span class="pre">run_test_suite</span></code> &#8211; a boolean (default: False)
whether to run <code class="docutils literal"><span class="pre">TestSuite(x).run()</span></code> on the unpickled objects</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">picklejar</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">unpickle_all</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<span class="go">Successfully unpickled 1 objects.</span>
<span class="go">Failed to unpickle 0 objects.</span>
</pre></div>
</div>
<p>When run with no arguments <a class="reference internal" href="#sage.structure.sage_object.unpickle_all" title="sage.structure.sage_object.unpickle_all"><code class="xref py py-meth docutils literal"><span class="pre">unpickle_all()</span></code></a> tests that all of the
&#8220;standard&#8221; pickles stored in the pickle_jar at
<code class="docutils literal"><span class="pre">SAGE_ROOT/local/share/sage/ext/pickle_jar/pickle_jar.tar.bz2</span></code> can be unpickled.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">unpickle_all</span><span class="p">()</span>  <span class="c1"># (4s on sage.math, 2011)</span>
<span class="go">doctest:... DeprecationWarning: ...</span>
<span class="go">See http://trac.sagemath.org/... for details.</span>
<span class="go">Successfully unpickled ... objects.</span>
<span class="go">Failed to unpickle 0 objects.</span>
</pre></div>
</div>
<p>Check that unpickling a second time works (see <a class="reference external" href="https://trac.sagemath.org/5838">trac ticket #5838</a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">unpickle_all</span><span class="p">()</span>
<span class="go">Successfully unpickled ... objects.</span>
<span class="go">Failed to unpickle 0 objects.</span>
</pre></div>
</div>
<p>When it is not possible to unpickle a pickle in the pickle_jar then
<a class="reference internal" href="#sage.structure.sage_object.unpickle_all" title="sage.structure.sage_object.unpickle_all"><code class="xref py py-meth docutils literal"><span class="pre">unpickle_all()</span></code></a> prints the following error message which warns against removing
pickles from the pickle_jar and directs the user towards
<a class="reference internal" href="#sage.structure.sage_object.register_unpickle_override" title="sage.structure.sage_object.register_unpickle_override"><code class="xref py py-meth docutils literal"><span class="pre">register_unpickle_override()</span></code></a>. The following code intentionally
breaks a pickle to illustrate this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="n">register_unpickle_override</span><span class="p">,</span> <span class="n">unpickle_all</span><span class="p">,</span> <span class="n">unpickle_global</span>
<span class="gp">sage: </span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">CombinatorialObject</span><span class="p">,</span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
<span class="go">....:     pass  # to break a pickle</span>
<span class="gp">sage: </span><span class="n">tableau_unpickler</span><span class="o">=</span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.combinat.tableau&#39;</span><span class="p">,</span><span class="s1">&#39;Tableau_class&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.combinat.tableau&#39;</span><span class="p">,</span><span class="s1">&#39;Tableau_class&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">)</span> <span class="c1"># breaking the pickle</span>
<span class="gp">sage: </span><span class="n">unpickle_all</span><span class="p">()</span>  <span class="c1"># todo: not tested</span>
<span class="gp">...</span>
<span class="go">Failed:</span>
<span class="go">_class__sage_combinat_crystals_affine_AffineCrystalFromClassicalAndPromotion_with_category_element_class__.sobj</span>
<span class="go">_class__sage_combinat_crystals_tensor_product_CrystalOfTableaux_with_category_element_class__.sobj</span>
<span class="go">_class__sage_combinat_crystals_tensor_product_TensorProductOfCrystalsWithGenerators_with_category__.sobj</span>
<span class="go">_class__sage_combinat_tableau_Tableau_class__.sobj</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">** This error is probably due to an old pickle failing to unpickle.</span>
<span class="go">** See sage.structure.sage_object.register_unpickle_override for</span>
<span class="go">** how to override the default unpickling methods for (old) pickles.</span>
<span class="go">** NOTE: pickles should never be removed from the pickle_jar!</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Successfully unpickled 583 objects.</span>
<span class="go">Failed to unpickle 4 objects.</span>
<span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.combinat.tableau&#39;</span><span class="p">,</span><span class="s1">&#39;Tableau_class&#39;</span><span class="p">,</span><span class="n">tableau_unpickler</span><span class="p">)</span> <span class="c1"># restore to default</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Create a custom-made <code class="docutils literal"><span class="pre">SourPickle</span></code> for the last example.</p>
</div>
<p>If you want to find <em>lots</em> of little issues in Sage then try the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">sage</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sage_object</span><span class="o">.</span><span class="n">unpickle_all</span><span class="p">(</span><span class="n">run_test_suite</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="c1"># todo: not tested</span>
</pre></div>
</div>
<p>This runs <a class="reference external" href="../../../misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite" title="(in Sage Reference Manual: Utilities v7.3)"><code class="xref py py-class docutils literal"><span class="pre">TestSuite</span></code></a> tests on all objects in the Sage pickle
jar. Some of those objects seem to unpickle properly, but do not
pass the tests because their internal data structure is messed
up. In most cases though it is just that their source file misses
a TestSuite call, and therefore some misfeatures went unnoticed
(typically Parents not implementing the <code class="docutils literal"><span class="pre">an_element</span></code> method).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Every so often the standard pickle jar should be updated by running the
doctest suite with the environment variable <code class="docutils literal"><span class="pre">SAGE_PICKLE_JAR</span></code> set, then
copying the files from <code class="docutils literal"><span class="pre">SAGE_ROOT/tmp/pickle_jar*</span></code> into the standard pickle
jar.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Sage&#8217;s pickle jar helps to ensure backward compatibility in sage. Pickles should
<strong>only</strong> be removed from the pickle jar after the corresponding objects
have been properly deprecated. Any proposal to remove pickles from the
pickle jar should first be discussed on sage-devel.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="sage.structure.sage_object.unpickle_global">
<code class="descclassname">sage.structure.sage_object.</code><code class="descname">unpickle_global</code><span class="sig-paren">(</span><em>module</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.structure.sage_object.unpickle_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a module name and a name within that module (typically a class
name), retrieve the corresponding object.  This normally just looks
up the name in the module, but it can be overridden by
register_unpickle_override.  This is used in the Sage unpickling
mechanism, so if the Sage source code organization changes,
register_unpickle_override can allow old pickles to continue to work.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.structure.sage_object</span> <span class="kn">import</span> <span class="n">unpickle_override</span><span class="p">,</span> <span class="n">register_unpickle_override</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
<p>Now we horribly break the pickling system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">register_unpickle_override</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">,</span> <span class="n">Rational</span><span class="p">,</span> <span class="n">call_name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sage.rings.rational&#39;</span><span class="p">,</span> <span class="s1">&#39;Rational&#39;</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.rational.Rational&#39;&gt;</span>
</pre></div>
</div>
<p>and we reach into the internals and put it back:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">del</span> <span class="n">unpickle_override</span><span class="p">[(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)]</span>
<span class="gp">sage: </span><span class="n">unpickle_global</span><span class="p">(</span><span class="s1">&#39;sage.rings.integer&#39;</span><span class="p">,</span> <span class="s1">&#39;Integer&#39;</span><span class="p">)</span>
<span class="go">&lt;type &#39;sage.rings.integer.Integer&#39;&gt;</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="../../index.html"
                                  title="previous chapter">Basic Structures</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="category_object.html"
                                  title="next chapter">Base class for objects of a category</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/sage/structure/sage_object.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18" />
               <!-- The shading of the "Go" button should be consistent -->
               <!-- with the colour of the header and footer. See the file -->
               <!-- doc/common/themes/sage/theme.conf for colours used by -->
               <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="category_object.html" title="Base class for objects of a category"
             >next</a> |</li>
        <li class="right" >
          <a href="../../index.html" title="Basic Structures"
             >previous</a> |</li>
  
    
      <a href="../../../../index.html"><img src="../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Basic Structures</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005--2016, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66100-14', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>