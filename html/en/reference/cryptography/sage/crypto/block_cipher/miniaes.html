<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mini-AES &mdash; Sage Reference Manual v7.2: Cryptography</title>
    
    <link rel="stylesheet" href="../../../../_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="../../../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Sage Reference Manual v7.2: Cryptography" href="../../../index.html" />
    <link rel="next" title="Blum-Goldwasser Probabilistic Encryption" href="../public_key/blum_goldwasser.html" />
    <link rel="prev" title="Simplified DES" href="sdes.html" />
    <link rel="icon" href="../../../../_static/sageicon.png" type="image/x-icon" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../public_key/blum_goldwasser.html" title="Blum-Goldwasser Probabilistic Encryption"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sdes.html" title="Simplified DES"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../../../../../index.html"><img src="../../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../../index.html">Cryptography</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mini-aes">
<span id="sage-crypto-block-cipher-miniaes"></span><h1>Mini-AES<a class="headerlink" href="#mini-aes" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-sage.crypto.block_cipher.miniaes"></span><p>A simplified variant of the Advanced Encryption Standard (AES). Note that
Mini-AES is for educational purposes only. It is a small-scale version of
the AES designed to help beginners understand the basic structure of AES.</p>
<p>AUTHORS:</p>
<ul class="simple">
<li>Minh Van Nguyen (2009-05): initial version</li>
</ul>
<dl class="class">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES">
<em class="property">class </em><code class="descclassname">sage.crypto.block_cipher.miniaes.</code><code class="descname">MiniAES</code><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="../../../../structure/sage/structure/sage_object.html#sage.structure.sage_object.SageObject" title="(in Sage Reference Manual: Basic Structures v7.2)"><code class="xref py py-class docutils literal"><span class="pre">sage.structure.sage_object.SageObject</span></code></a></p>
<p>This class implements the Mini Advanced Encryption Standard (Mini-AES)
described in <a class="reference internal" href="#p02" id="id1">[P02]</a>. Note that Phan&#8217;s Mini-AES is for educational purposes
only and is not secure for practical purposes. Mini-AES is a version of
the AES with all parameters significantly reduced, but at the same time
preserving the structure of AES. The goal of Mini-AES is to allow a
beginner to understand the structure of AES, thus laying a foundation
for a thorough study of AES. Its goal is as a teaching tool and is
different from the <a class="reference internal" href="../mq/sr.html#module-sage.crypto.mq.sr" title="sage.crypto.mq.sr"><code class="xref py py-mod docutils literal"><span class="pre">SR</span></code></a> small scale variants
of the AES. SR defines a family of parameterizable variants of the AES
suitable as a framework for comparing different cryptanalytic techniques
that can be brought to bear on the AES.</p>
<p>EXAMPLES:</p>
<p>Encrypt a plaintext:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">)]);</span> <span class="n">P</span>

<span class="go">[  x^3 + x   x^2 + 1]</span>
<span class="go">[  x^2 + x x^3 + x^2]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">)]);</span> <span class="n">key</span>

<span class="go">[    x^3 + x^2       x^3 + x]</span>
<span class="go">[x^3 + x^2 + x   x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="n">C</span>

<span class="go">[            x       x^2 + x]</span>
<span class="go">[x^3 + x^2 + x       x^3 + x]</span>
</pre></div>
</div>
<p>Decrypt the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span><span class="p">;</span> <span class="n">P</span>

<span class="go">[  x^3 + x   x^2 + 1]</span>
<span class="go">[  x^2 + x x^3 + x^2]</span>

<span class="go">[  x^3 + x   x^2 + 1]</span>
<span class="go">[  x^2 + x x^3 + x^2]</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>We can also work directly with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;KE&quot;</span><span class="p">);</span> <span class="n">key</span>
<span class="go">0100101101000101</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;Encrypt this secret message!&quot;</span><span class="p">);</span> <span class="n">P</span>
<span class="go">01000101011011100110001101110010011110010111000001110100001000000111010001101000011010010111001100100000011100110110010101100011011100100110010101110100001000000110110101100101011100110111001101100001011001110110010100100001</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;encrypt&quot;</span><span class="p">);</span> <span class="n">C</span>
<span class="go">10001000101001101111000001111000010011001110110101000111011011010101001011101111101011001110011100100011101100101010100010100111110110011001010001000111011011010010000011000110001100000111000011100110101111000000001110001001</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;decrypt&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Now we work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">)];</span> <span class="n">P</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span> <span class="n">key</span>
<span class="go">[2, 3, 11, 0]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="n">P</span><span class="p">);</span> <span class="n">P</span>
<span class="go">0000000100100011010001010110011110001001101010111100110111101111</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="n">key</span>
<span class="go">0010001110110000</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;encrypt&quot;</span><span class="p">);</span> <span class="n">C</span>
<span class="go">1100100000100011111001010101010101011011100111110001000011100001</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;decrypt&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Generate some random plaintext and a random secret key. Encrypt the
plaintext using that secret key and decrypt the result. Then compare the
decrypted plaintext with the original plaintext:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">random_key</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>REFERENCES:</p>
<table class="docutils citation" frame="void" id="p02" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[P02]</a></td><td>R. C.-W. Phan. Mini advanced encryption standard (mini-AES): a
testbed for cryptanalysis students. Cryptologia, 26(4):283&#8211;306, 2002.</td></tr>
</tbody>
</table>
<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.GF_to_binary">
<code class="descname">GF_to_binary</code><span class="sig-paren">(</span><em>G</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.GF_to_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the binary representation of <code class="docutils literal"><span class="pre">G</span></code>.
If <code class="docutils literal"><span class="pre">G</span></code> is an element of the finite field <span class="math">\(\GF{2^4}\)</span>, then
obtain the binary representation of <code class="docutils literal"><span class="pre">G</span></code>. If <code class="docutils literal"><span class="pre">G</span></code> is a list of
elements belonging to <span class="math">\(\GF{2^4}\)</span>, obtain the 4-bit
representation of each element of the list, then concatenate the
resulting 4-bit strings into a binary string. If <code class="docutils literal"><span class="pre">G</span></code> is a matrix
with entries over <span class="math">\(\GF{2^4}\)</span>, convert each matrix entry to its
4-bit representation, then concatenate the 4-bit strings. The
concatenation is performed starting from the top-left corner of the
matrix, working across left to right, top to bottom. Each element of
<span class="math">\(\GF{2^4}\)</span> can be associated with a unique 4-bit string
according to the following table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  4-bit string &amp; $\GF{2^4}$ &amp; 4-bit string &amp; $\GF{2^4}$ \\\hline
  0000 &amp; $0$           &amp; 1000 &amp; $x^3$              \\
  0001 &amp; $1$           &amp; 1001 &amp; $x^3 + 1$          \\
  0010 &amp; $x$           &amp; 1010 &amp; $x^3 + x$          \\
  0011 &amp; $x + 1$       &amp; 1011 &amp; $x^3 + x + 1$      \\
  0100 &amp; $x^2$         &amp; 1100 &amp; $x^3 + x^2$        \\
  0101 &amp; $x^2 + 1$     &amp; 1101 &amp; $x^3 + x^2 + 1$    \\
  0110 &amp; $x^2 + x$     &amp; 1110 &amp; $x^3 + x^2 + x$    \\
  0111 &amp; $x^2 + x + 1$ &amp; 1111 &amp; $x^3 + x^2 + x+ 1$ \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">G</span></code> &#8211; an element of <span class="math">\(\GF{2^4}\)</span>, a list of elements of
<span class="math">\(\GF{2^4}\)</span>, or a matrix over <span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A binary string representation of <code class="docutils literal"><span class="pre">G</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtain the binary representation of all elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">K</span><span class="p">);</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>  <span class="c1"># GF(2^4) has this many elements</span>
<span class="go">16</span>
<span class="gp">sage: </span><span class="p">[</span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">))]</span>

<span class="go">[0000,</span>
<span class="go">0001,</span>
<span class="go">0010,</span>
<span class="go">0011,</span>
<span class="go">0100,</span>
<span class="go">0101,</span>
<span class="go">0110,</span>
<span class="go">0111,</span>
<span class="go">1000,</span>
<span class="go">1001,</span>
<span class="go">1010,</span>
<span class="go">1011,</span>
<span class="go">1100,</span>
<span class="go">1101,</span>
<span class="go">1110,</span>
<span class="go">1111]</span>
</pre></div>
</div>
<p>The binary representation of a list of elements belonging to
<span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">)]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">01111100001010111111011000010111</span>
</pre></div>
</div>
<p>The binary representation of a matrix over <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x&quot;</span><span class="p">)]);</span> <span class="n">G</span>

<span class="go">[    x^3 + x^2         x + 1]</span>
<span class="go">[  x^2 + x + 1 x^3 + x^2 + x]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">1100001101111110</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">)]);</span> <span class="n">G</span>

<span class="go">[      x^2 + x + 1         x^3 + x^2                 x       x^3 + x + 1]</span>
<span class="go">[x^3 + x^2 + x + 1           x^2 + x                 1       x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">01111100001010111111011000010111</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Input must be an element of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)</span>
</pre></div>
</div>
<p>A list of elements belonging to <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: maes.GF_to_binary([])
Traceback (most recent call last):
...
ValueError: input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)
sage: G = [K.random_element() for i in xrange(5)]
sage: maes.GF_to_binary(G)
Traceback (most recent call last):
...
KeyError:...
</pre></div>
</div>
<p>A matrix over <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">FiniteField</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_binary</span><span class="p">(</span><span class="n">MS</span><span class="o">.</span><span class="n">random_element</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.GF_to_integer">
<code class="descname">GF_to_integer</code><span class="sig-paren">(</span><em>G</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.GF_to_integer" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the integer representation of the finite field element <code class="docutils literal"><span class="pre">G</span></code>.
If <code class="docutils literal"><span class="pre">G</span></code> is an element of the finite field <span class="math">\(\GF{2^4}\)</span>, then
obtain the integer representation of <code class="docutils literal"><span class="pre">G</span></code>. If <code class="docutils literal"><span class="pre">G</span></code> is a list of
elements belonging to <span class="math">\(\GF{2^4}\)</span>, obtain the integer
representation of each element of the list, and return the result
as a list of integers. If <code class="docutils literal"><span class="pre">G</span></code> is a matrix with entries over
<span class="math">\(\GF{2^4}\)</span>, convert each matrix entry to its integer representation,
and return the result as a list of integers. The resulting list is
obtained by starting from the top-left corner of the matrix, working
across left to right, top to bottom. Each element of <span class="math">\(\GF{2^4}\)</span> can
be associated with a unique integer according to the following table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  integer &amp; $\GF{2^4}$ &amp; integer &amp; $\GF{2^4}$ \\\hline
  0 &amp; $0$           &amp; 8  &amp; $x^3$              \\
  1 &amp; $1$           &amp; 9  &amp; $x^3 + 1$          \\
  2 &amp; $x$           &amp; 10 &amp; $x^3 + x$          \\
  3 &amp; $x + 1$       &amp; 11 &amp; $x^3 + x + 1$      \\
  4 &amp; $x^2$         &amp; 12 &amp; $x^3 + x^2$        \\
  5 &amp; $x^2 + 1$     &amp; 13 &amp; $x^3 + x^2 + 1$    \\
  6 &amp; $x^2 + x$     &amp; 14 &amp; $x^3 + x^2 + x$    \\
  7 &amp; $x^2 + x + 1$ &amp; 15 &amp; $x^3 + x^2 + x+ 1$ \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">G</span></code> &#8211; an element of <span class="math">\(\GF{2^4}\)</span>, a list of elements belonging to
<span class="math">\(\GF{2^4}\)</span>, or a matrix over <span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>The integer representation of <code class="docutils literal"><span class="pre">G</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtain the integer representation of all elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">S</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">K</span><span class="p">);</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>  <span class="c1"># GF(2^4) has this many elements</span>
<span class="go">16</span>
<span class="gp">sage: </span><span class="p">[</span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">))]</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
</pre></div>
</div>
<p>The integer representation of a list of elements belonging to
<span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">)]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">[7, 12, 2, 11, 15, 6, 1, 7]</span>
</pre></div>
</div>
<p>The integer representation of a matrix over <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x&quot;</span><span class="p">)]);</span> <span class="n">G</span>

<span class="go">[    x^3 + x^2         x + 1]</span>
<span class="go">[  x^2 + x + 1 x^3 + x^2 + x]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">[12, 3, 7, 14]</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">)]);</span> <span class="n">G</span>

<span class="go">[      x^2 + x + 1         x^3 + x^2                 x       x^3 + x + 1]</span>
<span class="go">[x^3 + x^2 + x + 1           x^2 + x                 1       x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="go">[7, 12, 2, 11, 15, 6, 1, 7]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Input must be an element of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">G</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)</span>
</pre></div>
</div>
<p>A list of elements belonging to <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: maes.GF_to_integer([])
Traceback (most recent call last):
...
ValueError: input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)
sage: G = [K.random_element() for i in xrange(5)]
sage: maes.GF_to_integer(G)
Traceback (most recent call last):
...
KeyError:...
</pre></div>
</div>
<p>A matrix over <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">FiniteField</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">GF_to_integer</span><span class="p">(</span><span class="n">MS</span><span class="o">.</span><span class="n">random_element</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input G must be an element of GF(16), a list of elements of GF(16), or a matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.add_key">
<code class="descname">add_key</code><span class="sig-paren">(</span><em>block</em>, <em>rkey</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.add_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the matrix addition of <code class="docutils literal"><span class="pre">block</span></code> and <code class="docutils literal"><span class="pre">rkey</span></code>. Both <code class="docutils literal"><span class="pre">block</span></code>
and <code class="docutils literal"><span class="pre">rkey</span></code> are <span class="math">\(2 \times 2\)</span> matrices over the finite field
<span class="math">\(\GF{2^4}\)</span>. This method just return the matrix addition of
these two matrices.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block</span></code> &#8211; a <span class="math">\(2 \times 2\)</span> matrix with entries over
<span class="math">\(\GF{2^4}\)</span></li>
<li><code class="docutils literal"><span class="pre">rkey</span></code> &#8211; a round key; a <span class="math">\(2 \times 2\)</span> matrix with entries over
<span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>The matrix addition of <code class="docutils literal"><span class="pre">block</span></code> and <code class="docutils literal"><span class="pre">rkey</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>We can work with elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">D</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">D</span>

<span class="go">[x^3 + x^2 + x + 1           x^3 + x]</span>
<span class="go">[                0         x^3 + x^2]</span>
<span class="gp">sage: </span><span class="n">k</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">k</span>

<span class="go">[          x^2 + 1 x^3 + x^2 + x + 1]</span>
<span class="go">[            x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<span class="go">[  x^3 + x   x^2 + 1]</span>
<span class="go">[    x + 1 x^3 + x^2]</span>
</pre></div>
</div>
<p>Or work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;We&quot;</span><span class="p">);</span> <span class="n">B</span>
<span class="go">0101011101100101</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="n">B</span>

<span class="go">[    x^2 + 1 x^2 + x + 1]</span>
<span class="go">[    x^2 + x     x^2 + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;KY&quot;</span><span class="p">);</span> <span class="n">key</span>
<span class="go">0100101101011001</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[        x^2 x^3 + x + 1]</span>
<span class="go">[    x^2 + 1     x^3 + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="go">[        1 x^3 + x^2]</span>
<span class="go">[    x + 1 x^3 + x^2]</span>
</pre></div>
</div>
<p>We can also work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span> <span class="n">N</span>
<span class="go">[2, 3, 5, 7]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">];</span> <span class="n">key</span>
<span class="go">[9, 11, 13, 15]</span>
<span class="gp">sage: </span><span class="n">N</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">N</span><span class="p">));</span> <span class="n">N</span>

<span class="go">[          x       x + 1]</span>
<span class="go">[    x^2 + 1 x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[          x^3 + 1       x^3 + x + 1]</span>
<span class="go">[    x^3 + x^2 + 1 x^3 + x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="go">[x^3 + x + 1         x^3]</span>
<span class="go">[        x^3         x^3]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block and key must each be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MSB</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MSB</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">round key must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrices must each be
<span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">MSB</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MSB</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">MSB</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MSB</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">MSK</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MSK</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">add_key</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">round key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.binary_to_GF">
<code class="descname">binary_to_GF</code><span class="sig-paren">(</span><em>B</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.binary_to_GF" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of elements of <span class="math">\(\GF{2^4}\)</span> that represents the
binary string <code class="docutils literal"><span class="pre">B</span></code>. The number of bits in <code class="docutils literal"><span class="pre">B</span></code> must be greater
than zero and a multiple of 4. Each nibble (or 4-bit string) is
uniquely associated with an element of <span class="math">\(\GF{2^4}\)</span> as
specified by the following table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  4-bit string &amp; $\GF{2^4}$ &amp; 4-bit string &amp; $\GF{2^4}$ \\\hline
  0000 &amp; $0$           &amp; 1000 &amp; $x^3$              \\
  0001 &amp; $1$           &amp; 1001 &amp; $x^3 + 1$          \\
  0010 &amp; $x$           &amp; 1010 &amp; $x^3 + x$          \\
  0011 &amp; $x + 1$       &amp; 1011 &amp; $x^3 + x + 1$      \\
  0100 &amp; $x^2$         &amp; 1100 &amp; $x^3 + x^2$        \\
  0101 &amp; $x^2 + 1$     &amp; 1101 &amp; $x^3 + x^2 + 1$    \\
  0110 &amp; $x^2 + x$     &amp; 1110 &amp; $x^3 + x^2 + x$    \\
  0111 &amp; $x^2 + x + 1$ &amp; 1111 &amp; $x^3 + x^2 + x+ 1$ \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">B</span></code> &#8211; a binary string, where the number of bits is positive and
a multiple of 4</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A list of elements of the finite field <span class="math">\(\GF{2^4}\)</span> that
represent the binary string <code class="docutils literal"><span class="pre">B</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtain all the elements of the finite field <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="s2">&quot;0000000100100011010001010110011110001001101010111100110111101111&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="go">[0,</span>
<span class="go">1,</span>
<span class="go">x,</span>
<span class="go">x + 1,</span>
<span class="go">x^2,</span>
<span class="go">x^2 + 1,</span>
<span class="go">x^2 + x,</span>
<span class="go">x^2 + x + 1,</span>
<span class="go">x^3,</span>
<span class="go">x^3 + 1,</span>
<span class="go">x^3 + x,</span>
<span class="go">x^3 + x + 1,</span>
<span class="go">x^3 + x^2,</span>
<span class="go">x^3 + x^2 + 1,</span>
<span class="go">x^3 + x^2 + x,</span>
<span class="go">x^3 + x^2 + x + 1]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input <code class="docutils literal"><span class="pre">B</span></code> must be a non-empty binary string, where the number
of bits is a multiple of 4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the number of bits in the binary string B must be positive and a multiple of 4</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="s2">&quot;101&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the number of bits in the binary string B must be positive and a multiple of 4</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.binary_to_integer">
<code class="descname">binary_to_integer</code><span class="sig-paren">(</span><em>B</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.binary_to_integer" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of integers representing the binary string <code class="docutils literal"><span class="pre">B</span></code>. The
number of bits in <code class="docutils literal"><span class="pre">B</span></code> must be greater than zero and a multiple of
4. Each nibble (or 4-bit string) is uniquely associated with an
integer as specified by the following table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  4-bit string &amp; integer &amp; 4-bit string &amp; integer \\\hline
  0000 &amp; 0 &amp; 1000 &amp; 8  \\
  0001 &amp; 1 &amp; 1001 &amp; 9  \\
  0010 &amp; 2 &amp; 1010 &amp; 10 \\
  0011 &amp; 3 &amp; 1011 &amp; 11 \\
  0100 &amp; 4 &amp; 1100 &amp; 12 \\
  0101 &amp; 5 &amp; 1101 &amp; 13 \\
  0110 &amp; 6 &amp; 1110 &amp; 14 \\
  0111 &amp; 7 &amp; 1111 &amp; 15 \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">B</span></code> &#8211; a binary string, where the number of bits is positive and
a multiple of 4</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A list of integers that represent the binary string <code class="docutils literal"><span class="pre">B</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtain the integer representation of every 4-bit string:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="s2">&quot;0000000100100011010001010110011110001001101010111100110111101111&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_integer</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input <code class="docutils literal"><span class="pre">B</span></code> must be a non-empty binary string, where the number
of bits is a multiple of 4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_integer</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the number of bits in the binary string B must be positive and a multiple of 4</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_integer</span><span class="p">(</span><span class="s2">&quot;101&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the number of bits in the binary string B must be positive and a multiple of 4</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.block_length">
<code class="descname">block_length</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.block_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the block length of Phan&#8217;s Mini-AES block cipher. A key in
Phan&#8217;s Mini-AES is a block of 16 bits. Each nibble of a key can be
considered as an element of the finite field <span class="math">\(\GF{2^4}\)</span>.
Therefore the key consists of four elements from <span class="math">\(\GF{2^4}\)</span>.</p>
<p>OUTPUT:</p>
<ul class="simple">
<li>The block (or key) length in number of bits.</li>
</ul>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">block_length</span><span class="p">()</span>
<span class="go">16</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.decrypt">
<code class="descname">decrypt</code><span class="sig-paren">(</span><em>C</em>, <em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.decrypt" title="Permalink to this definition">¶</a></dt>
<dd><p>Use Phan&#8217;s Mini-AES to decrypt the ciphertext <code class="docutils literal"><span class="pre">C</span></code> with the secret
key <code class="docutils literal"><span class="pre">key</span></code>. Both <code class="docutils literal"><span class="pre">C</span></code> and <code class="docutils literal"><span class="pre">key</span></code> must be <span class="math">\(2 \times 2\)</span> matrices over
the finite field <span class="math">\(\GF{2^4}\)</span>. Let <span class="math">\(\gamma\)</span> denote the
operation of nibble-sub, <span class="math">\(\pi\)</span> denote shift-row, <span class="math">\(\theta\)</span> denote
mix-column, and <span class="math">\(\sigma_{K_i}\)</span> denote add-key with the round key
<span class="math">\(K_i\)</span>. Then decryption <span class="math">\(D\)</span> using Phan&#8217;s Mini-AES is the function
composition</p>
<div class="math">
\[D = \sigma_{K_0} \circ \gamma^{-1} \circ \pi \circ \theta \circ \sigma_{K_1} \circ \gamma^{-1} \circ \pi \circ \sigma_{K_2}\]</div>
<p>where <span class="math">\(\gamma^{-1}\)</span> is the nibble-sub operation that uses the S-box
for decryption, and the order of execution is from right to left.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">C</span></code> &#8211; a ciphertext block; must be a <span class="math">\(2 \times 2\)</span> matrix over
the finite field <span class="math">\(\GF{2^4}\)</span></li>
<li><code class="docutils literal"><span class="pre">key</span></code> &#8211; a secret key for this Mini-AES block cipher; must be a
<span class="math">\(2 \times 2\)</span> matrix over the finite field <span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>The plaintext corresponding to <code class="docutils literal"><span class="pre">C</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>We encrypt a plaintext, decrypt the ciphertext, then compare the
decrypted plaintext with the original plaintext. Here we work with
elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">P</span>

<span class="go">[  x^3 + 1   x^2 + x]</span>
<span class="go">[x^3 + x^2     x + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">key</span>

<span class="go">[        x^3 + x^2 x^3 + x^2 + x + 1]</span>
<span class="go">[            x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="n">C</span>

<span class="go">[x^2 + x + 1   x^3 + x^2]</span>
<span class="go">[          x     x^2 + x]</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span><span class="p">;</span> <span class="n">P</span>

<span class="go">[  x^3 + 1   x^2 + x]</span>
<span class="go">[x^3 + x^2     x + 1]</span>

<span class="go">[  x^3 + 1   x^2 + x]</span>
<span class="go">[x^3 + x^2     x + 1]</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>But we can also work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">);</span> <span class="n">P</span>
<span class="go">0110010001100101</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[x^2 + x     x^2]</span>
<span class="go">[x^2 + x x^2 + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;ke&quot;</span><span class="p">);</span> <span class="n">key</span>
<span class="go">0110101101100101</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[    x^2 + x x^3 + x + 1]</span>
<span class="go">[    x^2 + x     x^2 + 1]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Here we work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">];</span> <span class="n">P</span>
<span class="go">[3, 5, 7, 14]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">];</span> <span class="n">key</span>
<span class="go">[2, 6, 7, 8]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[        x + 1       x^2 + 1]</span>
<span class="go">[  x^2 + x + 1 x^3 + x^2 + x]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[          x     x^2 + x]</span>
<span class="go">[x^2 + x + 1         x^3]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">ciphertext block must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrices must be
<span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">ciphertext block must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">MSC</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">MSC</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">MSK</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MSK</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.encrypt">
<code class="descname">encrypt</code><span class="sig-paren">(</span><em>P</em>, <em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.encrypt" title="Permalink to this definition">¶</a></dt>
<dd><p>Use Phan&#8217;s Mini-AES to encrypt the plaintext <code class="docutils literal"><span class="pre">P</span></code> with the secret
key <code class="docutils literal"><span class="pre">key</span></code>. Both <code class="docutils literal"><span class="pre">P</span></code> and <code class="docutils literal"><span class="pre">key</span></code> must be <span class="math">\(2 \times 2\)</span> matrices
over the finite field <span class="math">\(\GF{2^4}\)</span>. Let <span class="math">\(\gamma\)</span> denote the
operation of nibble-sub, <span class="math">\(\pi\)</span> denote shift-row, <span class="math">\(\theta\)</span> denote
mix-column, and <span class="math">\(\sigma_{K_i}\)</span> denote add-key with the round key
<span class="math">\(K_i\)</span>. Then encryption <span class="math">\(E\)</span> using Phan&#8217;s Mini-AES is the function
composition</p>
<div class="math">
\[E = \sigma_{K_2} \circ \pi \circ \gamma \circ \sigma_{K_1} \circ \theta \circ \pi \circ \gamma \circ \sigma_{K_0}\]</div>
<p>where the order of execution is from right to left. Note that
<span class="math">\(\gamma\)</span> is the nibble-sub operation that uses the S-box for
encryption.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">P</span></code> &#8211; a plaintext block; must be a <span class="math">\(2 \times 2\)</span> matrix over
the finite field <span class="math">\(\GF{2^4}\)</span></li>
<li><code class="docutils literal"><span class="pre">key</span></code> &#8211; a secret key for this Mini-AES block cipher; must be a
<span class="math">\(2 \times 2\)</span> matrix over the finite field <span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>The ciphertext corresponding to <code class="docutils literal"><span class="pre">P</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Here we work with elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">P</span>

<span class="go">[  x^3 + 1   x^2 + x]</span>
<span class="go">[x^3 + x^2     x + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">]);</span> <span class="n">key</span>

<span class="go">[        x^3 + x^2 x^3 + x^2 + x + 1]</span>
<span class="go">[            x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="go">[x^2 + x + 1   x^3 + x^2]</span>
<span class="go">[          x     x^2 + x]</span>
</pre></div>
</div>
<p>But we can also work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">);</span> <span class="n">P</span>
<span class="go">0110010001100101</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[x^2 + x     x^2]</span>
<span class="go">[x^2 + x x^2 + 1]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;ke&quot;</span><span class="p">);</span> <span class="n">key</span>
<span class="go">0110101101100101</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[    x^2 + x x^3 + x + 1]</span>
<span class="go">[    x^2 + x     x^2 + 1]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Now we work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">];</span> <span class="n">P</span>
<span class="go">[1, 5, 8, 12]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span> <span class="n">key</span>
<span class="go">[5, 9, 15, 0]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[        1   x^2 + 1]</span>
<span class="go">[      x^3 x^3 + x^2]</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">key</span><span class="p">));</span> <span class="n">key</span>

<span class="go">[          x^2 + 1           x^3 + 1]</span>
<span class="go">[x^3 + x^2 + x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">plaintext block must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrices must be
<span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">plaintext block must be a 2 x 2 matrix over GF(16)</span>
<span class="gp">sage: </span><span class="n">MSP</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MSP</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">MSK</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MSK</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.integer_to_GF">
<code class="descname">integer_to_GF</code><span class="sig-paren">(</span><em>N</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.integer_to_GF" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the finite field representation of <code class="docutils literal"><span class="pre">N</span></code>. If <span class="math">\(N\)</span> is an
integer such that <span class="math">\(0 \leq N \leq 15\)</span>, return the element of
<span class="math">\(\GF{2^4}\)</span> that represents <code class="docutils literal"><span class="pre">N</span></code>. If <code class="docutils literal"><span class="pre">N</span></code> is a list of integers
each of which is <span class="math">\(\geq 0\)</span> and <span class="math">\(\leq 15\)</span>, then obtain the element
of <span class="math">\(\GF{2^4}\)</span> that represents each such integer, and return a list
of such finite field representations. Each integer between 0 and 15,
inclusive, can be associated with a unique element of <span class="math">\(\GF{2^4}\)</span>
according to the following table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  integer &amp; $\GF{2^4}$ &amp; integer &amp; $\GF{2^4}$ \\\hline
  0 &amp; $0$           &amp; 8  &amp; $x^3$              \\
  1 &amp; $1$           &amp; 9  &amp; $x^3 + 1$          \\
  2 &amp; $x$           &amp; 10 &amp; $x^3 + x$          \\
  3 &amp; $x + 1$       &amp; 11 &amp; $x^3 + x + 1$      \\
  4 &amp; $x^2$         &amp; 12 &amp; $x^3 + x^2$        \\
  5 &amp; $x^2 + 1$     &amp; 13 &amp; $x^3 + x^2 + 1$    \\
  6 &amp; $x^2 + x$     &amp; 14 &amp; $x^3 + x^2 + x$    \\
  7 &amp; $x^2 + x + 1$ &amp; 15 &amp; $x^3 + x^2 + x+ 1$ \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">N</span></code> &#8211; a non-negative integer less than or equal to 15, or a list
of such integers</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>Elements of the finite field <span class="math">\(\GF{2^4}\)</span>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtain the element of <span class="math">\(\GF{2^4}\)</span> representing an integer <span class="math">\(n\)</span>, where
<span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">x</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">x^2 + x + 1</span>
</pre></div>
</div>
<p>Obtain the finite field elements corresponding to all non-negative
integers less than or equal to 15:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">)];</span> <span class="n">lst</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

<span class="go">[0,</span>
<span class="go">1,</span>
<span class="go">x,</span>
<span class="go">x + 1,</span>
<span class="go">x^2,</span>
<span class="go">x^2 + 1,</span>
<span class="go">x^2 + x,</span>
<span class="go">x^2 + x + 1,</span>
<span class="go">x^3,</span>
<span class="go">x^3 + 1,</span>
<span class="go">x^3 + x,</span>
<span class="go">x^3 + x + 1,</span>
<span class="go">x^3 + x^2,</span>
<span class="go">x^3 + x^2 + 1,</span>
<span class="go">x^3 + x^2 + x,</span>
<span class="go">x^3 + x^2 + x + 1]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input <code class="docutils literal"><span class="pre">N</span></code> can be an integer, but it must be such that
<span class="math">\(0 \leq N \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: from sage.crypto.block_cipher.miniaes import MiniAES
sage: maes = MiniAES()
sage: maes.integer_to_GF(-1)
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_GF(16)
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_GF(&quot;2&quot;)
Traceback (most recent call last):
...
TypeError: N must be an integer 0 &lt;= N &lt;= 15 or a list of such integers
</pre></div>
</div>
<p>The input <code class="docutils literal"><span class="pre">N</span></code> can be a list of integers, but each integer <span class="math">\(n\)</span> in
the list must be bounded such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: maes.integer_to_GF([])
Traceback (most recent call last):
...
ValueError: N must be an integer 0 &lt;= N &lt;= 15 or a list of such integers
sage: maes.integer_to_GF([&quot;&quot;])
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_GF([0, 2, 3, &quot;4&quot;])
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_GF([0, 2, 3, 16])
Traceback (most recent call last):
...
KeyError:...
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.integer_to_binary">
<code class="descname">integer_to_binary</code><span class="sig-paren">(</span><em>N</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.integer_to_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the binary representation of <code class="docutils literal"><span class="pre">N</span></code>. If <span class="math">\(N\)</span> is an integer such
that <span class="math">\(0 \leq N \leq 15\)</span>, return the binary representation of <code class="docutils literal"><span class="pre">N</span></code>.
If <code class="docutils literal"><span class="pre">N</span></code> is a list of integers each of which is <span class="math">\(\geq 0\)</span> and
<span class="math">\(\leq 15\)</span>, then obtain the binary representation of each integer,
and concatenate the individual binary representations into a single
binary string. Each integer between 0 and 15, inclusive, can be
associated with a unique 4-bit string according to the following
table:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  4-bit string &amp; integer &amp; 4-bit string &amp; integer \\\hline
  0000 &amp; 0 &amp; 1000 &amp; 8  \\
  0001 &amp; 1 &amp; 1001 &amp; 9  \\
  0010 &amp; 2 &amp; 1010 &amp; 10 \\
  0011 &amp; 3 &amp; 1011 &amp; 11 \\
  0100 &amp; 4 &amp; 1100 &amp; 12 \\
  0101 &amp; 5 &amp; 1101 &amp; 13 \\
  0110 &amp; 6 &amp; 1110 &amp; 14 \\
  0111 &amp; 7 &amp; 1111 &amp; 15 \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">N</span></code> &#8211; a non-negative integer less than or equal to 15, or a list
of such integers</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A binary string representing <code class="docutils literal"><span class="pre">N</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>The binary representations of all integers between 0 and
15, inclusive:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">)];</span> <span class="n">lst</span>
<span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
<span class="go">0000000100100011010001010110011110001001101010111100110111101111</span>
</pre></div>
</div>
<p>The binary representation of an integer between 0 and 15,
inclusive:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">0011</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">0101</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_binary</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">0111</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input <code class="docutils literal"><span class="pre">N</span></code> can be an integer, but must be bounded such that
<span class="math">\(0 \leq N \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: from sage.crypto.block_cipher.miniaes import MiniAES
sage: maes = MiniAES()
sage: maes.integer_to_binary(-1)
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_binary(&quot;1&quot;)
Traceback (most recent call last):
...
TypeError: N must be an integer 0 &lt;= N &lt;= 15 or a list of such integers
sage: maes.integer_to_binary(&quot;&quot;)
Traceback (most recent call last):
...
TypeError: N must be an integer 0 &lt;= N &lt;= 15 or a list of such integers
</pre></div>
</div>
<p>The input <code class="docutils literal"><span class="pre">N</span></code> can be a list of integers, but each integer <span class="math">\(n\)</span> of
the list must be <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: from sage.crypto.block_cipher.miniaes import MiniAES
sage: maes = MiniAES()
sage: maes.integer_to_binary([])
Traceback (most recent call last):
...
ValueError: N must be an integer 0 &lt;= N &lt;= 15 or a list of such integers
sage: maes.integer_to_binary([&quot;&quot;])
Traceback (most recent call last):
...
KeyError:...
sage: maes.integer_to_binary([0, 1, 2, 16])
Traceback (most recent call last):
...
KeyError:...
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.mix_column">
<code class="descname">mix_column</code><span class="sig-paren">(</span><em>block</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.mix_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the matrix multiplication of <code class="docutils literal"><span class="pre">block</span></code> with a constant matrix.
The constant matrix is</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
  x + 1 &amp; x \\
  x     &amp; x + 1
\end{bmatrix}\end{split}\]</div>
<p>If the input block is</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
  c_0 &amp; c_2 \\
  c_1 &amp; c_3
\end{bmatrix}\end{split}\]</div>
<p>then the output block is</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
  d_0 &amp; d_2 \\
  d_1 &amp; d_3
\end{bmatrix}
=
\begin{bmatrix}
  x + 1 &amp; x \\
  x     &amp; x + 1
\end{bmatrix}
\begin{bmatrix}
  c_0 &amp; c_2 \\
  c_1 &amp; c_3
\end{bmatrix}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block</span></code> &#8211; a <span class="math">\(2 \times 2\)</span> matrix with entries over
<span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A <span class="math">\(2 \times 2\)</span> matrix resulting from multiplying the above constant
matrix with the input matrix <code class="docutils literal"><span class="pre">block</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Here we work with elements of <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>

<span class="go">[          x^3 + x                 0]</span>
<span class="go">[          x^2 + 1 x^3 + x^2 + x + 1]</span>
</pre></div>
</div>
<p>Multiplying by the identity matrix should leave the constant matrix
unchanged:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">eye</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="n">eye</span><span class="p">)</span>

<span class="go">[x + 1     x]</span>
<span class="go">[    x x + 1]</span>
</pre></div>
</div>
<p>We can also work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;rT&quot;</span><span class="p">);</span> <span class="n">B</span>
<span class="go">0111001001010100</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="n">B</span>

<span class="go">[x^2 + x + 1           x]</span>
<span class="go">[    x^2 + 1         x^2]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="go">[        x + 1 x^3 + x^2 + x]</span>
<span class="go">[            1           x^3]</span>
</pre></div>
</div>
<p>We can also work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span> <span class="n">P</span>
<span class="go">[10, 5, 2, 7]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[    x^3 + x     x^2 + 1]</span>
<span class="go">[          x x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="go">[x^3 + 1       1]</span>
<span class="go">[      1   x + 1]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="s2">&quot;mat&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrix must be <span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">mix_column</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.nibble_sub">
<code class="descname">nibble_sub</code><span class="sig-paren">(</span><em>block</em>, <em>algorithm='encrypt'</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.nibble_sub" title="Permalink to this definition">¶</a></dt>
<dd><p>Substitute a nibble (or a block of 4 bits) using the following S-box:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll|ll} \hline
  Input &amp; Output &amp; Input &amp; Output \\\hline
  0000  &amp; 1110   &amp; 1000  &amp; 0011   \\
  0001  &amp; 0100   &amp; 1001  &amp; 1010   \\
  0010  &amp; 1101   &amp; 1010  &amp; 0110   \\
  0011  &amp; 0001   &amp; 1011  &amp; 1100   \\
  0100  &amp; 0010   &amp; 1100  &amp; 0101   \\
  0101  &amp; 1111   &amp; 1101  &amp; 1001   \\
  0110  &amp; 1011   &amp; 1110  &amp; 0000   \\
  0111  &amp; 1000   &amp; 1111  &amp; 0111   \\\hline
\end{tabular}\end{split}\]</div>
<p>The values in the above S-box are taken from the first row of the first
S-box of the Data Encryption Standard (DES). Each nibble can be
thought of as an element of the finite field <span class="math">\(\GF{2^4}\)</span> of 16
elements. Thus in terms of <span class="math">\(\GF{2^4}\)</span>, the S-box can also be
specified as:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll} \hline
  Input                &amp; Output               \\\hline
  $0$                  &amp;  $x^3 + x^2 + x$     \\
  $1$                  &amp;  $x^2$               \\
  $x$                  &amp;  $x^3 + x^2 + 1$     \\
  $x + 1$              &amp;  $1$                 \\
  $x^2$                &amp;  $x$                 \\
  $x^2 + 1$            &amp;  $x^3 + x^2 + x + 1$ \\
  $x^2 + x$            &amp;  $x^3 + x + 1$       \\
  $x^2 + x + 1$        &amp;  $x^3$               \\
  $x^3$                &amp;  $x + 1$             \\
  $x^3 + 1$            &amp;  $x^3 + x$           \\
  $x^3 + x$            &amp;  $x^2 + x$           \\
  $x^3 + x + 1$        &amp;  $x^3 + x^2$         \\
  $x^3 + x^2$          &amp;  $x^2 + 1$           \\
  $x^3 + x^2 + 1$      &amp;  $x^3 + 1$           \\
  $x^3 + x^2 + x$      &amp;  $0$                 \\
  $x^3 + x^2 + x + 1$  &amp;  $x^2 + x + 1$       \\\hline
\end{tabular}\end{split}\]</div>
<p>Note that the above S-box is used for encryption. The S-box for
decryption is obtained from the above S-box by reversing the role of
the Input and Output columns. Thus the previous Input column for
encryption now becomes the Output column for decryption, and the
previous Output column for encryption is now the Input column for
decryption. The S-box used for decryption can be specified as:</p>
<div class="math">
\[\begin{split}\begin{tabular}{ll} \hline
  Input               &amp; Output              \\\hline
  $0$                 &amp; $x^3 + x^2 + x$     \\
  $1$                 &amp; $x + 1$             \\
  $x$                 &amp; $x^2$               \\
  $x + 1$             &amp; $x^3$               \\
  $x^2$               &amp; $1$                 \\
  $x^2 + 1$           &amp; $x^3 + x^2$         \\
  $x^2 + x$           &amp; $x^3 + x$           \\
  $x^2 + x + 1$       &amp; $x^3 + x^2 + x + 1$ \\
  $x^3$               &amp; $x^2 + x + 1$       \\
  $x^3 + 1$           &amp; $x^3 + x^2 + 1$     \\
  $x^3 + x$           &amp; $x^3 + 1$           \\
  $x^3 + x + 1$       &amp; $x^2 + x$           \\
  $x^3 + x^2$         &amp; $x^3 + x + 1$       \\
  $x^3 + x^2 + 1$     &amp; $x$                 \\
  $x^3 + x^2 + x$     &amp; $0$                 \\
  $x^3 + x^2 + x + 1$ &amp; $x^2 + 1$           \\\hline
\end{tabular}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block</span></code> &#8211; a <span class="math">\(2 \times 2\)</span> matrix with entries over
<span class="math">\(\GF{2^4}\)</span></li>
<li><code class="docutils literal"><span class="pre">algorithm</span></code> &#8211; (default: <code class="docutils literal"><span class="pre">&quot;encrypt&quot;</span></code>) a string; a flag to signify
whether this nibble-sub operation is used for encryption or
decryption. The encryption flag is <code class="docutils literal"><span class="pre">&quot;encrypt&quot;</span></code> and the decryption
flag is <code class="docutils literal"><span class="pre">&quot;decrypt&quot;</span></code>.</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A <span class="math">\(2 \times 2\)</span> matrix resulting from applying an S-box on
entries of the <span class="math">\(2 \times 2\)</span> matrix <code class="docutils literal"><span class="pre">block</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Here we work with elements of the finite field <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;encrypt&quot;</span><span class="p">)</span>

<span class="go">[  x^2 + x + 1 x^3 + x^2 + x]</span>
<span class="go">[          x^3       x^2 + x]</span>
</pre></div>
</div>
<p>But we can also work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;bi&quot;</span><span class="p">);</span> <span class="n">B</span>
<span class="go">0110001001101001</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="n">B</span>

<span class="go">[x^2 + x       x]</span>
<span class="go">[x^2 + x x^3 + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;encrypt&quot;</span><span class="p">)</span>

<span class="go">[  x^3 + x + 1 x^3 + x^2 + 1]</span>
<span class="go">[  x^3 + x + 1       x^3 + x]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;decrypt&quot;</span><span class="p">)</span>

<span class="go">[      x^3 + x           x^2]</span>
<span class="go">[      x^3 + x x^3 + x^2 + 1]</span>
</pre></div>
</div>
<p>Here we work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">];</span> <span class="n">P</span>
<span class="go">[2, 6, 8, 14]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[            x       x^2 + x]</span>
<span class="go">[          x^3 x^3 + x^2 + x]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;encrypt&quot;</span><span class="p">)</span>

<span class="go">[x^3 + x^2 + 1   x^3 + x + 1]</span>
<span class="go">[        x + 1             0]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;decrypt&quot;</span><span class="p">)</span>

<span class="go">[        x^2     x^3 + x]</span>
<span class="go">[x^2 + x + 1           0]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="s2">&quot;mat&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrix must be <span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>The value for the option <code class="docutils literal"><span class="pre">algorithm</span></code> must be either the string
<code class="docutils literal"><span class="pre">&quot;encrypt&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;decrypt&quot;</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the algorithm for nibble-sub must be either &#39;encrypt&#39; or &#39;decrypt&#39;</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the algorithm for nibble-sub must be either &#39;encrypt&#39; or &#39;decrypt&#39;</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">nibble_sub</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">the algorithm for nibble-sub must be either &#39;encrypt&#39; or &#39;decrypt&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.random_key">
<code class="descname">random_key</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.random_key" title="Permalink to this definition">¶</a></dt>
<dd><p>A random key within the key space of this Mini-AES block cipher. Like
the AES, Phan&#8217;s Mini-AES is a symmetric-key block cipher. A Mini-AES
key is a block of 16 bits, or a <span class="math">\(2 \times 2\)</span> matrix with entries over
the finite field <span class="math">\(\GF{2^4}\)</span>. Thus the number of possible keys is
<span class="math">\(2^{16} = 16^4\)</span>.</p>
<p>OUTPUT:</p>
<ul class="simple">
<li>A <span class="math">\(2 \times 2\)</span> matrix over the finite field <span class="math">\(\GF{2^4}\)</span>, used
as a secret key for this Mini-AES block cipher.</li>
</ul>
<p>EXAMPLES:</p>
<p>Each nibble of a key is an element of the finite field
<span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">random_key</span><span class="p">()</span>
<span class="gp">sage: </span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">K</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">nrows</span><span class="p">())</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">ncols</span><span class="p">())]</span>
<span class="go">[True, True, True, True]</span>
</pre></div>
</div>
<p>Generate a random key, then perform encryption and decryption using
that key:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">random_key</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">C</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">=</span> <span class="n">maes</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">plaintxt</span> <span class="o">==</span> <span class="n">P</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.round_key">
<code class="descname">round_key</code><span class="sig-paren">(</span><em>key</em>, <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.round_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the round key for round <code class="docutils literal"><span class="pre">n</span></code>. Phan&#8217;s Mini-AES is defined to
have two rounds. The round key <span class="math">\(K_0\)</span> is generated and used prior to
the first round, with round keys <span class="math">\(K_1\)</span> and <span class="math">\(K_2\)</span> being used in rounds
1 and 2 respectively. In total, there are three round keys, each
generated from the secret key <code class="docutils literal"><span class="pre">key</span></code>.</p>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">key</span></code> &#8211; the secret key</li>
<li><code class="docutils literal"><span class="pre">n</span></code> &#8211; non-negative integer; the round number</li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>The <span class="math">\(n\)</span>-th round key.</li>
</ul>
<p>EXAMPLES:</p>
<p>Obtaining the round keys from the secret key:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="go">[        x^3 + x^2 x^3 + x^2 + x + 1]</span>
<span class="go">[            x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">key</span>

<span class="go">[        x^3 + x^2 x^3 + x^2 + x + 1]</span>
<span class="go">[            x + 1                 0]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="go">[            x + 1 x^3 + x^2 + x + 1]</span>
<span class="go">[                0 x^3 + x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="go">[x^2 + x x^3 + 1]</span>
<span class="go">[x^2 + x x^2 + x]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>Only two rounds are defined for this AES variant:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]</span> <span class="p">])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Mini-AES only defines two rounds</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Mini-AES only defines two rounds</span>
</pre></div>
</div>
<p>The input key must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the key matrix must be <span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">key</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">round_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">secret key must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.sbox">
<code class="descname">sbox</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.sbox" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the S-box of Mini-AES.</p>
<p>EXAMPLES:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">sbox</span><span class="p">()</span>
<span class="go">(14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sage.crypto.block_cipher.miniaes.MiniAES.shift_row">
<code class="descname">shift_row</code><span class="sig-paren">(</span><em>block</em><span class="sig-paren">)</span><a class="headerlink" href="#sage.crypto.block_cipher.miniaes.MiniAES.shift_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotate each row of <code class="docutils literal"><span class="pre">block</span></code> to the left by different nibble
amounts. The first or zero-th row is left unchanged, while the
second or row one is rotated left by one nibble. This has the effect
of only interchanging the nibbles in the second row. Let
<span class="math">\(b_0, b_1, b_2, b_3\)</span> be four nibbles arranged as the following
<span class="math">\(2 \times 2\)</span> matrix</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
  b_0 &amp; b_2 \\
  b_1 &amp; b_3
\end{bmatrix}\end{split}\]</div>
<p>Then the operation of shift-row is the mapping</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
  b_0 &amp; b_2 \\
  b_1 &amp; b_3
\end{bmatrix}
\longmapsto
\begin{bmatrix}
  b_0 &amp; b_2 \\
  b_3 &amp; b_1
\end{bmatrix}\end{split}\]</div>
<p>INPUT:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block</span></code> &#8211; a <span class="math">\(2 \times 2\)</span> matrix with entries over
<span class="math">\(\GF{2^4}\)</span></li>
</ul>
<p>OUTPUT:</p>
<ul class="simple">
<li>A <span class="math">\(2 \times 2\)</span> matrix resulting from applying shift-row on <code class="docutils literal"><span class="pre">block</span></code>.</li>
</ul>
<p>EXAMPLES:</p>
<p>Here we work with elements of the finite field <span class="math">\(\GF{2^4}\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">shift_row</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>

<span class="go">[x^3 + x^2 + x + 1                 0]</span>
<span class="go">[          x^3 + x       x^2 + x + 1]</span>
<span class="gp">sage: </span><span class="n">mat</span>

<span class="go">[x^3 + x^2 + x + 1                 0]</span>
<span class="go">[      x^2 + x + 1           x^3 + x]</span>
</pre></div>
</div>
<p>But we can also work with binary strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">bin</span> <span class="o">=</span> <span class="n">BinaryStrings</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">encoding</span><span class="p">(</span><span class="s2">&quot;Qt&quot;</span><span class="p">);</span> <span class="n">B</span>
<span class="go">0101000101110100</span>
<span class="gp">sage: </span><span class="n">B</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">binary_to_GF</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="n">B</span>

<span class="go">[    x^2 + 1           1]</span>
<span class="go">[x^2 + x + 1         x^2]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">shift_row</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="go">[    x^2 + 1           1]</span>
<span class="go">[        x^2 x^2 + x + 1]</span>
</pre></div>
</div>
<p>Here we work with integers <span class="math">\(n\)</span> such that <span class="math">\(0 \leq n \leq 15\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">];</span> <span class="n">P</span>
<span class="go">[3, 6, 9, 12]</span>
<span class="gp">sage: </span><span class="n">P</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">maes</span><span class="o">.</span><span class="n">integer_to_GF</span><span class="p">(</span><span class="n">P</span><span class="p">));</span> <span class="n">P</span>

<span class="go">[    x + 1   x^2 + x]</span>
<span class="go">[  x^3 + 1 x^3 + x^2]</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">shift_row</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="go">[    x + 1   x^2 + x]</span>
<span class="go">[x^3 + x^2   x^3 + 1]</span>
</pre></div>
</div>
<p>TESTS:</p>
<p>The input block must be a matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.crypto.block_cipher.miniaes</span> <span class="kn">import</span> <span class="n">MiniAES</span>
<span class="gp">sage: </span><span class="n">maes</span> <span class="o">=</span> <span class="n">MiniAES</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">shift_row</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
<p>In addition, the dimensions of the input matrix must be <span class="math">\(2 \times 2\)</span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">K</span> <span class="o">=</span> <span class="n">FiniteField</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">MS</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">mat</span> <span class="o">=</span> <span class="n">MS</span><span class="p">([[</span><span class="n">K</span><span class="p">(</span><span class="s2">&quot;x^3 + x^2 + x + 1&quot;</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)]])</span>
<span class="gp">sage: </span><span class="n">maes</span><span class="o">.</span><span class="n">shift_row</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">input block must be a 2 x 2 matrix over GF(16)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="sdes.html"
                                  title="previous chapter">Simplified DES</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../public_key/blum_goldwasser.html"
                                  title="next chapter">Blum-Goldwasser Probabilistic Encryption</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../../_sources/sage/crypto/block_cipher/miniaes.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../../search.html" method="get">
                <input type="text" name="q" size="18" />
               <!-- The shading of the "Go" button should be consistent -->
               <!-- with the colour of the header and footer. See the file -->
               <!-- doc/common/themes/sage/theme.conf for colours used by -->
               <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../public_key/blum_goldwasser.html" title="Blum-Goldwasser Probabilistic Encryption"
             >next</a> |</li>
        <li class="right" >
          <a href="sdes.html" title="Simplified DES"
             >previous</a> |</li>
  
    
      <a href="../../../../../index.html"><img src="../../../../_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="../../../index.html">Cryptography</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005--2016, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>