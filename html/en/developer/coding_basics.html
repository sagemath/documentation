<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="The reviewer’s check list" href="reviewer_checklist.html" /><link rel="prev" title="Setting up your workspace" href="workspace.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>General Conventions - Developer&#39;s Guide</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZGD13B5572"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ZGD13B5572');
</script></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Developer's Guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 9.8 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="index.html">Home - Developer's Guide</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="git_setup.html">Setting Up Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="walk_through.html">Sage Development Process</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="trac.html">The Sage Trac Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual_git.html">Using Git with the Sage Trac Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_background.html">Tips and References</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_git.html">Advanced Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Distributed Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_trac.html">Optional: Using the Git-Trac Command</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="workspace.html">Setting up your workspace</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">General Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="reviewer_checklist.html">The reviewer’s check list</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="doctesting.html">Running Sage’s doctests</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="portability_testing.html">Testing on multiple platforms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Additional development and testing tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sage_manuals.html">The Sage Manuals</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coding_in_python.html">Coding in Python for Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_in_cython.html">Coding in Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_in_other.html">Using External Libraries and Interfaces</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="packaging_sage_library.html">Packaging the Sage Library</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging Third-Party Code</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="general-conventions">
<span id="chapter-code-basics"></span><h1>General Conventions<a class="headerlink" href="#general-conventions" title="Permalink to this heading">#</a></h1>
<p>There are many ways to contribute to Sage including sharing scripts
and Sage worksheets that implement new functionality using Sage,
improving to the Sage library, or to working on the many underlying
libraries distributed with Sage <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
This guide focuses on editing the Sage library itself.</p>
<p>Sage is not just about gathering together functionality. It is about
providing a clear, systematic and consistent way to access a large
number of algorithms, in a coherent framework that makes sense
mathematically. In the design of Sage, the semantics of objects, the
definitions, etc., are informed by how the corresponding objects are
used in everyday mathematics.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="https://www.sagemath.org/links-components.html">https://www.sagemath.org/links-components.html</a> for a full list
of packages shipped with every copy of Sage</p>
</aside>
</aside>
<p>To meet the goal of making Sage easy to read, maintain, and improve,
all Python/Cython code that is included with Sage should adhere to the
style conventions discussed in this chapter.</p>
<section id="python-code-style">
<span id="section-coding-python"></span><h2>Python Code Style<a class="headerlink" href="#python-code-style" title="Permalink to this heading">#</a></h2>
<p>Follow the standard Python formatting rules when writing code for
Sage, as explained at the following URLs:</p>
<ul class="simple">
<li><p><span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0008/"><strong>PEP 0008</strong></a></p></li>
<li><p><span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0257/"><strong>PEP 0257</strong></a></p></li>
</ul>
<p>In particular,</p>
<ul>
<li><p>Use 4 spaces for indentation levels. Do not use tabs as they can
result in indentation confusion. Most editors have a feature that
will insert 4 spaces when the <kbd class="kbd docutils literal notranslate">Tab</kbd> key is hit. Also, many editors
will automatically search/replace leading tabs with 4 spaces.</p></li>
<li><p>Whitespace before and after assignment and binary operator of the
lowest priority in the expression:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>No whitespace before or after the <code class="docutils literal notranslate"><span class="pre">=</span></code> sign if it is used for
keyword arguments:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">complex</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">magic</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">real</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>No whitespace immediately inside parenthesis, brackets, and braces:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">spam</span><span class="p">(</span><span class="n">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="n">eggs</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="p">[</span><span class="n">i</span><span class="o">^</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p>Use all lowercase function names with words separated by
underscores. For example, you are encouraged to write Python
functions using the naming convention:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_some_value</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Note, however, that some functions do have uppercase letters where
it makes sense. For instance, the function for lattice reduction by
the LLL algorithm is called <code class="docutils literal notranslate"><span class="pre">Matrix_integer_dense.LLL</span></code>.</p>
</li>
<li><p>Use CamelCase for class names:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeValue</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>  <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>and factory functions that mimic object constructors, for example
<code class="docutils literal notranslate"><span class="pre">PolynomialRing</span></code> or:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SomeIdentityValue</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SomeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="files-and-directory-structure">
<span id="chapter-directory-structure"></span><h2>Files and Directory Structure<a class="headerlink" href="#files-and-directory-structure" title="Permalink to this heading">#</a></h2>
<p>Roughly, the Sage directory tree is layout like this. Note that we use
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT</span></code> in the following as a shortcut for the (arbitrary) name
of the directory containing the Sage sources:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>SAGE_ROOT/
    sage          # the Sage launcher
    Makefile      # top level Makefile
    build/        # Sage&#39;s build system
        pkgs/     # install, patch, and metadata from spkgs
    src/
        setup.py
        ...
        sage/            # Sage library
            ext_data/    # extra Sage resources (formerly src/ext)
        bin/             # the scripts in local/bin that are tracked
    upstream/            # tarballs of upstream sources
    local/               # installed binaries
</pre></div>
</div>
<p>Python Sage library code goes into <code class="docutils literal notranslate"><span class="pre">src/sage/</span></code> and uses the following
conventions. Directory names may be plural (e.g. <code class="docutils literal notranslate"><span class="pre">rings</span></code>) and file
names are almost always singular (e.g. <code class="docutils literal notranslate"><span class="pre">polynomial_ring.py</span></code>). Note
that the file <code class="docutils literal notranslate"><span class="pre">polynomial_ring.py</span></code> might still contain definitions
of several different types of polynomial rings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You are encouraged to include miscellaneous notes, emails, design
discussions, etc., in your package.  Make these plain text files
(with extension <code class="docutils literal notranslate"><span class="pre">.txt</span></code>) in a subdirectory called <code class="docutils literal notranslate"><span class="pre">notes</span></code>.</p>
</div>
<p>If you want to create a new directory (<a class="reference external" href="https://docs.python.org/3/tutorial/modules.html#packages">package</a>) in the
Sage library <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage</span></code> (say, <code class="docutils literal notranslate"><span class="pre">measure_theory</span></code>), that
directory will usually contain an empty file <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>, which
marks the directory as an ordinary package (see
<a class="reference internal" href="packaging_sage_library.html#section-namespace-packages"><span class="std std-ref">Ordinary packages vs. implicit namespace packages</span></a>), and also a file <code class="docutils literal notranslate"><span class="pre">all.py</span></code>,
listing imports from this package that are user-facing and important
enough to be in the global namespace of Sage at startup.  The file
<code class="docutils literal notranslate"><span class="pre">all.py</span></code> might look like this:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.borel_measure</span> <span class="kn">import</span> <span class="n">BorelMeasure</span>
<span class="kn">from</span> <span class="nn">.banach_tarski</span> <span class="kn">import</span> <span class="n">BanachTarskiParadox</span>
</pre></div>
</div>
<p>but it is generally better to use the <a class="reference external" href="../reference/misc/sage/misc/lazy_import.html#module-sage.misc.lazy_import" title="(in Utilities v9.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lazy_import</span></code></a>
framework:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sage.misc.lazy_import</span> <span class="kn">import</span> <span class="n">lazy_import</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;sage.measure_theory.borel_measure&#39;</span><span class="p">,</span> <span class="s1">&#39;BorelMeasure&#39;</span><span class="p">)</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;sage.measure_theory.banach_tarski&#39;</span><span class="p">,</span> <span class="s1">&#39;BanachTarskiParadox&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then in the file <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/all.py</span></code>, add a line</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sage.measure_theory.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Adding new top-level packages below <code class="xref py py-mod docutils literal notranslate"><span class="pre">sage</span></code> should be done
sparingly.  It is often better to create subpackages of existing
packages.</p>
<p>Non-Python Sage source code and supporting files can be included in one
of the following places:</p>
<ul>
<li><p>In the directory of the Python code that uses that file.  When the
Sage library is installed, the file will be installed in the same
location as the Python code. For example,
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/interfaces/maxima.py</span></code> needs to use the file
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/interfaces/maxima.lisp</span></code> at runtime, so it refers
to it as</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;sage-maxima.lisp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>In an appropriate subdirectory of <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/ext_data/</span></code>.
(At runtime, it is then available in the directory indicated by
<code class="docutils literal notranslate"><span class="pre">SAGE_EXTCODE</span></code>).  For example, if <code class="docutils literal notranslate"><span class="pre">file</span></code> is placed in
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/ext_data/directory/</span></code> it can be accessed with</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sage.env</span> <span class="kn">import</span> <span class="n">SAGE_EXTCODE</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SAGE_EXTCODE</span><span class="p">,</span> <span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>In both cases, the files must be listed (explicitly or via wildcards) in
the section <code class="docutils literal notranslate"><span class="pre">options.package_data</span></code> of the file
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/pkgs/sagemath-standard/setup.cfg.m4</span></code> (or the corresponding
file of another distribution).</p>
</section>
<section id="learn-by-copy-paste">
<h2>Learn by copy/paste<a class="headerlink" href="#learn-by-copy-paste" title="Permalink to this heading">#</a></h2>
<p>For all of the conventions discussed here, you can find many examples
in the Sage library.  Browsing through the code is helpful, but so is
searching: the functions <code class="docutils literal notranslate"><span class="pre">search_src</span></code>, <code class="docutils literal notranslate"><span class="pre">search_def</span></code>, and
<code class="docutils literal notranslate"><span class="pre">search_doc</span></code> are worth knowing about.  Briefly, from the “sage:”
prompt, <code class="docutils literal notranslate"><span class="pre">search_src(string)</span></code> searches Sage library code for the
string <code class="docutils literal notranslate"><span class="pre">string</span></code>. The command <code class="docutils literal notranslate"><span class="pre">search_def(string)</span></code> does a similar
search, but restricted to function definitions, while
<code class="docutils literal notranslate"><span class="pre">search_doc(string)</span></code> searches the Sage documentation.  See their
docstrings for more information and more options.</p>
</section>
<section id="headings-of-sage-library-code-files">
<h2>Headings of Sage Library Code Files<a class="headerlink" href="#headings-of-sage-library-code-files" title="Permalink to this heading">#</a></h2>
<p>The top of each Sage code file should follow this format:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&lt;Short one-line summary that ends with no period&gt;</span>

<span class="sd">&lt;Paragraph description&gt;</span>

<span class="sd">EXAMPLES::</span>

<span class="sd">&lt;Lots and lots of examples&gt;</span>

<span class="sd">AUTHORS:</span>

<span class="sd">- YOUR NAME (2005-01-03): initial version</span>

<span class="sd">- person (date in ISO year-month-day format): short desc</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ****************************************************************************</span>
<span class="c1">#       Copyright (C) 2013 YOUR NAME &lt;your email&gt;</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#                  https://www.gnu.org/licenses/</span>
<span class="c1"># ****************************************************************************</span>
</pre></div>
</div>
<p>As an example, see <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/rings/integer.pyx</span></code>, which contains the
implementation for <span class="math notranslate nohighlight">\(\ZZ\)</span>. The names of the people who made major contributions
to the file appear in the <code class="docutils literal notranslate"><span class="pre">AUTHORS</span></code> section. You can add your name to the
list if you belong to the people, but refrain from being verbose in the
description. The <code class="docutils literal notranslate"><span class="pre">AUTHORS</span></code> section shows very rough overview of the history,
especially if a lot of people have been working on that source file. The
authoritative log for who wrote what is always the git repository (see the
output of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">blame</span></code>).</p>
<p>All code included with Sage must be licensed under the GPLv2+ or a
compatible, that is, less restrictive license (e.g. the BSD license).</p>
</section>
<section id="documentation-strings">
<span id="section-docstrings"></span><h2>Documentation Strings<a class="headerlink" href="#documentation-strings" title="Permalink to this heading">#</a></h2>
<section id="the-docstring-of-a-function-content">
<span id="section-docstring-function"></span><h3>The docstring of a function: content<a class="headerlink" href="#the-docstring-of-a-function-content" title="Permalink to this heading">#</a></h3>
<p><strong>Every</strong> function must have a docstring that includes the following
information. You can use the existing functions of Sage as templates.</p>
<ul>
<li><p>A <strong>one-sentence description</strong> of the function.</p>
<p>It must be followed by a blank line and end in a period. It describes the
function or method’s effect as a command (“Do this”, “Return that”), not as
a description like “Returns the pathname …”.</p>
<p>For methods of a class, it is recommended to refer to the <code class="docutils literal notranslate"><span class="pre">self</span></code> argument
in a descriptive way, unless this leads to a confusion. For example, if
<code class="docutils literal notranslate"><span class="pre">self</span></code> is an integer, then <code class="docutils literal notranslate"><span class="pre">this</span> <span class="pre">integer</span></code> or <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">integer</span></code> is more
descriptive, and it is preferable to write</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>Return whether this integer is prime.
</pre></div>
</div>
</li>
<li><p>A <strong>longer description</strong>.</p>
<p>This is optional if the one-sentence description does not need
more explanations.</p>
<p>Start with assumptions of the object, if there are any. For example,</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>The poset is expected to be ranked.
</pre></div>
</div>
<p>if the function raises an exception when called on a non-ranked poset.</p>
<p>Define your terms</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>The lexicographic product of <span class="nv">`G`</span> and <span class="nv">`H`</span> is the graph with vertex set ...
</pre></div>
</div>
<p>and mention possible aliases</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>The tensor product is also known as the categorical product and ...
</pre></div>
</div>
</li>
<li><p>An <strong>INPUT</strong> and an <strong>OUTPUT</strong> block describing the input/output of
the function.</p>
<p>The INPUT block describes all arguments that the function accepts.</p>
<ol class="arabic simple">
<li><p>The type names should be descriptive, but do not have to represent
the exact Sage/Python types. For example, use “integer” for
anything that behaves like an integer, rather than <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p></li>
<li><p>Mention the default values of the input arguments when applicable.</p></li>
</ol>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>INPUT:

<span class="m">-</span> <span class="s">``n``</span> -- integer

<span class="m">-</span> <span class="s">``p``</span> -- prime integer (default: <span class="nv">`2`</span>); coprime with <span class="s">``n``</span>
</pre></div>
</div>
<p>The OUTPUT block describes the expected output. This is required if the
one-sentence description of the function needs more explanation.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>OUTPUT: the plaintext decrypted from the ciphertext <span class="s">``C``</span>
</pre></div>
</div>
<p>It is often the case that the output consists of several items.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>OUTPUT: a tuple of

<span class="m">-</span> the reduced echelon form <span class="nv">`H`</span> of the matrix <span class="nv">`A`</span>

<span class="m">-</span> the transformation matrix <span class="nv">`U`</span> such that <span class="nv">`UA = H`</span>
</pre></div>
</div>
<p>You are recommended to be verbose enough for complicated outputs.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>OUTPUT:

The decomposition of the free module on which this matrix <span class="nv">`A`</span> acts from
the right (i.e., the action is <span class="nv">`x`</span> goes to <span class="nv">`xA`</span>), along with whether
this matrix acts irreducibly on each factor. The factors are guaranteed
to be sorted in the same way as the corresponding factors of the
characteristic polynomial.
</pre></div>
</div>
</li>
<li><p>An <strong>EXAMPLES</strong> block for examples. This is not optional.</p>
<p>These examples are used for documentation, but they are also
tested before each release just like TESTS block.</p>
<p>They should have good coverage of the functionality in question.</p>
</li>
<li><p>A <strong>SEEALSO</strong> block (highly recommended) with links to related parts of
Sage. This helps users find the features that interest them and discover
the new ones.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">SEEALSO</span><span class="p">::</span>

    <span class="na">:ref:</span><span class="nv">`chapter-sage_manuals_links`</span>,
    <span class="na">:meth:</span><span class="nv">`sage.somewhere.other_useful_method`</span>,
    <span class="na">:mod:</span><span class="nv">`sage.some.related.module`</span>.
</pre></div>
</div>
<p>See <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><span class="std std-ref">Hyperlinks</span></a> for details on how to setup
links in Sage.</p>
</li>
<li><p>An <strong>ALGORITHM</strong> block (optional).</p>
<p>It indicates what algorithm and/or what software is used, e.g.
<code class="docutils literal notranslate"><span class="pre">ALGORITHM:</span> <span class="pre">Uses</span> <span class="pre">Pari</span></code>. Here’s a longer example with a
bibliographical reference:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>ALGORITHM:

The following algorithm is adapted from page 89 of <span class="s">[Nat2000]_</span>.

Let <span class="nv">`p`</span> be an odd (positive) prime and let <span class="nv">`g`</span> be a generator
modulo <span class="nv">`p`</span>. Then <span class="nv">`g^k`</span> is a generator modulo <span class="nv">`p`</span> if and only if
<span class="nv">`\gcd(k, p-1) = 1`</span>. Since <span class="nv">`p`</span> is an odd prime and positive, then
<span class="nv">`p - 1`</span> is even so that any even integer between 1 and <span class="nv">`p - 1`</span>,
inclusive, is not relatively prime to <span class="nv">`p - 1`</span>. We have now
narrowed our search to all odd integers <span class="nv">`k`</span> between 1 and <span class="nv">`p - 1`</span>,
inclusive.

So now start with a generator <span class="nv">`g`</span> modulo an odd (positive) prime
<span class="nv">`p`</span>. For any odd integer <span class="nv">`k`</span> between 1 and <span class="nv">`p - 1`</span>, inclusive,
<span class="nv">`g^k`</span> is a generator modulo <span class="nv">`p`</span> if and only if <span class="nv">`\gcd(k, p-1) = 1`</span>.
</pre></div>
</div>
<p>The bibliographical reference should go in Sage’s master
bibliography file,
<code class="file docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en/reference/references/index.rst</span></code>:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="nt">[Nat2000]</span> \M. B. Nathanson. Elementary Methods in Number Theory.
   Springer, 2000.
</pre></div>
</div>
</li>
<li><p>A <strong>NOTE</strong> block for tips/tricks (optional).</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">NOTE</span><span class="p">::</span>

    You should note that this sentence is indented at least 4
    spaces. Never use the tab character.
</pre></div>
</div>
</li>
<li><p>A <strong>WARNING</strong> block for critical information about your code (optional).</p>
<p>For example known situations for which the code breaks, or anything
that the user should be aware of.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">WARNING</span><span class="p">::</span>

    Whenever you edit the Sage documentation, make sure that
    the edited version still builds. That is, you need to ensure
    that you can still build the HTML and PDF versions of the
    updated documentation. If the edited documentation fails to
    build, it is very likely that you would be requested to
    change your patch.
</pre></div>
</div>
</li>
<li><p>A <strong>TODO</strong> block for future improvements (optional).</p>
<p>It can contain disabled doctests to demonstrate the desired
feature. Here’s an example of a TODO block:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">TODO</span><span class="p">::</span>

    Add to <span class="s">``have_fresh_beers``</span> an interface with the faster
    algorithm &quot;Buy a Better Fridge&quot; (BaBF)<span class="se">::</span>

<span class="s">        sage: have_fresh_beers(&#39;Bière de l\&#39;Yvette&#39;, algorithm=&quot;BaBF&quot;) # not implemented</span>
<span class="s">        Enjoy !</span>
</pre></div>
</div>
</li>
<li><p>A <strong>PLOT</strong> block to illustrate with pictures the output of a function.</p>
<p>Generate with Sage code an object <code class="docutils literal notranslate"><span class="pre">g</span></code> with a <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method, then call
<code class="docutils literal notranslate"><span class="pre">sphinx_plot(g)</span></code>:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">PLOT</span><span class="p">::</span>

    g = graphs.PetersenGraph()
    sphinx_plot(g)
</pre></div>
</div>
</li>
<li><p>A <strong>REFERENCES</strong> block to list related books or papers (optional).</p>
<p>Almost all bibliographic information should be put in the master bibliography
file, see below. Citations will then link to the master bibliography where
the reader can find the bibliographic details (see below for citation
syntax).  REFERENCE blocks in individual docstrings are therefore usually not
necessary.</p>
<p>Nevertheless, a REFERENCE block can be useful if there are relevant sources
which are not explicitly mentioned in the docstring or if the docstring is
particularly long. In that case, add the bibliographic information to the
master bibliography file, if not already present, and add a reference block
to your docstring as follows:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>REFERENCES:

For more information, see <span class="s">[Str1969]_</span>, or one of the following references:

<span class="m">-</span> <span class="s">[Sto2000]_</span>

<span class="m">-</span> <span class="s">[Voe2003]_</span>
</pre></div>
</div>
<p>Note the trailing underscores which makes the citations into hyperlinks. See
below for more about the master bibliography file. For more about citations,
see the <a class="reference external" href="https://www.sphinx-doc.org/rest.html#citations">Sphinx/reST markup for citations</a>. For links to trac tickets
or wikipedia, see <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><span class="std std-ref">Hyperlinks</span></a>.</p>
</li>
<li><p>A <strong>TESTS</strong> block (highly recommended).</p>
<p>Formatted just like EXAMPLES, containing tests that are not relevant
to users.  In particular, these blocks are not shown when users ask
for help via <code class="docutils literal notranslate"><span class="pre">foo?</span></code>: they are stripped by the function
<a class="reference external" href="../reference/misc/sage/misc/sagedoc.html#sage.misc.sagedoc.skip_TESTS_block" title="(in Utilities v9.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">sage.misc.sagedoc.skip_TESTS_block()</span></code></a>.</p>
<p>Special and corner cases, like number zero, one-element group etc.
should usually go to this block. This is also right place for most
tests of input validation; for example if the function accepts
<code class="docutils literal notranslate"><span class="pre">direction='up'</span></code> and <code class="docutils literal notranslate"><span class="pre">direction='down'</span></code>, you can use this block to check
that <code class="docutils literal notranslate"><span class="pre">direction='junk'</span></code> raises an exception.</p>
<p>For the purposes of removal, A “TESTS” block is a block starting
with “TESTS:” (or the same with two colons), on a line on
its own, and ending either with a line indented less than “TESTS”,
or with a line with the same level of indentation – not more –
matching one of the following:</p>
<ul class="simple">
<li><p>a Sphinx directive of the form “.. foo:”, optionally followed by
other text.</p></li>
<li><p>text of the form “UPPERCASE:”, optionally followed by other
text.</p></li>
<li><p>lines which look like a reST header: one line containing
anything, followed by a line consisting only of whitespace,
followed by a string of hyphens, equal signs, or other
characters which are valid markers for reST
headers: <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">=</span> <span class="pre">`</span> <span class="pre">:</span> <span class="pre">'</span> <span class="pre">&quot;</span> <span class="pre">~</span> <span class="pre">_</span> <span class="pre">^</span> <span class="pre">*</span> <span class="pre">+</span> <span class="pre">#</span> <span class="pre">&lt;</span> <span class="pre">&gt;</span></code>.
However, lines only containing double colons <span class="math notranslate nohighlight">\(::\)</span> do not
end “TESTS” blocks.</p></li>
</ul>
<p>Sometimes (but rarely) one has private or protected methods that don’t need a
proper <code class="docutils literal notranslate"><span class="pre">EXAMPLES</span></code> doctest. In these cases, one can either write traditional
doctest using the <code class="docutils literal notranslate"><span class="pre">TESTS</span></code> block or use pytest to test the method.
In the latter case, one has to add <code class="docutils literal notranslate"><span class="pre">TESTS:</span> <span class="pre">pytest</span></code> to the docstring, so that
the method is explicitly marked as tested.</p>
</li>
</ul>
<section id="note-about-sphinx-directives-vs-other-blocks">
<h4>Note about Sphinx directives vs. other blocks<a class="headerlink" href="#note-about-sphinx-directives-vs-other-blocks" title="Permalink to this heading">#</a></h4>
<p>The main Sphinx directives that are used in Sage are:</p>
<p><code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">MATH::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">NOTE::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">PLOT::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">RUBRIC::</span></code>,
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">SEEALSO::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">TODO::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">TOPIC::</span></code> and <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">WARNING::</span></code>.</p>
<p>They must be written exactly as above, so for example
<code class="docutils literal notranslate"><span class="pre">WARNING::</span></code> or <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">WARNING</span> <span class="pre">::</span></code> will not work.</p>
<p>Some other directives are also available, but less frequently used, namely:</p>
<p><code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">MODULEAUTHOR::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">automethod::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">autofunction::</span></code>,
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">image::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">figure::</span></code>.</p>
<p>Other blocks shall not be used as directives; for example
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">ALGORITHM::</span></code> will not be shown at all.</p>
</section>
<section id="sage-documentation-style">
<h4>Sage documentation style<a class="headerlink" href="#sage-documentation-style" title="Permalink to this heading">#</a></h4>
<p>All Sage documentation is written in reStructuredText (reST) and is
processed by Sphinx. See <a class="reference external" href="https://www.sphinx-doc.org/rest.html">https://www.sphinx-doc.org/rest.html</a> for an
introduction. Sage imposes these styles:</p>
<ul>
<li><p>Lines should be shorter than 80 characters. If in doubt, read <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length">PEP8: Maximum
Line Length</a>.</p></li>
<li><p>All reST and Sphinx directives (like <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">WARNING::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">NOTE::</span></code>,
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">MATH::</span></code>, etc.) are written in uppercase.</p></li>
<li><p>Code fragments are quoted with double backticks. This includes function
arguments and the Python literals like <code class="docutils literal notranslate"><span class="pre">``True``</span></code>, <code class="docutils literal notranslate"><span class="pre">``False``</span></code> and
<code class="docutils literal notranslate"><span class="pre">``None``</span></code>. For example:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>If <span class="s">``check``</span> is <span class="s">``True``</span>, then ...
</pre></div>
</div>
</li>
</ul>
</section>
<section id="sage-s-master-bibliography-file">
<h4>Sage’s master <strong>BIBLIOGRAPHY</strong> file<a class="headerlink" href="#sage-s-master-bibliography-file" title="Permalink to this heading">#</a></h4>
<p>All bibliographical references should be stored in the master
bibliography file,
<code class="file docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en/reference/references/index.rst</span></code>, in the
format</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="nt">[Gau1801]</span> \C. F. Gauss, <span class="ge">*Disquisitiones Arithmeticae*</span>, 1801.

<span class="p">..</span> <span class="nt">[RSA1978]</span> \R. Rivest, A. Shamir, L. Adleman,
             &quot;A Method for Obtaining Digital Signatures and
             Public-Key Cryptosystems&quot;.
             Communications of the ACM <span class="gs">**21**</span> (February 1978),
             120–126. <span class="na">:doi:</span><span class="nv">`10.1145/359340.359342`</span>.
</pre></div>
</div>
<p>The part in brackets is the citation key: given these examples, you
could then use <code class="docutils literal notranslate"><span class="pre">[Gau1801]_</span></code> in a docstring to provide a link to the
first reference. Note the trailing underscore which makes the citation a
hyperlink.</p>
<p>When possible, the key should have this form: for a single author, use the
first three letters of the family name followed by the year; for multiple
authors, use the first letter of each of the family names followed by the
year. Note that the year should be four digits, not just the last two – Sage
already has references from both 1910 and 2010, for example.</p>
<p>When abbreviating the first name of an author in a bibliography
listing, be sure to put a backslash in front of it. This ensures
that the letter (<code class="docutils literal notranslate"><span class="pre">C.</span></code> in the example above) will not be
interpreted as a list enumerator.</p>
<p>For more about citations, see the <a class="reference external" href="https://www.sphinx-doc.org/rest.html#citations">Sphinx/reST markup for citations</a>.</p>
</section>
<section id="template">
<h4>Template<a class="headerlink" href="#template" title="Permalink to this heading">#</a></h4>
<p>Use the following template when documenting functions. Note the
indentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the point `(x^5,y)`.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``x`` -- integer (default: `1`); the description of the</span>
<span class="sd">      argument ``x`` goes here. If it contains multiple lines, all</span>
<span class="sd">      the lines after the first need to begin at the same indentation</span>
<span class="sd">      as the backtick.</span>

<span class="sd">    - ``y`` -- integer (default: `2`); the description of the</span>
<span class="sd">      argument ``y``</span>

<span class="sd">    OUTPUT: the point as a tuple</span>

<span class="sd">    EXAMPLES:</span>

<span class="sd">    This example illustrates ... ::</span>

<span class="sd">        sage: A = ModuliSpace()</span>
<span class="sd">        sage: A.point(2,3)</span>
<span class="sd">        xxx</span>

<span class="sd">    We now ... ::</span>

<span class="sd">        sage: B = A.point(5,6)</span>
<span class="sd">        sage: xxx</span>

<span class="sd">    It is an error to ... ::</span>

<span class="sd">        sage: C = A.point(&#39;x&#39;,7)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        TypeError: unable to convert &#39;r&#39; to an integer</span>

<span class="sd">    .. NOTE::</span>

<span class="sd">        This function uses the algorithm of [BCDT2001]_ to determine</span>
<span class="sd">        whether an elliptic curve `E` over `Q` is modular.</span>

<span class="sd">    ...</span>

<span class="sd">    .. SEEALSO::</span>

<span class="sd">        :func:`line`</span>

<span class="sd">    TESTS::</span>

<span class="sd">        sage: A.point(42, 0)  # Check for corner case y=0</span>
<span class="sd">        xxx</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">&lt;</span><span class="n">body</span> <span class="n">of</span> <span class="n">the</span> <span class="n">function</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The master bibliography file would contain</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="nt">[BCDT2001]</span> Breuil, Conrad, Diamond, Taylor,
              &quot;Modularity ....&quot;
</pre></div>
</div>
<p>You are strongly encouraged to:</p>
<ul>
<li><p>Use LaTeX typesetting (see <a class="reference internal" href="#section-latex-typeset"><span class="std std-ref">LaTeX Typesetting</span></a>).</p></li>
<li><p>Liberally describe what the examples do.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There must be a blank line after the example code and before the
explanatory text for the next example (indentation is not enough).</p>
</div>
</li>
<li><p>Illustrate the exceptions raised by the function with examples (as
given above: “It is an error to [..]”, …)</p></li>
<li><p>Include many examples.</p>
<p>They are helpful for the users, and are crucial for the quality and
adaptability of Sage. Without such examples, small changes to one part
of Sage that break something else might not go seen until much later
when someone uses the system, which is unacceptable.</p>
</li>
</ul>
</section>
</section>
<section id="fine-points-on-styles">
<h3>Fine points on styles<a class="headerlink" href="#fine-points-on-styles" title="Permalink to this heading">#</a></h3>
<p>A Sage developer, in writing code and docstrings, should follow the styles
suggested in this manual, except special cases with good reasons. However, there
are some details where we as a community did not reach to an agreement on
the official style. These are</p>
<ul>
<li><p>one space:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">sentence</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span> <span class="n">sentence</span><span class="o">.</span>
</pre></div>
</div>
<p>vs two spaces:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">sentence</span><span class="o">.</span>  <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span> <span class="n">sentence</span><span class="o">.</span>
</pre></div>
</div>
<p>between sentences.</p>
</li>
<li><p>tight list:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">first</span> <span class="n">item</span>
<span class="o">-</span> <span class="n">second</span> <span class="n">item</span>
<span class="o">-</span> <span class="n">third</span> <span class="n">item</span>
</pre></div>
</div>
<p>vs spaced list:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">first</span> <span class="n">item</span>

<span class="o">-</span> <span class="n">second</span> <span class="n">item</span>

<span class="o">-</span> <span class="n">third</span> <span class="n">item</span>
</pre></div>
</div>
</li>
</ul>
<p>There are different opinions on each of these, and in reality, we find
instances in each style in our codebase. Then what should we do? Do we decide
on one style by voting? There are different opinions even on what to do!</p>
<p>We can at least do this to prevent any dispute about these style conflicts:</p>
<ul class="simple">
<li><p>Acknowledge different authors may have different preferences on these.</p></li>
<li><p>Respect the style choice of the author who first wrote the code or the docstrings.</p></li>
</ul>
<section id="private-functions">
<h4>Private functions<a class="headerlink" href="#private-functions" title="Permalink to this heading">#</a></h4>
<p>Functions whose names start with an underscore are considered
private. They do not appear in the reference manual, and their docstring
should not contain any information that is crucial for Sage users. You
can make their docstrings be part of the documentation of another
method. For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">SageObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;usual docstring&gt;</span>

<span class="sd">        .. automethod:: _f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This would be hidden without the ``.. automethod::``</span>
<span class="sd">         &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Private functions should contain an EXAMPLES (or TESTS) block.</p>
<p>A special case is the constructor <code class="docutils literal notranslate"><span class="pre">__init__</span></code>: due to its special
status the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> docstring is used as the class docstring if
there is not one already. That is, you can do the following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">SageObject</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="c1"># no class docstring</span>
<span class="gp">....: </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">....: </span>        <span class="sd">&quot;&quot;&quot;Construct a Foo.&quot;&quot;&quot;</span>
<span class="gp">sage: </span><span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.sageinspect</span> <span class="kn">import</span> <span class="n">sage_getdoc</span>
<span class="gp">sage: </span><span class="n">sage_getdoc</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>              <span class="c1"># class docstring</span>
<span class="go">&#39;Construct a Foo.\n&#39;</span>
<span class="gp">sage: </span><span class="n">sage_getdoc</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>     <span class="c1"># constructor docstring</span>
<span class="go">&#39;Construct a Foo.\n&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="latex-typesetting">
<span id="section-latex-typeset"></span><h3>LaTeX Typesetting<a class="headerlink" href="#latex-typesetting" title="Permalink to this heading">#</a></h3>
<p>In Sage’s documentation LaTeX code is allowed and is marked with <strong>backticks</strong>:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">`x^2</span> <span class="pre">+</span> <span class="pre">y^2</span> <span class="pre">=</span> <span class="pre">1`</span></code> yields <span class="math notranslate nohighlight">\(x^2 + y^2 = 1\)</span>.</p>
</div></blockquote>
<p><strong>Backslashes:</strong> For LaTeX commands containing backslashes, either use double
backslashes or begin the docstring with a <code class="docutils literal notranslate"><span class="pre">r&quot;&quot;&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span></code>. Both of
the following are valid:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `\\cos(x)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `\sin(x)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p><strong>MATH block:</strong> This is similar to the LaTeX syntax <code class="docutils literal notranslate"><span class="pre">\[&lt;math</span> <span class="pre">expression&gt;\]</span></code>
(or <code class="docutils literal notranslate"><span class="pre">$$&lt;math</span> <span class="pre">expression&gt;$$</span></code>). For instance:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">MATH</span><span class="p">::</span>

    \sum_{i=1}^{\infty} (a_1 a_2 \cdots a_i)^{1/i}
    \leq
    e \sum_{i=1}^{\infty} a_i
</pre></div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\sum_{i=1}^{\infty} (a_1 a_2 \cdots a_i)^{1/i}
\leq
e \sum_{i=1}^{\infty} a_i\]</div>
</div>
<p>The <strong>aligned</strong> environment works as it does in LaTeX:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">MATH</span><span class="p">::</span>

    \begin{aligned}
     f(x) &amp; = x^2 - 1 \\
     g(x) &amp; = x^x - f(x - 2)
    \end{aligned}
</pre></div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
 f(x) &amp; = x^2 - 1 \\
 g(x) &amp; = x^x - f(x - 2)
\end{aligned}\end{split}\]</div>
</div>
<p>When building the PDF documentation, everything is translated to LaTeX
and each MATH block is automatically wrapped in a math environment –
in particular, it is turned into <code class="docutils literal notranslate"><span class="pre">\begin{gather}</span> <span class="pre">block</span>
<span class="pre">\end{gather}</span></code>.  So if you want to use a LaTeX environment (like
<code class="docutils literal notranslate"><span class="pre">align</span></code>) which in ordinary LaTeX would not be wrapped like this, you
must add a <strong>:nowrap:</strong> flag to the MATH mode. See also <a class="reference external" href="http://sphinx-doc.org/latest/ext/math.html?highlight=nowrap#directive-math">Sphinx’s
documentation for math blocks</a>. :</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">MATH</span><span class="p">::</span>
   <span class="nc">:nowrap:</span>

   \begin{align}
      1+...+n &amp;= n(n+1)/2\\
      &amp;= O(n^2)\\
   \end{align}
</pre></div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\begin{align}
1+...+n &amp;= n(n+1)/2\\
&amp;= O(n^2)\\
\end{align}</div></div>
<p><strong>Readability balance:</strong> in the interactive console, LaTeX formulas contained
in the documentation are represented by their LaTeX code (with backslashes
stripped). In this situation <code class="docutils literal notranslate"><span class="pre">\\frac{a}{b}</span></code> is less readable than <code class="docutils literal notranslate"><span class="pre">a/b</span></code> or
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">b^{-1}</span></code> (some users may not even know LaTeX code). Make it pleasant for
everybody as much as you can manage.</p>
<p><strong>Commons rings</strong> <span class="math notranslate nohighlight">\((\Bold{Z},\Bold{N},...)\)</span>: The Sage LaTeX style is to typeset
standard rings and fields using the locally-defined macro <code class="docutils literal notranslate"><span class="pre">\\Bold</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">\\Bold{Z}</span></code> gives <span class="math notranslate nohighlight">\(\Bold{Z}\)</span>).</p>
<p><strong>Shortcuts</strong> are available which preserve readability, e.g. <code class="docutils literal notranslate"><span class="pre">\\ZZ</span></code> (<span class="math notranslate nohighlight">\(\ZZ\)</span>),
<code class="docutils literal notranslate"><span class="pre">\\RR</span></code> (<span class="math notranslate nohighlight">\(\RR\)</span>), <code class="docutils literal notranslate"><span class="pre">\\CC</span></code> (<span class="math notranslate nohighlight">\(\CC\)</span>), and <code class="docutils literal notranslate"><span class="pre">\\QQ</span></code> (<span class="math notranslate nohighlight">\(\QQ\)</span>). They appear as
LaTeX-formatted <code class="docutils literal notranslate"><span class="pre">\\Bold{Z}</span></code> in the html manual, and as <code class="docutils literal notranslate"><span class="pre">Z</span></code> in the
interactive help. Other examples: <code class="docutils literal notranslate"><span class="pre">\\GF{q}</span></code> (<span class="math notranslate nohighlight">\(\GF{q}\)</span>) and <code class="docutils literal notranslate"><span class="pre">\\Zmod{p}</span></code>
(<span class="math notranslate nohighlight">\(\Zmod{p}\)</span>).</p>
<p>See the file <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/misc/latex_macros.py</span></code> for a full list and
for details about how to add more macros.</p>
</section>
<section id="writing-testable-examples">
<span id="section-doctest-writing"></span><h3>Writing Testable Examples<a class="headerlink" href="#writing-testable-examples" title="Permalink to this heading">#</a></h3>
<p>The examples from Sage’s documentation have a double purpose:</p>
<ul class="simple">
<li><p>They provide <strong>illustrations</strong> of the code’s usage to the users</p></li>
<li><p>They are <strong>tests</strong> that are checked before each release, helping us avoid
new bugs.</p></li>
</ul>
<p>All new doctests added to Sage should <strong>pass all tests</strong> (see
<a class="reference internal" href="doctesting.html#chapter-doctesting"><span class="std std-ref">Running Sage’s doctests</span></a>), i.e. running <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">your_file.py</span></code> should not
give any error messages. Below are instructions about how doctests should be
written.</p>
<p><strong>What doctests should test:</strong></p>
<ul>
<li><p><strong>Interesting examples</strong> of what the function can do. This will be the
most helpful to a lost user. It is also the occasion to check famous
theorems (just in case):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">is_prime</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c1"># 6 is not prime</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># and here is a proof</span>
<span class="go">6</span>
</pre></div>
</div>
</li>
<li><p>All <strong>meaningful combinations</strong> of input arguments. For example a function
may accept an <code class="docutils literal notranslate"><span class="pre">algorithm=&quot;B&quot;</span></code> argument, and doctests should involve both
<code class="docutils literal notranslate"><span class="pre">algorithm=&quot;A&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">algorithm=&quot;B&quot;</span></code>.</p></li>
<li><p><strong>Corner cases:</strong> the code should be able to handle a 0 input, or an empty
set, or a null matrix, or a null function, … All corner cases should be
checked, as they are the most likely to be broken, now or in the future. This
probably belongs to the TESTS block (see <a class="reference internal" href="#section-docstring-function"><span class="std std-ref">The docstring of a function: content</span></a>).</p></li>
<li><p><strong>Systematic tests</strong> of all small-sized inputs, or tests of <strong>random</strong>
instances if possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that <strong>TestSuites</strong> are an automatic way to generate some of these
tests in specific situations. See
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/misc/sage_unittest.py</span></code>.</p>
</div>
</li>
</ul>
<p><strong>The syntax:</strong></p>
<ul>
<li><p><strong>Environment:</strong> doctests should work if you copy/paste them in Sage’s
interactive console. For example, the function <code class="docutils literal notranslate"><span class="pre">AA()</span></code> in the file
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/algebras/steenrod/steenrod_algebra.py</span></code> includes an
EXAMPLES block containing the following:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.algebras.steenrod.steenrod_algebra</span> <span class="kn">import</span> <span class="n">AA</span> <span class="k">as</span> <span class="n">A</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">()</span>
<span class="go">mod 2 Steenrod algebra, milnor basis</span>
</pre></div>
</div>
<p>Sage does not know about the function <code class="docutils literal notranslate"><span class="pre">AA()</span></code> by default, so it needs to be
imported before it is tested. Hence the first line in the example.</p>
</li>
<li><p><strong>Preparsing:</strong> As in Sage’s console, <span class="math notranslate nohighlight">\(4/3\)</span> returns <span class="math notranslate nohighlight">\(4/3\)</span> and not
<span class="math notranslate nohighlight">\(1.3333333333333333\)</span> as in Python 3.8. Testing occurs with full Sage
preparsing of input within the standard Sage shell environment, as
described in <a class="reference internal" href="coding_in_python.html#section-preparsing"><span class="std std-ref">Sage Preparsing</span></a>.</p></li>
<li><p><strong>Writing files:</strong> If a test outputs to a file, the file should be a
temporary file.  Use <a class="reference external" href="../reference/misc/sage/misc/temporary_file.html#sage.misc.temporary_file.tmp_filename" title="(in Utilities v9.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">tmp_filename()</span></code></a> to get a temporary filename, or
<a class="reference external" href="../reference/misc/sage/misc/temporary_file.html#sage.misc.temporary_file.tmp_dir" title="(in Utilities v9.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">tmp_dir()</span></code></a> to get a temporary directory. An example from
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/sage/plot/graphics.py</span></code>):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p><strong>Multiline doctests:</strong> You may write tests that span multiple lines, using
the line continuation marker <code class="docutils literal notranslate"><span class="pre">....:</span></code></p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">srange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">....: </span>    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">is_prime</span><span class="p">():</span>
<span class="gp">....: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">5</span>
<span class="go">7</span>
</pre></div>
</div>
</li>
<li><p><strong>Python3 print:</strong> Python3 syntax for print must be used in Sage
code and doctests. If you use an old-style print in doctests, it
will raise a SyntaxError:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">print</span> <span class="s2">&quot;not like that&quot;</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">SyntaxError: ...</span>
<span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;but like this&quot;</span><span class="p">)</span>
<span class="go">but like this</span>
</pre></div>
</div>
</li>
<li><p><strong>Split long lines:</strong> You may want to split long lines of code with a
backslash. Note: this syntax is non-standard and may be removed in the
future:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">n</span> <span class="o">=</span> <span class="mi">123456789123456789123456789</span>\
<span class="gp">....: </span>    <span class="mi">123456789123456789123456789</span>
<span class="gp">sage: </span><span class="n">n</span><span class="o">.</span><span class="n">is_prime</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</li>
<li><p><strong>Doctests flags:</strong> flags are available to change the behaviour of doctests:
see <a class="reference internal" href="#section-further-conventions"><span class="std std-ref">Special Markup to Influence Doctests</span></a>.</p></li>
</ul>
</section>
<section id="special-markup-to-influence-doctests">
<span id="section-further-conventions"></span><h3>Special Markup to Influence Doctests<a class="headerlink" href="#special-markup-to-influence-doctests" title="Permalink to this heading">#</a></h3>
<p>Overly complicated output in the example code can be shortened
by an ellipsis marker <code class="docutils literal notranslate"><span class="pre">...</span></code>:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="p">[</span><span class="n">ZZ</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">ordinal_str</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">)]</span>
<span class="go">[&#39;0th&#39;,</span>
<span class="go"> &#39;1st&#39;,</span>
<span class="go"> &#39;2nd&#39;,</span>
<span class="go"> &#39;3rd&#39;,</span>
<span class="go"> &#39;4th&#39;,</span>
<span class="go"> &#39;5th&#39;,</span>
<span class="go"> ...</span>
<span class="go"> &#39;21st&#39;,</span>
<span class="go"> &#39;22nd&#39;,</span>
<span class="go"> &#39;23rd&#39;,</span>
<span class="go"> &#39;24th&#39;]</span>
<span class="gp">sage: </span><span class="n">ZZ</span><span class="p">(</span><span class="s1">&#39;sage&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">TypeError: unable to convert &#39;sage&#39; to an integer</span>
</pre></div>
</div>
<p>On the proper usage of the ellipsis marker, see <a class="reference external" href="https://docs.python.org/release/3.8.10/library/doctest.html#doctest.ELLIPSIS">Python’s documentation</a>.</p>
<p>There are a number of magic comments that you can put into the example
code that change how the output is verified by the Sage doctest
framework. Here is a comprehensive list:</p>
<ul>
<li><p><strong>random:</strong> The line will be executed, but its output will not be checked with
the output in the documentation string:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">CombinatorialObject</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># random</span>
<span class="go">1335416675971793195</span>
<span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># random</span>
<span class="go">This doctest passes too, as the output is not checked</span>
</pre></div>
</div>
<p>Doctests are expected to pass with any state of the pseudorandom number
generators (PRNGs).
When possible, avoid the problem, e.g.: rather than checking the value of the
hash in a doctest, one could illustrate successfully using it as a key in a
dict.</p>
<p>One can also avoid the <code class="docutils literal notranslate"><span class="pre">random</span></code>-tag by checking basic properties:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">QQ</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="n">QQ</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">QQ</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span> <span class="ow">in</span> <span class="n">QQ</span>
<span class="go">True</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">QQ</span><span class="o">.</span><span class="n">random_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">b</span> <span class="o">=</span> <span class="n">QQ</span><span class="o">.</span><span class="n">_random_nonzero_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">QQ</span><span class="o">.</span><span class="n">_random_nonzero_element</span><span class="p">()</span>
<span class="gp">sage: </span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Distribution can be checked with loops:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">found</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>
<span class="gp">sage: </span><span class="k">while</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
<span class="gp">....: </span>    <span class="n">found</span><span class="p">[</span><span class="n">ZZ</span><span class="o">.</span><span class="n">random_element</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>This is mathematically correct, as it is
guaranteed to terminate. However, there is a
nonzero probability of a timout.</p>
</li>
<li><p><strong>long time:</strong> The line is only tested if the <code class="docutils literal notranslate"><span class="pre">--long</span></code> option is given, e.g.
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--long</span> <span class="pre">f.py</span></code>.</p>
<p>Use it for doctests that take more than a second to run. No example should
take more than about 30 seconds:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">E</span><span class="o">.</span><span class="n">regulator</span><span class="p">()</span>        <span class="c1"># long time (1 second)</span>
<span class="go">0.0511114082399688</span>
</pre></div>
</div>
</li>
<li><p><strong>tol</strong> or <strong>tolerance:</strong> The numerical values returned by the line are only
verified to the given tolerance. It is useful when the output is subject to
numerical noise due to system-dependent (floating point arithmetic, math
libraries, …) or non-deterministic algorithms.</p>
<ul class="simple">
<li><p>This may be prefixed by <code class="docutils literal notranslate"><span class="pre">abs[olute]</span></code> or <code class="docutils literal notranslate"><span class="pre">rel[ative]</span></code> to specify whether
to measure <strong>absolute</strong> or <strong>relative</strong> error (see the
<a class="reference external" href="https://en.wikipedia.org/wiki/Approximation_error">Wikipedia article Approximation_error</a>).</p></li>
<li><p>If none of <code class="docutils literal notranslate"><span class="pre">abs/rel</span></code> is specified, the error is considered to be
<code class="docutils literal notranslate"><span class="pre">absolute</span></code> when the expected value is <strong>zero</strong>, and is <code class="docutils literal notranslate"><span class="pre">relative</span></code> for
<strong>nonzero</strong> values.</p></li>
</ul>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># abs tol 1e-9</span>
<span class="go">3.14159265358979</span>
<span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># rel tol 2</span>
<span class="go">6</span>
<span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># abs tol 1.41593</span>
<span class="go">2</span>
<span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">zeta8</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">CyclotomicField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">N</span><span class="p">(</span><span class="n">zeta8</span><span class="p">)</span>  <span class="c1"># absolute tolerance 1e-10</span>
<span class="go">0.7071067812 + 0.7071067812*I</span>
</pre></div>
</div>
<p><strong>Multiple numerical values:</strong> the representation of complex numbers,
matrices, or polynomials usually involves several numerical values. If a
doctest with tolerance contains several numbers, each of them is checked
individually:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The sum of 1 and 1 equals 5&quot;</span><span class="p">)</span>  <span class="c1"># abs tol 1</span>
<span class="go">The sum of 2 and 2 equals 4</span>
<span class="gp">sage: </span><span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="p">()</span> <span class="c1"># rel tol 1e-1</span>
<span class="go">0.7 + 0.7*I</span>
<span class="gp">sage: </span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">1.001</span><span class="p">)</span><span class="o">^</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span> <span class="c1"># rel tol 2</span>
<span class="go">x^4 + 4*x^3 + 6*x^2 + 4*x + 1</span>
<span class="gp">sage: </span><span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">random_matrix</span><span class="p">(</span><span class="n">RR</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="o">^</span><span class="mi">3</span>
<span class="gp">sage: </span><span class="n">M</span><span class="o">^</span><span class="mi">2</span> <span class="c1"># abs tol 1e-2</span>
<span class="go">[1 0 0]</span>
<span class="go">[0 1 0]</span>
<span class="go">[0 0 1]</span>
</pre></div>
</div>
<p>The values that the doctesting framework involves in the error computations
are defined by the regular expression <code class="docutils literal notranslate"><span class="pre">float_regex</span></code> in
<a class="reference external" href="../reference/doctest/sage/doctest/parsing.html#module-sage.doctest.parsing" title="(in Sage's Doctesting Framework v9.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.doctest.parsing</span></code></a>.</p>
</li>
<li><p><strong>not implemented</strong> or <strong>not tested:</strong> The line is never tested.</p>
<p>Use it for very long doctests that are only meant as documentation. It can
also be used for todo notes of what will eventually be implemented:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>    <span class="c1"># todo: not implemented</span>
</pre></div>
</div>
<p>It is also immediately clear to the user that the indicated example
does not currently work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Skip all doctests of a file/directory</p>
<ul class="simple">
<li><p><strong>file:</strong> If one of the first 10 lines of a file starts with any of
<code class="docutils literal notranslate"><span class="pre">r&quot;&quot;&quot;</span> <span class="pre">nodoctest</span></code> (or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span> <span class="pre">nodoctest</span></code> or <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">nodoctest</span></code> or <code class="docutils literal notranslate"><span class="pre">%</span>
<span class="pre">nodoctest</span></code> or <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">nodoctest</span></code>, or any of these with different spacing),
then that file will be skipped.</p></li>
<li><p><strong>directory:</strong> If a directory contains a file <code class="docutils literal notranslate"><span class="pre">nodoctest.py</span></code>, then that
whole directory will be skipped.</p></li>
</ul>
<p>Neither of this applies to files or directories which are explicitly given
as command line arguments: those are always tested.</p>
</div>
</li>
<li><p><strong>optional:</strong> A line flagged with <code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code> is not tested unless
the <code class="docutils literal notranslate"><span class="pre">--optional=keyword</span></code> flag is passed to <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span></code> (see
<a class="reference internal" href="doctesting.html#section-optional-doctest-flag"><span class="std std-ref">Run Optional Doctests</span></a>). The main applications are:</p>
<ul>
<li><p><strong>optional packages:</strong> When a line requires an optional package to be
installed (e.g. the <code class="docutils literal notranslate"><span class="pre">sloane_database</span></code> package):</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">SloaneEncyclopedia</span><span class="p">[</span><span class="mi">60843</span><span class="p">]</span>    <span class="c1"># optional - sloane_database</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If one of the first 10 lines of a file starts with any of
<code class="docutils literal notranslate"><span class="pre">r&quot;&quot;&quot;</span> <span class="pre">sage.doctest:</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code>
(or <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span> <span class="pre">sage.doctest:</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code>
or <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">sage.doctest:</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code>
or <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">sage.doctest:</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code>
or <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">sage.doctest:</span> <span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></code>,
or any of these with different spacing),
then that file will be skipped unless
the <code class="docutils literal notranslate"><span class="pre">--optional=keyword</span></code> flag is passed to <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span></code>.</p>
<p>This does not apply to files which are explicitly given
as command line arguments: those are always tested.</p>
<p>If you add such a line to a file, you are strongly encouraged
to add a note to the module-level documentation, saying that
the doctests in this file will be skipped unless the
appropriate conditions are met.</p>
</div>
</li>
<li><p><strong>internet:</strong> For lines that require an internet connection:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">oeis</span><span class="p">(</span><span class="mi">60843</span><span class="p">)</span>                 <span class="c1"># optional - internet</span>
<span class="go">A060843: Busy Beaver problem: a(n) = maximal number of steps that an</span>
<span class="go">n-state Turing machine can make on an initially blank tape before</span>
<span class="go">eventually halting.</span>
</pre></div>
</div>
</li>
<li><p><strong>bug:</strong> For lines that describe bugs. Alternatively, use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">known</span> <span class="pre">bug</span></code>
instead: it is an alias for <code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">bug</span></code>.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>The following should yield 4.  See <span class="na">:trac:</span><span class="nv">`2`</span>. <span class="se">::</span>

<span class="s">    sage: 2+2  # optional - bug</span>
<span class="s">    5</span>
<span class="s">    sage: 2+2  # known bug</span>
<span class="s">    5</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Any words after <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">optional</span></code> are interpreted as a list of
package (spkg) names or other feature tags, separated by spaces.</p></li>
<li><p>Any punctuation other than underscores (<code class="docutils literal notranslate"><span class="pre">_</span></code>) and periods (<code class="docutils literal notranslate"><span class="pre">.</span></code>),
that is, commas, hyphens, semicolons, …, after the
first word ends the list of packages.  Hyphens or colons between the
word <code class="docutils literal notranslate"><span class="pre">optional</span></code> and the first package name are allowed.  Therefore,
you should not write <code class="docutils literal notranslate"><span class="pre">optional:</span> <span class="pre">needs</span> <span class="pre">package</span> <span class="pre">CHomP</span></code> but simply
<code class="docutils literal notranslate"><span class="pre">optional:</span> <span class="pre">CHomP</span></code>.</p></li>
<li><p>Optional tags are case-insensitive, so you could also write <code class="docutils literal notranslate"><span class="pre">optional:</span>
<span class="pre">chOMP</span></code>.</p></li>
</ul>
</div>
</li>
<li><p><strong>indirect doctest:</strong> in the docstring of a function <code class="docutils literal notranslate"><span class="pre">A(...)</span></code>, a line
calling <code class="docutils literal notranslate"><span class="pre">A</span></code> and in which the name <code class="docutils literal notranslate"><span class="pre">A</span></code> does not appear should have this
flag. This prevents <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">--coverage</span> <span class="pre">&lt;file&gt;</span></code> from reporting the docstring as
“not testing what it should test”.</p>
<p>Use it when testing special functions like <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>, <code class="docutils literal notranslate"><span class="pre">__add__</span></code>,
etc. Use it also when you test the function by calling <code class="docutils literal notranslate"><span class="pre">B</span></code> which
internally calls <code class="docutils literal notranslate"><span class="pre">A</span></code>:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>This is the docstring of an <span class="s">``__add__``</span> method. The following
example tests it, but <span class="s">``__add__``</span> is not written anywhere<span class="se">::</span>

<span class="s">    sage: 1+1 # indirect doctest</span>
<span class="s">    2</span>
</pre></div>
</div>
</li>
<li><p><strong>32-bit</strong> or <strong>64-bit:</strong> for tests that behave differently on 32-bit or
64-bit machines. Note that this particular flag is to be applied on the
<strong>output</strong> lines, not the input lines:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="mi">31</span> <span class="o">+</span> <span class="mi">2</span><span class="o">^</span><span class="mi">13</span><span class="p">)</span>
<span class="go">8193                      # 32-bit</span>
<span class="go">2147491840                # 64-bit</span>
</pre></div>
</div>
</li>
</ul>
<p>Using <code class="docutils literal notranslate"><span class="pre">search_src</span></code> from the Sage prompt (or <code class="docutils literal notranslate"><span class="pre">grep</span></code>), one can
easily find the aforementioned keywords. In the case of <code class="docutils literal notranslate"><span class="pre">todo:</span> <span class="pre">not</span>
<span class="pre">implemented</span></code>, one can use the results of such a search to direct
further development on Sage.</p>
</section>
</section>
<section id="running-automated-doctests">
<span id="chapter-testing"></span><h2>Running Automated Doctests<a class="headerlink" href="#running-automated-doctests" title="Permalink to this heading">#</a></h2>
<p>This section describes Sage’s automated testing of test files of the
following types: <code class="docutils literal notranslate"><span class="pre">.py</span></code>, <code class="docutils literal notranslate"><span class="pre">.pyx</span></code>, <code class="docutils literal notranslate"><span class="pre">.sage</span></code>, <code class="docutils literal notranslate"><span class="pre">.rst</span></code>. Briefly, use
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;file&gt;</span></code> to test that the examples in <code class="docutils literal notranslate"><span class="pre">&lt;file&gt;</span></code> behave
exactly as claimed. See the following subsections for more
details. See also <a class="reference internal" href="#section-docstrings"><span class="std std-ref">Documentation Strings</span></a> for a discussion on how to
include examples in documentation strings and what conventions to
follow. The chapter <a class="reference internal" href="doctesting.html#chapter-doctesting"><span class="std std-ref">Running Sage’s doctests</span></a> contains a tutorial on
doctesting modules in the Sage library.</p>
<section id="testing-py-pyx-and-sage-files">
<span id="section-testpython"></span><h3>Testing .py, .pyx and .sage Files<a class="headerlink" href="#testing-py-pyx-and-sage-files" title="Permalink to this heading">#</a></h3>
<p>Run <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.py&gt;</span></code> to test all code examples in
<code class="docutils literal notranslate"><span class="pre">filename.py</span></code>. Similar remarks apply to <code class="docutils literal notranslate"><span class="pre">.sage</span></code> and <code class="docutils literal notranslate"><span class="pre">.pyx</span></code>
files:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sage -t <span class="o">[</span>--verbose<span class="o">]</span> <span class="o">[</span>--optional<span class="o">]</span>  <span class="o">[</span>files and directories ... <span class="o">]</span>
</pre></div>
</div>
<p>The Sage doctesting framework is based on the standard Python doctest
module, but with many additional features (such as parallel testing,
timeouts, optional tests).  The Sage doctester recognizes <code class="docutils literal notranslate"><span class="pre">sage:</span></code>
prompts as well as <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code> prompts.  It also preparses the doctests,
just like in interactive Sage sessions.</p>
<p>Your file passes the tests if the code in it will run when entered
at the <code class="docutils literal notranslate"><span class="pre">sage:</span></code> prompt with no extra imports. Thus users are
guaranteed to be able to exactly copy code out of the examples you
write for the documentation and have them work.</p>
<p>For more information, see <a class="reference internal" href="doctesting.html#chapter-doctesting"><span class="std std-ref">Running Sage’s doctests</span></a>.</p>
</section>
<section id="testing-rest-documentation">
<h3>Testing reST Documentation<a class="headerlink" href="#testing-rest-documentation" title="Permalink to this heading">#</a></h3>
<p>Run <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.rst&gt;</span></code> to test the examples in verbatim
environments in reST documentation.</p>
<p>Of course in reST files, one often inserts explanatory texts between
different verbatim environments. To link together verbatim
environments, use the <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">link</span></code> comment. For example:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>EXAMPLES<span class="se">::</span>

<span class="s">        sage: a = 1</span>


Next we add 1 to <span class="s">``a``</span>.

<span class="p">..</span> <span class="ow">link</span><span class="p">::</span>

        sage: 1 + a
        2
</pre></div>
</div>
<p>If you want to link all the verbatim environments together, you can
put <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">linkall</span></code> anywhere in the file, on a line by itself.  (For
clarity, it might be best to put it near the top of the file.)  Then
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span></code> will act as if there were a <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">link</span></code> before each
verbatim environment.  The file
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en/tutorial/interfaces.rst</span></code> contains a
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">linkall</span></code> directive, for example.</p>
<p>You can also put <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">skip</span></code> right before a verbatim environment to
have that example skipped when testing the file.  This goes in the
same place as the <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">link</span></code> in the previous example.</p>
<p>See the files in <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en/tutorial/</span></code> for many
examples of how to include automated testing in reST documentation for
Sage.</p>
</section>
</section>
<section id="general-coding-style-regarding-whitespace">
<span id="section-coding-general-whitespace"></span><h2>General Coding Style Regarding Whitespace<a class="headerlink" href="#general-coding-style-regarding-whitespace" title="Permalink to this heading">#</a></h2>
<p>Use spaces instead of tabs for indentation. The only exception is for
makefiles, in which tabs have a syntactic meaning different from
spaces.</p>
<p>Do not add trailing whitespace.</p>
<p>Sage provides editor configuration for Emacs, using the file
<code class="docutils literal notranslate"><span class="pre">.dir-locals.el</span></code>, to use spaces instead of tabs.  Regarding trailing
whitespace, see <a class="reference external" href="https://www.emacswiki.org/emacs/DeletingWhitespace">https://www.emacswiki.org/emacs/DeletingWhitespace</a>
for various solutions.</p>
<p>If you use another editor, we recommend to configure it so you do not
add tabs to files. See <a class="reference internal" href="workspace.html#section-ide"><span class="std std-ref">Configuring text editors and IDEs for use with Sage</span></a>.</p>
</section>
<section id="global-options">
<h2>Global Options<a class="headerlink" href="#global-options" title="Permalink to this heading">#</a></h2>
<p>Global options for classes can be defined in Sage using
<a class="reference external" href="../reference/structure/sage/structure/global_options.html#sage.structure.global_options.GlobalOptions" title="(in Parents and Elements v9.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">GlobalOptions</span></code></a>.</p>
</section>
<section id="miscellaneous-minor-things">
<h2>Miscellaneous minor things<a class="headerlink" href="#miscellaneous-minor-things" title="Permalink to this heading">#</a></h2>
<p>Some decisions are arbitrary, but common conventions make life easier.</p>
<ul>
<li><p>Non-ASCII names in identifiers:</p>
<ul class="simple">
<li><p>Translate <em>ä</em> and <em>ö</em> to <em>ae</em> and <em>oe</em>, like <code class="docutils literal notranslate"><span class="pre">moebius_function</span></code>
for Möbius function.</p></li>
<li><p>Translate <em>á</em> to <em>a</em>, like <code class="docutils literal notranslate"><span class="pre">lovasz_number</span></code> for Lovász number.</p></li>
</ul>
</li>
<li><p>Common function keyword arguments:</p>
<p>This is a list of some keyword arguments that many functions and
methods take.  For consistency, you should use the keywords from the
list below with the meaning as explained here. Do not use a
different keyword with the same meaning (for example, do not use
<code class="docutils literal notranslate"><span class="pre">method</span></code>; use <code class="docutils literal notranslate"><span class="pre">algorithm</span></code> instead).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">algorithm</span></code>, a string or <code class="docutils literal notranslate"><span class="pre">None</span></code>: choose between various
implementation or algorithm. Use <code class="docutils literal notranslate"><span class="pre">None</span></code> as a default that
selects a sensible default, which could depend on installed
optional packages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">certificate</span></code>, a Boolean with <code class="docutils literal notranslate"><span class="pre">False</span></code> as default: whether the
function should return some kind of certificate together with the
result. With <code class="docutils literal notranslate"><span class="pre">certificate=True</span></code> the return value should be a
pair <span class="math notranslate nohighlight">\((r, c)\)</span> where <span class="math notranslate nohighlight">\(r\)</span> is the result that would be given with
<code class="docutils literal notranslate"><span class="pre">certificate=False</span></code> and <span class="math notranslate nohighlight">\(c\)</span> is the certificate or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
there is no meaningful certificate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proof</span></code>, a Boolean with <code class="docutils literal notranslate"><span class="pre">True</span></code> as default: if <code class="docutils literal notranslate"><span class="pre">True</span></code>,
require a mathematically proven computation. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, a
probabilistic algorithm or an algorithm relying to non-proved
hypothesis like RH can be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check</span></code>, a Boolean: do some additional checks to verify the
input parameters. This should not otherwise influence the
functioning of the code: if code works with <code class="docutils literal notranslate"><span class="pre">check=True</span></code>, it should
also work with <code class="docutils literal notranslate"><span class="pre">check=False</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coerce</span></code>, a Boolean: convert the input parameters to a suitable
parent. This is typically used in constructors. You can call a
method with <code class="docutils literal notranslate"><span class="pre">coerce=False</span></code> to skip some checks if the parent is
known to be correct.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inplace</span></code>, a Boolean: whether to modify the object in-place or
to return a copy.</p></li>
</ul>
</li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reviewer_checklist.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">The reviewer’s check list</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="workspace.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Setting up your workspace</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">General Conventions</a><ul>
<li><a class="reference internal" href="#python-code-style">Python Code Style</a></li>
<li><a class="reference internal" href="#files-and-directory-structure">Files and Directory Structure</a></li>
<li><a class="reference internal" href="#learn-by-copy-paste">Learn by copy/paste</a></li>
<li><a class="reference internal" href="#headings-of-sage-library-code-files">Headings of Sage Library Code Files</a></li>
<li><a class="reference internal" href="#documentation-strings">Documentation Strings</a><ul>
<li><a class="reference internal" href="#the-docstring-of-a-function-content">The docstring of a function: content</a><ul>
<li><a class="reference internal" href="#note-about-sphinx-directives-vs-other-blocks">Note about Sphinx directives vs. other blocks</a></li>
<li><a class="reference internal" href="#sage-documentation-style">Sage documentation style</a></li>
<li><a class="reference internal" href="#sage-s-master-bibliography-file">Sage’s master <strong>BIBLIOGRAPHY</strong> file</a></li>
<li><a class="reference internal" href="#template">Template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fine-points-on-styles">Fine points on styles</a><ul>
<li><a class="reference internal" href="#private-functions">Private functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#latex-typesetting">LaTeX Typesetting</a></li>
<li><a class="reference internal" href="#writing-testable-examples">Writing Testable Examples</a></li>
<li><a class="reference internal" href="#special-markup-to-influence-doctests">Special Markup to Influence Doctests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-automated-doctests">Running Automated Doctests</a><ul>
<li><a class="reference internal" href="#testing-py-pyx-and-sage-files">Testing .py, .pyx and .sage Files</a></li>
<li><a class="reference internal" href="#testing-rest-documentation">Testing reST Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-coding-style-regarding-whitespace">General Coding Style Regarding Whitespace</a></li>
<li><a class="reference internal" href="#global-options">Global Options</a></li>
<li><a class="reference internal" href="#miscellaneous-minor-things">Miscellaneous minor things</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"ZZ": "\\Bold{Z}", "NN": "\\Bold{N}", "RR": "\\Bold{R}", "CC": "\\Bold{C}", "QQ": "\\Bold{Q}", "QQbar": "\\overline{\\QQ}", "GF": ["\\Bold{F}_{#1}", 1], "Zp": ["\\Bold{Z}_{#1}", 1], "Qp": ["\\Bold{Q}_{#1}", 1], "Zmod": ["\\ZZ/#1\\ZZ", 1], "CDF": "\\Bold{C}", "CIF": "\\Bold{C}", "CLF": "\\Bold{C}", "RDF": "\\Bold{R}", "RIF": "\\Bold{I} \\Bold{R}", "RLF": "\\Bold{R}", "SL": "\\mathrm{SL}", "PSL": "\\mathrm{PSL}", "Bold": ["\\mathbf{#1}", 1]}, "inlineMath": [["$", "$"], ["\\(", "\\)"]], "maxBuffer": 51200, "autoload": {"color": [], "colorv2": ["color"]}}}</script>
    <script defer="defer" src="_static/mathjax/tex-chtml.js"></script>
    </body>
</html>