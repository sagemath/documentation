<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Testing on Multiple Platforms" href="portability_testing.html" /><link rel="prev" title="General Conventions" href="coding_basics.html" />

    <meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Running Sage’s Doctests - Developer Guide</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Developer Guide</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo_sagemath_black.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo_sagemath_white.svg" alt="Dark Logo"/>
  </div>
  
      <span class="sidebar-brand-text">Sage 10.0 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-home">
  <div class="sidebar-tree">
    <ul><li class="toctree-l1">
      <a class="reference internal" href="index.html">Home - Developer Guide</a>
    </li></ul>
  </div>
</div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Development Walk-through</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_setup.html">Setting Up Git</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="github.html">The Sage Repository on GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Using Git with GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="review.html">Reviewing Code</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="git_basic.html">Git Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_advanced.html">Advanced Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_background.html">Git Tips and References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workspace.html">Setting up your workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_basics.html">General Conventions</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Running Sage’s Doctests</a></li>
<li class="toctree-l1"><a class="reference internal" href="portability_testing.html">Testing on Multiple Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Additional Development and Testing Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sage_manuals.html">The Sage Manuals</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="coding_in_python.html">Coding in Python for Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_in_cython.html">Coding in Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_in_other.html">Using External Libraries and Interfaces</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging Third-Party Code for Sage</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_sage_library.html">Packaging the Sage Library for Distribution</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="running-sage-s-doctests">
<span id="chapter-doctesting"></span><h1>Running Sage’s Doctests<a class="headerlink" href="#running-sage-s-doctests" title="Permalink to this heading">#</a></h1>
<p>Doctesting a function ensures that the function performs as claimed by
its documentation. Testing can be performed using one thread or
multiple threads. After compiling a source version of Sage, doctesting
can be run on the whole Sage library, on all modules under a given
directory, or on a specified module only. For the purposes of this
chapter, suppose we have compiled Sage 6.0 from source and the top
level Sage directory is:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span><span class="nb">pwd</span>
<span class="go">/scratch/jdemeyer/build/sage-6.0</span>
</pre></div>
</div>
<p>See the section <a class="reference internal" href="coding_basics.html#chapter-testing"><span class="std std-ref">Running automated doctests</span></a> for information on Sage’s
automated testing process. The general syntax for doctesting is as
follows. To doctest a module in the library of a version of Sage, use
this syntax:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/path/to/sage-x.y.z/sage -t [--long] /path/to/sage-x.y.z/path/to/module.py[x]
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">--long</span></code> is an optional argument (see <a class="reference internal" href="#section-options"><span class="std std-ref">Optional arguments</span></a>
for more options). The version of <code class="docutils literal notranslate"><span class="pre">sage</span></code> used must match the version
of Sage containing the module we want to doctest. A Sage module can be
either a Python script (with the file extension “.py”) or it can be a
Cython script, in which case it has the file extension “.pyx”.</p>
<section id="testing-a-module">
<h2>Testing a module<a class="headerlink" href="#testing-a-module" title="Permalink to this heading">#</a></h2>
<p>Say we want to run all tests in the sudoku module
<code class="docutils literal notranslate"><span class="pre">sage/games/sudoku.py</span></code>. In a terminal window, first we <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the
top level Sage directory of our local Sage installation. Now  we can
start doctesting as demonstrated in the following terminal session:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t src/sage/games/sudoku.py
<span class="go">Running doctests with ID 2012-07-03-03-36-49-d82849c6.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/games/sudoku.py</span>
<span class="go">    [103 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 4.8 seconds</span>
<span class="go">    cpu time: 3.6 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
</pre></div>
</div>
<p>The numbers output by the test show that testing the sudoku module
takes about four seconds, while testing all specified modules took the
same amount of time; the total time required includes some startup
time for the code that runs the tests. In this case, we only tested
one module so it is not surprising that the total testing time is
approximately the same as the time required to test only that one
module. Notice that the syntax is:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t src/sage/games/sudoku.py
<span class="go">Running doctests with ID 2012-07-03-03-39-02-da6accbb.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/games/sudoku.py</span>
<span class="go">    [103 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 4.9 seconds</span>
<span class="go">    cpu time: 3.6 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
</pre></div>
</div>
<p>but not:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t sage/games/sudoku.py
<span class="go">Running doctests with ID 2012-07-03-03-40-53-6cc4f29f.</span>
<span class="go">No files matching sage/games/sudoku.py</span>
<span class="go">No files to doctest</span>
</pre></div>
</div>
<p>We can also first <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the directory containing the module
<code class="docutils literal notranslate"><span class="pre">sudoku.py</span></code> and doctest that module as follows:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span><span class="nb">cd</span> src/sage/games/
<span class="gp">[jdemeyer@sage games]$ </span>ls
<span class="go">__init__.py  hexad.py       sudoku.py           sudoku_backtrack.pyx</span>
<span class="go">all.py       quantumino.py  sudoku_backtrack.c</span>
<span class="gp">[jdemeyer@sage games]$ </span>../../../../sage -t sudoku.py
<span class="go">Running doctests with ID 2012-07-03-03-41-39-95ebd2ff.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t sudoku.py</span>
<span class="go">    [103 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 5.2 seconds</span>
<span class="go">    cpu time: 3.6 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
</pre></div>
</div>
<p>In all of the above terminal sessions, we used a local installation of
Sage to test its own modules. Even if we have a system-wide Sage
installation, using that version to doctest the modules of a local
installation is a recipe for confusion.</p>
<p>You can also run the Sage doctester as follows:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -tox -e doctest -- src/sage/games/sudoku.py
</pre></div>
</div>
<p>See <a class="reference internal" href="tools.html#chapter-tools"><span class="std std-ref">Additional Development and Testing Tools</span></a> for more information about tox.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">#</a></h2>
<p>To doctest modules of a Sage installation, from a terminal window we
first <code class="docutils literal notranslate"><span class="pre">cd</span></code> to the top level directory of that Sage installation,
otherwise known as the <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT</span></code> of that installation. When we
run tests, we use that particular Sage installation via the syntax
<code class="docutils literal notranslate"><span class="pre">./sage</span></code>; notice the “dot-forward-slash” at the front of
<code class="docutils literal notranslate"><span class="pre">sage</span></code>. This is a precaution against confusion that can arise when
our system has multiple Sage installations. For example, the following
syntax is acceptable because we explicitly specify the Sage
installation in the current <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t src/sage/games/sudoku.py
<span class="go">Running doctests with ID 2012-07-03-03-43-24-a3449f54.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/games/sudoku.py</span>
<span class="go">    [103 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 4.9 seconds</span>
<span class="go">    cpu time: 3.6 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
<span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t <span class="s2">&quot;src/sage/games/sudoku.py&quot;</span>
<span class="go">Running doctests with ID 2012-07-03-03-43-54-ac8ca007.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/games/sudoku.py</span>
<span class="go">    [103 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 4.9 seconds</span>
<span class="go">    cpu time: 3.6 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
</pre></div>
</div>
<p>The following syntax is not recommended as we are using a system-wide
Sage installation (if it exists):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>sage -t src/sage/games/sudoku.py
<span class="go">sage -t  &quot;src/sage/games/sudoku.py&quot;</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;/home/jdemeyer/sage/sage-6.0/src/sage/games/sudoku.py&quot;, line 515:</span>
<span class="go">    sage: next(h.solve(algorithm=&#39;backtrack&#39;))</span>
<span class="go">Exception raised:</span>
<span class="go">    Traceback (most recent call last):</span>
<span class="go">      File &quot;/usr/local/sage/local/bin/ncadoctest.py&quot;, line 1231, in run_one_test</span>
<span class="go">        self.run_one_example(test, example, filename, compileflags)</span>
<span class="go">      File &quot;/usr/local/sage/local/bin/sagedoctest.py&quot;, line 38, in run_one_example</span>
<span class="go">        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)</span>
<span class="go">      File &quot;/usr/local/sage/local/bin/ncadoctest.py&quot;, line 1172, in run_one_example</span>
<span class="go">        compileflags, 1) in test.globs</span>
<span class="go">      File &quot;&lt;doctest __main__.example_13[4]&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">        next(h.solve(algorithm=&#39;backtrack&#39;))###line 515:</span>
<span class="go">    sage: next(h.solve(algorithm=&#39;backtrack&#39;))</span>
<span class="go">      File &quot;/home/jdemeyer/.sage/tmp/sudoku.py&quot;, line 607, in solve</span>
<span class="go">        for soln in gen:</span>
<span class="go">      File &quot;/home/jdemeyer/.sage/tmp/sudoku.py&quot;, line 719, in backtrack</span>
<span class="go">        from sudoku_backtrack import backtrack_all</span>
<span class="go">    ImportError: No module named sudoku_backtrack</span>
<span class="go">**********************************************************************</span>
<span class="go">[...more errors...]</span>
<span class="go">2 items had failures:</span>
<span class="go">   4 of  15 in __main__.example_13</span>
<span class="go">   2 of   8 in __main__.example_14</span>
<span class="go">***Test Failed*** 6 failures.</span>
<span class="go">For whitespace errors, see the file /home/jdemeyer/.sage//tmp/.doctest_sudoku.py</span>
<span class="go">         [21.1 s]</span>

<span class="go">----------------------------------------------------------------------</span>
<span class="go">The following tests failed:</span>


<span class="go">        sage -t  &quot;src/sage/games/sudoku.py&quot;</span>
<span class="go">Total time for all tests: 21.3 seconds</span>
</pre></div>
</div>
<p>In this case, we received an error because the system-wide Sage
installation is a different (older) version than the one we are
using for Sage development.  Make sure you always test the files
with the correct version of Sage.</p>
</section>
<section id="parallel-testing-many-modules">
<h2>Parallel testing many modules<a class="headerlink" href="#parallel-testing-many-modules" title="Permalink to this heading">#</a></h2>
<p>So far we have used a single thread to doctest a module in the Sage
library. There are hundreds, even thousands of modules in the Sage
library. Testing them all using one thread would take a few
hours. Depending on our hardware, this could take up to six hours or
more. On a multi-core system, parallel doctesting can significantly
reduce the testing time. Unless we also want to use our computer
while doctesting in parallel, we can choose to devote all the cores
of our system for parallel testing.</p>
<p>Let us doctest all modules in a directory, first using a single thread
and then using four threads. For this example, suppose we want to test
all the modules under <code class="docutils literal notranslate"><span class="pre">sage/crypto/</span></code>. We can use a syntax similar to
that shown above to achieve this:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t src/sage/crypto
<span class="go">Running doctests with ID 2012-07-03-03-45-40-7f837dcf.</span>
<span class="go">Doctesting 24 files.</span>
<span class="go">sage -t src/sage/crypto/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/boolean_function.pyx</span>
<span class="go">    [252 tests, 4.4 s]</span>
<span class="go">sage -t src/sage/crypto/cipher.py</span>
<span class="go">    [10 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/classical.py</span>
<span class="go">    [718 tests, 11.3 s]</span>
<span class="go">sage -t src/sage/crypto/classical_cipher.py</span>
<span class="go">    [130 tests, 0.5 s]</span>
<span class="go">sage -t src/sage/crypto/cryptosystem.py</span>
<span class="go">    [82 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/lattice.py</span>
<span class="go">    [1 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/lfsr.py</span>
<span class="go">    [31 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/stream.py</span>
<span class="go">    [17 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/stream_cipher.py</span>
<span class="go">    [114 tests, 0.2 s]</span>
<span class="go">sage -t src/sage/crypto/util.py</span>
<span class="go">    [122 tests, 0.2 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/miniaes.py</span>
<span class="go">    [430 tests, 1.3 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/sdes.py</span>
<span class="go">    [290 tests, 0.9 s]</span>
<span class="go">sage -t src/sage/crypto/mq/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/mq/mpolynomialsystem.py</span>
<span class="go">    [320 tests, 9.1 s]</span>
<span class="go">sage -t src/sage/crypto/mq/mpolynomialsystemgenerator.py</span>
<span class="go">    [42 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/sbox.pyx</span>
<span class="go">    [124 tests, 0.8 s]</span>
<span class="go">sage -t src/sage/crypto/mq/sr.py</span>
<span class="go">    [435 tests, 5.5 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/blum_goldwasser.py</span>
<span class="go">    [135 tests, 0.2 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 38.1 seconds</span>
<span class="go">    cpu time: 29.8 seconds</span>
<span class="go">    cumulative wall time: 35.1 seconds</span>
</pre></div>
</div>
<p>Now we do the same thing, but this time we also use the optional
argument <code class="docutils literal notranslate"><span class="pre">--long</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -t --long src/sage/crypto/
<span class="go">Running doctests with ID 2012-07-03-03-48-11-c16721e6.</span>
<span class="go">Doctesting 24 files.</span>
<span class="go">sage -t --long src/sage/crypto/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/boolean_function.pyx</span>
<span class="go">    [252 tests, 4.2 s]</span>
<span class="go">sage -t --long src/sage/crypto/cipher.py</span>
<span class="go">    [10 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/classical.py</span>
<span class="go">    [718 tests, 10.3 s]</span>
<span class="go">sage -t --long src/sage/crypto/classical_cipher.py</span>
<span class="go">    [130 tests, 0.5 s]</span>
<span class="go">sage -t --long src/sage/crypto/cryptosystem.py</span>
<span class="go">    [82 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/lattice.py</span>
<span class="go">    [1 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/lfsr.py</span>
<span class="go">    [31 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/stream.py</span>
<span class="go">    [17 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/stream_cipher.py</span>
<span class="go">    [114 tests, 0.2 s]</span>
<span class="go">sage -t --long src/sage/crypto/util.py</span>
<span class="go">    [122 tests, 0.2 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/miniaes.py</span>
<span class="go">    [430 tests, 1.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/sdes.py</span>
<span class="go">    [290 tests, 0.7 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/mpolynomialsystem.py</span>
<span class="go">    [320 tests, 7.5 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/mpolynomialsystemgenerator.py</span>
<span class="go">    [42 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/sbox.pyx</span>
<span class="go">    [124 tests, 0.7 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/sr.py</span>
<span class="go">    [437 tests, 82.4 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/blum_goldwasser.py</span>
<span class="go">    [135 tests, 0.2 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 111.8 seconds</span>
<span class="go">    cpu time: 106.1 seconds</span>
<span class="go">    cumulative wall time: 108.5 seconds</span>
</pre></div>
</div>
<p>Notice the time difference between the first set of tests and the
second set, which uses the optional argument <code class="docutils literal notranslate"><span class="pre">--long</span></code>. Many tests in the
Sage library are flagged with <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">long</span> <span class="pre">time</span></code> because these are known to
take a long time to run through. Without using the optional <code class="docutils literal notranslate"><span class="pre">--long</span></code>
argument, the module <code class="docutils literal notranslate"><span class="pre">sage/crypto/mq/sr.py</span></code> took about five
seconds. With this optional argument, it required 82 seconds to run
through all tests in that module. Here is a snippet of a function in
the module <code class="docutils literal notranslate"><span class="pre">sage/crypto/mq/sr.py</span></code> with a doctest that has been flagged
as taking a long time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_consistency</span><span class="p">(</span><span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test all combinations of ``r``, ``c``, ``e`` and ``n`` in ``(1,</span>
<span class="sd">    2)`` for consistency of random encryptions and their polynomial</span>
<span class="sd">    systems. `\GF{2}` and `\GF{2^e}` systems are tested. This test takes</span>
<span class="sd">    a while.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    - ``max_n`` -- maximal number of rounds to consider (default: 2)</span>
<span class="sd">    - ``kwargs`` -- are passed to the SR constructor</span>

<span class="sd">    TESTS:</span>

<span class="sd">    The following test called with ``max_n`` = 2 requires a LOT of RAM</span>
<span class="sd">    (much more than 2GB).  Since this might cause the doctest to fail</span>
<span class="sd">    on machines with &quot;only&quot; 2GB of RAM, we test ``max_n`` = 1, which</span>
<span class="sd">    has a more reasonable memory usage. ::</span>

<span class="sd">        sage: from sage.crypto.mq.sr import test_consistency</span>
<span class="sd">        sage: test_consistency(1)  # long time (80s on sage.math, 2011)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Now we doctest the same directory in parallel using 4 threads:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -tp <span class="m">4</span> src/sage/crypto/
<span class="go">Running doctests with ID 2012-07-07-00-11-55-9b17765e.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 24 files using 4 threads.</span>
<span class="go">sage -t src/sage/crypto/boolean_function.pyx</span>
<span class="go">    [252 tests, 3.8 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/miniaes.py</span>
<span class="go">    [429 tests, 1.1 s]</span>
<span class="go">sage -t src/sage/crypto/mq/sr.py</span>
<span class="go">    [432 tests, 5.7 s]</span>
<span class="go">sage -t src/sage/crypto/sbox.pyx</span>
<span class="go">    [123 tests, 0.8 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/sdes.py</span>
<span class="go">    [289 tests, 0.6 s]</span>
<span class="go">sage -t src/sage/crypto/classical_cipher.py</span>
<span class="go">    [123 tests, 0.4 s]</span>
<span class="go">sage -t src/sage/crypto/stream_cipher.py</span>
<span class="go">    [113 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/blum_goldwasser.py</span>
<span class="go">    [134 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/lfsr.py</span>
<span class="go">    [30 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/util.py</span>
<span class="go">    [121 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/crypto/cryptosystem.py</span>
<span class="go">    [79 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/stream.py</span>
<span class="go">    [12 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/mq/mpolynomialsystemgenerator.py</span>
<span class="go">    [40 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/cipher.py</span>
<span class="go">    [3 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/lattice.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/public_key/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/mq/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/block_cipher/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/crypto/mq/mpolynomialsystem.py</span>
<span class="go">    [318 tests, 8.4 s]</span>
<span class="go">sage -t src/sage/crypto/classical.py</span>
<span class="go">    [717 tests, 10.4 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 12.9 seconds</span>
<span class="go">    cpu time: 30.5 seconds</span>
<span class="go">    cumulative wall time: 31.7 seconds</span>
<span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -tp <span class="m">4</span> --long src/sage/crypto/
<span class="go">Running doctests with ID 2012-07-07-00-13-04-d71f3cd4.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 24 files using 4 threads.</span>
<span class="go">sage -t --long src/sage/crypto/boolean_function.pyx</span>
<span class="go">    [252 tests, 3.7 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/miniaes.py</span>
<span class="go">    [429 tests, 1.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/sbox.pyx</span>
<span class="go">    [123 tests, 0.8 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/sdes.py</span>
<span class="go">    [289 tests, 0.6 s]</span>
<span class="go">sage -t --long src/sage/crypto/classical_cipher.py</span>
<span class="go">    [123 tests, 0.4 s]</span>
<span class="go">sage -t --long src/sage/crypto/util.py</span>
<span class="go">    [121 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/stream_cipher.py</span>
<span class="go">    [113 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/blum_goldwasser.py</span>
<span class="go">    [134 tests, 0.1 s]</span>
<span class="go">sage -t --long src/sage/crypto/lfsr.py</span>
<span class="go">    [30 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/cryptosystem.py</span>
<span class="go">    [79 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/stream.py</span>
<span class="go">    [12 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/mpolynomialsystemgenerator.py</span>
<span class="go">    [40 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/cipher.py</span>
<span class="go">    [3 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/lattice.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/block_cipher/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/public_key/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/mpolynomialsystem.py</span>
<span class="go">    [318 tests, 9.0 s]</span>
<span class="go">sage -t --long src/sage/crypto/classical.py</span>
<span class="go">    [717 tests, 10.5 s]</span>
<span class="go">sage -t --long src/sage/crypto/mq/sr.py</span>
<span class="go">    [434 tests, 88.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 90.4 seconds</span>
<span class="go">    cpu time: 113.4 seconds</span>
<span class="go">    cumulative wall time: 114.5 seconds</span>
</pre></div>
</div>
<p>As the number of threads increases, the total testing time
decreases.</p>
</section>
<section id="parallel-testing-the-whole-sage-library">
<span id="section-parallel-test-whole-library"></span><h2>Parallel testing the whole Sage library<a class="headerlink" href="#parallel-testing-the-whole-sage-library" title="Permalink to this heading">#</a></h2>
<p>The main Sage library resides in the directory
<code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/</span></code>. We can use the syntax described above
to doctest the main library using multiple threads. When doing release
management or patching the main Sage library, a release manager would
parallel test the library using 10 threads with the following command:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>./sage -tp <span class="m">10</span> --long src/
</pre></div>
</div>
<p>Another way is run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptestlong</span></code>, which builds Sage (if necessary),
builds the Sage documentation (if necessary), and then runs parallel
doctests.  This determines the number of threads by reading the
environment variable <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">MAKE</span></code>: if it is set to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j12</span></code>, then
use 12 threads.  If <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">MAKE</span></code> is not set, then by default it uses
the number of CPU cores (as determined by the Python function
<code class="docutils literal notranslate"><span class="pre">multiprocessing.cpu_count()</span></code>) with a minimum of 2 and a maximum of 8.</p>
<p>In any case, this will test the Sage library with multiple threads:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[jdemeyer@sage sage-6.0]$ </span>make ptestlong
</pre></div>
</div>
<p>Any of the following commands would also doctest the Sage library or
one of its clones:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>make test
make check
make testlong
make ptest
make ptestlong
</pre></div>
</div>
<p>The differences are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code> — These two commands run the same
set of tests. First the Sage standard documentation is tested,
i.e. the documentation that resides in</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/common</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/fr</span></code></p></li>
</ul>
<p>Finally, the commands doctest the Sage library. For more details on
these command, see the file <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/Makefile</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">testlong</span></code> — This command doctests the standard
documentation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/common</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/en</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/src/doc/fr</span></code></p></li>
</ul>
<p>and then the Sage library. Doctesting is run with the optional
argument <code class="docutils literal notranslate"><span class="pre">--long</span></code>. See the file <code class="docutils literal notranslate"><span class="pre">SAGE_ROOT/Makefile</span></code> for further
details.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptest</span></code> — Similar to the commands <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">check</span></code>. However, doctesting is run with the number of threads as
described above for <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptestlong</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptestlong</span></code> — Similar to the command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptest</span></code>, but
using the optional argument <code class="docutils literal notranslate"><span class="pre">--long</span></code> for doctesting.</p></li>
</ul>
<p>The underlying command for running these tests is <code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--all</span></code>. For
example, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ptestlong</span></code> executes the command
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">-p</span> <span class="pre">--all</span> <span class="pre">--long</span> <span class="pre">--logfile=logs/ptestlong.log</span></code>. So if you want
to add extra flags when you run these tests, for example <code class="docutils literal notranslate"><span class="pre">--verbose</span></code>,
you can execute
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">-p</span> <span class="pre">--all</span> <span class="pre">--long</span> <span class="pre">--verbose</span> <span class="pre">--logfile=path/to/logfile</span></code>.
Some of the extra testing options are discussed here; run
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">-h</span></code> for a complete list.</p>
</section>
<section id="beyond-the-sage-library">
<h2>Beyond the Sage library<a class="headerlink" href="#beyond-the-sage-library" title="Permalink to this heading">#</a></h2>
<p>Doctesting also works fine for files not in the Sage library.  For
example, suppose we have a Python script called
<code class="docutils literal notranslate"><span class="pre">my_python_script.py</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[mvngu@sage build]$ </span>cat my_python_script.py
<span class="go">from sage.all_cmdline import *   # import sage library</span>

<span class="go">def square(n):</span>
<span class="go">    &quot;&quot;&quot;</span>
<span class="go">    Return the square of n.</span>

<span class="go">    EXAMPLES::</span>

<span class="go">        sage: square(2)</span>
<span class="go">        4</span>
<span class="go">    &quot;&quot;&quot;</span>
<span class="go">    return n**2</span>
</pre></div>
</div>
<p>Then we can doctest it just as with Sage library files:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[mvngu@sage sage-6.0]$ </span>./sage -t my_python_script.py
<span class="go">Running doctests with ID 2012-07-07-00-17-56-d056f7c0.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t my_python_script.py</span>
<span class="go">    [1 test, 0.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 2.2 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
</pre></div>
</div>
<p>Doctesting can also be performed on Sage scripts. Say we have a Sage
script called <code class="docutils literal notranslate"><span class="pre">my_sage_script.sage</span></code> with the following content:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[mvngu@sage sage-6.0]$ </span>cat my_sage_script.sage
<span class="go">def cube(n):</span>
<span class="go">    r&quot;&quot;&quot;</span>
<span class="go">    Return the cube of n.</span>

<span class="go">    EXAMPLES::</span>

<span class="go">        sage: cube(2)</span>
<span class="go">        8</span>
<span class="go">    &quot;&quot;&quot;</span>
<span class="go">    return n**3</span>
</pre></div>
</div>
<p>Then we can doctest it just as for Python files:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[mvngu@sage build]$ </span>sage-6.0/sage -t my_sage_script.sage
<span class="go">Running doctests with ID 2012-07-07-00-20-06-82ee728c.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t my_sage_script.sage</span>
<span class="go">    [1 test, 0.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 2.5 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
</pre></div>
</div>
<p>Alternatively, we can preparse it to convert it to a Python script,
and then doctest that:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[mvngu@sage build]$ </span>sage-6.0/sage --preparse my_sage_script.sage
<span class="gp">[mvngu@sage build]$ </span>cat my_sage_script.sage.py
<span class="gp"># </span>This file was *autogenerated* from the file my_sage_script.sage.
<span class="go">from sage.all_cmdline import *   # import sage library</span>
<span class="go">_sage_const_3 = Integer(3)</span>
<span class="go">def cube(n):</span>
<span class="go">    r&quot;&quot;&quot;</span>
<span class="go">    Return the cube of n.</span>

<span class="go">    EXAMPLES::</span>

<span class="go">        sage: cube(2)</span>
<span class="go">        8</span>
<span class="go">    &quot;&quot;&quot;</span>
<span class="go">    return n**_sage_const_3</span>
<span class="gp">[mvngu@sage build]$ </span>sage-6.0/sage -t my_sage_script.sage.py
<span class="go">Running doctests with ID 2012-07-07-00-26-46-2bb00911.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t my_sage_script.sage.py</span>
<span class="go">    [2 tests, 0.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 2.3 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
</pre></div>
</div>
</section>
<section id="doctesting-from-within-sage">
<h2>Doctesting from within Sage<a class="headerlink" href="#doctesting-from-within-sage" title="Permalink to this heading">#</a></h2>
<p>You can run doctests from within Sage, which can be useful since you
don’t have to wait for Sage to start.  Use the <code class="docutils literal notranslate"><span class="pre">run_doctests</span></code>
function in the global namespace, passing it either a string or a module:</p>
<div class="highlight-ipycon notranslate"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">run_doctests</span><span class="p">(</span><span class="n">sage</span><span class="o">.</span><span class="n">combinat</span><span class="o">.</span><span class="n">affine_permutation</span><span class="p">)</span>
<span class="go">Running doctests with ID 2018-02-07-13-23-13-89fe17b1.</span>
<span class="go">Git branch: develop</span>
<span class="go">Using --optional=sagemath_doc_html,sage</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t /opt/sage/sage_stable/src/sage/combinat/affine_permutation.py</span>
<span class="go">    [338 tests, 4.32 s]</span>
<span class="gt">----------------------------------------------------------------------</span>
<span class="n">All</span> <span class="n">tests</span> <span class="n">passed</span><span class="err">!</span>
<span class="gt">----------------------------------------------------------------------</span>
<span class="n">Total</span> <span class="n">time</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">tests</span><span class="p">:</span> <span class="mf">4.4</span> <span class="n">seconds</span>
    <span class="n">cpu</span> <span class="n">time</span><span class="p">:</span> <span class="mf">3.6</span> <span class="n">seconds</span>
    <span class="n">cumulative</span> <span class="n">wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">4.3</span> <span class="n">seconds</span>
</pre></div>
</div>
</section>
<section id="optional-arguments">
<span id="section-options"></span><h2>Optional arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this heading">#</a></h2>
<section id="run-long-doctests">
<h3>Run long doctests<a class="headerlink" href="#run-long-doctests" title="Permalink to this heading">#</a></h3>
<p>Ideally, doctests should not take any noticeable amount of time. If
you really need longer-running doctests (anything beyond about one
second) then you should mark them as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sage: my_long_test()  # long time
</pre></div>
</div>
<p>Even then, long doctests should ideally complete in 5 seconds or
less. We know that you (the author) want to show off the capabilities
of your code, but this is not the place to do so. Long-running tests
will sooner or later hurt our ability to run the testsuite. Really,
doctests should be as fast as possible while providing coverage for
the code.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--long</span></code> flag to run doctests that have been marked with the
comment <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">long</span> <span class="pre">time</span></code>. These tests are normally skipped in order to
reduce the time spent running tests:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t src/sage/rings/tests.py
<span class="go">Running doctests with ID 2012-06-21-16-00-13-40835825.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t tests.py</span>
<span class="go">    [18 tests, 1.1 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 2.9 seconds</span>
<span class="go">    cpu time: 0.9 seconds</span>
<span class="go">    cumulative wall time: 1.1 seconds</span>
</pre></div>
</div>
<p>In order to run the long tests as well, do the following:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --long src/sage/rings/tests.py
<span class="go">Running doctests with ID 2012-06-21-16-02-05-d13a9a24.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t tests.py</span>
<span class="go">    [20 tests, 34.7 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 46.5 seconds</span>
<span class="go">    cpu time: 25.2 seconds</span>
<span class="go">    cumulative wall time: 34.7 seconds</span>
</pre></div>
</div>
<p>To find tests that take longer than the allowed time use the
<code class="docutils literal notranslate"><span class="pre">--warn-long</span></code> flag.  Without any options it will cause tests to
print a warning if they take longer than 1.0 second. Note that this is
a warning, not an error:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --warn-long src/sage/rings/factorint.pyx
<span class="go">Running doctests with ID 2012-07-14-03-27-03-2c952ac1.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t --warn-long src/sage/rings/factorint.pyx</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/rings/factorint.pyx&quot;, line 125, in sage.rings.factorint.base_exponent</span>
<span class="go">Failed example:</span>
<span class="go">    base_exponent(-4)</span>
<span class="go">Test ran for 4.09 s</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/rings/factorint.pyx&quot;, line 153, in sage.rings.factorint.factor_aurifeuillian</span>
<span class="go">Failed example:</span>
<span class="go">    fa(2^6+1)</span>
<span class="go">Test ran for 2.22 s</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/rings/factorint.pyx&quot;, line 155, in sage.rings.factorint.factor_aurifeuillian</span>
<span class="go">Failed example:</span>
<span class="go">    fa(2^58+1)</span>
<span class="go">Test ran for 2.22 s</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/rings/factorint.pyx&quot;, line 163, in sage.rings.factorint.factor_aurifeuillian</span>
<span class="go">Failed example:</span>
<span class="go">    fa(2^4+1)</span>
<span class="go">Test ran for 2.25 s</span>
<span class="go">**********************************************************************</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 16.1 seconds</span>
<span class="go">    cpu time: 9.7 seconds</span>
<span class="go">    cumulative wall time: 10.9 seconds</span>
</pre></div>
</div>
<p>You can also pass in an explicit amount of time:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --long --warn-long <span class="m">2</span>.0 src/sage/rings/tests.py
<span class="go">Running doctests with ID 2012-07-14-03-30-13-c9164c9d.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t --long --warn-long 2.0 tests.py</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;tests.py&quot;, line 240, in sage.rings.tests.test_random_elements</span>
<span class="go">Failed example:</span>
<span class="go">    sage.rings.tests.test_random_elements(trials=1000)  # long time (5 seconds)</span>
<span class="go">Test ran for 13.36 s</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;tests.py&quot;, line 283, in sage.rings.tests.test_random_arith</span>
<span class="go">Failed example:</span>
<span class="go">    sage.rings.tests.test_random_arith(trials=1000)   # long time (5 seconds?)</span>
<span class="go">Test ran for 12.42 s</span>
<span class="go">**********************************************************************</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 27.6 seconds</span>
<span class="go">    cpu time: 24.8 seconds</span>
<span class="go">    cumulative wall time: 26.3 seconds</span>
</pre></div>
</div>
<p>Finally, you can disable any warnings about long tests with
<code class="docutils literal notranslate"><span class="pre">--warn-long</span> <span class="pre">0</span></code>.</p>
<p>Doctests start from a random seed:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[kliem@sage sage-9.2]$ </span>sage -t src/sage/doctest/tests/random_seed.rst
<span class="go">Running doctests with ID 2020-06-23-23-22-59-49f37a55.</span>
<span class="go">...</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t --warn-long 89.5 --random-seed=112986622569797306072457879734474628454 src/sage/doctest/tests/random_seed.rst</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/doctest/tests/random_seed.rst&quot;, line 3, in sage.doctest.tests.random_seed</span>
<span class="go">Failed example:</span>
<span class="go">    randint(5, 10)</span>
<span class="go">Expected:</span>
<span class="go">    9</span>
<span class="go">Got:</span>
<span class="go">    8</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">   1 of   2 in sage.doctest.tests.random_seed</span>
<span class="go">    [1 test, 1 failure, 0.00 s]</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">sage -t --warn-long 89.5 --random-seed=112986622569797306072457879734474628454 src/sage/doctest/tests/random_seed.rst  # 1 doctest failed</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 0.0 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
</pre></div>
</div>
<p>This seed can be set explicitly to reproduce possible failures:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[kliem@sage sage-9.2]$ </span>sage -t --warn-long <span class="m">89</span>.5 --random-seed<span class="o">=</span><span class="m">112986622569797306072457879734474628454</span> src/sage/doctest/tests/random_seed.rst
<span class="go">Running doctests with ID 2020-06-23-23-24-28-14a52269.</span>
<span class="go">...</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t --warn-long 89.5 --random-seed=112986622569797306072457879734474628454 src/sage/doctest/tests/random_seed.rst</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;src/sage/doctest/tests/random_seed.rst&quot;, line 3, in sage.doctest.tests.random_seed</span>
<span class="go">Failed example:</span>
<span class="go">    randint(5, 10)</span>
<span class="go">Expected:</span>
<span class="go">    9</span>
<span class="go">Got:</span>
<span class="go">    8</span>
<span class="go">**********************************************************************</span>
<span class="go">1 item had failures:</span>
<span class="go">   1 of   2 in sage.doctest.tests.random_seed</span>
<span class="go">    [1 test, 1 failure, 0.00 s]</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">sage -t --warn-long 89.5 --random-seed=112986622569797306072457879734474628454 src/sage/doctest/tests/random_seed.rst  # 1 doctest failed</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 0.0 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
</pre></div>
</div>
<p>It can also be set explicitly using the environment variable
<code class="docutils literal notranslate"><span class="pre">SAGE_DOCTEST_RANDOM_SEED</span></code>.</p>
</section>
<section id="run-optional-doctests">
<span id="section-optional-doctest-flag"></span><h3>Run optional doctests<a class="headerlink" href="#run-optional-doctests" title="Permalink to this heading">#</a></h3>
<p>You can run tests that require optional packages by using the
<code class="docutils literal notranslate"><span class="pre">--optional</span></code> flag.  Obviously, you need to have installed the
necessary optional packages in order for these tests to succeed.  See
<a class="reference external" href="http://www.sagemath.org/packages/optional/">http://www.sagemath.org/packages/optional/</a> in order to download
optional packages.</p>
<p>By default, Sage only runs doctests that are not marked with the <code class="docutils literal notranslate"><span class="pre">optional</span></code> tag.  This is equivalent to running</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --optional<span class="o">=</span>sagemath_doc_html,sage src/sage/rings/real_mpfr.pyx
<span class="go">Running doctests with ID 2012-06-21-16-18-30-a368a200.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/rings/real_mpfr.pyx</span>
<span class="go">    [819 tests, 7.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 8.4 seconds</span>
<span class="go">    cpu time: 4.1 seconds</span>
<span class="go">    cumulative wall time: 7.0 seconds</span>
</pre></div>
</div>
<p>If you want to also run tests that require magma, you can do the following:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --optional<span class="o">=</span>sagemath_doc_html,sage,magma src/sage/rings/real_mpfr.pyx
<span class="go">Running doctests with ID 2012-06-21-16-18-30-a00a7319</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/rings/real_mpfr.pyx</span>
<span class="go">    [823 tests, 8.4 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 9.6 seconds</span>
<span class="go">    cpu time: 4.0 seconds</span>
<span class="go">    cumulative wall time: 8.4 seconds</span>
</pre></div>
</div>
<p>In order to just run the tests that are marked as requiring magma, omit <code class="docutils literal notranslate"><span class="pre">sage</span></code> and <code class="docutils literal notranslate"><span class="pre">sagemath_doc_html</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --optional<span class="o">=</span>magma src/sage/rings/real_mpfr.pyx
<span class="go">Running doctests with ID 2012-06-21-16-18-33-a2bc1fdf</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/rings/real_mpfr.pyx</span>
<span class="go">    [4 tests, 2.0 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 3.2 seconds</span>
<span class="go">    cpu time: 0.1 seconds</span>
<span class="go">    cumulative wall time: 2.0 seconds</span>
</pre></div>
</div>
<p>If you want Sage to detect external software or other capabilities
(such as magma, latex, internet) automatically and run all of the
relevant tests, then add <code class="docutils literal notranslate"><span class="pre">external</span></code>:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sage -t --optional<span class="o">=</span>external src/sage/rings/real_mpfr.pyx
<span class="go">Running doctests with ID 2016-03-16-14-10-21-af2ebb67.</span>
<span class="go">Using --optional=external</span>
<span class="go">External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t --warn-long 28.0 src/sage/rings/real_mpfr.pyx</span>
<span class="go">    [5 tests, 0.04 s]</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 0.5 seconds</span>
<span class="go">    cpu time: 0.0 seconds</span>
<span class="go">    cumulative wall time: 0.0 seconds</span>
<span class="go">External software detected for doctesting: magma</span>
</pre></div>
</div>
<p>To run all tests, regardless of whether they are marked optional, pass <code class="docutils literal notranslate"><span class="pre">all</span></code> as the <code class="docutils literal notranslate"><span class="pre">optional</span></code> tag:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --optional<span class="o">=</span>all src/sage/rings/real_mpfr.pyx
<span class="go">Running doctests with ID 2012-06-21-16-31-18-8c097f55</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/rings/real_mpfr.pyx</span>
<span class="go">    [865 tests, 11.2 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 12.8 seconds</span>
<span class="go">    cpu time: 4.7 seconds</span>
<span class="go">    cumulative wall time: 11.2 seconds</span>
</pre></div>
</div>
</section>
<section id="running-doctests-in-parallel">
<h3>Running doctests in parallel<a class="headerlink" href="#running-doctests-in-parallel" title="Permalink to this heading">#</a></h3>
<p>If you’re testing many files, you can get big speedups by using more
than one thread.  To run doctests in parallel use the <code class="docutils literal notranslate"><span class="pre">--nthreads</span></code>
flag (<code class="docutils literal notranslate"><span class="pre">-p</span></code> is a shortened version).  Pass in the number of threads
you would like to use (by default Sage just uses 1):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -tp <span class="m">2</span> src/sage/doctest/
<span class="go">Running doctests with ID 2012-06-22-19-09-25-a3afdb8c.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 8 files using 2 threads.</span>
<span class="go">sage -t src/sage/doctest/control.py</span>
<span class="go">    [114 tests, 4.6 s]</span>
<span class="go">sage -t src/sage/doctest/util.py</span>
<span class="go">    [114 tests, 0.6 s]</span>
<span class="go">sage -t src/sage/doctest/parsing.py</span>
<span class="go">    [187 tests, 0.5 s]</span>
<span class="go">sage -t src/sage/doctest/sources.py</span>
<span class="go">    [128 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/doctest/reporting.py</span>
<span class="go">    [53 tests, 0.1 s]</span>
<span class="go">sage -t src/sage/doctest/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/doctest/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/doctest/forker.py</span>
<span class="go">    [322 tests, 15.5 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 17.0 seconds</span>
<span class="go">    cpu time: 4.2 seconds</span>
<span class="go">    cumulative wall time: 21.5 seconds</span>
</pre></div>
</div>
</section>
<section id="doctesting-all-of-sage">
<h3>Doctesting all of Sage<a class="headerlink" href="#doctesting-all-of-sage" title="Permalink to this heading">#</a></h3>
<p>To doctest the whole Sage library use the <code class="docutils literal notranslate"><span class="pre">--all</span></code> flag (<code class="docutils literal notranslate"><span class="pre">-a</span></code> for
short).  In addition to testing the code in Sage’s Python and Cython
files, this command will run the tests defined in Sage’s documentation
as well as testing the Sage notebook:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t -a
<span class="go">Running doctests with ID 2012-06-22-19-10-27-e26fce6d.</span>
<span class="go">Doctesting entire Sage library.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 2020 files.</span>
<span class="go">sage -t /Users/roed/sage/sage-5.3/src/sage/plot/plot.py</span>
<span class="go">    [304 tests, 69.0 s]</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="debugging-tools">
<h3>Debugging tools<a class="headerlink" href="#debugging-tools" title="Permalink to this heading">#</a></h3>
<p>Sometimes doctests fail (that’s why we run them after all).  There are
various flags to help when something goes wrong.  If a doctest
produces a Python error, then normally tests continue after reporting
that an error occurred.  If you use the flag <code class="docutils literal notranslate"><span class="pre">--debug</span></code> (<code class="docutils literal notranslate"><span class="pre">-d</span></code> for
short) then you will drop into an interactive Python debugger whenever
a Python exception occurs.  As an example, I modified
<a class="reference external" href="../reference/arithmetic_curves/sage/schemes/elliptic_curves/constructor.html#module-sage.schemes.elliptic_curves.constructor" title="(in Elliptic curves v10.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sage.schemes.elliptic_curves.constructor</span></code></a> to produce an error:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --debug src/sage/schemes/elliptic_curves/constructor.py
<span class="go">Running doctests with ID 2012-06-23-12-09-04-b6352629.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">**********************************************************************</span>
<span class="go">File &quot;sage.schemes.elliptic_curves.constructor&quot;, line 4, in sage.schemes.elliptic_curves.constructor</span>
<span class="go">Failed example:</span>
<span class="go">    EllipticCurve([0,0])</span>
<span class="go">Exception raised:</span>
<span class="go">    Traceback (most recent call last):</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/doctest/forker.py&quot;, line 573, in _run</span>
<span class="go">        self.execute(example, compiled, test.globs)</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/doctest/forker.py&quot;, line 835, in execute</span>
<span class="go">        exec compiled in globs</span>
<span class="go">      File &quot;&lt;doctest sage.schemes.elliptic_curves.constructor[0]&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">        EllipticCurve([Integer(0),Integer(0)])</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.py&quot;, line 346, in EllipticCurve</span>
<span class="go">        return ell_rational_field.EllipticCurve_rational_field(x, y)</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py&quot;, line 216, in __init__</span>
<span class="go">        EllipticCurve_number_field.__init__(self, Q, ainvs)</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_number_field.py&quot;, line 159, in __init__</span>
<span class="go">        EllipticCurve_field.__init__(self, [field(x) for x in ainvs])</span>
<span class="go">      File &quot;/Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py&quot;, line 156, in __init__</span>
<span class="go">        &quot;Invariants %s define a singular curve.&quot;%ainvs</span>
<span class="go">    ArithmeticError: Invariants [0, 0, 0, 0, 0] define a singular curve.</span>
<span class="go">&gt; /Users/roed/sage/sage-5.3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py(156)__init__()</span>
<span class="go">-&gt; &quot;Invariants %s define a singular curve.&quot;%ainvs</span>
<span class="gp gp-VirtualEnv">(Pdb)</span> <span class="go">l</span>
<span class="go">151                 if len(ainvs) == 2:</span>
<span class="go">152                     ainvs = [K(0),K(0),K(0)] + ainvs</span>
<span class="go">153                 self.__ainvs = tuple(ainvs)</span>
<span class="go">154                 if self.discriminant() == 0:</span>
<span class="go">155                     raise ArithmeticError(</span>
<span class="go">156  -&gt;                     &quot;Invariants %s define a singular curve.&quot;%ainvs)</span>
<span class="go">157                 PP = projective_space.ProjectiveSpace(2, K, names=&#39;xyz&#39;);</span>
<span class="go">158                 x, y, z = PP.coordinate_ring().gens()</span>
<span class="go">159                 a1, a2, a3, a4, a6 = ainvs</span>
<span class="go">160                 f = y**2*z + (a1*x + a3*z)*y*z \</span>
<span class="go">161                     - (x**3 + a2*x**2*z + a4*x*z**2 + a6*z**3)</span>
<span class="gp gp-VirtualEnv">(Pdb)</span> <span class="go">p ainvs</span>
<span class="go">[0, 0, 0, 0, 0]</span>
<span class="gp gp-VirtualEnv">(Pdb)</span> <span class="go">quit</span>
<span class="go">**********************************************************************</span>
<span class="go">1 items had failures:</span>
<span class="go">   1 of   1 in sage.schemes.elliptic_curves.constructor</span>
<span class="go">***Test Failed*** 1 failures.</span>
<span class="go">sage -t src/sage/schemes/elliptic_curves/constructor.py</span>
<span class="go">    [64 tests, 89.2 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">sage -t src/sage/schemes/elliptic_curves/constructor.py # 1 doctest failed</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 90.4 seconds</span>
<span class="go">    cpu time: 4.5 seconds</span>
<span class="go">    cumulative wall time: 89.2 seconds</span>
</pre></div>
</div>
<p>Sometimes an error might be so severe that it causes Sage to segfault
or hang.  In such a situation you have a number of options.  The
doctest framework will print out the output so far, so that at least
you know what test caused the problem (if you want this output to
appear in real time use the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> flag).  To have doctests run
under the control of gdb, use the <code class="docutils literal notranslate"><span class="pre">--gdb</span></code> flag:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --gdb src/sage/schemes/elliptic_curves/constructor.py
<span class="go">exec gdb --eval-commands=&quot;run&quot; --args /home/roed/sage-9.7/local/var/lib/sage/venv-python3.9/bin/python3 sage-runtests --serial --timeout=0 --stats_path=/home/roed/.sage/timings2.json --optional=pip,sage,sage_spkg src/sage/schemes/elliptic_curves/constructor.py</span>
<span class="go">GNU gdb 6.8-debian</span>
<span class="go">Copyright (C) 2008 Free Software Foundation, Inc.</span>
<span class="go">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span>
<span class="go">This is free software: you are free to change and redistribute it.</span>
<span class="go">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span>
<span class="go">and &quot;show warranty&quot; for details.</span>
<span class="go">This GDB was configured as &quot;x86_64-linux-gnu&quot;...</span>
<span class="go">[Thread debugging using libthread_db enabled]</span>
<span class="go">[New Thread 0x7f10f85566e0 (LWP 6534)]</span>
<span class="go">Running doctests with ID 2012-07-07-00-43-36-b1b735e7.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/schemes/elliptic_curves/constructor.py</span>
<span class="go">    [67 tests, 5.8 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 15.7 seconds</span>
<span class="go">    cpu time: 4.4 seconds</span>
<span class="go">    cumulative wall time: 5.8 seconds</span>

<span class="go">Program exited normally.</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">quit</span>
</pre></div>
</div>
<p>Sage also includes valgrind, and you can run doctests under various
valgrind tools to track down memory issues: the relevant flags are
<code class="docutils literal notranslate"><span class="pre">--valgrind</span></code> (or <code class="docutils literal notranslate"><span class="pre">--memcheck</span></code>), <code class="docutils literal notranslate"><span class="pre">--massif</span></code>, <code class="docutils literal notranslate"><span class="pre">--cachegrind</span></code> and
<code class="docutils literal notranslate"><span class="pre">--omega</span></code>.  See <a class="reference external" href="http://wiki.sagemath.org/ValgrindingSage">http://wiki.sagemath.org/ValgrindingSage</a> for more details.</p>
<p>Once you’re done fixing whatever problems where revealed by the
doctests, you can rerun just those files that failed their most recent
test by using the <code class="docutils literal notranslate"><span class="pre">--failed</span></code> flag (<code class="docutils literal notranslate"><span class="pre">-f</span></code> for short):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t -fa
<span class="go">Running doctests with ID 2012-07-07-00-45-35-d8b5a408.</span>
<span class="go">Doctesting entire Sage library.</span>
<span class="go">Only doctesting files that failed last test.</span>
<span class="go">No files to doctest</span>
</pre></div>
</div>
</section>
<section id="miscellaneous-options">
<h3>Miscellaneous options<a class="headerlink" href="#miscellaneous-options" title="Permalink to this heading">#</a></h3>
<p>There are various other options that change the behavior of Sage’s
doctesting code.</p>
<section id="show-only-first-failure">
<h4>Show only first failure<a class="headerlink" href="#show-only-first-failure" title="Permalink to this heading">#</a></h4>
<p>The first failure in a file often causes a cascade of others, as
NameErrors arise from variables that weren’t defined and tests fail
because old values of variables are used.  To only see the first
failure in each doctest block use the <code class="docutils literal notranslate"><span class="pre">--initial</span></code> flag (<code class="docutils literal notranslate"><span class="pre">-i</span></code> for
short).</p>
</section>
<section id="show-skipped-optional-tests">
<h4>Show skipped optional tests<a class="headerlink" href="#show-skipped-optional-tests" title="Permalink to this heading">#</a></h4>
<p>To print a summary at the end of each file with the number of optional
tests skipped, use the <code class="docutils literal notranslate"><span class="pre">--show-skipped</span></code> flag:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --show-skipped src/sage/rings/finite_rings/integer_mod.pyx
<span class="go">Running doctests with ID 2013-03-14-15-32-05-8136f5e3.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t sage/rings/finite_rings/integer_mod.pyx</span>
<span class="go">    2 axiom tests not run</span>
<span class="go">    1 cunningham test not run</span>
<span class="go">    2 fricas tests not run</span>
<span class="go">    1 long test not run</span>
<span class="go">    3 magma tests not run</span>
<span class="go">    [440 tests, 4.0 s]</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 4.3 seconds</span>
<span class="go">    cpu time: 2.4 seconds</span>
<span class="go">    cumulative wall time: 4.0 seconds</span>
</pre></div>
</div>
</section>
<section id="running-tests-with-iterations">
<h4>Running tests with iterations<a class="headerlink" href="#running-tests-with-iterations" title="Permalink to this heading">#</a></h4>
<p>Sometimes tests fail intermittently.  There are two options that allow
you to run tests repeatedly in an attempt to search for Heisenbugs.
The flag <code class="docutils literal notranslate"><span class="pre">--global-iterations</span></code> takes an integer and runs the whole
set of tests that many times serially:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --global-iterations <span class="m">2</span> src/sage/sandpiles
<span class="go">Running doctests with ID 2012-07-07-00-59-28-e7048ad9.</span>
<span class="go">Doctesting 3 files (2 global iterations).</span>
<span class="go">sage -t src/sage/sandpiles/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/sandpile.py</span>
<span class="go">    [711 tests, 14.7 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 17.6 seconds</span>
<span class="go">    cpu time: 13.2 seconds</span>
<span class="go">    cumulative wall time: 14.7 seconds</span>
<span class="go">sage -t src/sage/sandpiles/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/sandpile.py</span>
<span class="go">    [711 tests, 13.8 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 14.3 seconds</span>
<span class="go">    cpu time: 26.4 seconds</span>
<span class="go">    cumulative wall time: 28.5 seconds</span>
</pre></div>
</div>
<p>You can also iterate in a different order: the <code class="docutils literal notranslate"><span class="pre">--file-iterations</span></code>
flag runs the tests in each file <code class="docutils literal notranslate"><span class="pre">N</span></code> times before proceeding:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --file-iterations <span class="m">2</span> src/sage/sandpiles
<span class="go">Running doctests with ID 2012-07-07-01-01-43-8f954206.</span>
<span class="go">Doctesting 3 files (2 file iterations).</span>
<span class="go">sage -t src/sage/sandpiles/__init__.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/all.py</span>
<span class="go">    [0 tests, 0.0 s]</span>
<span class="go">sage -t src/sage/sandpiles/sandpile.py</span>
<span class="go">    [1422 tests, 13.3 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 29.6 seconds</span>
<span class="go">    cpu time: 12.7 seconds</span>
<span class="go">    cumulative wall time: 13.3 seconds</span>
</pre></div>
</div>
<p>Note that the reported results are the average time for all tests in
that file to finish.  If a failure in a file occurs, then the failure
is reported and testing proceeds with the next file.</p>
</section>
<section id="using-a-different-timeout">
<h4>Using a different timeout<a class="headerlink" href="#using-a-different-timeout" title="Permalink to this heading">#</a></h4>
<p>On a slow machine the default timeout of 5 minutes may not be enough
for the slowest files.  Use the <code class="docutils literal notranslate"><span class="pre">--timeout</span></code> flag (<code class="docutils literal notranslate"><span class="pre">-T</span></code> for short)
to set it to something else:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -tp <span class="m">2</span> --all --timeout <span class="m">1</span>
<span class="go">Running doctests with ID 2012-07-07-01-09-37-deb1ab83.</span>
<span class="go">Doctesting entire Sage library.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 2067 files using 2 threads.</span>
<span class="go">sage -t src/sage/schemes/elliptic_curves/ell_rational_field.py</span>
<span class="go">    Timed out!</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="using-absolute-paths">
<h4>Using absolute paths<a class="headerlink" href="#using-absolute-paths" title="Permalink to this heading">#</a></h4>
<p>By default filenames are printed using relative paths.  To use
absolute paths instead pass in the <code class="docutils literal notranslate"><span class="pre">--abspath</span></code> flag:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --abspath src/sage/doctest/control.py
<span class="go">Running doctests with ID 2012-07-07-01-13-03-a023e212.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t /home/roed/sage-6.0/src/sage/doctest/control.py</span>
<span class="go">    [133 tests, 4.7 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 7.1 seconds</span>
<span class="go">    cpu time: 0.2 seconds</span>
<span class="go">    cumulative wall time: 4.7 seconds</span>
</pre></div>
</div>
</section>
<section id="testing-changed-files">
<h4>Testing changed files<a class="headerlink" href="#testing-changed-files" title="Permalink to this heading">#</a></h4>
<p>If you are working on some files in the Sage library it can be
convenient to test only the files that have changed.  To do so use the
<code class="docutils literal notranslate"><span class="pre">--new</span></code> flag, which tests files that have been modified or added
since the last commit:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --new
<span class="go">Running doctests with ID 2012-07-07-01-15-52-645620ee.</span>
<span class="go">Doctesting files changed since last git commit.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/doctest/control.py</span>
<span class="go">    [133 tests, 3.7 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 3.8 seconds</span>
<span class="go">    cpu time: 0.1 seconds</span>
<span class="go">    cumulative wall time: 3.7 seconds</span>
</pre></div>
</div>
</section>
<section id="running-tests-in-a-random-order">
<h4>Running tests in a random order<a class="headerlink" href="#running-tests-in-a-random-order" title="Permalink to this heading">#</a></h4>
<p>By default, tests are run in the order in which they appear in the
file.  To run tests in a random order (which can reveal subtle bugs),
use the <code class="docutils literal notranslate"><span class="pre">--randorder</span></code> flag and pass in a random seed:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --new --randorder <span class="m">127</span>
<span class="go">Running doctests with ID 2012-07-07-01-19-06-97c8484e.</span>
<span class="go">Doctesting files changed since last git commit.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/doctest/control.py</span>
<span class="go">    [133 tests, 3.6 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 3.7 seconds</span>
<span class="go">    cpu time: 0.2 seconds</span>
<span class="go">    cumulative wall time: 3.6 seconds</span>
</pre></div>
</div>
<p>Note that even with this option, the tests within a given doctest block are still run in order.</p>
</section>
<section id="testing-external-files">
<h4>Testing external files<a class="headerlink" href="#testing-external-files" title="Permalink to this heading">#</a></h4>
<p>When testing a file which is not part of a package (which is not in a
directory containing an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file), the testing
code loads the globals from that file into the namespace before
running tests.  To disable this behaviour (and require imports to be
explicitly specified), use the <code class="docutils literal notranslate"><span class="pre">--force-lib</span></code> option.</p>
</section>
<section id="auxiliary-files">
<h4>Auxiliary files<a class="headerlink" href="#auxiliary-files" title="Permalink to this heading">#</a></h4>
<p>To specify a logfile (rather than use the default which is created for
<code class="docutils literal notranslate"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--all</span></code>), use the <code class="docutils literal notranslate"><span class="pre">--logfile</span></code> flag:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -t --logfile test1.log src/sage/doctest/control.py
<span class="go">Running doctests with ID 2012-07-07-01-25-49-e7c0e52d.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/doctest/control.py</span>
<span class="go">    [133 tests, 4.3 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 6.7 seconds</span>
<span class="go">    cpu time: 0.1 seconds</span>
<span class="go">    cumulative wall time: 4.3 seconds</span>
<span class="gp">[roed@sage sage-6.0]$ </span>cat test1.log
<span class="go">Running doctests with ID 2012-07-07-01-25-49-e7c0e52d.</span>
<span class="go">Doctesting 1 file.</span>
<span class="go">sage -t src/sage/doctest/control.py</span>
<span class="go">    [133 tests, 4.3 s]</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">All tests passed!</span>
<span class="go">------------------------------------------------------------------------</span>
<span class="go">Total time for all tests: 6.7 seconds</span>
<span class="go">    cpu time: 0.1 seconds</span>
<span class="go">    cumulative wall time: 4.3 seconds</span>
</pre></div>
</div>
<p>To give a json file storing the timings for each file, use the
<code class="docutils literal notranslate"><span class="pre">--stats_path</span></code> flag.  These statistics are used in sorting files so
that slower tests are run first (and thus multiple processes are
utilized most efficiently):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">[roed@sage sage-6.0]$ </span>sage -tp <span class="m">2</span> --stats-path ~/.sage/timings2.json --all
<span class="go">Running doctests with ID 2012-07-07-01-28-34-2df4251d.</span>
<span class="go">Doctesting entire Sage library.</span>
<span class="go">Sorting sources by runtime so that slower doctests are run first....</span>
<span class="go">Doctesting 2067 files using 2 threads.</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="portability_testing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Testing on Multiple Platforms</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="coding_basics.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">General Conventions</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2005--2023, The Sage Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Running Sage’s Doctests</a><ul>
<li><a class="reference internal" href="#testing-a-module">Testing a module</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#parallel-testing-many-modules">Parallel testing many modules</a></li>
<li><a class="reference internal" href="#parallel-testing-the-whole-sage-library">Parallel testing the whole Sage library</a></li>
<li><a class="reference internal" href="#beyond-the-sage-library">Beyond the Sage library</a></li>
<li><a class="reference internal" href="#doctesting-from-within-sage">Doctesting from within Sage</a></li>
<li><a class="reference internal" href="#optional-arguments">Optional arguments</a><ul>
<li><a class="reference internal" href="#run-long-doctests">Run long doctests</a></li>
<li><a class="reference internal" href="#run-optional-doctests">Run optional doctests</a></li>
<li><a class="reference internal" href="#running-doctests-in-parallel">Running doctests in parallel</a></li>
<li><a class="reference internal" href="#doctesting-all-of-sage">Doctesting all of Sage</a></li>
<li><a class="reference internal" href="#debugging-tools">Debugging tools</a></li>
<li><a class="reference internal" href="#miscellaneous-options">Miscellaneous options</a><ul>
<li><a class="reference internal" href="#show-only-first-failure">Show only first failure</a></li>
<li><a class="reference internal" href="#show-skipped-optional-tests">Show skipped optional tests</a></li>
<li><a class="reference internal" href="#running-tests-with-iterations">Running tests with iterations</a></li>
<li><a class="reference internal" href="#using-a-different-timeout">Using a different timeout</a></li>
<li><a class="reference internal" href="#using-absolute-paths">Using absolute paths</a></li>
<li><a class="reference internal" href="#testing-changed-files">Testing changed files</a></li>
<li><a class="reference internal" href="#running-tests-in-a-random-order">Running tests in a random order</a></li>
<li><a class="reference internal" href="#testing-external-files">Testing external files</a></li>
<li><a class="reference internal" href="#auxiliary-files">Auxiliary files</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    </body>
</html>