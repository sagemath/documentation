<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>対話型シェル &mdash; Sage チュートリアル v7.3</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage チュートリアル v7.3" href="index.html" />
    <link rel="next" title="インターフェイスについて" href="interfaces.html" />
    <link rel="prev" title="より進んだ数学" href="tour_advanced.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="interfaces.html" title="インターフェイスについて"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="tour_advanced.html" title="より進んだ数学"
             accesskey="P">前へ</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Sage チュートリアル v7.3</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="chapter-interactive-shell">
<span id="id1"></span><h1>対話型シェル<a class="headerlink" href="#chapter-interactive-shell" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>このチュートリアルの大部分は，読者が <code class="docutils literal"><span class="pre">sage</span></code> コマンドによってSageインタプリタを起動しているものと前提している．
コマンド <code class="docutils literal"><span class="pre">sage</span></code> は改造版IPythonシェルを起動し，大量の関数やクラス群をインポートしてコマンドプロンプトから利用可能にする．
<code class="docutils literal"><span class="pre">$SAGE_ROOT/ipythonrc</span></code> ファイルを編集すれば，さらなるシェル環境のカスタマイズも可能だ．
Sageを起動すると，すぐに次のような画面が現れる:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">SAGE</span> <span class="n">Version</span> <span class="mf">3.1</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">Release</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2008</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">24</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">Type</span> <span class="n">notebook</span><span class="p">()</span> <span class="k">for</span> <span class="n">the</span> <span class="n">GUI</span><span class="p">,</span> <span class="ow">and</span> <span class="n">license</span><span class="p">()</span> <span class="k">for</span> <span class="n">information</span><span class="o">.</span>        <span class="o">|</span>
<span class="o">----------------------------------------------------------------------</span>


<span class="n">sage</span><span class="p">:</span>
</pre></div>
</div>
<p>Sageを終了するには，Ctrl-Dと押すか， コマンド <code class="docutils literal"><span class="pre">quit</span></code> あるいは <code class="docutils literal"><span class="pre">exit</span></code> を入力する．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">quit</span>
<span class="go">Exiting SAGE (CPU time 0m0.00s, Wall time 0m0.89s)</span>
</pre></div>
</div>
<p>&#8220;Wall time&#8221;は，CPUタイムではなく外界の実経過時間を示している．
CPUタイムはGAPやSingularなどのサブプロセスの消費時間までは勘定に入れてくれないから，実経過時間も計算時間の見積りに必要だ．</p>
<p>(ターミナルから <code class="docutils literal"><span class="pre">kill</span> <span class="pre">-9</span></code> を入力してSageプロセスを停止するのは止めたほうがいい．
<code class="docutils literal"><span class="pre">kill</span> <span class="pre">-9</span></code> ではMapleなどの子プロセスが停止しなかったり， <code class="docutils literal"><span class="pre">$HOME/.sage/tmp</span></code> 内の一時ファイルが消去されずに終わるなどの恐れがある．)</p>
<div class="section" id="sage">
<h2>Sageセッション<a class="headerlink" href="#sage" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><em>セッション</em> とは，Sageの起動から終了までの間に行なわれた一連の入出力の総体のことをいう．
Sageは，Sageに対する入力の全てをIPython経由で記録している．
事実，(ノートブック経由ではなく)対話型シェルを使ってSageを動かしているのならば，好きな時に <code class="docutils literal"><span class="pre">%history</span></code> (または <code class="docutils literal"><span class="pre">%hist</span></code>) と入力して，それまでの全入力履歴を見ることができる．
IPythonについてもっと知りたければ、Sageプロンプトで <code class="docutils literal"><span class="pre">?</span></code> と入力すれば， &#8220;IPython offers numbered prompts ... with input and output caching. All input is saved and can be retrieved as variables (besides the usual arrow key recall). The following GLOBAL variables always exist (so don&#8217;t overwrite them!)&#8221; などと詳しい情報を表示させることができる:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>   <span class="n">_</span><span class="p">:</span>  <span class="n">前回の入力を呼び出す</span> <span class="p">(</span><span class="n">対話型シェルとノートブックの両方で通用する</span><span class="p">)</span>
  <span class="n">__</span><span class="p">:</span> <span class="n">前々回の入力を呼び出す</span><span class="p">(</span><span class="n">対話型シェルのみで通用</span><span class="p">)</span>
<span class="n">_oh</span> <span class="p">:</span> <span class="n">全ての入力をリストする</span><span class="p">(</span><span class="n">対話型シェルのみで通用</span><span class="p">)</span>
</pre></div>
</div>
<p>ここで例を見てみよう:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">factor</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go"> _1 = 2^2 * 5^2</span>
<span class="gp">sage: </span><span class="n">kronecker_symbol</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="go"> _2 = -1</span>
<span class="gp">sage: </span><span class="o">%</span><span class="n">hist</span>   <span class="c1"># これが使えるのは対話型シェル上のみ．ノートブックではだめ．</span>
<span class="go">1: factor(100)</span>
<span class="go">2: kronecker_symbol(3,5)</span>
<span class="go">3: %hist</span>
<span class="gp">sage: </span><span class="n">_oh</span>
<span class="go"> _4 = {1: 2^2 * 5^2, 2: -1}</span>
<span class="gp">sage: </span><span class="n">_i1</span>
<span class="go"> _5 = &#39;factor(ZZ(100))\n&#39;</span>
<span class="gp">sage: </span><span class="nb">eval</span><span class="p">(</span><span class="n">_i1</span><span class="p">)</span>
<span class="go"> _6 = 2^2 * 5^2</span>
<span class="gp">sage: </span><span class="o">%</span><span class="n">hist</span>
<span class="go">1: factor(100)</span>
<span class="go">2: kronecker_symbol(3,5)</span>
<span class="go">3: %hist</span>
<span class="go">4: _oh</span>
<span class="go">5: _i1</span>
<span class="go">6: eval(_i1)</span>
<span class="go">7: %hist</span>
</pre></div>
</div>
<p>以降，このチュートリアル，それに他のSageドキュメンテーションでも出力番号を省略する．</p>
<p>セッション中は，一連の入力をマクロとして保存しておいて再利用することもできる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">M</span> <span class="o">=</span> <span class="n">ModularSymbols</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
<span class="gp">sage: </span><span class="o">%</span><span class="n">hist</span>
<span class="go">1: E = EllipticCurve([1,2,3,4,5])</span>
<span class="go">2: M = ModularSymbols(37)</span>
<span class="go">3: %hist</span>
<span class="gp">sage: </span><span class="o">%</span><span class="n">macro</span> <span class="n">em</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span>
<span class="go">Macro `em` created. To execute, type its name (without quotes).</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span>
<span class="go">Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 5 over</span>
<span class="go">Rational Field</span>
<span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">sage: </span><span class="n">M</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">sage: </span><span class="n">em</span>
<span class="go">Executing Macro...</span>
<span class="gp">sage: </span><span class="n">E</span>
<span class="go">Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 5 over</span>
<span class="go">Rational Field</span>
</pre></div>
</div>
<p>対話型シェルを使っている間も，感嘆符 <code class="docutils literal"><span class="pre">!</span></code> を前置すれば好きなUNIXシェルコマンドを実行することができる．
例えば</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: !ls
auto  example.sage glossary.tex  t  tmp  tut.log  tut.tex
</pre></div>
</div>
<p>のように，カレントディレクトリの内容を表示することができる．</p>
<p>シェル変数 <code class="docutils literal"><span class="pre">PATH</span></code> の先頭にはSageのbinディレクトリが配置されているから， <code class="docutils literal"><span class="pre">gp</span></code> ， <code class="docutils literal"><span class="pre">gap</span></code> ， <code class="docutils literal"><span class="pre">singular</span></code> ， <code class="docutils literal"><span class="pre">maxima</span></code> などを実行すると，Sageに付属しているプログラムのバージョンを確認することができる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: !gp
Reading GPRC: /etc/gprc ...Done.

                           GP/PARI CALCULATOR Version 2.2.11 (alpha)
                  i686 running linux (ix86/GMP-4.1.4 kernel) 32-bit version
...
sage: !singular
                     SINGULAR                             /  Development
 A Computer Algebra System for Polynomial Computations   /   version 3-0-1
                                                       0&lt;
     by: G.-M. Greuel, G. Pfister, H. Schoenemann        \   October 2005
FB Mathematik der Universitaet, D-67653 Kaiserslautern    \
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>入出力のログをとる<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Sageセッションのロギングと，セッションの保存(<a class="reference internal" href="#section-save"><span class="std std-ref">セッション全体の保存と読み込み</span></a> 節を参照)は同じことではない．
入力のログをとるには， <code class="docutils literal"><span class="pre">logstart</span></code> コマンドを使う(オプションで出力のログも可能だ)．
詳細については <code class="docutils literal"><span class="pre">logstart?</span></code> と入力してみてほしい．
<code class="docutils literal"><span class="pre">logstart</span></code> を使えば，全ての入力と出力のログを残し，将来のセッション時に(そのログファイルをリロードしてやるだけで)入力を再生することも可能になる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>was@form:~$ sage
----------------------------------------------------------------------
| SAGE Version 3.0.2, Release Date: 2008-05-24                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: logstart setup
Activating auto-logging. Current session state plus future input saved.
Filename       : setup
Mode           : backup
Output logging : False
Timestamping   : False
State          : active
sage: E = EllipticCurve([1,2,3,4,5]).minimal_model()
sage: F = QQ^3
sage: x,y = QQ[&#39;x,y&#39;].gens()
sage: G = E.gens()
sage:
Exiting SAGE (CPU time 0m0.61s, Wall time 0m50.39s).
was@form:~$ sage
----------------------------------------------------------------------
| SAGE Version 3.0.2, Release Date: 2008-05-24                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: load(&quot;setup&quot;)
Loading log file &lt;setup&gt; one line at a time...
Finished replaying log file &lt;setup&gt;
sage: E
Elliptic Curve defined by y^2 + x*y  = x^3 - x^2 + 4*x + 3 over Rational
Field
sage: x*y
x*y
sage: G
[(2 : 3 : 1)]
</pre></div>
</div>
<p>SageをLinux KDEターミナル <code class="docutils literal"><span class="pre">konsole</span></code> 上で使っているなら，以下の手順でセッションを保存することもできる．
まず <code class="docutils literal"><span class="pre">konsole</span></code> 上でSageを起動したら、 &#8220;settings&#8221;(日本語環境であれば『設定』)を選択し，次に &#8220;history&#8221;(『履歴』)， &#8220;set unlimited&#8221;(『無制限にする』)の順に選択しておく．
セッションを保存したくなった時点で， &#8220;edit&#8221;(『編集』)の中の &#8220;save history as...&#8221;(『履歴を名前を付けて保存』)を選択してセッションを保存するファイル名を入力してやればよい．
いったんファイルとして保存してしまえば，好きなようにxemacsなどのエディタで読み込んだりプリントアウトしたりすることができる．</p>
</div>
<div class="section" id="id3">
<h2>プロンプト記号はペースト時に無視される<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>SageセッションあるいはPythonの演算結果を読み込んで，Sage上にコピーしたい場合がある．
厄介なのは、そうした出力に <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code> や <code class="docutils literal"><span class="pre">sage:</span></code> といったプロンプト記号が紛れ込んでいることだ．
しかし実際には，プロンプト記号を含む実行例をSage上へ好きにコピー・ペーストしてやることができる．
デフォルトでSageパーサーはデータをPythonに送る前に行頭の <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code> や <code class="docutils literal"><span class="pre">sage:</span></code> プロンプト記号を除去してくれるからだ．
例えば</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span>
<span class="go">1024</span>
<span class="gp">sage: </span><span class="n">sage</span><span class="p">:</span> <span class="n">sage</span><span class="p">:</span> <span class="mi">2</span><span class="o">^</span><span class="mi">10</span>
<span class="go">1024</span>
<span class="gp">sage: </span><span class="o">&gt;&gt;&gt;</span> <span class="mi">2</span><span class="o">^</span><span class="mi">10</span>
<span class="go">1024</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>計時コマンド<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>入力行の先頭に <code class="docutils literal"><span class="pre">%time</span></code> コマンドを入れておくと，出力までに要した時間を表示することができる．
例として，べき乗計算を異なった方法で行なった場合の実行時間を比較してみよう．
以下に示した実行時間の値は，動かしているコンピュータ本体やSageのバージョンによって大きく異なる可能性が高い．
まず、Pythonを直に動かしてみると:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">time</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1938</span><span class="p">)</span><span class="o">^</span><span class="nb">int</span><span class="p">(</span><span class="mi">99484</span><span class="p">)</span>
<span class="go">CPU times: user 0.66 s, sys: 0.00 s, total: 0.66 s</span>
<span class="go">Wall time: 0.66</span>
</pre></div>
</div>
<p>上の出力は，実行に計0.66秒かかり， &#8220;Wall time&#8221; つまりユーザーの実待ち時間もやはり0.66秒だったことを示している．
コンピュータに他のプログラムから大きな負荷がかかっている場合， &#8220;Wall time&#8221;がCPUタイムよりかなり長くなることがある．</p>
<p>次に，同じべき乗計算をSage組み込みのInteger型を使って実行した場合の時間を計ってみよう．
SageのInteger型は，Cython経由でGMPライブラリを使って実装されている:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">time</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1938</span><span class="o">^</span><span class="mi">99484</span>
<span class="go">CPU times: user 0.04 s, sys: 0.00 s, total: 0.04 s</span>
<span class="go">Wall time: 0.04</span>
</pre></div>
</div>
<p>PARIのC-ライブラリを経由すると</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">time</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pari</span><span class="p">(</span><span class="mi">1938</span><span class="p">)</span><span class="o">^</span><span class="n">pari</span><span class="p">(</span><span class="mi">99484</span><span class="p">)</span>
<span class="go">CPU times: user 0.05 s, sys: 0.00 s, total: 0.05 s</span>
<span class="go">Wall time: 0.05</span>
</pre></div>
</div>
<p>GMPの方が速いが，その差はわずかだ(Sage用にビルドされたPARIは整数演算にGMPを使っているのだから，納得できる結果である)．</p>
<p>次の例のように， <code class="docutils literal"><span class="pre">cputime</span></code> コマンドを使えば，一連のコマンドからなるコードブロックの実行時間を計ることもできる:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">cputime</span><span class="p">()</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1938</span><span class="p">)</span><span class="o">^</span><span class="nb">int</span><span class="p">(</span><span class="mi">99484</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">b</span> <span class="o">=</span> <span class="mi">1938</span><span class="o">^</span><span class="mi">99484</span>
<span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">pari</span><span class="p">(</span><span class="mi">1938</span><span class="p">)</span><span class="o">^</span><span class="n">pari</span><span class="p">(</span><span class="mi">99484</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">cputime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>                       <span class="c1"># random 値には若干の幅がある．</span>
<span class="go">0.64</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: cputime?
 ...
     Return the time in CPU second since SAGE started, or with optional
     argument t, return the time since time t.
     INPUT:
         t -- (optional) float, time in CPU seconds
     OUTPUT:
         float -- time in CPU seconds
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">walltime</span></code> コマンドの動作は，計測するのが実経過時間である点以外は <code class="docutils literal"><span class="pre">cputime</span></code> コマンドと変わらない．</p>
<p>上で求めたべき乗を，Sageに取り込まれている各コンピュータ代数システムを使って計算することもできる．
計算を実行するには，使いたいシステムの名前をコマンド名としてそのプログラムのサーバを呼び出す．
いちばん肝心な計測値は，実経過時間(wall time)だ．
しかし，実経過時間とCPUタイムの値が大幅に食い違う場合は，解決すべきパフォーマンス上の問題点の存在を示している可能性がある．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">time</span> <span class="mi">1938</span><span class="o">^</span><span class="mi">99484</span><span class="p">;</span>
<span class="go">CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s</span>
<span class="go">Wall time: 0.01</span>
<span class="gp">sage: </span><span class="n">gp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gp</span><span class="p">(</span><span class="s1">&#39;1938^99484&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 0.04</span>
<span class="gp">sage: </span><span class="n">maxima</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">maxima</span><span class="p">(</span><span class="s1">&#39;1938^99484&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 0.30</span>
<span class="gp">sage: </span><span class="n">kash</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">kash</span><span class="p">(</span><span class="s1">&#39;1938^99484&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 0.04</span>
<span class="gp">sage: </span><span class="n">mathematica</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">        0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">mathematica</span><span class="p">(</span><span class="s1">&#39;1938^99484&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 0.03</span>
<span class="gp">sage: </span><span class="n">maple</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">maple</span><span class="p">(</span><span class="s1">&#39;1938^99484&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 0.11</span>
<span class="gp">sage: </span><span class="n">gap</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">sage: </span><span class="n">time</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gap</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;1938^99484;;&#39;</span><span class="p">)</span>
<span class="go">CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s</span>
<span class="go">Wall time: 1.02</span>
</pre></div>
</div>
<p>以上のテスト計算で最も遅かったのは，GAPとMaximaである(実行結果はホスト <code class="docutils literal"><span class="pre">sage.math.washington.edu</span></code> 上のもの)．
各システムとのpexpectインターフェイスにかかる負荷を考えると，上の一連の計測値を最速だったSageの値と比較するのは公平を欠く面があるかもしれない．</p>
</div>
<div class="section" id="ipython">
<h2>IPythonトリック<a class="headerlink" href="#ipython" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>すでに述べたように，SageはそのフロントエンドとしてIPythonを援用しており，ユーザはIPythonのコマンドと独自機能を自由に利用することができる．
その全貌については， ご自分で <a class="reference external" href="http://ipython.scipy.org/moin/Documentation">full IPython documentation</a> を読んみてほしい．
そのかわり，ここではIPythonの「マジックコマンド」と呼ばれる，お便利なトリックをいくつか紹介させていただこう:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">%bg</span></code> を使えばコマンドをバックグラウンドで実行し， 結果には <code class="docutils literal"><span class="pre">jobs</span></code> でアクセスすることができる．(この機能は <code class="docutils literal"><span class="pre">not</span> <span class="pre">tested</span></code> とコメントされている．というのは <code class="docutils literal"><span class="pre">%bg</span></code> 書法がSageの自動テスト機能とは余り相性が良くないからだ．ユーザ各自が入力してやれば，その通り動作するはずである．もちろん，この機能が最も役立つのは実行に時間のかかるコマンドと組み合わせる場合である．)</p>
<p>使用例を以下に示す．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="k">def</span> <span class="nf">quick</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span>
<span class="gp">sage: </span><span class="o">%</span><span class="n">bg</span> <span class="n">quick</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># not tested</span>
<span class="go">Starting job # 0 in a separate thread.</span>
<span class="gp">sage: </span><span class="n">jobs</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>  <span class="c1"># not tested</span>
<span class="go">Completed jobs:</span>
<span class="go">0 : quick(20)</span>
<span class="gp">sage: </span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">result</span>  <span class="c1"># the actual answer, not tested</span>
<span class="go">40</span>
</pre></div>
</div>
<p>バックグラウンドに送られるジョブはSageの前処理パーサを経由しないことに注意 &#8211; 詳細は <a class="reference internal" href="afterword.html#section-mathannoy"><span class="std std-ref">前処理パーサ: SageとPython の相違点</span></a> 節を参照されたい．
パーサを通すための(不器用であるけれども)１つの方法は</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">bg</span> <span class="nb">eval</span><span class="p">(</span><span class="n">preparse</span><span class="p">(</span><span class="s1">&#39;quick(20)&#39;</span><span class="p">))</span> <span class="c1"># not tested</span>
</pre></div>
</div>
<p>とすることだろう．</p>
<p>ただし，より安全で簡単なのは前処理パーサを必要としないコマンドで <code class="docutils literal"><span class="pre">%bg</span></code> を使うことだろう．</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">%edit</span></code> (<code class="docutils literal"><span class="pre">%ed</span></code> や <code class="docutils literal"><span class="pre">ed</span></code> でもいい)を使ってエディタを起動すれば，複雑なコードの入力が楽になる．
Sageの使用前に，環境変数 <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal"><span class="pre">EDITOR</span></code> に好みのエディタ名を設定しておこう(<code class="docutils literal"><span class="pre">export</span> <span class="pre">EDITOR=/usr/bin/emacs</span></code> または <code class="docutils literal"><span class="pre">export</span> <span class="pre">EDITOR=/usr/bin/vim</span></code> とするか， <code class="docutils literal"><span class="pre">.profile</span></code> ファイルなどで同様の設定をする)．
するとSageプロンプトで <code class="docutils literal"><span class="pre">%edit</span></code> を実行すれば設定したエディタが起動する．そのエディタで関数</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div>
</div>
<p>を定義し，保存したらエディタを終了する．
以降，このセッション中は <code class="docutils literal"><span class="pre">some_function</span></code> を利用できるようになる．
内容を編集したければSageプロンプトで <code class="docutils literal"><span class="pre">%edit</span> <span class="pre">some_function</span></code> と入力すればよい．</p>
</li>
<li><p class="first">結果出力を他の用途のために編集したければ， <code class="docutils literal"><span class="pre">%rep</span></code> を実行する．
すると直前に実行したコマンドの出力が編集できるようにSageプロンプト上に配置される．:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">-sin(x)</span>
</pre></div>
</div>
<p>この段階でSageプロンプトから <code class="docutils literal"><span class="pre">%rep</span></code> を実行すると，新しいSageプロンプトに続いて <code class="docutils literal"><span class="pre">-sin(x)</span></code> が現われる．
カーソルは同じ行末にある．</p>
</li>
</ul>
<p>IPythonのクイック レファレンスガイドを見たければ， <code class="docutils literal"><span class="pre">%quickref</span></code> と入力する．
執筆時点(2011年4月)ではSageはIPythonのバージョン0.9.1を採用しており， <a class="reference external" href="http://ipython.org/ipython-doc/dev/interactive/tutorial.html#magic-functions">documentation for its magic commands</a>
はオンラインで読むことができる．
マジックコマンドの，ちょっと進んだ機能群についてはIPythonの <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/reference.html#magic-command-system">ここ</a>
で文書化されているのが見つかるはずだ．</p>
</div>
<div class="section" id="id6">
<h2>エラーと例外処理<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>処理中に何かまずいことが起きると，Pythonはふつう『例外』(exception)を発生し，その例外を引き起こした原因を教えてくれることもある．
よくお目にかかることになるのは， <code class="docutils literal"><span class="pre">NameError</span></code> や <code class="docutils literal"><span class="pre">ValueError</span></code> といった名称の例外だ(Pythonレファレンスマニュアル <a class="reference internal" href="bibliography.html#py" id="id7">[Py]</a> に例外名の包括的なリストがある)．
実例を見てみよう:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="mi">3</span><span class="n">_2</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">SyntaxError</span>: <span class="n">invalid syntax</span>

<span class="gp">sage: </span><span class="n">EllipticCurve</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">infinity</span><span class="p">])</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">SignError</span>: <span class="n">cannot multiply infinity by zero</span>
</pre></div>
</div>
<p>何が悪いか調べるには対話型デバッガが役立つこともある．
デバッガを使うには、 <code class="docutils literal"><span class="pre">%pdb</span></code> コマンドによって作動のオン/オフをトグルする(デフォルトはオフ)．
作動後は、例外が発生するとデバッガが起動し，プロンプト <code class="docutils literal"><span class="pre">ipdb&gt;</span></code> が表示される．
このデバッガの中から，任意のローカル変数の状態を表示したり，実行スタックを上下して様子を調べることができる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="o">%</span><span class="n">pdb</span>
<span class="go">Automatic pdb calling has been turned ON</span>
<span class="gp">sage: </span><span class="n">EllipticCurve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">infinity</span><span class="p">])</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">&lt;type &#39;exceptions.TypeError&#39;&gt;             Traceback (most recent call last)</span>
<span class="gp">...</span>

<span class="go">ipdb&gt;</span>
</pre></div>
</div>
<p>デバッガから実行できるコマンドの一覧を見るには， <code class="docutils literal"><span class="pre">ipdb&gt;</span></code> プロンプト上で <code class="docutils literal"><span class="pre">?</span></code> を入力する:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ipdb&gt; ?

Documented commands (type help &lt;topic&gt;):
========================================
EOF    break  commands   debug    h       l     pdef   quit    tbreak
a      bt     condition  disable  help    list  pdoc   r       u
alias  c      cont       down     ignore  n     pinfo  return  unalias
args   cl     continue   enable   j       next  pp     s       up
b      clear  d          exit     jump    p     q      step    w
whatis where

Miscellaneous help topics:
==========================
exec  pdb

Undocumented commands:
======================
retval  rv
</pre></div>
</div>
<p>Sageに戻るには，Ctrl-Dか <code class="docutils literal"><span class="pre">quit</span></code> を入力する．</p>
</div>
<div class="section" id="section-tabcompletion">
<span id="id8"></span><h2>コマンド入力の遡行検索とタブ補完<a class="headerlink" href="#section-tabcompletion" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><em>遡行検索</em>: コマンドの冒頭部を打ち込んでから <code class="docutils literal"><span class="pre">Ctrl-p</span></code>  (または上向き矢印キー)を押すと，冒頭部が一致する過去の入力行を全て呼び出すことができる．
この機能は，Sageをいったん終了し再起動してからでも有効である．
<code class="docutils literal"><span class="pre">Ctrl-r</span></code> を入力すれば，入力ヒストリを逆方向に検索することも可能だ．
この入力行の検索と再利用機能は全て <code class="docutils literal"><span class="pre">readline</span></code>  パッケージを経由しており，ほとんどのLinux系システム上で利用できるはずだ．</p>
<p>タブ補完機能を体験するため，まず3次元ベクトル空間 <span class="math">\(V=\QQ^3\)</span> を生成しておく:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">V</span> <span class="o">=</span> <span class="n">VectorSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">V</span>
<span class="go">Vector space of dimension 3 over Rational Field</span>
</pre></div>
</div>
<p>次のような，もっと簡潔な記号法を使ってもよい:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">V</span> <span class="o">=</span> <span class="n">QQ</span><span class="o">^</span><span class="mi">3</span>
</pre></div>
</div>
<p>タブ補完を使えば，簡単に <span class="math">\(V\)</span> の全メンバ関数を一覧表示することができる．
<code class="docutils literal"><span class="pre">V.</span></code> と入力し，ついで <code class="docutils literal"><span class="pre">[tab]</span></code> キーを押すだけだ:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">V</span><span class="o">.</span><span class="p">[</span><span class="n">tab</span> <span class="n">key</span><span class="p">]</span>
<span class="go">V._VectorSpace_generic__base_field</span>
<span class="gp">...</span>
<span class="go">V.ambient_space</span>
<span class="go">V.base_field</span>
<span class="go">V.base_ring</span>
<span class="go">V.basis</span>
<span class="go">V.coordinates</span>
<span class="gp">...</span>
<span class="go">V.zero_vector</span>
</pre></div>
</div>
<p>関数名の出だし何文字かを打ってから <code class="docutils literal"><span class="pre">[tab</span> <span class="pre">キー]</span></code> を押せば，入力した文字で始まる名前の関数だけに候補を絞ることができる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">V</span><span class="o">.</span><span class="n">i</span><span class="p">[</span><span class="n">tab</span> <span class="n">key</span><span class="p">]</span>
<span class="go">V.is_ambient  V.is_dense    V.is_full     V.is_sparse</span>
</pre></div>
</div>
<p>特定の関数について調べたい場合もある．
coordinates関数を例にとると，そのヘルプを表示するには <code class="docutils literal"><span class="pre">V.coordinates?</span></code> と入力すればいいし，ソースコードを見るには <code class="docutils literal"><span class="pre">V.coordinates??</span></code> を入力すればいい．
詳細については次の節で解説する．</p>
</div>
<div class="section" id="id9">
<h2>統合ヘルプシステム<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Sageの特長の一つは，総合的なヘルプ機能の装備である．
関数名に続けて?を入力すると、その関数のドキュメントを表示することができる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: V = QQ^3
sage: V.coordinates?
Type:           instancemethod
Base Class:     &lt;type &#39;instancemethod&#39;&gt;
String Form:    &lt;bound method FreeModule_ambient_field.coordinates of Vector
space of dimension 3 over Rational Field&gt;
Namespace:      Interactive
File:           /home/was/s/local/lib/python2.4/site-packages/sage/modules/f
ree_module.py
Definition:     V.coordinates(self, v)
Docstring:
    Write v in terms of the basis for self.

    Returns a list c such that if B is the basis for self, then

            sum c_i B_i = v.

    If v is not in self, raises an ArithmeticError exception.

    EXAMPLES:
        sage: M = FreeModule(IntegerRing(), 2); M0,M1=M.gens()
        sage: W = M.submodule([M0 + M1, M0 - 2*M1])
        sage: W.coordinates(2*M0-M1)
        [2, -1]
</pre></div>
</div>
<p>上で見たように，ヘルプ表示には，そのオブジェクトの型，定義されているファイル，現セッションにペーストすることができる使用例付きの解説が含まれる．
使用例のほとんどは常に自動的なテストが行なわれていて，仕様どおりの正確な動作が確認されている．</p>
<p>もう一つの機能は，Sageのオープンソース精神をよく表すものだ．
<code class="docutils literal"><span class="pre">f</span></code> がPythonで書かれた関数であれば <code class="docutils literal"><span class="pre">f??</span></code> と入力すると <code class="docutils literal"><span class="pre">f</span></code> を定義しているソースを表示することができるのだ．
例えば</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: V = QQ^3
sage: V.coordinates??
Type:           instancemethod
...
Source:
def coordinates(self, v):
        &quot;&quot;&quot;
        Write $v$ in terms of the basis for self.
        ...
        &quot;&quot;&quot;
        return self.coordinate_vector(v).list()
</pre></div>
</div>
<p>これを見ると， <code class="docutils literal"><span class="pre">coordinates</span></code> 関数は <code class="docutils literal"><span class="pre">coordinate_vector</span></code> 関数を呼び出して結果をリストに変換しているだけであることが判る．
では <code class="docutils literal"><span class="pre">coordinate_vector</span></code> 関数が何をしているかと言うと:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: V = QQ^3
sage: V.coordinate_vector??
...
def coordinate_vector(self, v):
        ...
        return self.ambient_vector_space()(v)
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">coordinate_vector</span></code> 関数は，入力を生成空間(ambient space)に合わせて型変換するから，これは <span class="math">\(v\)</span> の係数ベクトルが空間 <span class="math">\(V\)</span> ではどう変換されるか計算していることと同じである．
<span class="math">\(V\)</span> は <span class="math">\(\QQ^3\)</span> そのものだから，すでに同じ構造になっている．
部分空間用に，上とは異なる <code class="docutils literal"><span class="pre">coordinate_vector</span></code> 関数も用意されている．
部分空間を作って，どんな関数か見てみることにしよう:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sage: V = QQ^3; W = V.span_of_basis([V.0, V.1])
sage: W.coordinate_vector??
...
def coordinate_vector(self, v):
        &quot;&quot;&quot;
         ...
        &quot;&quot;&quot;
        # First find the coordinates of v wrt echelon basis.
        w = self.echelon_coordinate_vector(v)
        # Next use transformation matrix from echelon basis to
        # user basis.
        T = self.echelon_to_user_matrix()
        return T.linear_combination_of_rows(w)
</pre></div>
</div>
<p>(こうした実装の仕方は無駄が多いと思われる方は，どうか我々に連絡して線形代数周りの最適化に力を貸していただきたい．)</p>
<p><code class="docutils literal"><span class="pre">help(コマンド名)</span></code> あるいは <code class="docutils literal"><span class="pre">help(クラス名)</span></code> と入力すれば，知りた いクラスのmanページ型ヘルプファイルを表示することもできる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">help</span><span class="p">(</span><span class="n">VectorSpace</span><span class="p">)</span>
<span class="go">Help on class VectorSpace ...</span>

<span class="go">class VectorSpace(__builtin__.object)</span>
<span class="go"> |  Create a Vector Space.</span>
<span class="go"> |</span>
<span class="go"> |  To create an ambient space over a field with given dimension</span>
<span class="go"> |  using the calling syntax ...</span>
<span class="go"> :</span>
<span class="go"> :</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q</span></code> と入力してヘルプを終えると，中断前のセッション画面がそのまま復帰する．
セッションに干渉することがある <code class="docutils literal"><span class="pre">function_name?</span></code> と違って， ヘルプ表示はセッションの邪魔をしない．
とりわけ便利なのは  <code class="docutils literal"><span class="pre">help(モジュール名)</span></code> と入力することだ．
例えばベクトル空間は  <code class="docutils literal"><span class="pre">sage.modules.free_module</span></code> で定義されているから，そのモジュール全体に関するドキュメントを見たければ <code class="docutils literal"><span class="pre">help(sage.modules.free_module)</span></code> と実行すればよい．
ヘルプを使ってドキュメントを閲覧している間は， <code class="docutils literal"><span class="pre">/</span></code> と打てば語句検索 ができるし， <code class="docutils literal"><span class="pre">?</span></code> と打てば逆方向に検索することができる．</p>
</div>
<div class="section" id="id10">
<h2>オブジェクトの保存と読み込み<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>行列や，あるいはもっと手間のかかる複雑なモジュラーシンボルの空間を扱っていて，後で利用するため結果を保存しておきたくなったとしよう．
そんな場合にはどうすればよいだろうか．
オブジェクトを保存するために各コンピュータ代数システムが提供している方法は，以下の通りである．</p>
<ol class="arabic simple">
<li><strong>セッションの保存:</strong> セッション全体の保存と読み込みのみ可能(GAP，Magmaなど)．</li>
<li><strong>統合入出力:</strong> 全オブジェクトの印字が再利用可能な形式で行なわれる(GAPとPARI)．</li>
<li><strong>再実行</strong>: インタープリタによるプログラムの再実行が容易にしてある(Singular，PARI)．</li>
</ol>
<p>Pythonで動くSageでは，全てのオブジェクトのシリアル化(直列化)という，他とは異なる方法が採用されている．
つまりオブジェクトを，その原型を再現可能な形式で文字列に変換するのだ．
これはPARIの統合入出力の考え方に近いが，オブジェクトを複雑な印字形式で画面出力してやる必要がないのが利点だ．
さらに保存と読み込みは(ほとんどの場合)完全に自動化されているから，新たにプログラムを書く必要もない．
そうした機能はPythonに最初から組込まれているものだからである．</p>
<p>ほぼ全てのSageオブジェクト <code class="docutils literal"><span class="pre">x</span></code> は， コマンド <code class="docutils literal"><span class="pre">save(x,ファイル名)</span></code> (あるいは多くの場合 <code class="docutils literal"><span class="pre">x.save(ファイル名)</span></code>)を使えば圧縮形式でディスクに保存することができるようになっている．
保存したオブジェクトを読み戻すには， <code class="docutils literal"><span class="pre">load(ファイル名)</span></code> を実行する．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">MatrixSpace</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="mi">3</span><span class="p">)(</span><span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span>
<span class="gp">sage: </span><span class="n">A</span>
<span class="go">[ 15  18  21]</span>
<span class="go">[ 42  54  66]</span>
<span class="go">[ 69  90 111]</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>ここでいったんSageを終了してみよう．再起動後に <code class="docutils literal"><span class="pre">A</span></code>  を読み込むには:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">A</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">A</span>
<span class="go">[ 15  18  21]</span>
<span class="go">[ 42  54  66]</span>
<span class="go">[ 69  90 111]</span>
</pre></div>
</div>
<p>楕円曲線のようなもっと複雑なオブジェクトに対しても，以上と同じやり方が通用する．
メモリ上に配置されていたオブジェクト関連の全データは，そのオブジェクトと共に保存される．
例えば</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="s1">&#39;11a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">v</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">anlist</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>              <span class="c1"># ちょっと時間がかかる</span>
<span class="gp">sage: </span><span class="n">save</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">quit</span>
</pre></div>
</div>
<p>こうして保存された <code class="docutils literal"><span class="pre">E</span></code> は，オブジェクト本体と一緒に <span class="math">\(a_n\)</span> の冒頭100000個も保存するため，153Kバイトの大きさになる．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>~/tmp$ ls -l E.sobj
-rw-r--r--  1 was was 153500 2006-01-28 19:23 E.sobj
~/tmp$ sage [...]
sage: E = load(&#39;E&#39;)
sage: v = E.anlist(100000)              # すぐ終了
</pre></div>
</div>
<p>(Python経由の保存と読み込みには， <code class="docutils literal"><span class="pre">cPickle</span></code> モジュールが使われている．
実際，Sageオブジェクト <code class="docutils literal"><span class="pre">x</span></code> の保存は <code class="docutils literal"><span class="pre">cPickle.dumps(x,</span> <span class="pre">2)</span></code> を実行して行なうことができる．引数 <code class="docutils literal"><span class="pre">2</span></code> に注目．)</p>
<p>Sageで保存・読み込みできないのは，GAP， Singular， Maximaなど外部コンピュータ代数システムで作成されたオブジェクトである．
これらは読み込むことができても &#8220;invalid&#8221;(利用不能)な状態にあると認識される．
GAPでは，相当数のオブジェクトが再構成に使える印字形式を持つ一方，再構成できな場合も多いため印字形式からのオブジェクトの再構成は意図的に禁止されている．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">gap</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">The session in which this object was defined is no longer</span>
<span class="go">running.</span>
</pre></div>
</div>
<p>GP/PARIオブジェクトは，印字形式から十分に再構成可能なため，保存と読み込みも可能になっている．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="n">gp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>保存したオブジェクトは，異なるアーキテクチャ上の，異なるオペレーティングシステムで動くSageへもロードすることができる．
例えば，32ビット OSX上で保存した大規模行列を64ビット版LinuxのSageへ読み込み，その階段形式を求めてから元のOS X上へ戻すといったことも可能だ．
さらに，オブジェクトの保存までに使ったのとは違うバージョンのSageでオブジェクトを読み込むこともできる場合が多い．
ただし，これは読み書きしたいオブジェクトに関わるコードがバージョン間で大きくは異ならないことが条件となる．
オブジェクトの保存に際しては，その属性の全てがオブジェクトを定義している(ソースコードではなく)クラスと共に保存される．
そのクラスが新バージョンのSageに存在しない場合，配下のオブジェクトを新バージョンでは読み込むことはできない．
しかし古いバージョンで読み込むことはできるはずだから，(<code class="docutils literal"><span class="pre">x.__dict__</span></code> で)オブジェクト <code class="docutils literal"><span class="pre">x</span></code> のディクショナリを生成して保存しておけば，それを新しいバージョンで読み込むことができることもある．</p>
<div class="section" id="id11">
<h3>テキスト形式で保存する<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>オブジェクトをASCIIテキスト形式で保存しておくこともできる．
手順は，ファイルを書込みモードで開いて，そこに保存すべきオブジェクトの文字列表現を書き込むだけのことだ(このやり方で複数個のオブジェクトを保存することができる)．
オブジェクトの書込みを終えたら，ファイルをクローズすればよい．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="mi">7</span>
<span class="gp">sage: </span><span class="n">o</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="gp">sage: </span><span class="n">o</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="section-save">
<span id="id12"></span><h2>セッション全体の保存と読み込み<a class="headerlink" href="#section-save" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Sageは，セッション全体を保存し再ロードするための非常に柔軟な機能を備えている．</p>
<p>コマンド <code class="docutils literal"><span class="pre">save_session(セッション名)</span></code> は，現セッション中に定義された全ての変数を、コマンドで指定した <code class="docutils literal"><span class="pre">セッション名</span></code> にディクショナリとして保存する．
(保存を想定していない変数がある場合もまれに見られるが，そうした時はディクショナリに保存されずに終るだけだ．)
保存先は <code class="docutils literal"><span class="pre">.sobj</span></code> ファイルとなり，他の保存済みオブジェクトと全く同じように読み込むことができる．
セッション中に保存したオブジェクトを再びロードすると，変数名をキー，オブジェクトを値とするディクショナリが生成されることになる．</p>
<p>実行中のセッションに <code class="docutils literal"><span class="pre">セッション名</span></code> に定義された変数をロードするには， <code class="docutils literal"><span class="pre">load_session(セッション名)</span></code> コマンドを使う．
このコマンドは現セッションとロードされる側のセッション内容を合併するのであって，現セッションで定義した変数が消去されるわけではない．</p>
<p>まずSageを起動し，変数をいくつか定義しておく．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="s1">&#39;11a&#39;</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">M</span> <span class="o">=</span> <span class="n">ModularSymbols</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">389</span>
<span class="gp">sage: </span><span class="n">t</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">2003</span><span class="p">)</span><span class="o">.</span><span class="n">matrix</span><span class="p">();</span> <span class="n">t</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span><span class="o">.</span><span class="n">factor</span><span class="p">()</span>
<span class="go"> _4 = (x - 2004) * (x - 12)^2 * (x + 54)^2</span>
</pre></div>
</div>
<p>次にこのセッションをファイルに保存し，先に定義した変数を残しておく．
<code class="docutils literal"><span class="pre">.sobj</span></code> ファイルを確認すると，その大きさは3Kバイトほどとなっている．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">save_session</span><span class="p">(</span><span class="s1">&#39;misc&#39;</span><span class="p">)</span>
<span class="go">Saving a</span>
<span class="go">Saving M</span>
<span class="go">Saving t</span>
<span class="go">Saving E</span>
<span class="gp">sage: </span><span class="n">quit</span>
<span class="go">was@form:~/tmp$ ls -l misc.sobj</span>
<span class="go">-rw-r--r--  1 was was 2979 2006-01-28 19:47 misc.sobj</span>
</pre></div>
</div>
<p>仕上げにSageを再起動し，変数をいくつか追加定義してから，先に保存したセッションを読み込んでみよう．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">b</span> <span class="o">=</span> <span class="mi">19</span>
<span class="gp">sage: </span><span class="n">load_session</span><span class="p">(</span><span class="s1">&#39;misc&#39;</span><span class="p">)</span>
<span class="go">Loading a</span>
<span class="go">Loading M</span>
<span class="go">Loading E</span>
<span class="go">Loading t</span>
</pre></div>
</div>
<p>保存しておいた変数が再び利用可能になる一方，上で追加した変数 <code class="docutils literal"><span class="pre">b</span></code> は上書きされていないことが分る．</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">M</span>
<span class="go">Full Modular Symbols space for Gamma_0(37) of weight 2 with sign 0</span>
<span class="go">and dimension 5 over Rational Field</span>
<span class="gp">sage: </span><span class="n">E</span>
<span class="go">Elliptic Curve defined by y^2 + y = x^3 - x^2 - 10*x - 20 over Rational</span>
<span class="go">Field</span>
<span class="gp">sage: </span><span class="n">b</span>
<span class="go">19</span>
<span class="gp">sage: </span><span class="n">a</span>
<span class="go">389</span>
</pre></div>
</div>
</div>
<div class="section" id="section-notebook">
<span id="id13"></span><h2>ノートブックインターフェイス<a class="headerlink" href="#section-notebook" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Sageノートブックを起動するには、Sageコマンドライン上で</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">notebook</span><span class="p">()</span>
</pre></div>
</div>
<p>と実行する．
これでSageノートブックが起動すると同時に，閲覧用のデフォルトWebブラウザが開かれる．
ノートブックサーバが使用する状態ファイル群は， <code class="docutils literal"><span class="pre">$HOME/.sage/sage\_notebook</span></code> に保存される．</p>
<p>起動時に指定できるオプションとして</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">sage: </span><span class="n">notebook</span><span class="p">(</span><span class="s2">&quot;ディレクトリ名&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>とすると，標準ディレクトリ <code class="docutils literal"><span class="pre">$HOME/.sage/sage_notebook</span></code> ではなく指定した <code class="docutils literal"><span class="pre">ディレクトリ名</span></code> のディレクトリにある状態ファイル群を使って新しくノートブックサーバを起動する．
このオプションは，特定のプロジェクトに多数のワークシート群がぶら下がっていたり，同時に複数のノートブックサーバを動かしたい場合に便利だ．</p>
<p>ノートブックを起動すると、まず <code class="docutils literal"><span class="pre">$HOME/.sage/sage_notebook</span></code> 内に以下のようなファイル群が生成される:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">sobj</span>       <span class="p">(</span><span class="n">ノートブックSAGEオブジェクト</span> <span class="n">ファイル</span><span class="p">)</span>
<span class="n">objects</span><span class="o">/</span>      <span class="p">(</span><span class="n">SAGEオブジェクト群を保管するディレクトリ</span><span class="p">)</span>
<span class="n">worksheets</span><span class="o">/</span>   <span class="p">(</span><span class="n">SAGEワークシートを保管するディレクトリ</span><span class="p">)</span>
</pre></div>
</div>
<p>上のファイル群の作成後，ノートブックはWebサーバの起動を行なう．</p>
<p>「ノートブック」(notebook)とはユーザーアカウントの集合であって，各ノートブックにはワークシートを好きな数だけ保持することができる．
ワークシートを新規に作成すると，そのワークシートを定義するデータが <code class="docutils literal"><span class="pre">worksheets/username/number</span></code> ディレクトリに保存される．
これらのディレクトリに必ず出来ているのがファイル <code class="docutils literal"><span class="pre">worksheet.txt</span></code> である．
このプレーンテキストからなるファイルには，ワークシートやSageその他に何によらず変更が加えられた場合，元のワークシートを復元するために必要な全情報が可読形式で保存されている．</p>
<p>Sage上で <code class="docutils literal"><span class="pre">notebook?</span></code> と入力すると，ノートブックサーバを起動する方法に関する詳しい情報が得られる．</p>
<p>次の図を見ると，Sageノートブックの構造が分る:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----------------------</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>   <span class="n">firefox</span><span class="o">/</span><span class="n">safari</span>   <span class="o">|</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>     <span class="n">javascript</span>     <span class="o">|</span>
<span class="o">|</span>      <span class="n">program</span>       <span class="o">|</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">----------------------</span>
      <span class="o">|</span>      <span class="o">^</span>
      <span class="o">|</span> <span class="n">AJAX</span> <span class="o">|</span>
      <span class="n">V</span>      <span class="o">|</span>
<span class="o">----------------------</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>       <span class="n">sage</span>         <span class="o">|</span>                <span class="n">SAGE</span> <span class="n">process</span> <span class="mi">1</span>
<span class="o">|</span>       <span class="n">web</span>          <span class="o">|</span> <span class="o">------------&gt;</span>  <span class="n">SAGE</span> <span class="n">process</span> <span class="mi">2</span>    <span class="p">(</span><span class="n">Python</span> <span class="n">processes</span><span class="p">)</span>
<span class="o">|</span>      <span class="n">server</span>        <span class="o">|</span>   <span class="n">pexpect</span>      <span class="n">SAGE</span> <span class="n">process</span> <span class="mi">3</span>
<span class="o">|</span>                    <span class="o">|</span>                    <span class="o">.</span>
<span class="o">|</span>                    <span class="o">|</span>                    <span class="o">.</span>
<span class="o">----------------------</span>                    <span class="o">.</span>
</pre></div>
</div>
<p>ノートブックからSageコマンド  <code class="docutils literal"><span class="pre">コマンド名</span></code> のヘルプを見たければ，ブラウザ表示画面内入力ボックスで <code class="docutils literal"><span class="pre">コマンド名?</span></code> と入力し， <code class="docutils literal"><span class="pre">&lt;esc&gt;</span></code> を押せばよい(<code class="docutils literal"><span class="pre">&lt;shift-enter&gt;</span></code> ではない)．</p>
<p>ノートブック上で通用するキーボードショートカットを確認するには， <code class="docutils literal"><span class="pre">Help</span></code> リンクをクリックする．</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">目次</a></h3>
            <ul>
<li><a class="reference internal" href="#">対話型シェル</a><ul>
<li><a class="reference internal" href="#sage">Sageセッション</a></li>
<li><a class="reference internal" href="#id2">入出力のログをとる</a></li>
<li><a class="reference internal" href="#id3">プロンプト記号はペースト時に無視される</a></li>
<li><a class="reference internal" href="#id4">計時コマンド</a></li>
<li><a class="reference internal" href="#ipython">IPythonトリック</a></li>
<li><a class="reference internal" href="#id6">エラーと例外処理</a></li>
<li><a class="reference internal" href="#section-tabcompletion">コマンド入力の遡行検索とタブ補完</a></li>
<li><a class="reference internal" href="#id9">統合ヘルプシステム</a></li>
<li><a class="reference internal" href="#id10">オブジェクトの保存と読み込み</a><ul>
<li><a class="reference internal" href="#id11">テキスト形式で保存する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-save">セッション全体の保存と読み込み</a></li>
<li><a class="reference internal" href="#section-notebook">ノートブックインターフェイス</a></li>
</ul>
</li>
</ul>

            <h4>前のトピックへ</h4>
            <p class="topless"><a href="tour_advanced.html"
                                  title="前の章へ">より進んだ数学</a></p>
            <h4>次のトピックへ</h4>
            <p class="topless"><a href="interfaces.html"
                                  title="次の章へ">インターフェイスについて</a></p>
            <h3>このページ</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/interactive_shell.txt"
                     rel="nofollow">ソースコードを表示</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>クイック検索</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="検索" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="interfaces.html" title="インターフェイスについて"
             >次へ</a> |</li>
        <li class="right" >
          <a href="tour_advanced.html" title="より進んだ数学"
             >前へ</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li class="nav-item nav-item-0"><a href="index.html">Sage チュートリアル v7.3</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer" role="contentinfo">
        &copy; Copyright 2005--2016, The Sage Development Team.
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4 で生成しました。
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>